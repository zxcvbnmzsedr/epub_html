
        <html lang="en">
        <head>
        <meta charset="UTF-8"/>
        </head>
        <body>
        <div><div class="markdown-body">
    <h1>&#12300;&#28304;&#30721;&#35299;&#35835;&#12301;&#26381;&#21153;&#23548;&#20986;</h1><div class="lake-content" typography="classic">
 <div class="ne-quote">
  <p class="ne-p" id="u835c1f5d">
   <span class="ne-text">
    &#21407;&#25991;&#22320;&#22336;&#65306;
   </span>
   <a class="ne-link" data-href="https://dubbo.apache.org/zh/docsv2.7/dev/source/export-service/" href="https://dubbo.apache.org/zh/docsv2.7/dev/source/export-service/" target="_blank">
    <span class="ne-text">
     https://dubbo.apache.org/zh/docsv2.7/dev/source/export-service/
    </span>
   </a>
  </p>
  <p class="ne-p" id="u3bf3179a">
   <span class="ne-text">
   </span>
  </p>
  <p class="ne-p" id="u158fd504">
   <span class="ne-text">
    &#20316;&#32773;&#65306; Dubbo &#23448;&#26041;
   </span>
  </p>
 </div>
 <p class="ne-p" id="u6c8e1a2d">
  <br>
 </p>
 <p class="ne-p" id="uadf88eb0">
  <span class="ne-text">
   &#26412;&#25991;&#20171;&#32461;&#20102; Dubbo &#26381;&#21153;&#23548;&#20986;&#30340;&#36807;&#31243;&#21644;&#23454;&#29616;&#32454;&#33410;
  </span>
 </p>
 <p class="ne-p" id="u381c4957">
  <br>
 </p>
 <h2 id="8814759b">
  <span class="ne-text">
   1.&#31616;&#20171;
  </span>
 </h2>
 <p class="ne-p" id="uf94c7896">
  <br>
 </p>
 <p class="ne-p" id="ufaab2d62">
  <span class="ne-text">
   &#26412;&#31687;&#25991;&#31456;&#65292;&#25105;&#20204;&#26469;&#30740;&#31350;&#19968;&#19979; Dubbo &#23548;&#20986;&#26381;&#21153;&#30340;&#36807;&#31243;&#12290;Dubbo &#26381;&#21153;&#23548;&#20986;&#36807;&#31243;&#22987;&#20110; Spring &#23481;&#22120;&#21457;&#24067;&#21047;&#26032;&#20107;&#20214;&#65292;Dubbo &#22312;&#25509;&#25910;&#21040;&#20107;&#20214;&#21518;&#65292;&#20250;&#31435;&#21363;&#25191;&#34892;&#26381;&#21153;&#23548;&#20986;&#36923;&#36753;&#12290;&#25972;&#20010;&#36923;&#36753;&#22823;&#33268;&#21487;&#20998;&#20026;&#19977;&#20010;&#37096;&#20998;&#65292;&#31532;&#19968;&#37096;&#20998;&#26159;&#21069;&#32622;&#24037;&#20316;&#65292;&#20027;&#35201;&#29992;&#20110;&#26816;&#26597;&#21442;&#25968;&#65292;&#32452;&#35013; URL&#12290;&#31532;&#20108;&#37096;&#20998;&#26159;&#23548;&#20986;&#26381;&#21153;&#65292;&#21253;&#21547;&#23548;&#20986;&#26381;&#21153;&#21040;&#26412;&#22320; (JVM)&#65292;&#21644;&#23548;&#20986;&#26381;&#21153;&#21040;&#36828;&#31243;&#20004;&#20010;&#36807;&#31243;&#12290;&#31532;&#19977;&#37096;&#20998;&#26159;&#21521;&#27880;&#20876;&#20013;&#24515;&#27880;&#20876;&#26381;&#21153;&#65292;&#29992;&#20110;&#26381;&#21153;&#21457;&#29616;&#12290;&#26412;&#31687;&#25991;&#31456;&#23558;&#20250;&#23545;&#36825;&#19977;&#20010;&#37096;&#20998;&#20195;&#30721;&#36827;&#34892;&#35814;&#32454;&#30340;&#20998;&#26512;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u208d3e67">
  <br>
 </p>
 <h2 id="4bb2d8a9">
  <span class="ne-text">
   2.&#28304;&#30721;&#20998;&#26512;
  </span>
 </h2>
 <p class="ne-p" id="uc3170d1d">
  <br>
 </p>
 <p class="ne-p" id="u6d542206">
  <span class="ne-text">
   &#26381;&#21153;&#23548;&#20986;&#30340;&#20837;&#21475;&#26041;&#27861;&#26159; ServiceBean &#30340; onApplicationEvent&#12290;onApplicationEvent &#26159;&#19968;&#20010;&#20107;&#20214;&#21709;&#24212;&#26041;&#27861;&#65292;&#35813;&#26041;&#27861;&#20250;&#22312;&#25910;&#21040; Spring &#19978;&#19979;&#25991;&#21047;&#26032;&#20107;&#20214;&#21518;&#25191;&#34892;&#26381;&#21153;&#23548;&#20986;&#25805;&#20316;&#12290;&#26041;&#27861;&#20195;&#30721;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u6356191e">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="ca5da6d0">public void onApplicationEvent(ContextRefreshedEvent event) {
    // &#26159;&#21542;&#26377;&#24310;&#36831;&#23548;&#20986; &amp;&amp; &#26159;&#21542;&#24050;&#23548;&#20986; &amp;&amp; &#26159;&#19981;&#26159;&#24050;&#34987;&#21462;&#28040;&#23548;&#20986;
    if (isDelay() &amp;&amp; !isExported() &amp;&amp; !isUnexported()) {
        // &#23548;&#20986;&#26381;&#21153;
        export();
    }
}</pre>
 <p class="ne-p" id="ua309809d">
  <br>
 </p>
 <p class="ne-p" id="u6fa9ccf9">
  <span class="ne-text">
   &#36825;&#20010;&#26041;&#27861;&#39318;&#20808;&#20250;&#26681;&#25454;&#26465;&#20214;&#20915;&#23450;&#26159;&#21542;&#23548;&#20986;&#26381;&#21153;&#65292;&#27604;&#22914;&#26377;&#20123;&#26381;&#21153;&#35774;&#32622;&#20102;&#24310;&#26102;&#23548;&#20986;&#65292;&#37027;&#20040;&#27492;&#26102;&#23601;&#19981;&#24212;&#35813;&#22312;&#27492;&#22788;&#23548;&#20986;&#12290;&#36824;&#26377;&#19968;&#20123;&#26381;&#21153;&#24050;&#32463;&#34987;&#23548;&#20986;&#20102;&#65292;&#25110;&#32773;&#24403;&#21069;&#26381;&#21153;&#34987;&#21462;&#28040;&#23548;&#20986;&#20102;&#65292;&#27492;&#26102;&#20063;&#19981;&#33021;&#20877;&#27425;&#23548;&#20986;&#30456;&#20851;&#26381;&#21153;&#12290;&#27880;&#24847;&#36825;&#37324;&#30340; isDelay &#26041;&#27861;&#65292;&#36825;&#20010;&#26041;&#27861;&#23383;&#38754;&#24847;&#24605;&#26159;&#8220;&#26159;&#21542;&#24310;&#36831;&#23548;&#20986;&#26381;&#21153;&#8221;&#65292;&#36820;&#22238; true &#34920;&#31034;&#24310;&#36831;&#23548;&#20986;&#65292;false &#34920;&#31034;&#19981;&#24310;&#36831;&#23548;&#20986;&#12290;&#20294;&#26159;&#35813;&#26041;&#27861;&#30495;&#23454;&#24847;&#24605;&#21364;&#24182;&#38750;&#22914;&#27492;&#65292;&#24403;&#26041;&#27861;&#36820;&#22238; true &#26102;&#65292;&#34920;&#31034;&#26080;&#38656;&#24310;&#36831;&#23548;&#20986;&#12290;&#36820;&#22238; false &#26102;&#65292;&#34920;&#31034;&#38656;&#35201;&#24310;&#36831;&#23548;&#20986;&#12290;&#19982;&#23383;&#38754;&#24847;&#24605;&#24688;&#24688;&#30456;&#21453;&#65292;&#36825;&#20010;&#38656;&#35201;&#22823;&#23478;&#27880;&#24847;&#19968;&#19979;&#12290;&#19979;&#38754;&#25105;&#20204;&#26469;&#30475;&#19968;&#19979;&#36825;&#20010;&#26041;&#27861;&#30340;&#36923;&#36753;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u8fe46a57">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="a6f994ea">// -&#9734;- ServiceBean
private boolean isDelay() {
    // &#33719;&#21462; delay
    Integer delay = getDelay();
    ProviderConfig provider = getProvider();
    if (delay == null &amp;&amp; provider != null) {
        // &#22914;&#26524;&#21069;&#38754;&#33719;&#21462;&#30340; delay &#20026;&#31354;&#65292;&#36825;&#37324;&#32487;&#32493;&#33719;&#21462;
        delay = provider.getDelay();
    }
    // &#21028;&#26029; delay &#26159;&#21542;&#20026;&#31354;&#65292;&#25110;&#32773;&#31561;&#20110; -1
    return supportedApplicationListener &amp;&amp; (delay == null || delay == -1);
}</pre>
 <p class="ne-p" id="u167806a8">
  <br>
 </p>
 <p class="ne-p" id="u601ca479">
  <span class="ne-text">
   &#26242;&#26102;&#24573;&#30053; supportedApplicationListener &#36825;&#20010;&#26465;&#20214;&#65292;&#24403; delay &#20026;&#31354;&#65292;&#25110;&#32773;&#31561;&#20110;-1&#26102;&#65292;&#35813;&#26041;&#27861;&#36820;&#22238; true&#65292;&#32780;&#19981;&#26159; false&#12290;&#36825;&#20010;&#26041;&#27861;&#30340;&#36820;&#22238;&#20540;&#35753;&#20154;&#26377;&#28857;&#22256;&#24785;&#12290;&#35813;&#26041;&#27861;&#30446;&#21069;&#24050;&#34987;&#37325;&#26500;&#65292;&#35814;&#32454;&#35831;&#21442;&#32771;
  </span>
  <a class="ne-link" data-href="https://github.com/apache/dubbo/pull/2686" href="https://github.com/apache/dubbo/pull/2686" target="_blank">
   <span class="ne-text">
    dubbo #2686
   </span>
  </a>
  <span class="ne-text">
   &#12290;
  </span>
 </p>
 <p class="ne-p" id="ue71d556f">
  <br>
 </p>
 <p class="ne-p" id="ue7588fef">
  <span class="ne-text">
   &#29616;&#22312;&#35299;&#37322;&#19968;&#19979; supportedApplicationListener &#21464;&#37327;&#21547;&#20041;&#65292;&#35813;&#21464;&#37327;&#29992;&#20110;&#34920;&#31034;&#24403;&#21069;&#30340; Spring &#23481;&#22120;&#26159;&#21542;&#25903;&#25345; ApplicationListener&#65292;&#36825;&#20010;&#20540;&#21021;&#22987;&#20026; false&#12290;&#22312; Spring &#23481;&#22120;&#23558;&#33258;&#24049;&#35774;&#32622;&#21040; ServiceBean &#20013;&#26102;&#65292;ServiceBean &#30340; setApplicationContext &#26041;&#27861;&#20250;&#26816;&#27979; Spring &#23481;&#22120;&#26159;&#21542;&#25903;&#25345; ApplicationListener&#12290;&#33509;&#25903;&#25345;&#65292;&#21017;&#23558; supportedApplicationListener &#32622;&#20026; true&#12290;ServiceBean &#26159; Dubbo &#19982; Spring &#26694;&#26550;&#36827;&#34892;&#25972;&#21512;&#30340;&#20851;&#38190;&#65292;&#21487;&#20197;&#30475;&#20570;&#26159;&#20004;&#20010;&#26694;&#26550;&#20043;&#38388;&#30340;&#26725;&#26753;&#12290;&#20855;&#26377;&#21516;&#26679;&#20316;&#29992;&#30340;&#31867;&#36824;&#26377; ReferenceBean&#12290;
  </span>
 </p>
 <p class="ne-p" id="ueb28fedf">
  <br>
 </p>
 <p class="ne-p" id="u24cfd695">
  <span class="ne-text">
   &#29616;&#22312;&#25105;&#20204;&#30693;&#36947;&#20102; Dubbo &#26381;&#21153;&#23548;&#20986;&#36807;&#31243;&#30340;&#36215;&#28857;&#65292;&#25509;&#19979;&#26469;&#23545;&#26381;&#21153;&#23548;&#20986;&#30340;&#21069;&#32622;&#36923;&#36753;&#36827;&#34892;&#20998;&#26512;&#12290;
  </span>
 </p>
 <p class="ne-p" id="udad7007c">
  <br>
 </p>
 <h3 id="189c26f6">
  <span class="ne-text">
   2.1 &#21069;&#32622;&#24037;&#20316;
  </span>
 </h3>
 <p class="ne-p" id="uf598643a">
  <br>
 </p>
 <p class="ne-p" id="u709d0524">
  <span class="ne-text">
   &#21069;&#32622;&#24037;&#20316;&#20027;&#35201;&#21253;&#21547;&#20004;&#20010;&#37096;&#20998;&#65292;&#20998;&#21035;&#26159;&#37197;&#32622;&#26816;&#26597;&#65292;&#20197;&#21450; URL &#35013;&#37197;&#12290;&#22312;&#23548;&#20986;&#26381;&#21153;&#20043;&#21069;&#65292;Dubbo &#38656;&#35201;&#26816;&#26597;&#29992;&#25143;&#30340;&#37197;&#32622;&#26159;&#21542;&#21512;&#29702;&#65292;&#25110;&#32773;&#20026;&#29992;&#25143;&#34917;&#20805;&#32570;&#30465;&#37197;&#32622;&#12290;&#37197;&#32622;&#26816;&#26597;&#23436;&#25104;&#21518;&#65292;&#25509;&#19979;&#26469;&#38656;&#35201;&#26681;&#25454;&#36825;&#20123;&#37197;&#32622;&#32452;&#35013; URL&#12290;&#22312; Dubbo &#20013;&#65292;URL &#30340;&#20316;&#29992;&#21313;&#20998;&#37325;&#35201;&#12290;Dubbo &#20351;&#29992; URL &#20316;&#20026;&#37197;&#32622;&#36733;&#20307;&#65292;&#25152;&#26377;&#30340;&#25299;&#23637;&#28857;&#37117;&#26159;&#36890;&#36807; URL &#33719;&#21462;&#37197;&#32622;&#12290;&#36825;&#19968;&#28857;&#65292;&#23448;&#26041;&#25991;&#26723;&#20013;&#26377;&#25152;&#35828;&#26126;&#12290;
  </span>
 </p>
 <p class="ne-p" id="ud33b7b66">
  <br>
 </p>
 <div class="ne-quote">
  <p class="ne-p" id="u2d7006ac">
   <span class="ne-text">
    &#37319;&#29992; URL &#20316;&#20026;&#37197;&#32622;&#20449;&#24687;&#30340;&#32479;&#19968;&#26684;&#24335;&#65292;&#25152;&#26377;&#25193;&#23637;&#28857;&#37117;&#36890;&#36807;&#20256;&#36882; URL &#25658;&#24102;&#37197;&#32622;&#20449;&#24687;&#12290;
   </span>
  </p>
 </div>
 <p class="ne-p" id="u0496dbc2">
  <br>
 </p>
 <p class="ne-p" id="u26294df9">
  <span class="ne-text">
   &#25509;&#19979;&#26469;&#65292;&#25105;&#20204;&#20808;&#26469;&#20998;&#26512;&#37197;&#32622;&#26816;&#26597;&#37096;&#20998;&#30340;&#28304;&#30721;&#65292;&#38543;&#21518;&#20877;&#26469;&#20998;&#26512; URL &#32452;&#35013;&#37096;&#20998;&#30340;&#28304;&#30721;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u4894e20e">
  <br>
 </p>
 <h4 id="9603da9a">
  <span class="ne-text">
   2.1.1 &#26816;&#26597;&#37197;&#32622;
  </span>
 </h4>
 <p class="ne-p" id="ucf960762">
  <br>
 </p>
 <p class="ne-p" id="u5ad3aad6">
  <span class="ne-text">
   &#26412;&#33410;&#25105;&#20204;&#25509;&#30528;&#21069;&#38754;&#30340;&#28304;&#30721;&#21521;&#19979;&#20998;&#26512;&#65292;&#21069;&#38754;&#35828;&#36807; onApplicationEvent &#26041;&#27861;&#22312;&#32463;&#36807;&#19968;&#20123;&#21028;&#26029;&#21518;&#65292;&#20250;&#20915;&#23450;&#26159;&#21542;&#35843;&#29992; export &#26041;&#27861;&#23548;&#20986;&#26381;&#21153;&#12290;&#37027;&#20040;&#19979;&#38754;&#25105;&#20204;&#20174; export &#26041;&#27861;&#24320;&#22987;&#36827;&#34892;&#20998;&#26512;&#65292;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u430a1387">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="d7e3708b">public synchronized void export() {
    if (provider != null) {
        // &#33719;&#21462; export &#21644; delay &#37197;&#32622;
        if (export == null) {
            export = provider.getExport();
        }
        if (delay == null) {
            delay = provider.getDelay();
        }
    }
    // &#22914;&#26524; export &#20026; false&#65292;&#21017;&#19981;&#23548;&#20986;&#26381;&#21153;
    if (export != null &amp;&amp; !export) {
        return;
    }

    // delay &gt; 0&#65292;&#24310;&#26102;&#23548;&#20986;&#26381;&#21153;
    if (delay != null &amp;&amp; delay &gt; 0) {
        delayExportExecutor.schedule(new Runnable() {
            @Override
            public void run() {
                doExport();
            }
        }, delay, TimeUnit.MILLISECONDS);
        
    // &#31435;&#21363;&#23548;&#20986;&#26381;&#21153;
    } else {
        doExport();
    }
}</pre>
 <p class="ne-p" id="uaa1384e6">
  <br>
 </p>
 <p class="ne-p" id="u231e4b6e">
  <span class="ne-text">
   export &#26041;&#27861;&#23545;&#20004;&#39033;&#37197;&#32622;&#36827;&#34892;&#20102;&#26816;&#26597;&#65292;&#24182;&#26681;&#25454;&#37197;&#32622;&#25191;&#34892;&#30456;&#24212;&#30340;&#21160;&#20316;&#12290;&#39318;&#20808;&#26159; export &#37197;&#32622;&#65292;&#36825;&#20010;&#37197;&#32622;&#20915;&#23450;&#20102;&#26159;&#21542;&#23548;&#20986;&#26381;&#21153;&#12290;&#26377;&#26102;&#20505;&#25105;&#20204;&#21482;&#26159;&#24819;&#26412;&#22320;&#21551;&#21160;&#26381;&#21153;&#36827;&#34892;&#19968;&#20123;&#35843;&#35797;&#24037;&#20316;&#65292;&#25105;&#20204;&#24182;&#19981;&#24076;&#26395;&#25226;&#26412;&#22320;&#21551;&#21160;&#30340;&#26381;&#21153;&#26292;&#38706;&#20986;&#21435;&#32473;&#21035;&#20154;&#35843;&#29992;&#12290;&#27492;&#26102;&#65292;&#25105;&#20204;&#21487;&#36890;&#36807;&#37197;&#32622; export &#31105;&#27490;&#26381;&#21153;&#23548;&#20986;&#65292;&#27604;&#22914;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u64da9ae4">
  <br>
 </p>
 <pre class="ne-codeblock language-xml" data-language="xml" id="0fff27b3">&lt;dubbo:provider export="false" /&gt;</pre>
 <p class="ne-p" id="u8137634f">
  <br>
 </p>
 <p class="ne-p" id="uf07c8291">
  <span class="ne-text">
   delay &#37197;&#32622;&#39038;&#21517;&#24605;&#20041;&#65292;&#29992;&#20110;&#24310;&#36831;&#23548;&#20986;&#26381;&#21153;&#65292;&#36825;&#20010;&#23601;&#19981;&#20998;&#26512;&#20102;&#12290;&#19979;&#38754;&#65292;&#25105;&#20204;&#32487;&#32493;&#20998;&#26512;&#28304;&#30721;&#65292;&#36825;&#27425;&#35201;&#20998;&#26512;&#30340;&#26159; doExport &#26041;&#27861;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u36e3fcca">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="194ad5b5">protected synchronized void doExport() {
    if (unexported) {
        throw new IllegalStateException("Already unexported!");
    }
    if (exported) {
        return;
    }
    exported = true;
    // &#26816;&#27979; interfaceName &#26159;&#21542;&#21512;&#27861;
    if (interfaceName == null || interfaceName.length() == 0) {
        throw new IllegalStateException("interface not allow null!");
    }
    // &#26816;&#27979; provider &#26159;&#21542;&#20026;&#31354;&#65292;&#20026;&#31354;&#21017;&#26032;&#24314;&#19968;&#20010;&#65292;&#24182;&#36890;&#36807;&#31995;&#32479;&#21464;&#37327;&#20026;&#20854;&#21021;&#22987;&#21270;
    checkDefault();

    // &#19979;&#38754;&#20960;&#20010; if &#35821;&#21477;&#29992;&#20110;&#26816;&#27979; provider&#12289;application &#31561;&#26680;&#24515;&#37197;&#32622;&#31867;&#23545;&#35937;&#26159;&#21542;&#20026;&#31354;&#65292;
    // &#33509;&#20026;&#31354;&#65292;&#21017;&#23581;&#35797;&#20174;&#20854;&#20182;&#37197;&#32622;&#31867;&#23545;&#35937;&#20013;&#33719;&#21462;&#30456;&#24212;&#30340;&#23454;&#20363;&#12290;
    if (provider != null) {
        if (application == null) {
            application = provider.getApplication();
        }
        if (module == null) {
            module = provider.getModule();
        }
        if (registries == null) {...}
        if (monitor == null) {...}
        if (protocols == null) {...}
    }
    if (module != null) {
        if (registries == null) {
            registries = module.getRegistries();
        }
        if (monitor == null) {...}
    }
    if (application != null) {
        if (registries == null) {
            registries = application.getRegistries();
        }
        if (monitor == null) {...}
    }

    // &#26816;&#27979; ref &#26159;&#21542;&#20026;&#27867;&#21270;&#26381;&#21153;&#31867;&#22411;
    if (ref instanceof GenericService) {
        // &#35774;&#32622; interfaceClass &#20026; GenericService.class
        interfaceClass = GenericService.class;
        if (StringUtils.isEmpty(generic)) {
            // &#35774;&#32622; generic = "true"
            generic = Boolean.TRUE.toString();
        }
        
    // ref &#38750; GenericService &#31867;&#22411;
    } else {
        try {
            interfaceClass = Class.forName(interfaceName, true, Thread.currentThread()
                    .getContextClassLoader());
        } catch (ClassNotFoundException e) {
            throw new IllegalStateException(e.getMessage(), e);
        }
        // &#23545; interfaceClass&#65292;&#20197;&#21450; &lt;dubbo:method&gt; &#26631;&#31614;&#20013;&#30340;&#24517;&#35201;&#23383;&#27573;&#36827;&#34892;&#26816;&#26597;
        checkInterfaceAndMethods(interfaceClass, methods);
        // &#23545; ref &#21512;&#27861;&#24615;&#36827;&#34892;&#26816;&#27979;
        checkRef();
        // &#35774;&#32622; generic = "false"
        generic = Boolean.FALSE.toString();
    }

    // local &#21644; stub &#22312;&#21151;&#33021;&#24212;&#35813;&#26159;&#19968;&#33268;&#30340;&#65292;&#29992;&#20110;&#37197;&#32622;&#26412;&#22320;&#23384;&#26681;
    if (local != null) {
        if ("true".equals(local)) {
            local = interfaceName + "Local";
        }
        Class&lt;?&gt; localClass;
        try {
            // &#33719;&#21462;&#26412;&#22320;&#23384;&#26681;&#31867;
            localClass = ClassHelper.forNameWithThreadContextClassLoader(local);
        } catch (ClassNotFoundException e) {
            throw new IllegalStateException(e.getMessage(), e);
        }
        // &#26816;&#27979;&#26412;&#22320;&#23384;&#26681;&#31867;&#26159;&#21542;&#21487;&#36171;&#20540;&#32473;&#25509;&#21475;&#31867;&#65292;&#33509;&#19981;&#21487;&#36171;&#20540;&#21017;&#20250;&#25243;&#20986;&#24322;&#24120;&#65292;&#25552;&#37266;&#20351;&#29992;&#32773;&#26412;&#22320;&#23384;&#26681;&#31867;&#31867;&#22411;&#19981;&#21512;&#27861;
        if (!interfaceClass.isAssignableFrom(localClass)) {
            throw new IllegalStateException("The local implementation class " + localClass.getName() + " not implement interface " + interfaceName);
        }
    }

    if (stub != null) {
        // &#27492;&#22788;&#30340;&#20195;&#30721;&#21644;&#19978;&#19968;&#20010; if &#20998;&#25903;&#30340;&#20195;&#30721;&#22522;&#26412;&#19968;&#33268;&#65292;&#36825;&#37324;&#30465;&#30053;
    }

    // &#26816;&#27979;&#21508;&#31181;&#23545;&#35937;&#26159;&#21542;&#20026;&#31354;&#65292;&#20026;&#31354;&#21017;&#26032;&#24314;&#65292;&#25110;&#32773;&#25243;&#20986;&#24322;&#24120;
    checkApplication();
    checkRegistry();
    checkProtocol();
    appendProperties(this);
    checkStubAndMock(interfaceClass);
    if (path == null || path.length() == 0) {
        path = interfaceName;
    }

    // &#23548;&#20986;&#26381;&#21153;
    doExportUrls();

    // ProviderModel &#34920;&#31034;&#26381;&#21153;&#25552;&#20379;&#32773;&#27169;&#22411;&#65292;&#27492;&#23545;&#35937;&#20013;&#23384;&#20648;&#20102;&#19982;&#26381;&#21153;&#25552;&#20379;&#32773;&#30456;&#20851;&#30340;&#20449;&#24687;&#12290;
    // &#27604;&#22914;&#26381;&#21153;&#30340;&#37197;&#32622;&#20449;&#24687;&#65292;&#26381;&#21153;&#23454;&#20363;&#31561;&#12290;&#27599;&#20010;&#34987;&#23548;&#20986;&#30340;&#26381;&#21153;&#23545;&#24212;&#19968;&#20010; ProviderModel&#12290;
    // ApplicationModel &#25345;&#26377;&#25152;&#26377;&#30340; ProviderModel&#12290;
    ProviderModel providerModel = new ProviderModel(getUniqueServiceName(), this, ref);
    ApplicationModel.initProviderModel(getUniqueServiceName(), providerModel);
}</pre>
 <p class="ne-p" id="u87e7270b">
  <br>
 </p>
 <p class="ne-p" id="uc9efe3aa">
  <span class="ne-text">
   &#20197;&#19978;&#23601;&#26159;&#37197;&#32622;&#26816;&#26597;&#30340;&#30456;&#20851;&#20998;&#26512;&#65292;&#20195;&#30721;&#27604;&#36739;&#22810;&#65292;&#38656;&#35201;&#22823;&#23478;&#32784;&#24515;&#30475;&#19968;&#19979;&#12290;&#19979;&#38754;&#23545;&#37197;&#32622;&#26816;&#26597;&#30340;&#36923;&#36753;&#36827;&#34892;&#31616;&#21333;&#30340;&#24635;&#32467;&#65292;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u8ec227e4">
  <br>
 </p>
 <ol class="ne-ol">
  <li id="u15470b04">
   <span class="ne-text">
    &#26816;&#27979;
   </span>
   <span class="ne-text">
    dubbo:service
   </span>
   <span class="ne-text">
    &#26631;&#31614;&#30340; interface &#23646;&#24615;&#21512;&#27861;&#24615;&#65292;&#19981;&#21512;&#27861;&#21017;&#25243;&#20986;&#24322;&#24120;
   </span>
  </li>
  <li id="u0c0444ea">
   <span class="ne-text">
    &#26816;&#27979; ProviderConfig&#12289;ApplicationConfig &#31561;&#26680;&#24515;&#37197;&#32622;&#31867;&#23545;&#35937;&#26159;&#21542;&#20026;&#31354;&#65292;&#33509;&#20026;&#31354;&#65292;&#21017;&#23581;&#35797;&#20174;&#20854;&#20182;&#37197;&#32622;&#31867;&#23545;&#35937;&#20013;&#33719;&#21462;&#30456;&#24212;&#30340;&#23454;&#20363;&#12290;
   </span>
  </li>
 </ol>
 <ol class="ne-ol" start="3">
  <li id="ub282b868">
   <span class="ne-text">
    &#26816;&#27979;&#24182;&#22788;&#29702;&#27867;&#21270;&#26381;&#21153;&#21644;&#26222;&#36890;&#26381;&#21153;&#31867;
   </span>
  </li>
  <li id="ue669c57c">
   <span class="ne-text">
    &#26816;&#27979;&#26412;&#22320;&#23384;&#26681;&#37197;&#32622;&#65292;&#24182;&#36827;&#34892;&#30456;&#24212;&#30340;&#22788;&#29702;
   </span>
  </li>
 </ol>
 <ol class="ne-ol" start="5">
  <li id="ue2f69c0b">
   <span class="ne-text">
    &#23545; ApplicationConfig&#12289;RegistryConfig &#31561;&#37197;&#32622;&#31867;&#36827;&#34892;&#26816;&#27979;&#65292;&#20026;&#31354;&#21017;&#23581;&#35797;&#21019;&#24314;&#65292;&#33509;&#26080;&#27861;&#21019;&#24314;&#21017;&#25243;&#20986;&#24322;&#24120;
   </span>
  </li>
 </ol>
 <p class="ne-p" id="u184031a7">
  <br>
 </p>
 <p class="ne-p" id="u1456589a">
  <span class="ne-text">
   &#37197;&#32622;&#26816;&#26597;&#24182;&#38750;&#26412;&#25991;&#37325;&#28857;&#65292;&#22240;&#27492;&#36825;&#37324;&#19981;&#25171;&#31639;&#23545; doExport &#26041;&#27861;&#25152;&#35843;&#29992;&#30340;&#26041;&#27861;&#36827;&#34892;&#20998;&#26512;&#65288;doExportUrls &#26041;&#27861;&#38500;&#22806;&#65289;&#12290;&#22312;&#36825;&#20123;&#26041;&#27861;&#20013;&#65292;&#38500;&#20102; appendProperties &#26041;&#27861;&#31245;&#24494;&#22797;&#26434;&#19968;&#20123;&#65292;&#20854;&#20182;&#26041;&#27861;&#36923;&#36753;&#19981;&#26159;&#24456;&#22797;&#26434;&#12290;&#22240;&#27492;&#65292;&#22823;&#23478;&#21487;&#33258;&#34892;&#20998;&#26512;&#12290;
  </span>
 </p>
 <p class="ne-p" id="ua7a4d99b">
  <br>
 </p>
 <h4 id="e3ae0146">
  <span class="ne-text">
   2.1.2 &#22810;&#21327;&#35758;&#22810;&#27880;&#20876;&#20013;&#24515;&#23548;&#20986;&#26381;&#21153;
  </span>
 </h4>
 <p class="ne-p" id="u80d857fc">
  <br>
 </p>
 <p class="ne-p" id="u8a9d218c">
  <span class="ne-text">
   Dubbo &#20801;&#35768;&#25105;&#20204;&#20351;&#29992;&#19981;&#21516;&#30340;&#21327;&#35758;&#23548;&#20986;&#26381;&#21153;&#65292;&#20063;&#20801;&#35768;&#25105;&#20204;&#21521;&#22810;&#20010;&#27880;&#20876;&#20013;&#24515;&#27880;&#20876;&#26381;&#21153;&#12290;Dubbo &#22312; doExportUrls &#26041;&#27861;&#20013;&#23545;&#22810;&#21327;&#35758;&#65292;&#22810;&#27880;&#20876;&#20013;&#24515;&#36827;&#34892;&#20102;&#25903;&#25345;&#12290;&#30456;&#20851;&#20195;&#30721;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u7e112acc">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="ec5bbb4d">private void doExportUrls() {
    // &#21152;&#36733;&#27880;&#20876;&#20013;&#24515;&#38142;&#25509;
    List&lt;URL&gt; registryURLs = loadRegistries(true);
    // &#36941;&#21382; protocols&#65292;&#24182;&#22312;&#27599;&#20010;&#21327;&#35758;&#19979;&#23548;&#20986;&#26381;&#21153;
    for (ProtocolConfig protocolConfig : protocols) {
        doExportUrlsFor1Protocol(protocolConfig, registryURLs);
    }
}</pre>
 <p class="ne-p" id="u391a5340">
  <br>
 </p>
 <p class="ne-p" id="u4722230e">
  <span class="ne-text">
   &#19978;&#38754;&#20195;&#30721;&#39318;&#20808;&#26159;&#36890;&#36807; loadRegistries &#21152;&#36733;&#27880;&#20876;&#20013;&#24515;&#38142;&#25509;&#65292;&#28982;&#21518;&#20877;&#36941;&#21382; ProtocolConfig &#38598;&#21512;&#23548;&#20986;&#27599;&#20010;&#26381;&#21153;&#12290;&#24182;&#22312;&#23548;&#20986;&#26381;&#21153;&#30340;&#36807;&#31243;&#20013;&#65292;&#23558;&#26381;&#21153;&#27880;&#20876;&#21040;&#27880;&#20876;&#20013;&#24515;&#12290;&#19979;&#38754;&#65292;&#25105;&#20204;&#20808;&#26469;&#30475;&#19968;&#19979; loadRegistries &#26041;&#27861;&#30340;&#36923;&#36753;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u9170b09b">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="fedb441d">protected List&lt;URL&gt; loadRegistries(boolean provider) {
    // &#26816;&#27979;&#26159;&#21542;&#23384;&#22312;&#27880;&#20876;&#20013;&#24515;&#37197;&#32622;&#31867;&#65292;&#19981;&#23384;&#22312;&#21017;&#25243;&#20986;&#24322;&#24120;
    checkRegistry();
    List&lt;URL&gt; registryList = new ArrayList&lt;URL&gt;();
    if (registries != null &amp;&amp; !registries.isEmpty()) {
        for (RegistryConfig config : registries) {
            String address = config.getAddress();
            if (address == null || address.length() == 0) {
                // &#33509; address &#20026;&#31354;&#65292;&#21017;&#23558;&#20854;&#35774;&#20026; 0.0.0.0
                address = Constants.ANYHOST_VALUE;
            }

            // &#20174;&#31995;&#32479;&#23646;&#24615;&#20013;&#21152;&#36733;&#27880;&#20876;&#20013;&#24515;&#22320;&#22336;
            String sysaddress = System.getProperty("dubbo.registry.address");
            if (sysaddress != null &amp;&amp; sysaddress.length() &gt; 0) {
                address = sysaddress;
            }
            // &#26816;&#27979; address &#26159;&#21542;&#21512;&#27861;
            if (address.length() &gt; 0 &amp;&amp; !RegistryConfig.NO_AVAILABLE.equalsIgnoreCase(address)) {
                Map&lt;String, String&gt; map = new HashMap&lt;String, String&gt;();
                // &#28155;&#21152; ApplicationConfig &#20013;&#30340;&#23383;&#27573;&#20449;&#24687;&#21040; map &#20013;
                appendParameters(map, application);
                // &#28155;&#21152; RegistryConfig &#23383;&#27573;&#20449;&#24687;&#21040; map &#20013;
                appendParameters(map, config);
                
                // &#28155;&#21152; path&#12289;pid&#65292;protocol &#31561;&#20449;&#24687;&#21040; map &#20013;
                map.put("path", RegistryService.class.getName());
                map.put("dubbo", Version.getProtocolVersion());
                map.put(Constants.TIMESTAMP_KEY, String.valueOf(System.currentTimeMillis()));
                if (ConfigUtils.getPid() &gt; 0) {
                    map.put(Constants.PID_KEY, String.valueOf(ConfigUtils.getPid()));
                }
                if (!map.containsKey("protocol")) {
                    if (ExtensionLoader.getExtensionLoader(RegistryFactory.class).hasExtension("remote")) {
                        map.put("protocol", "remote");
                    } else {
                        map.put("protocol", "dubbo");
                    }
                }

                // &#35299;&#26512;&#24471;&#21040; URL &#21015;&#34920;&#65292;address &#21487;&#33021;&#21253;&#21547;&#22810;&#20010;&#27880;&#20876;&#20013;&#24515; ip&#65292;
                // &#22240;&#27492;&#35299;&#26512;&#24471;&#21040;&#30340;&#26159;&#19968;&#20010; URL &#21015;&#34920;
                List&lt;URL&gt; urls = UrlUtils.parseURLs(address, map);
                for (URL url : urls) {
                    url = url.addParameter(Constants.REGISTRY_KEY, url.getProtocol());
                    // &#23558; URL &#21327;&#35758;&#22836;&#35774;&#32622;&#20026; registry
                    url = url.setProtocol(Constants.REGISTRY_PROTOCOL);
                    // &#36890;&#36807;&#21028;&#26029;&#26465;&#20214;&#65292;&#20915;&#23450;&#26159;&#21542;&#28155;&#21152; url &#21040; registryList &#20013;&#65292;&#26465;&#20214;&#22914;&#19979;&#65306;
                    // (&#26381;&#21153;&#25552;&#20379;&#32773; &amp;&amp; register = true &#25110; null) 
                    //    || (&#38750;&#26381;&#21153;&#25552;&#20379;&#32773; &amp;&amp; subscribe = true &#25110; null)
                    if ((provider &amp;&amp; url.getParameter(Constants.REGISTER_KEY, true))
                            || (!provider &amp;&amp; url.getParameter(Constants.SUBSCRIBE_KEY, true))) {
                        registryList.add(url);
                    }
                }
            }
        }
    }
    return registryList;
}</pre>
 <p class="ne-p" id="u0e66a05d">
  <br>
 </p>
 <p class="ne-p" id="u60ee3da8">
  <span class="ne-text">
   loadRegistries &#26041;&#27861;&#20027;&#35201;&#21253;&#21547;&#22914;&#19979;&#30340;&#36923;&#36753;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u0998a7cb">
  <br>
 </p>
 <ol class="ne-ol">
  <li id="u92b76907">
   <span class="ne-text">
    &#26816;&#27979;&#26159;&#21542;&#23384;&#22312;&#27880;&#20876;&#20013;&#24515;&#37197;&#32622;&#31867;&#65292;&#19981;&#23384;&#22312;&#21017;&#25243;&#20986;&#24322;&#24120;
   </span>
  </li>
  <li id="ub9b04adc">
   <span class="ne-text">
    &#26500;&#24314;&#21442;&#25968;&#26144;&#23556;&#38598;&#21512;&#65292;&#20063;&#23601;&#26159; map
   </span>
  </li>
 </ol>
 <ol class="ne-ol" start="3">
  <li id="ud505ec1e">
   <span class="ne-text">
    &#26500;&#24314;&#27880;&#20876;&#20013;&#24515;&#38142;&#25509;&#21015;&#34920;
   </span>
  </li>
  <li id="u10fbad4f">
   <span class="ne-text">
    &#36941;&#21382;&#38142;&#25509;&#21015;&#34920;&#65292;&#24182;&#26681;&#25454;&#26465;&#20214;&#20915;&#23450;&#26159;&#21542;&#23558;&#20854;&#28155;&#21152;&#21040; registryList &#20013;
   </span>
  </li>
 </ol>
 <p class="ne-p" id="uad2885a9">
  <br>
 </p>
 <p class="ne-p" id="u12bfa8fc">
  <span class="ne-text">
   &#20851;&#20110;&#22810;&#21327;&#35758;&#22810;&#27880;&#20876;&#20013;&#24515;&#23548;&#20986;&#26381;&#21153;&#23601;&#20808;&#20998;&#26512;&#21040;&#36825;&#65292;&#20195;&#30721;&#19981;&#26159;&#24456;&#22810;&#65292;&#25509;&#19979;&#26469;&#20998;&#26512; URL &#32452;&#35013;&#36807;&#31243;&#12290;
  </span>
 </p>
 <p class="ne-p" id="ud34d4c4d">
  <br>
 </p>
 <h4 id="20d25f5e">
  <span class="ne-text">
   2.1.3 &#32452;&#35013; URL
  </span>
 </h4>
 <p class="ne-p" id="ua0806dc4">
  <br>
 </p>
 <p class="ne-p" id="ud8a75d34">
  <span class="ne-text">
   &#37197;&#32622;&#26816;&#26597;&#23436;&#27605;&#21518;&#65292;&#32039;&#25509;&#30528;&#35201;&#20570;&#30340;&#20107;&#24773;&#26159;&#26681;&#25454;&#37197;&#32622;&#65292;&#20197;&#21450;&#20854;&#20182;&#19968;&#20123;&#20449;&#24687;&#32452;&#35013; URL&#12290;&#21069;&#38754;&#35828;&#36807;&#65292;URL &#26159; Dubbo &#37197;&#32622;&#30340;&#36733;&#20307;&#65292;&#36890;&#36807; URL &#21487;&#35753; Dubbo &#30340;&#21508;&#31181;&#37197;&#32622;&#22312;&#21508;&#20010;&#27169;&#22359;&#20043;&#38388;&#20256;&#36882;&#12290;URL &#20043;&#20110; Dubbo&#65292;&#29369;&#22914;&#27700;&#20043;&#20110;&#40060;&#65292;&#38750;&#24120;&#37325;&#35201;&#12290;&#22823;&#23478;&#22312;&#38405;&#35835; Dubbo &#26381;&#21153;&#23548;&#20986;&#30456;&#20851;&#28304;&#30721;&#30340;&#36807;&#31243;&#20013;&#65292;&#35201;&#27880;&#24847; URL &#20869;&#23481;&#30340;&#21464;&#21270;&#12290;&#26082;&#28982; URL &#22914;&#27492;&#37325;&#35201;&#65292;&#37027;&#20040;&#19979;&#38754;&#25105;&#20204;&#26469;&#20102;&#35299;&#19968;&#19979; URL &#32452;&#35013;&#30340;&#36807;&#31243;&#12290;
  </span>
 </p>
 <p class="ne-p" id="ubacd6863">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="2d007281">private void doExportUrlsFor1Protocol(ProtocolConfig protocolConfig, List&lt;URL&gt; registryURLs) {
    String name = protocolConfig.getName();
    // &#22914;&#26524;&#21327;&#35758;&#21517;&#20026;&#31354;&#65292;&#25110;&#31354;&#20018;&#65292;&#21017;&#23558;&#21327;&#35758;&#21517;&#21464;&#37327;&#35774;&#32622;&#20026; dubbo
    if (name == null || name.length() == 0) {
        name = "dubbo";
    }

    Map&lt;String, String&gt; map = new HashMap&lt;String, String&gt;();
    // &#28155;&#21152; side&#12289;&#29256;&#26412;&#12289;&#26102;&#38388;&#25139;&#20197;&#21450;&#36827;&#31243;&#21495;&#31561;&#20449;&#24687;&#21040; map &#20013;
    map.put(Constants.SIDE_KEY, Constants.PROVIDER_SIDE);
    map.put(Constants.DUBBO_VERSION_KEY, Version.getProtocolVersion());
    map.put(Constants.TIMESTAMP_KEY, String.valueOf(System.currentTimeMillis()));
    if (ConfigUtils.getPid() &gt; 0) {
        map.put(Constants.PID_KEY, String.valueOf(ConfigUtils.getPid()));
    }

    // &#36890;&#36807;&#21453;&#23556;&#23558;&#23545;&#35937;&#30340;&#23383;&#27573;&#20449;&#24687;&#28155;&#21152;&#21040; map &#20013;
    appendParameters(map, application);
    appendParameters(map, module);
    appendParameters(map, provider, Constants.DEFAULT_KEY);
    appendParameters(map, protocolConfig);
    appendParameters(map, this);

    // methods &#20026; MethodConfig &#38598;&#21512;&#65292;MethodConfig &#20013;&#23384;&#20648;&#20102; &lt;dubbo:method&gt; &#26631;&#31614;&#30340;&#37197;&#32622;&#20449;&#24687;
    if (methods != null &amp;&amp; !methods.isEmpty()) {
        // &#36825;&#27573;&#20195;&#30721;&#29992;&#20110;&#28155;&#21152; Callback &#37197;&#32622;&#21040; map &#20013;&#65292;&#20195;&#30721;&#22826;&#38271;&#65292;&#24453;&#20250;&#21333;&#29420;&#20998;&#26512;
    }

    // &#26816;&#27979; generic &#26159;&#21542;&#20026; "true"&#65292;&#24182;&#26681;&#25454;&#26816;&#27979;&#32467;&#26524;&#21521; map &#20013;&#28155;&#21152;&#19981;&#21516;&#30340;&#20449;&#24687;
    if (ProtocolUtils.isGeneric(generic)) {
        map.put(Constants.GENERIC_KEY, generic);
        map.put(Constants.METHODS_KEY, Constants.ANY_VALUE);
    } else {
        String revision = Version.getVersion(interfaceClass, version);
        if (revision != null &amp;&amp; revision.length() &gt; 0) {
            map.put("revision", revision);
        }

        // &#20026;&#25509;&#21475;&#29983;&#25104;&#21253;&#35065;&#31867; Wrapper&#65292;Wrapper &#20013;&#21253;&#21547;&#20102;&#25509;&#21475;&#30340;&#35814;&#32454;&#20449;&#24687;&#65292;&#27604;&#22914;&#25509;&#21475;&#26041;&#27861;&#21517;&#25968;&#32452;&#65292;&#23383;&#27573;&#20449;&#24687;&#31561;
        String[] methods = Wrapper.getWrapper(interfaceClass).getMethodNames();
        // &#28155;&#21152;&#26041;&#27861;&#21517;&#21040; map &#20013;&#65292;&#22914;&#26524;&#21253;&#21547;&#22810;&#20010;&#26041;&#27861;&#21517;&#65292;&#21017;&#29992;&#36887;&#21495;&#38548;&#24320;&#65292;&#27604;&#22914; method = init,destroy
        if (methods.length == 0) {
            logger.warn("NO method found in service interface ...");
            map.put(Constants.METHODS_KEY, Constants.ANY_VALUE);
        } else {
            // &#23558;&#36887;&#21495;&#20316;&#20026;&#20998;&#38548;&#31526;&#36830;&#25509;&#26041;&#27861;&#21517;&#65292;&#24182;&#23558;&#36830;&#25509;&#21518;&#30340;&#23383;&#31526;&#20018;&#25918;&#20837; map &#20013;
            map.put(Constants.METHODS_KEY, StringUtils.join(new HashSet&lt;String&gt;(Arrays.asList(methods)), ","));
        }
    }

    // &#28155;&#21152; token &#21040; map &#20013;
    if (!ConfigUtils.isEmpty(token)) {
        if (ConfigUtils.isDefault(token)) {
            // &#38543;&#26426;&#29983;&#25104; token
            map.put(Constants.TOKEN_KEY, UUID.randomUUID().toString());
        } else {
            map.put(Constants.TOKEN_KEY, token);
        }
    }
    // &#21028;&#26029;&#21327;&#35758;&#21517;&#26159;&#21542;&#20026; injvm
    if (Constants.LOCAL_PROTOCOL.equals(protocolConfig.getName())) {
        protocolConfig.setRegister(false);
        map.put("notify", "false");
    }

    // &#33719;&#21462;&#19978;&#19979;&#25991;&#36335;&#24452;
    String contextPath = protocolConfig.getContextpath();
    if ((contextPath == null || contextPath.length() == 0) &amp;&amp; provider != null) {
        contextPath = provider.getContextpath();
    }

    // &#33719;&#21462; host &#21644; port
    String host = this.findConfigedHosts(protocolConfig, registryURLs, map);
    Integer port = this.findConfigedPorts(protocolConfig, name, map);
    // &#32452;&#35013; URL
    URL url = new URL(name, host, port, (contextPath == null || contextPath.length() == 0 ? "" : contextPath + "/") + path, map);
    
    // &#30465;&#30053;&#26080;&#20851;&#20195;&#30721;
}</pre>
 <p class="ne-p" id="u030a582a">
  <br>
 </p>
 <p class="ne-p" id="u02c86103">
  <span class="ne-text">
   &#19978;&#38754;&#30340;&#20195;&#30721;&#39318;&#20808;&#26159;&#23558;&#19968;&#20123;&#20449;&#24687;&#65292;&#27604;&#22914;&#29256;&#26412;&#12289;&#26102;&#38388;&#25139;&#12289;&#26041;&#27861;&#21517;&#20197;&#21450;&#21508;&#31181;&#37197;&#32622;&#23545;&#35937;&#30340;&#23383;&#27573;&#20449;&#24687;&#25918;&#20837;&#21040; map &#20013;&#65292;map &#20013;&#30340;&#20869;&#23481;&#23558;&#20316;&#20026; URL &#30340;&#26597;&#35810;&#23383;&#31526;&#20018;&#12290;&#26500;&#24314;&#22909; map &#21518;&#65292;&#32039;&#25509;&#30528;&#26159;&#33719;&#21462;&#19978;&#19979;&#25991;&#36335;&#24452;&#12289;&#20027;&#26426;&#21517;&#20197;&#21450;&#31471;&#21475;&#21495;&#31561;&#20449;&#24687;&#12290;&#26368;&#21518;&#23558; map &#21644;&#20027;&#26426;&#21517;&#31561;&#25968;&#25454;&#20256;&#32473; URL &#26500;&#36896;&#26041;&#27861;&#21019;&#24314; URL &#23545;&#35937;&#12290;&#38656;&#35201;&#27880;&#24847;&#30340;&#26159;&#65292;&#36825;&#37324;&#20986;&#29616;&#30340; URL &#24182;&#38750; java.net.URL&#65292;&#32780;&#26159; com.alibaba.dubbo.common.URL&#12290;
  </span>
 </p>
 <p class="ne-p" id="u0ef4e88b">
  <br>
 </p>
 <p class="ne-p" id="u1a95b553">
  <span class="ne-text">
   &#19978;&#38754;&#30465;&#30053;&#20102;&#19968;&#27573;&#20195;&#30721;&#65292;&#36825;&#37324;&#31616;&#21333;&#20998;&#26512;&#19968;&#19979;&#12290;&#36825;&#27573;&#20195;&#30721;&#29992;&#20110;&#26816;&#27979;
  </span>
  <span class="ne-text">
   dubbo:method
  </span>
  <span class="ne-text">
   &#26631;&#31614;&#20013;&#30340;&#37197;&#32622;&#20449;&#24687;&#65292;&#24182;&#23558;&#30456;&#20851;&#37197;&#32622;&#28155;&#21152;&#21040; map &#20013;&#12290;&#20195;&#30721;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="uf9ddc603">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="c3c975f4">private void doExportUrlsFor1Protocol(ProtocolConfig protocolConfig, List&lt;URL&gt; registryURLs) {
    // ...

    // methods &#20026; MethodConfig &#38598;&#21512;&#65292;MethodConfig &#20013;&#23384;&#20648;&#20102; &lt;dubbo:method&gt; &#26631;&#31614;&#30340;&#37197;&#32622;&#20449;&#24687;
    if (methods != null &amp;&amp; !methods.isEmpty()) {
        for (MethodConfig method : methods) {
            // &#28155;&#21152; MethodConfig &#23545;&#35937;&#30340;&#23383;&#27573;&#20449;&#24687;&#21040; map &#20013;&#65292;&#38190; = &#26041;&#27861;&#21517;.&#23646;&#24615;&#21517;&#12290;
            // &#27604;&#22914;&#23384;&#20648; &lt;dubbo:method name="sayHello" retries="2"&gt; &#23545;&#24212;&#30340; MethodConfig&#65292;
            // &#38190; = sayHello.retries&#65292;map = {"sayHello.retries": 2, "xxx": "yyy"}
            appendParameters(map, method, method.getName());

            String retryKey = method.getName() + ".retry";
            if (map.containsKey(retryKey)) {
                String retryValue = map.remove(retryKey);
                // &#26816;&#27979; MethodConfig retry &#26159;&#21542;&#20026; false&#65292;&#33509;&#26159;&#65292;&#21017;&#35774;&#32622;&#37325;&#35797;&#27425;&#25968;&#20026;0
                if ("false".equals(retryValue)) {
                    map.put(method.getName() + ".retries", "0");
                }
            }
            
            // &#33719;&#21462; ArgumentConfig &#21015;&#34920;
            List&lt;ArgumentConfig&gt; arguments = method.getArguments();
            if (arguments != null &amp;&amp; !arguments.isEmpty()) {
                for (ArgumentConfig argument : arguments) {
                    // &#26816;&#27979; type &#23646;&#24615;&#26159;&#21542;&#20026;&#31354;&#65292;&#25110;&#32773;&#31354;&#20018;&#65288;&#20998;&#25903;1 &#11088;&#65039;&#65289;
                    if (argument.getType() != null &amp;&amp; argument.getType().length() &gt; 0) {
                        Method[] methods = interfaceClass.getMethods();
                        if (methods != null &amp;&amp; methods.length &gt; 0) {
                            for (int i = 0; i &lt; methods.length; i++) {
                                String methodName = methods[i].getName();
                                // &#27604;&#23545;&#26041;&#27861;&#21517;&#65292;&#26597;&#25214;&#30446;&#26631;&#26041;&#27861;
                                if (methodName.equals(method.getName())) {
                                    Class&lt;?&gt;[] argtypes = methods[i].getParameterTypes();
                                    if (argument.getIndex() != -1) {
                                        // &#26816;&#27979; ArgumentConfig &#20013;&#30340; type &#23646;&#24615;&#19982;&#26041;&#27861;&#21442;&#25968;&#21015;&#34920;
                                        // &#20013;&#30340;&#21442;&#25968;&#21517;&#31216;&#26159;&#21542;&#19968;&#33268;&#65292;&#19981;&#19968;&#33268;&#21017;&#25243;&#20986;&#24322;&#24120;(&#20998;&#25903;2 &#11088;&#65039;)
                                        if (argtypes[argument.getIndex()].getName().equals(argument.getType())) {
                                            // &#28155;&#21152; ArgumentConfig &#23383;&#27573;&#20449;&#24687;&#21040; map &#20013;&#65292;
                                            // &#38190;&#21069;&#32512; = &#26041;&#27861;&#21517;.index&#65292;&#27604;&#22914;:
                                            // map = {"sayHello.3": true}
                                            appendParameters(map, argument, method.getName() + "." + argument.getIndex());
                                        } else {
                                            throw new IllegalArgumentException("argument config error: ...");
                                        }
                                    } else {    // &#20998;&#25903;3 &#11088;&#65039;
                                        for (int j = 0; j &lt; argtypes.length; j++) {
                                            Class&lt;?&gt; argclazz = argtypes[j];
                                            // &#20174;&#21442;&#25968;&#31867;&#22411;&#21015;&#34920;&#20013;&#26597;&#25214;&#31867;&#22411;&#21517;&#31216;&#20026; argument.type &#30340;&#21442;&#25968;
                                            if (argclazz.getName().equals(argument.getType())) {
                                                appendParameters(map, argument, method.getName() + "." + j);
                                                if (argument.getIndex() != -1 &amp;&amp; argument.getIndex() != j) {
                                                    throw new IllegalArgumentException("argument config error: ...");
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }

                    // &#29992;&#25143;&#26410;&#37197;&#32622; type &#23646;&#24615;&#65292;&#20294;&#37197;&#32622;&#20102; index &#23646;&#24615;&#65292;&#19988; index != -1
                    } else if (argument.getIndex() != -1) {    // &#20998;&#25903;4 &#11088;&#65039;
                        // &#28155;&#21152; ArgumentConfig &#23383;&#27573;&#20449;&#24687;&#21040; map &#20013;
                        appendParameters(map, argument, method.getName() + "." + argument.getIndex());
                    } else {
                        throw new IllegalArgumentException("argument config must set index or type");
                    }
                }
            }
        }
    }

    // ...
}</pre>
 <p class="ne-p" id="u2ea7aead">
  <br>
 </p>
 <p class="ne-p" id="u687a28e4">
  <span class="ne-text">
   &#19978;&#38754;&#36825;&#27573;&#20195;&#30721; for &#24490;&#29615;&#21644; if else &#20998;&#25903;&#23884;&#22871;&#22826;&#22810;&#65292;&#23548;&#33268;&#23618;&#27425;&#22826;&#28145;&#65292;&#19981;&#21033;&#20110;&#38405;&#35835;&#65292;&#38656;&#35201;&#32784;&#24515;&#30475;&#19968;&#19979;&#12290;&#22823;&#23478;&#22312;&#30475;&#36825;&#27573;&#20195;&#30721;&#26102;&#65292;&#27880;&#24847;&#25226;&#20960;&#20010;&#37325;&#35201;&#30340;&#26465;&#20214;&#20998;&#25903;&#25214;&#20986;&#26469;&#12290;&#21482;&#35201;&#29702;&#35299;&#20102;&#36825;&#20960;&#20010;&#20998;&#25903;&#30340;&#24847;&#22270;&#65292;&#23601;&#21487;&#20197;&#24324;&#25026;&#36825;&#27573;&#20195;&#30721;&#12290;&#35831;&#27880;&#24847;&#19978;&#38754;&#20195;&#30721;&#20013;&#11088;&#65039;&#31526;&#21495;&#65292;&#36825;&#20960;&#20010;&#31526;&#21495;&#26631;&#35782;&#20986;&#20102;4&#20010;&#37325;&#35201;&#30340;&#20998;&#25903;&#65292;&#19979;&#38754;&#29992;&#20266;&#20195;&#30721;&#35299;&#37322;&#19968;&#19979;&#36825;&#20960;&#20010;&#20998;&#25903;&#30340;&#21547;&#20041;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u9228a642">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="555e783c">// &#33719;&#21462; ArgumentConfig &#21015;&#34920;
for (&#36941;&#21382; ArgumentConfig &#21015;&#34920;) {
    if (type &#19981;&#20026; null&#65292;&#20063;&#19981;&#20026;&#31354;&#20018;) {    // &#20998;&#25903;1
        1. &#36890;&#36807;&#21453;&#23556;&#33719;&#21462; interfaceClass &#30340;&#26041;&#27861;&#21015;&#34920;
        for (&#36941;&#21382;&#26041;&#27861;&#21015;&#34920;) {
            1. &#27604;&#23545;&#26041;&#27861;&#21517;&#65292;&#26597;&#25214;&#30446;&#26631;&#26041;&#27861;
        	2. &#36890;&#36807;&#21453;&#23556;&#33719;&#21462;&#30446;&#26631;&#26041;&#27861;&#30340;&#21442;&#25968;&#31867;&#22411;&#25968;&#32452; argtypes
            if (index != -1) {    // &#20998;&#25903;2
                1. &#20174; argtypes &#25968;&#32452;&#20013;&#33719;&#21462;&#19979;&#26631; index &#22788;&#30340;&#20803;&#32032; argType
                2. &#26816;&#27979; argType &#30340;&#21517;&#31216;&#19982; ArgumentConfig &#20013;&#30340; type &#23646;&#24615;&#26159;&#21542;&#19968;&#33268;
                3. &#28155;&#21152; ArgumentConfig &#23383;&#27573;&#20449;&#24687;&#21040; map &#20013;&#65292;&#25110;&#25243;&#20986;&#24322;&#24120;
            } else {    // &#20998;&#25903;3
                1. &#36941;&#21382;&#21442;&#25968;&#31867;&#22411;&#25968;&#32452; argtypes&#65292;&#26597;&#25214; argument.type &#31867;&#22411;&#30340;&#21442;&#25968;
                2. &#28155;&#21152; ArgumentConfig &#23383;&#27573;&#20449;&#24687;&#21040; map &#20013;
            }
        }
    } else if (index != -1) {    // &#20998;&#25903;4
		1. &#28155;&#21152; ArgumentConfig &#23383;&#27573;&#20449;&#24687;&#21040; map &#20013;
    }
}</pre>
 <p class="ne-p" id="u0f200405">
  <br>
 </p>
 <p class="ne-p" id="ud51735b7">
  <span class="ne-text">
   &#22312;&#26412;&#33410;&#20998;&#26512;&#30340;&#28304;&#30721;&#20013;&#65292;appendParameters &#36825;&#20010;&#26041;&#27861;&#20986;&#29616;&#30340;&#27425;&#25968;&#27604;&#36739;&#22810;&#65292;&#35813;&#26041;&#27861;&#29992;&#20110;&#23558;&#23545;&#35937;&#23383;&#27573;&#20449;&#24687;&#28155;&#21152;&#21040; map &#20013;&#12290;&#23454;&#29616;&#19978;&#21017;&#26159;&#36890;&#36807;&#21453;&#23556;&#33719;&#21462;&#30446;&#26631;&#23545;&#35937;&#30340; getter &#26041;&#27861;&#65292;&#24182;&#35843;&#29992;&#35813;&#26041;&#27861;&#33719;&#21462;&#23646;&#24615;&#20540;&#12290;&#28982;&#21518;&#20877;&#36890;&#36807; getter &#26041;&#27861;&#21517;&#35299;&#26512;&#20986;&#23646;&#24615;&#21517;&#65292;&#27604;&#22914;&#20174;&#26041;&#27861;&#21517; getName &#20013;&#21487;&#35299;&#26512;&#20986;&#23646;&#24615; name&#12290;&#22914;&#26524;&#29992;&#25143;&#20256;&#20837;&#20102;&#23646;&#24615;&#21517;&#21069;&#32512;&#65292;&#27492;&#26102;&#38656;&#35201;&#23558;&#23646;&#24615;&#21517;&#21152;&#20837;&#21069;&#32512;&#20869;&#23481;&#12290;&#26368;&#21518;&#23558; &lt;&#23646;&#24615;&#21517;&#65292;&#23646;&#24615;&#20540;&gt; &#38190;&#20540;&#23545;&#23384;&#20837;&#21040; map &#20013;&#23601;&#34892;&#20102;&#12290;&#38480;&#20110;&#31687;&#24133;&#21407;&#22240;&#65292;&#36825;&#37324;&#23601;&#19981;&#20998;&#26512; appendParameters &#26041;&#27861;&#30340;&#28304;&#30721;&#20102;&#65292;&#22823;&#23478;&#35831;&#33258;&#34892;&#20998;&#26512;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u6e360f5b">
  <br>
 </p>
 <h3 id="fa1285e3">
  <span class="ne-text">
   2.2 &#23548;&#20986; Dubbo &#26381;&#21153;
  </span>
 </h3>
 <p class="ne-p" id="u063fef6a">
  <br>
 </p>
 <p class="ne-p" id="ueb53c8a8">
  <span class="ne-text">
   &#21069;&#32622;&#24037;&#20316;&#20570;&#23436;&#65292;&#25509;&#19979;&#26469;&#23601;&#21487;&#20197;&#36827;&#34892;&#26381;&#21153;&#23548;&#20986;&#20102;&#12290;&#26381;&#21153;&#23548;&#20986;&#20998;&#20026;&#23548;&#20986;&#21040;&#26412;&#22320; (JVM)&#65292;&#21644;&#23548;&#20986;&#21040;&#36828;&#31243;&#12290;&#22312;&#28145;&#20837;&#20998;&#26512;&#26381;&#21153;&#23548;&#20986;&#30340;&#28304;&#30721;&#21069;&#65292;&#25105;&#20204;&#20808;&#26469;&#20174;&#23439;&#35266;&#23618;&#38754;&#19978;&#30475;&#19968;&#19979;&#26381;&#21153;&#23548;&#20986;&#36923;&#36753;&#12290;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="ucb081f4b">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="afa3ebdd">private void doExportUrlsFor1Protocol(ProtocolConfig protocolConfig, List&lt;URL&gt; registryURLs) {
    
    // &#30465;&#30053;&#26080;&#20851;&#20195;&#30721;
    
    if (ExtensionLoader.getExtensionLoader(ConfiguratorFactory.class)
            .hasExtension(url.getProtocol())) {
        // &#21152;&#36733; ConfiguratorFactory&#65292;&#24182;&#29983;&#25104; Configurator &#23454;&#20363;&#65292;&#28982;&#21518;&#36890;&#36807;&#23454;&#20363;&#37197;&#32622; url
        url = ExtensionLoader.getExtensionLoader(ConfiguratorFactory.class)
                .getExtension(url.getProtocol()).getConfigurator(url).configure(url);
    }

    String scope = url.getParameter(Constants.SCOPE_KEY);
    // &#22914;&#26524; scope = none&#65292;&#21017;&#20160;&#20040;&#37117;&#19981;&#20570;
    if (!Constants.SCOPE_NONE.toString().equalsIgnoreCase(scope)) {
        // scope != remote&#65292;&#23548;&#20986;&#21040;&#26412;&#22320;
        if (!Constants.SCOPE_REMOTE.toString().equalsIgnoreCase(scope)) {
            exportLocal(url);
        }

        // scope != local&#65292;&#23548;&#20986;&#21040;&#36828;&#31243;
        if (!Constants.SCOPE_LOCAL.toString().equalsIgnoreCase(scope)) {
            if (registryURLs != null &amp;&amp; !registryURLs.isEmpty()) {
                for (URL registryURL : registryURLs) {
                    url = url.addParameterIfAbsent(Constants.DYNAMIC_KEY, registryURL.getParameter(Constants.DYNAMIC_KEY));
                    // &#21152;&#36733;&#30417;&#35270;&#22120;&#38142;&#25509;
                    URL monitorUrl = loadMonitor(registryURL);
                    if (monitorUrl != null) {
                        // &#23558;&#30417;&#35270;&#22120;&#38142;&#25509;&#20316;&#20026;&#21442;&#25968;&#28155;&#21152;&#21040; url &#20013;
                        url = url.addParameterAndEncoded(Constants.MONITOR_KEY, monitorUrl.toFullString());
                    }

                    String proxy = url.getParameter(Constants.PROXY_KEY);
                    if (StringUtils.isNotEmpty(proxy)) {
                        registryURL = registryURL.addParameter(Constants.PROXY_KEY, proxy);
                    }

                    // &#20026;&#26381;&#21153;&#25552;&#20379;&#31867;(ref)&#29983;&#25104; Invoker
                    Invoker&lt;?&gt; invoker = proxyFactory.getInvoker(ref, (Class) interfaceClass, registryURL.addParameterAndEncoded(Constants.EXPORT_KEY, url.toFullString()));
                    // DelegateProviderMetaDataInvoker &#29992;&#20110;&#25345;&#26377; Invoker &#21644; ServiceConfig
                    DelegateProviderMetaDataInvoker wrapperInvoker = new DelegateProviderMetaDataInvoker(invoker, this);

                    // &#23548;&#20986;&#26381;&#21153;&#65292;&#24182;&#29983;&#25104; Exporter
                    Exporter&lt;?&gt; exporter = protocol.export(wrapperInvoker);
                    exporters.add(exporter);
                }
                
            // &#19981;&#23384;&#22312;&#27880;&#20876;&#20013;&#24515;&#65292;&#20165;&#23548;&#20986;&#26381;&#21153;
            } else {
                Invoker&lt;?&gt; invoker = proxyFactory.getInvoker(ref, (Class) interfaceClass, url);
                DelegateProviderMetaDataInvoker wrapperInvoker = new DelegateProviderMetaDataInvoker(invoker, this);

                Exporter&lt;?&gt; exporter = protocol.export(wrapperInvoker);
                exporters.add(exporter);
            }
        }
    }
    this.urls.add(url);
}</pre>
 <p class="ne-p" id="u52a35723">
  <br>
 </p>
 <p class="ne-p" id="u1828f573">
  <span class="ne-text">
   &#19978;&#38754;&#20195;&#30721;&#26681;&#25454; url &#20013;&#30340; scope &#21442;&#25968;&#20915;&#23450;&#26381;&#21153;&#23548;&#20986;&#26041;&#24335;&#65292;&#20998;&#21035;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="ua3496ef7">
  <br>
 </p>
 <ul class="ne-ul">
  <li id="ub61c285b">
   <span class="ne-text">
    scope = none&#65292;&#19981;&#23548;&#20986;&#26381;&#21153;
   </span>
  </li>
  <li id="uf483b617">
   <span class="ne-text">
    scope != remote&#65292;&#23548;&#20986;&#21040;&#26412;&#22320;
   </span>
  </li>
 </ul>
 <ul class="ne-ul">
  <li id="uef11ccc6">
   <span class="ne-text">
    scope != local&#65292;&#23548;&#20986;&#21040;&#36828;&#31243;
   </span>
  </li>
 </ul>
 <p class="ne-p" id="uc8f1980d">
  <br>
 </p>
 <p class="ne-p" id="u4cfb1d27">
  <span class="ne-text">
   &#19981;&#31649;&#26159;&#23548;&#20986;&#21040;&#26412;&#22320;&#65292;&#36824;&#26159;&#36828;&#31243;&#12290;&#36827;&#34892;&#26381;&#21153;&#23548;&#20986;&#20043;&#21069;&#65292;&#22343;&#38656;&#35201;&#20808;&#21019;&#24314; Invoker&#65292;&#36825;&#26159;&#19968;&#20010;&#24456;&#37325;&#35201;&#30340;&#27493;&#39588;&#12290;&#22240;&#27492;&#19979;&#38754;&#20808;&#26469;&#20998;&#26512; Invoker &#30340;&#21019;&#24314;&#36807;&#31243;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u49c16a0f">
  <br>
 </p>
 <h3 id="e330ac3c">
  <span class="ne-text">
   2.2.1 Invoker &#21019;&#24314;&#36807;&#31243;
  </span>
 </h3>
 <p class="ne-p" id="uc33dd5b1">
  <br>
 </p>
 <p class="ne-p" id="u6e84bb9e">
  <span class="ne-text">
   &#22312; Dubbo &#20013;&#65292;Invoker &#26159;&#19968;&#20010;&#38750;&#24120;&#37325;&#35201;&#30340;&#27169;&#22411;&#12290;&#22312;&#26381;&#21153;&#25552;&#20379;&#31471;&#65292;&#20197;&#21450;&#26381;&#21153;&#24341;&#29992;&#31471;&#22343;&#20250;&#20986;&#29616; Invoker&#12290;Dubbo &#23448;&#26041;&#25991;&#26723;&#20013;&#23545; Invoker &#36827;&#34892;&#20102;&#35828;&#26126;&#65292;&#36825;&#37324;&#24341;&#29992;&#19968;&#19979;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u27dc134f">
  <br>
 </p>
 <div class="ne-quote">
  <p class="ne-p" id="u238e309d">
   <span class="ne-text">
    Invoker &#26159;&#23454;&#20307;&#22495;&#65292;&#23427;&#26159; Dubbo &#30340;&#26680;&#24515;&#27169;&#22411;&#65292;&#20854;&#23427;&#27169;&#22411;&#37117;&#21521;&#23427;&#38752;&#25200;&#65292;&#25110;&#36716;&#25442;&#25104;&#23427;&#65292;&#23427;&#20195;&#34920;&#19968;&#20010;&#21487;&#25191;&#34892;&#20307;&#65292;&#21487;&#21521;&#23427;&#21457;&#36215; invoke &#35843;&#29992;&#65292;&#23427;&#26377;&#21487;&#33021;&#26159;&#19968;&#20010;&#26412;&#22320;&#30340;&#23454;&#29616;&#65292;&#20063;&#21487;&#33021;&#26159;&#19968;&#20010;&#36828;&#31243;&#30340;&#23454;&#29616;&#65292;&#20063;&#21487;&#33021;&#19968;&#20010;&#38598;&#32676;&#23454;&#29616;&#12290;
   </span>
  </p>
 </div>
 <p class="ne-p" id="ub8dfcbe1">
  <br>
 </p>
 <p class="ne-p" id="u6c26a240">
  <span class="ne-text">
   &#26082;&#28982; Invoker &#22914;&#27492;&#37325;&#35201;&#65292;&#37027;&#20040;&#25105;&#20204;&#24456;&#26377;&#24517;&#35201;&#25630;&#28165;&#26970; Invoker &#30340;&#29992;&#36884;&#12290;Invoker &#26159;&#30001; ProxyFactory &#21019;&#24314;&#32780;&#26469;&#65292;Dubbo &#40664;&#35748;&#30340; ProxyFactory &#23454;&#29616;&#31867;&#26159; JavassistProxyFactory&#12290;&#19979;&#38754;&#25105;&#20204;&#21040; JavassistProxyFactory &#20195;&#30721;&#20013;&#65292;&#25506;&#32034; Invoker &#30340;&#21019;&#24314;&#36807;&#31243;&#12290;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u25484a84">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="2999a8bf">public &lt;T&gt; Invoker&lt;T&gt; getInvoker(T proxy, Class&lt;T&gt; type, URL url) {
	// &#20026;&#30446;&#26631;&#31867;&#21019;&#24314; Wrapper
    final Wrapper wrapper = Wrapper.getWrapper(proxy.getClass().getName().indexOf('$') &lt; 0 ? proxy.getClass() : type);
    // &#21019;&#24314;&#21311;&#21517; Invoker &#31867;&#23545;&#35937;&#65292;&#24182;&#23454;&#29616; doInvoke &#26041;&#27861;&#12290;
    return new AbstractProxyInvoker&lt;T&gt;(proxy, type, url) {
        @Override
        protected Object doInvoke(T proxy, String methodName,
                                  Class&lt;?&gt;[] parameterTypes,
                                  Object[] arguments) throws Throwable {
			// &#35843;&#29992; Wrapper &#30340; invokeMethod &#26041;&#27861;&#65292;invokeMethod &#26368;&#32456;&#20250;&#35843;&#29992;&#30446;&#26631;&#26041;&#27861;
            return wrapper.invokeMethod(proxy, methodName, parameterTypes, arguments);
        }
    };
}</pre>
 <p class="ne-p" id="uf8cbb3fe">
  <br>
 </p>
 <p class="ne-p" id="uf883f035">
  <span class="ne-text">
   &#22914;&#19978;&#65292;JavassistProxyFactory &#21019;&#24314;&#20102;&#19968;&#20010;&#32487;&#25215;&#33258; AbstractProxyInvoker &#31867;&#30340;&#21311;&#21517;&#23545;&#35937;&#65292;&#24182;&#35206;&#20889;&#20102;&#25277;&#35937;&#26041;&#27861; doInvoke&#12290;&#35206;&#20889;&#21518;&#30340; doInvoke &#36923;&#36753;&#27604;&#36739;&#31616;&#21333;&#65292;&#20165;&#26159;&#23558;&#35843;&#29992;&#35831;&#27714;&#36716;&#21457;&#32473;&#20102; Wrapper &#31867;&#30340; invokeMethod &#26041;&#27861;&#12290;Wrapper &#29992;&#20110;&#8220;&#21253;&#35065;&#8221;&#30446;&#26631;&#31867;&#65292;Wrapper &#26159;&#19968;&#20010;&#25277;&#35937;&#31867;&#65292;&#20165;&#21487;&#36890;&#36807; getWrapper(Class) &#26041;&#27861;&#21019;&#24314;&#23376;&#31867;&#12290;&#22312;&#21019;&#24314; Wrapper &#23376;&#31867;&#30340;&#36807;&#31243;&#20013;&#65292;&#23376;&#31867;&#20195;&#30721;&#29983;&#25104;&#36923;&#36753;&#20250;&#23545; getWrapper &#26041;&#27861;&#20256;&#20837;&#30340; Class &#23545;&#35937;&#36827;&#34892;&#35299;&#26512;&#65292;&#25343;&#21040;&#35832;&#22914;&#31867;&#26041;&#27861;&#65292;&#31867;&#25104;&#21592;&#21464;&#37327;&#31561;&#20449;&#24687;&#12290;&#20197;&#21450;&#29983;&#25104; invokeMethod &#26041;&#27861;&#20195;&#30721;&#21644;&#20854;&#20182;&#19968;&#20123;&#26041;&#27861;&#20195;&#30721;&#12290;&#20195;&#30721;&#29983;&#25104;&#23436;&#27605;&#21518;&#65292;&#36890;&#36807; Javassist &#29983;&#25104; Class &#23545;&#35937;&#65292;&#26368;&#21518;&#20877;&#36890;&#36807;&#21453;&#23556;&#21019;&#24314; Wrapper &#23454;&#20363;&#12290;&#30456;&#20851;&#30340;&#20195;&#30721;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u3f656e34">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="e57600cb"> public static Wrapper getWrapper(Class&lt;?&gt; c) {	
    while (ClassGenerator.isDynamicClass(c))
        c = c.getSuperclass();

    if (c == Object.class)
        return OBJECT_WRAPPER;

    // &#20174;&#32531;&#23384;&#20013;&#33719;&#21462; Wrapper &#23454;&#20363;
    Wrapper ret = WRAPPER_MAP.get(c);
    if (ret == null) {
        // &#32531;&#23384;&#26410;&#21629;&#20013;&#65292;&#21019;&#24314; Wrapper
        ret = makeWrapper(c);
        // &#20889;&#20837;&#32531;&#23384;
        WRAPPER_MAP.put(c, ret);
    }
    return ret;
}</pre>
 <p class="ne-p" id="u095aaa1f">
  <br>
 </p>
 <p class="ne-p" id="ua25a9d74">
  <span class="ne-text">
   getWrapper &#26041;&#27861;&#20165;&#21253;&#21547;&#19968;&#20123;&#32531;&#23384;&#25805;&#20316;&#36923;&#36753;&#65292;&#19981;&#38590;&#29702;&#35299;&#12290;&#19979;&#38754;&#25105;&#20204;&#30475;&#19968;&#19979; makeWrapper &#26041;&#27861;&#12290;
  </span>
 </p>
 <p class="ne-p" id="uc059ab54">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="fd4a7076">private static Wrapper makeWrapper(Class&lt;?&gt; c) {
    // &#26816;&#27979; c &#26159;&#21542;&#20026;&#22522;&#26412;&#31867;&#22411;&#65292;&#33509;&#26159;&#21017;&#25243;&#20986;&#24322;&#24120;
    if (c.isPrimitive())
        throw new IllegalArgumentException("Can not create wrapper for primitive type: " + c);

    String name = c.getName();
    ClassLoader cl = ClassHelper.getClassLoader(c);

    // c1 &#29992;&#20110;&#23384;&#20648; setPropertyValue &#26041;&#27861;&#20195;&#30721;
    StringBuilder c1 = new StringBuilder("public void setPropertyValue(Object o, String n, Object v){ ");
    // c2 &#29992;&#20110;&#23384;&#20648; getPropertyValue &#26041;&#27861;&#20195;&#30721;
    StringBuilder c2 = new StringBuilder("public Object getPropertyValue(Object o, String n){ ");
    // c3 &#29992;&#20110;&#23384;&#20648; invokeMethod &#26041;&#27861;&#20195;&#30721;
    StringBuilder c3 = new StringBuilder("public Object invokeMethod(Object o, String n, Class[] p, Object[] v) throws " + InvocationTargetException.class.getName() + "{ ");

    // &#29983;&#25104;&#31867;&#22411;&#36716;&#25442;&#20195;&#30721;&#21450;&#24322;&#24120;&#25429;&#25417;&#20195;&#30721;&#65292;&#27604;&#22914;&#65306;
    //   DemoService w; try { w = ((DemoServcie) $1); }}catch(Throwable e){ throw new IllegalArgumentException(e); }
    c1.append(name).append(" w; try{ w = ((").append(name).append(")$1); }catch(Throwable e){ throw new IllegalArgumentException(e); }");
    c2.append(name).append(" w; try{ w = ((").append(name).append(")$1); }catch(Throwable e){ throw new IllegalArgumentException(e); }");
    c3.append(name).append(" w; try{ w = ((").append(name).append(")$1); }catch(Throwable e){ throw new IllegalArgumentException(e); }");

    // pts &#29992;&#20110;&#23384;&#20648;&#25104;&#21592;&#21464;&#37327;&#21517;&#21644;&#31867;&#22411;
    Map&lt;String, Class&lt;?&gt;&gt; pts = new HashMap&lt;String, Class&lt;?&gt;&gt;();
    // ms &#29992;&#20110;&#23384;&#20648;&#26041;&#27861;&#25551;&#36848;&#20449;&#24687;&#65288;&#21487;&#29702;&#35299;&#20026;&#26041;&#27861;&#31614;&#21517;&#65289;&#21450; Method &#23454;&#20363;
    Map&lt;String, Method&gt; ms = new LinkedHashMap&lt;String, Method&gt;();
    // mns &#20026;&#26041;&#27861;&#21517;&#21015;&#34920;
    List&lt;String&gt; mns = new ArrayList&lt;String&gt;();
    // dmns &#29992;&#20110;&#23384;&#20648;&#8220;&#23450;&#20041;&#22312;&#24403;&#21069;&#31867;&#20013;&#30340;&#26041;&#27861;&#8221;&#30340;&#21517;&#31216;
    List&lt;String&gt; dmns = new ArrayList&lt;String&gt;();

    // --------------------------------&#10024; &#20998;&#21106;&#32447;1 &#10024;-------------------------------------

    // &#33719;&#21462; public &#35775;&#38382;&#32423;&#21035;&#30340;&#23383;&#27573;&#65292;&#24182;&#20026;&#25152;&#26377;&#23383;&#27573;&#29983;&#25104;&#26465;&#20214;&#21028;&#26029;&#35821;&#21477;
    for (Field f : c.getFields()) {
        String fn = f.getName();
        Class&lt;?&gt; ft = f.getType();
        if (Modifier.isStatic(f.getModifiers()) || Modifier.isTransient(f.getModifiers()))
            // &#24573;&#30053;&#20851;&#38190;&#23383; static &#25110; transient &#20462;&#39280;&#30340;&#21464;&#37327;
            continue;

        // &#29983;&#25104;&#26465;&#20214;&#21028;&#26029;&#21450;&#36171;&#20540;&#35821;&#21477;&#65292;&#27604;&#22914;&#65306;
        // if( $2.equals("name") ) { w.name = (java.lang.String) $3; return;}
        // if( $2.equals("age") ) { w.age = ((Number) $3).intValue(); return;}
        c1.append(" if( $2.equals(\"").append(fn).append("\") ){ w.").append(fn).append("=").append(arg(ft, "$3")).append("; return; }");

        // &#29983;&#25104;&#26465;&#20214;&#21028;&#26029;&#21450;&#36820;&#22238;&#35821;&#21477;&#65292;&#27604;&#22914;&#65306;
        // if( $2.equals("name") ) { return ($w)w.name; }
        c2.append(" if( $2.equals(\"").append(fn).append("\") ){ return ($w)w.").append(fn).append("; }");

        // &#23384;&#20648; &lt;&#23383;&#27573;&#21517;, &#23383;&#27573;&#31867;&#22411;&gt; &#38190;&#20540;&#23545;&#21040; pts &#20013;
        pts.put(fn, ft);
    }

    // --------------------------------&#10024; &#20998;&#21106;&#32447;2 &#10024;-------------------------------------

    Method[] methods = c.getMethods();
    // &#26816;&#27979; c &#20013;&#26159;&#21542;&#21253;&#21547;&#22312;&#24403;&#21069;&#31867;&#20013;&#22768;&#26126;&#30340;&#26041;&#27861;
    boolean hasMethod = hasMethods(methods);
    if (hasMethod) {
        c3.append(" try{");
    }
    for (Method m : methods) {
        if (m.getDeclaringClass() == Object.class)
            // &#24573;&#30053; Object &#20013;&#23450;&#20041;&#30340;&#26041;&#27861;
            continue;

        String mn = m.getName();
        // &#29983;&#25104;&#26041;&#27861;&#21517;&#21028;&#26029;&#35821;&#21477;&#65292;&#27604;&#22914;&#65306;
        // if ( "sayHello".equals( $2 )
        c3.append(" if( \"").append(mn).append("\".equals( $2 ) ");
        int len = m.getParameterTypes().length;
        // &#29983;&#25104;&#8220;&#36816;&#34892;&#26102;&#20256;&#20837;&#30340;&#21442;&#25968;&#25968;&#37327;&#19982;&#26041;&#27861;&#21442;&#25968;&#21015;&#34920;&#38271;&#24230;&#8221;&#21028;&#26029;&#35821;&#21477;&#65292;&#27604;&#22914;&#65306;
        // &amp;&amp; $3.length == 2
        c3.append(" &amp;&amp; ").append(" $3.length == ").append(len);

        boolean override = false;
        for (Method m2 : methods) {
            // &#26816;&#27979;&#26041;&#27861;&#26159;&#21542;&#23384;&#22312;&#37325;&#36733;&#24773;&#20917;&#65292;&#26465;&#20214;&#20026;&#65306;&#26041;&#27861;&#23545;&#35937;&#19981;&#21516; &amp;&amp; &#26041;&#27861;&#21517;&#30456;&#21516;
            if (m != m2 &amp;&amp; m.getName().equals(m2.getName())) {
                override = true;
                break;
            }
        }
        // &#23545;&#37325;&#36733;&#26041;&#27861;&#36827;&#34892;&#22788;&#29702;&#65292;&#32771;&#34385;&#19979;&#38754;&#30340;&#26041;&#27861;&#65306;
        //    1. void sayHello(Integer, String)
        //    2. void sayHello(Integer, Integer)
        // &#26041;&#27861;&#21517;&#30456;&#21516;&#65292;&#21442;&#25968;&#21015;&#34920;&#38271;&#24230;&#20063;&#30456;&#21516;&#65292;&#22240;&#27492;&#19981;&#33021;&#20165;&#36890;&#36807;&#36825;&#20004;&#39033;&#21028;&#26029;&#20004;&#20010;&#26041;&#27861;&#26159;&#21542;&#30456;&#31561;&#12290;
        // &#38656;&#35201;&#36827;&#19968;&#27493;&#21028;&#26029;&#26041;&#27861;&#30340;&#21442;&#25968;&#31867;&#22411;
        if (override) {
            if (len &gt; 0) {
                for (int l = 0; l &lt; len; l++) {
                    // &#29983;&#25104;&#21442;&#25968;&#31867;&#22411;&#36827;&#34892;&#26816;&#27979;&#20195;&#30721;&#65292;&#27604;&#22914;&#65306;
                    // &amp;&amp; $3[0].getName().equals("java.lang.Integer") 
                    //    &amp;&amp; $3[1].getName().equals("java.lang.String")
                    c3.append(" &amp;&amp; ").append(" $3[").append(l).append("].getName().equals(\"")
                            .append(m.getParameterTypes()[l].getName()).append("\")");
                }
            }
        }

        // &#28155;&#21152; ) {&#65292;&#23436;&#25104;&#26041;&#27861;&#21028;&#26029;&#35821;&#21477;&#65292;&#27492;&#26102;&#29983;&#25104;&#30340;&#20195;&#30721;&#21487;&#33021;&#22914;&#19979;&#65288;&#24050;&#26684;&#24335;&#21270;&#65289;&#65306;
        // if ("sayHello".equals($2) 
        //     &amp;&amp; $3.length == 2
        //     &amp;&amp; $3[0].getName().equals("java.lang.Integer") 
        //     &amp;&amp; $3[1].getName().equals("java.lang.String")) {
        c3.append(" ) { ");

        // &#26681;&#25454;&#36820;&#22238;&#20540;&#31867;&#22411;&#29983;&#25104;&#30446;&#26631;&#26041;&#27861;&#35843;&#29992;&#35821;&#21477;
        if (m.getReturnType() == Void.TYPE)
            // w.sayHello((java.lang.Integer)$4[0], (java.lang.String)$4[1]); return null;
            c3.append(" w.").append(mn).append('(').append(args(m.getParameterTypes(), "$4")).append(");").append(" return null;");
        else
            // return w.sayHello((java.lang.Integer)$4[0], (java.lang.String)$4[1]);
            c3.append(" return ($w)w.").append(mn).append('(').append(args(m.getParameterTypes(), "$4")).append(");");

        // &#28155;&#21152; }, &#29983;&#25104;&#30340;&#20195;&#30721;&#24418;&#22914;&#65288;&#24050;&#26684;&#24335;&#21270;&#65289;&#65306;
        // if ("sayHello".equals($2) 
        //     &amp;&amp; $3.length == 2
        //     &amp;&amp; $3[0].getName().equals("java.lang.Integer") 
        //     &amp;&amp; $3[1].getName().equals("java.lang.String")) {
        //
        //     w.sayHello((java.lang.Integer)$4[0], (java.lang.String)$4[1]); 
        //     return null;
        // }
        c3.append(" }");

        // &#28155;&#21152;&#26041;&#27861;&#21517;&#21040; mns &#38598;&#21512;&#20013;
        mns.add(mn);
        // &#26816;&#27979;&#24403;&#21069;&#26041;&#27861;&#26159;&#21542;&#22312; c &#20013;&#34987;&#22768;&#26126;&#30340;
        if (m.getDeclaringClass() == c)
            // &#33509;&#26159;&#65292;&#21017;&#23558;&#24403;&#21069;&#26041;&#27861;&#21517;&#28155;&#21152;&#21040; dmns &#20013;
            dmns.add(mn);
        ms.put(ReflectUtils.getDesc(m), m);
    }
    if (hasMethod) {
        // &#28155;&#21152;&#24322;&#24120;&#25429;&#25417;&#35821;&#21477;
        c3.append(" } catch(Throwable e) { ");
        c3.append("     throw new java.lang.reflect.InvocationTargetException(e); ");
        c3.append(" }");
    }

    // &#28155;&#21152; NoSuchMethodException &#24322;&#24120;&#25243;&#20986;&#20195;&#30721;
    c3.append(" throw new " + NoSuchMethodException.class.getName() + "(\"Not found method \\\"\"+$2+\"\\\" in class " + c.getName() + ".\"); }");

    // --------------------------------&#10024; &#20998;&#21106;&#32447;3 &#10024;-------------------------------------

    Matcher matcher;
    // &#22788;&#29702; get/set &#26041;&#27861;
    for (Map.Entry&lt;String, Method&gt; entry : ms.entrySet()) {
        String md = entry.getKey();
        Method method = (Method) entry.getValue();
        // &#21305;&#37197;&#20197; get &#24320;&#22836;&#30340;&#26041;&#27861;
        if ((matcher = ReflectUtils.GETTER_METHOD_DESC_PATTERN.matcher(md)).matches()) {
            // &#33719;&#21462;&#23646;&#24615;&#21517;
            String pn = propertyName(matcher.group(1));
            // &#29983;&#25104;&#23646;&#24615;&#21028;&#26029;&#20197;&#21450;&#36820;&#22238;&#35821;&#21477;&#65292;&#31034;&#20363;&#22914;&#19979;&#65306;
            // if( $2.equals("name") ) { return ($w).w.getName(); }
            c2.append(" if( $2.equals(\"").append(pn).append("\") ){ return ($w)w.").append(method.getName()).append("(); }");
            pts.put(pn, method.getReturnType());

        // &#21305;&#37197;&#20197; is/has/can &#24320;&#22836;&#30340;&#26041;&#27861;
        } else if ((matcher = ReflectUtils.IS_HAS_CAN_METHOD_DESC_PATTERN.matcher(md)).matches()) {
            String pn = propertyName(matcher.group(1));
            // &#29983;&#25104;&#23646;&#24615;&#21028;&#26029;&#20197;&#21450;&#36820;&#22238;&#35821;&#21477;&#65292;&#31034;&#20363;&#22914;&#19979;&#65306;
            // if( $2.equals("dream") ) { return ($w).w.hasDream(); }
            c2.append(" if( $2.equals(\"").append(pn).append("\") ){ return ($w)w.").append(method.getName()).append("(); }");
            pts.put(pn, method.getReturnType());

        // &#21305;&#37197;&#20197; set &#24320;&#22836;&#30340;&#26041;&#27861;
        } else if ((matcher = ReflectUtils.SETTER_METHOD_DESC_PATTERN.matcher(md)).matches()) {
            Class&lt;?&gt; pt = method.getParameterTypes()[0];
            String pn = propertyName(matcher.group(1));
            // &#29983;&#25104;&#23646;&#24615;&#21028;&#26029;&#20197;&#21450; setter &#35843;&#29992;&#35821;&#21477;&#65292;&#31034;&#20363;&#22914;&#19979;&#65306;
            // if( $2.equals("name") ) { w.setName((java.lang.String)$3); return; }
            c1.append(" if( $2.equals(\"").append(pn).append("\") ){ w.").append(method.getName()).append("(").append(arg(pt, "$3")).append("); return; }");
            pts.put(pn, pt);
        }
    }

    // &#28155;&#21152; NoSuchPropertyException &#24322;&#24120;&#25243;&#20986;&#20195;&#30721;
    c1.append(" throw new " + NoSuchPropertyException.class.getName() + "(\"Not found property \\\"\"+$2+\"\\\" filed or setter method in class " + c.getName() + ".\"); }");
    c2.append(" throw new " + NoSuchPropertyException.class.getName() + "(\"Not found property \\\"\"+$2+\"\\\" filed or setter method in class " + c.getName() + ".\"); }");

    // --------------------------------&#10024; &#20998;&#21106;&#32447;4 &#10024;-------------------------------------

    long id = WRAPPER_CLASS_COUNTER.getAndIncrement();
    // &#21019;&#24314;&#31867;&#29983;&#25104;&#22120;
    ClassGenerator cc = ClassGenerator.newInstance(cl);
    // &#35774;&#32622;&#31867;&#21517;&#21450;&#36229;&#31867;
    cc.setClassName((Modifier.isPublic(c.getModifiers()) ? Wrapper.class.getName() : c.getName() + "$sw") + id);
    cc.setSuperClass(Wrapper.class);

    // &#28155;&#21152;&#40664;&#35748;&#26500;&#36896;&#26041;&#27861;
    cc.addDefaultConstructor();

    // &#28155;&#21152;&#23383;&#27573;
    cc.addField("public static String[] pns;");
    cc.addField("public static " + Map.class.getName() + " pts;");
    cc.addField("public static String[] mns;");
    cc.addField("public static String[] dmns;");
    for (int i = 0, len = ms.size(); i &lt; len; i++)
        cc.addField("public static Class[] mts" + i + ";");

    // &#28155;&#21152;&#26041;&#27861;&#20195;&#30721;
    cc.addMethod("public String[] getPropertyNames(){ return pns; }");
    cc.addMethod("public boolean hasProperty(String n){ return pts.containsKey($1); }");
    cc.addMethod("public Class getPropertyType(String n){ return (Class)pts.get($1); }");
    cc.addMethod("public String[] getMethodNames(){ return mns; }");
    cc.addMethod("public String[] getDeclaredMethodNames(){ return dmns; }");
    cc.addMethod(c1.toString());
    cc.addMethod(c2.toString());
    cc.addMethod(c3.toString());

    try {
        // &#29983;&#25104;&#31867;
        Class&lt;?&gt; wc = cc.toClass();
        
        // &#35774;&#32622;&#23383;&#27573;&#20540;
        wc.getField("pts").set(null, pts);
        wc.getField("pns").set(null, pts.keySet().toArray(new String[0]));
        wc.getField("mns").set(null, mns.toArray(new String[0]));
        wc.getField("dmns").set(null, dmns.toArray(new String[0]));
        int ix = 0;
        for (Method m : ms.values())
            wc.getField("mts" + ix++).set(null, m.getParameterTypes());

        // &#21019;&#24314; Wrapper &#23454;&#20363;
        return (Wrapper) wc.newInstance();
    } catch (RuntimeException e) {
        throw e;
    } catch (Throwable e) {
        throw new RuntimeException(e.getMessage(), e);
    } finally {
        cc.release();
        ms.clear();
        mns.clear();
        dmns.clear();
    }
}</pre>
 <p class="ne-p" id="u2e5a39eb">
  <br>
 </p>
 <p class="ne-p" id="u7e54495c">
  <span class="ne-text">
   &#19978;&#38754;&#20195;&#30721;&#24456;&#38271;&#65292;&#22823;&#23478;&#32784;&#24515;&#30475;&#19968;&#19979;&#12290;&#25105;&#20204;&#22312;&#19978;&#38754;&#20195;&#30721;&#20013;&#20570;&#20102;&#22823;&#37327;&#30340;&#27880;&#37322;&#65292;&#24182;&#25353;&#21151;&#33021;&#23545;&#20195;&#30721;&#36827;&#34892;&#20102;&#20998;&#22359;&#65292;&#20197;&#24110;&#21161;&#22823;&#23478;&#29702;&#35299;&#20195;&#30721;&#36923;&#36753;&#12290;&#19979;&#38754;&#23545;&#36825;&#27573;&#20195;&#30721;&#36827;&#34892;&#35762;&#35299;&#12290;&#39318;&#20808;&#25105;&#20204;&#25226;&#30446;&#20809;&#31227;&#21040;&#20998;&#21106;&#32447;1&#20043;&#19978;&#30340;&#20195;&#30721;&#65292;&#36825;&#27573;&#20195;&#30721;&#20027;&#35201;&#29992;&#20110;&#36827;&#34892;&#19968;&#20123;&#21021;&#22987;&#21270;&#25805;&#20316;&#12290;&#27604;&#22914;&#21019;&#24314; c1&#12289;c2&#12289;c3 &#20197;&#21450; pts&#12289;ms&#12289;mns &#31561;&#21464;&#37327;&#65292;&#20197;&#21450;&#21521; c1&#12289;c2&#12289;c3 &#20013;&#28155;&#21152;&#26041;&#27861;&#23450;&#20041;&#21644;&#31867;&#22411;&#36716;&#25442;&#20195;&#30721;&#12290;&#25509;&#19979;&#26469;&#26159;&#20998;&#21106;&#32447;1&#21040;&#20998;&#21106;&#32447;2&#20043;&#38388;&#30340;&#20195;&#30721;&#65292;&#36825;&#27573;&#20195;&#30721;&#29992;&#20110;&#20026; public &#32423;&#21035;&#30340;&#23383;&#27573;&#29983;&#25104;&#26465;&#20214;&#21028;&#26029;&#21462;&#20540;&#19982;&#36171;&#20540;&#20195;&#30721;&#12290;&#36825;&#27573;&#20195;&#30721;&#19981;&#26159;&#24456;&#38590;&#30475;&#25026;&#65292;&#23601;&#19981;&#22810;&#35828;&#20102;&#12290;&#32487;&#32493;&#21521;&#19979;&#30475;&#65292;&#20998;&#21106;&#32447;2&#21644;&#20998;&#38548;&#32447;3&#20043;&#38388;&#30340;&#20195;&#30721;&#29992;&#20110;&#20026;&#23450;&#20041;&#22312;&#24403;&#21069;&#31867;&#20013;&#30340;&#26041;&#27861;&#29983;&#25104;&#21028;&#26029;&#35821;&#21477;&#65292;&#21644;&#26041;&#27861;&#35843;&#29992;&#35821;&#21477;&#12290;&#22240;&#20026;&#38656;&#35201;&#23545;&#26041;&#27861;&#37325;&#36733;&#36827;&#34892;&#26657;&#39564;&#65292;&#22240;&#27492;&#21040;&#36825;&#36825;&#27573;&#20195;&#30721;&#30475;&#36215;&#26469;&#26377;&#28857;&#22797;&#26434;&#12290;&#19981;&#36807;&#32784;&#24515;&#30475;&#19968;&#19979;&#65292;&#20063;&#19981;&#26159;&#24456;&#38590;&#29702;&#35299;&#12290;&#25509;&#19979;&#26469;&#26159;&#20998;&#21106;&#32447;3&#21644;&#20998;&#38548;&#32447;4&#20043;&#38388;&#30340;&#20195;&#30721;&#65292;&#36825;&#27573;&#20195;&#30721;&#29992;&#20110;&#22788;&#29702; getter&#12289;setter &#20197;&#21450;&#20197; is/has/can &#24320;&#22836;&#30340;&#26041;&#27861;&#12290;&#22788;&#29702;&#26041;&#24335;&#26159;&#36890;&#36807;&#27491;&#21017;&#34920;&#36798;&#24335;&#33719;&#21462;&#26041;&#27861;&#31867;&#22411;&#65288;get/set/is/&#8230;&#65289;&#65292;&#20197;&#21450;&#23646;&#24615;&#21517;&#12290;&#20043;&#21518;&#20026;&#23646;&#24615;&#21517;&#29983;&#25104;&#21028;&#26029;&#35821;&#21477;&#65292;&#28982;&#21518;&#20026;&#26041;&#27861;&#29983;&#25104;&#35843;&#29992;&#35821;&#21477;&#12290;&#26368;&#21518;&#25105;&#20204;&#20877;&#26469;&#30475;&#19968;&#19979;&#20998;&#38548;&#32447;4&#20197;&#19979;&#30340;&#20195;&#30721;&#65292;&#36825;&#27573;&#20195;&#30721;&#36890;&#36807; ClassGenerator &#20026;&#21018;&#21018;&#29983;&#25104;&#30340;&#20195;&#30721;&#26500;&#24314; Class &#31867;&#65292;&#24182;&#36890;&#36807;&#21453;&#23556;&#21019;&#24314;&#23545;&#35937;&#12290;ClassGenerator &#26159; Dubbo &#33258;&#24049;&#23553;&#35013;&#30340;&#65292;&#35813;&#31867;&#30340;&#26680;&#24515;&#26159; toClass() &#30340;&#37325;&#36733;&#26041;&#27861; toClass(ClassLoader, ProtectionDomain)&#65292;&#35813;&#26041;&#27861;&#36890;&#36807; javassist &#26500;&#24314; Class&#12290;&#36825;&#37324;&#23601;&#19981;&#20998;&#26512; toClass &#26041;&#27861;&#20102;&#65292;&#22823;&#23478;&#35831;&#33258;&#34892;&#20998;&#26512;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u1ffd511c">
  <br>
 </p>
 <p class="ne-p" id="u2b32c508">
  <span class="ne-text">
   &#38405;&#35835; Wrapper &#31867;&#20195;&#30721;&#38656;&#35201;&#23545; javassist &#26694;&#26550;&#26377;&#25152;&#20102;&#35299;&#12290;&#20851;&#20110; javassist&#65292;&#22823;&#23478;&#22914;&#26524;&#19981;&#29087;&#24713;&#65292;&#35831;&#33258;&#34892;&#26597;&#38405;&#36164;&#26009;&#65292;&#26412;&#33410;&#19981;&#25171;&#31639;&#20171;&#32461; javassist &#30456;&#20851;&#20869;&#23481;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u8a6350f3">
  <br>
 </p>
 <p class="ne-p" id="ubd91fe03">
  <span class="ne-text">
   &#22909;&#20102;&#65292;&#20851;&#20110; Wrapper &#31867;&#29983;&#25104;&#36807;&#31243;&#23601;&#20998;&#26512;&#21040;&#36825;&#12290;&#22914;&#26524;&#22823;&#23478;&#30475;&#30340;&#19981;&#26159;&#24456;&#26126;&#30333;&#65292;&#21487;&#20197;&#21333;&#29420;&#20026; Wrapper &#21019;&#24314;&#21333;&#20803;&#27979;&#35797;&#65292;&#28982;&#21518;&#21333;&#27493;&#35843;&#35797;&#12290;&#24182;&#23558;&#29983;&#25104;&#30340;&#20195;&#30721;&#25335;&#36125;&#20986;&#26469;&#65292;&#26684;&#24335;&#21270;&#21518;&#20877;&#36827;&#34892;&#35266;&#23519;&#21644;&#29702;&#35299;&#12290;
  </span>
 </p>
 <p class="ne-p" id="ud8caebd2">
  <br>
 </p>
 <h3 id="ff36161d">
  <span class="ne-text">
   2.2.2 &#23548;&#20986;&#26381;&#21153;&#21040;&#26412;&#22320;
  </span>
 </h3>
 <p class="ne-p" id="u52a9ce74">
  <br>
 </p>
 <p class="ne-p" id="u149be833">
  <span class="ne-text">
   &#26412;&#33410;&#25105;&#20204;&#26469;&#30475;&#19968;&#19979;&#26381;&#21153;&#23548;&#20986;&#30456;&#20851;&#30340;&#20195;&#30721;&#65292;&#25353;&#29031;&#20195;&#30721;&#25191;&#34892;&#39034;&#24207;&#65292;&#26412;&#33410;&#20808;&#26469;&#20998;&#26512;&#23548;&#20986;&#26381;&#21153;&#21040;&#26412;&#22320;&#30340;&#36807;&#31243;&#12290;&#30456;&#20851;&#20195;&#30721;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="ub8dce097">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="7e13fb15">private void exportLocal(URL url) {
    // &#22914;&#26524; URL &#30340;&#21327;&#35758;&#22836;&#31561;&#20110; injvm&#65292;&#35828;&#26126;&#24050;&#32463;&#23548;&#20986;&#21040;&#26412;&#22320;&#20102;&#65292;&#26080;&#38656;&#20877;&#27425;&#23548;&#20986;
    if (!Constants.LOCAL_PROTOCOL.equalsIgnoreCase(url.getProtocol())) {
        URL local = URL.valueOf(url.toFullString())
            .setProtocol(Constants.LOCAL_PROTOCOL)    // &#35774;&#32622;&#21327;&#35758;&#22836;&#20026; injvm
            .setHost(LOCALHOST)
            .setPort(0);
        ServiceClassHolder.getInstance().pushServiceClass(getServiceClass(ref));
        // &#21019;&#24314; Invoker&#65292;&#24182;&#23548;&#20986;&#26381;&#21153;&#65292;&#36825;&#37324;&#30340; protocol &#20250;&#22312;&#36816;&#34892;&#26102;&#35843;&#29992; InjvmProtocol &#30340; export &#26041;&#27861;
        Exporter&lt;?&gt; exporter = protocol.export(
            proxyFactory.getInvoker(ref, (Class) interfaceClass, local));
        exporters.add(exporter);
    }
}</pre>
 <p class="ne-p" id="u9af62782">
  <br>
 </p>
 <p class="ne-p" id="ud8c455dd">
  <span class="ne-text">
   exportLocal &#26041;&#27861;&#27604;&#36739;&#31616;&#21333;&#65292;&#39318;&#20808;&#26681;&#25454; URL &#21327;&#35758;&#22836;&#20915;&#23450;&#26159;&#21542;&#23548;&#20986;&#26381;&#21153;&#12290;&#33509;&#38656;&#23548;&#20986;&#65292;&#21017;&#21019;&#24314;&#19968;&#20010;&#26032;&#30340; URL &#24182;&#23558;&#21327;&#35758;&#22836;&#12289;&#20027;&#26426;&#21517;&#20197;&#21450;&#31471;&#21475;&#35774;&#32622;&#25104;&#26032;&#30340;&#20540;&#12290;&#28982;&#21518;&#21019;&#24314; Invoker&#65292;&#24182;&#35843;&#29992; InjvmProtocol &#30340; export &#26041;&#27861;&#23548;&#20986;&#26381;&#21153;&#12290;&#19979;&#38754;&#25105;&#20204;&#26469;&#30475;&#19968;&#19979; InjvmProtocol &#30340; export &#26041;&#27861;&#37117;&#20570;&#20102;&#21738;&#20123;&#20107;&#24773;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u91fe737d">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="085876f2">public &lt;T&gt; Exporter&lt;T&gt; export(Invoker&lt;T&gt; invoker) throws RpcException {
    // &#21019;&#24314; InjvmExporter
    return new InjvmExporter&lt;T&gt;(invoker, invoker.getUrl().getServiceKey(), exporterMap);
}</pre>
 <p class="ne-p" id="udabec8e4">
  <br>
 </p>
 <p class="ne-p" id="u9347c5c6">
  <span class="ne-text">
   &#22914;&#19978;&#65292;InjvmProtocol &#30340; export &#26041;&#27861;&#20165;&#21019;&#24314;&#20102;&#19968;&#20010; InjvmExporter&#65292;&#26080;&#20854;&#20182;&#36923;&#36753;&#12290;&#21040;&#27492;&#23548;&#20986;&#26381;&#21153;&#21040;&#26412;&#22320;&#23601;&#20998;&#26512;&#23436;&#20102;&#65292;&#25509;&#19979;&#26469;&#65292;&#25105;&#20204;&#32487;&#32493;&#20998;&#26512;&#23548;&#20986;&#26381;&#21153;&#21040;&#36828;&#31243;&#30340;&#36807;&#31243;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u9fba9ed6">
  <br>
 </p>
 <h3 id="3fbfa5a3">
  <span class="ne-text">
   2.2.3 &#23548;&#20986;&#26381;&#21153;&#21040;&#36828;&#31243;
  </span>
 </h3>
 <p class="ne-p" id="u03bb3def">
  <br>
 </p>
 <p class="ne-p" id="u0e50e96c">
  <span class="ne-text">
   &#19982;&#23548;&#20986;&#26381;&#21153;&#21040;&#26412;&#22320;&#30456;&#27604;&#65292;&#23548;&#20986;&#26381;&#21153;&#21040;&#36828;&#31243;&#30340;&#36807;&#31243;&#35201;&#22797;&#26434;&#19981;&#23569;&#65292;&#20854;&#21253;&#21547;&#20102;&#26381;&#21153;&#23548;&#20986;&#19982;&#26381;&#21153;&#27880;&#20876;&#20004;&#20010;&#36807;&#31243;&#12290;&#36825;&#20004;&#20010;&#36807;&#31243;&#28041;&#21450;&#21040;&#20102;&#22823;&#37327;&#30340;&#35843;&#29992;&#65292;&#27604;&#36739;&#22797;&#26434;&#12290;&#25353;&#29031;&#20195;&#30721;&#25191;&#34892;&#39034;&#24207;&#65292;&#26412;&#33410;&#20808;&#26469;&#20998;&#26512;&#26381;&#21153;&#23548;&#20986;&#36923;&#36753;&#65292;&#26381;&#21153;&#27880;&#20876;&#36923;&#36753;&#23558;&#22312;&#19979;&#19968;&#33410;&#36827;&#34892;&#20998;&#26512;&#12290;&#19979;&#38754;&#24320;&#22987;&#20998;&#26512;&#65292;&#25105;&#20204;&#25226;&#30446;&#20809;&#31227;&#21160;&#21040; RegistryProtocol &#30340; export &#26041;&#27861;&#19978;&#12290;
  </span>
 </p>
 <p class="ne-p" id="ua47e8351">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="0263042f">public &lt;T&gt; Exporter&lt;T&gt; export(final Invoker&lt;T&gt; originInvoker) throws RpcException {
    // &#23548;&#20986;&#26381;&#21153;
    final ExporterChangeableWrapper&lt;T&gt; exporter = doLocalExport(originInvoker);

    // &#33719;&#21462;&#27880;&#20876;&#20013;&#24515; URL&#65292;&#20197; zookeeper &#27880;&#20876;&#20013;&#24515;&#20026;&#20363;&#65292;&#24471;&#21040;&#30340;&#31034;&#20363; URL &#22914;&#19979;&#65306;
    // zookeeper://127.0.0.1:2181/com.alibaba.dubbo.registry.RegistryService?application=demo-provider&amp;dubbo=2.0.2&amp;export=dubbo%3A%2F%2F172.17.48.52%3A20880%2Fcom.alibaba.dubbo.demo.DemoService%3Fanyhost%3Dtrue%26application%3Ddemo-provider
    URL registryUrl = getRegistryUrl(originInvoker);

    // &#26681;&#25454; URL &#21152;&#36733; Registry &#23454;&#29616;&#31867;&#65292;&#27604;&#22914; ZookeeperRegistry
    final Registry registry = getRegistry(originInvoker);
    
    // &#33719;&#21462;&#24050;&#27880;&#20876;&#30340;&#26381;&#21153;&#25552;&#20379;&#32773; URL&#65292;&#27604;&#22914;&#65306;
    // dubbo://172.17.48.52:20880/com.alibaba.dubbo.demo.DemoService?anyhost=true&amp;application=demo-provider&amp;dubbo=2.0.2&amp;generic=false&amp;interface=com.alibaba.dubbo.demo.DemoService&amp;methods=sayHello
    final URL registeredProviderUrl = getRegisteredProviderUrl(originInvoker);

    // &#33719;&#21462; register &#21442;&#25968;
    boolean register = registeredProviderUrl.getParameter("register", true);

    // &#21521;&#26381;&#21153;&#25552;&#20379;&#32773;&#19982;&#28040;&#36153;&#32773;&#27880;&#20876;&#34920;&#20013;&#27880;&#20876;&#26381;&#21153;&#25552;&#20379;&#32773;
    ProviderConsumerRegTable.registerProvider(originInvoker, registryUrl, registeredProviderUrl);

    // &#26681;&#25454; register &#30340;&#20540;&#20915;&#23450;&#26159;&#21542;&#27880;&#20876;&#26381;&#21153;
    if (register) {
        // &#21521;&#27880;&#20876;&#20013;&#24515;&#27880;&#20876;&#26381;&#21153;
        register(registryUrl, registeredProviderUrl);
        ProviderConsumerRegTable.getProviderWrapper(originInvoker).setReg(true);
    }

    // &#33719;&#21462;&#35746;&#38405; URL&#65292;&#27604;&#22914;&#65306;
    // provider://172.17.48.52:20880/com.alibaba.dubbo.demo.DemoService?category=configurators&amp;check=false&amp;anyhost=true&amp;application=demo-provider&amp;dubbo=2.0.2&amp;generic=false&amp;interface=com.alibaba.dubbo.demo.DemoService&amp;methods=sayHello
    final URL overrideSubscribeUrl = getSubscribedOverrideUrl(registeredProviderUrl);
    // &#21019;&#24314;&#30417;&#21548;&#22120;
    final OverrideListener overrideSubscribeListener = new OverrideListener(overrideSubscribeUrl, originInvoker);
    overrideListeners.put(overrideSubscribeUrl, overrideSubscribeListener);
    // &#21521;&#27880;&#20876;&#20013;&#24515;&#36827;&#34892;&#35746;&#38405; override &#25968;&#25454;
    registry.subscribe(overrideSubscribeUrl, overrideSubscribeListener);
    // &#21019;&#24314;&#24182;&#36820;&#22238; DestroyableExporter
    return new DestroyableExporter&lt;T&gt;(exporter, originInvoker, overrideSubscribeUrl, registeredProviderUrl);
}</pre>
 <p class="ne-p" id="u6e18980b">
  <br>
 </p>
 <p class="ne-p" id="u194bf501">
  <span class="ne-text">
   &#19978;&#38754;&#20195;&#30721;&#30475;&#36215;&#26469;&#27604;&#36739;&#22797;&#26434;&#65292;&#20027;&#35201;&#20570;&#22914;&#19979;&#19968;&#20123;&#25805;&#20316;&#65306;
  </span>
 </p>
 <p class="ne-p" id="ua0ab9361">
  <br>
 </p>
 <ol class="ne-ol">
  <li id="u68819898">
   <span class="ne-text">
    &#35843;&#29992; doLocalExport &#23548;&#20986;&#26381;&#21153;
   </span>
  </li>
  <li id="ud0e82f6a">
   <span class="ne-text">
    &#21521;&#27880;&#20876;&#20013;&#24515;&#27880;&#20876;&#26381;&#21153;
   </span>
  </li>
 </ol>
 <ol class="ne-ol" start="3">
  <li id="u242917a2">
   <span class="ne-text">
    &#21521;&#27880;&#20876;&#20013;&#24515;&#36827;&#34892;&#35746;&#38405; override &#25968;&#25454;
   </span>
  </li>
  <li id="u88e8ecf4">
   <span class="ne-text">
    &#21019;&#24314;&#24182;&#36820;&#22238; DestroyableExporter
   </span>
  </li>
 </ol>
 <p class="ne-p" id="ue16e4d1d">
  <br>
 </p>
 <p class="ne-p" id="u8acb3913">
  <span class="ne-text">
   &#22312;&#20197;&#19978;&#25805;&#20316;&#20013;&#65292;&#38500;&#20102;&#21019;&#24314;&#24182;&#36820;&#22238; DestroyableExporter &#27809;&#20160;&#20040;&#38590;&#24230;&#22806;&#65292;&#20854;&#20182;&#20960;&#27493;&#25805;&#20316;&#37117;&#19981;&#26159;&#24456;&#31616;&#21333;&#12290;&#36825;&#20854;&#20013;&#65292;&#23548;&#20986;&#26381;&#21153;&#21644;&#27880;&#20876;&#26381;&#21153;&#26159;&#26412;&#31456;&#35201;&#37325;&#28857;&#20998;&#26512;&#30340;&#36923;&#36753;&#12290; &#35746;&#38405; override &#25968;&#25454;&#24182;&#38750;&#26412;&#25991;&#37325;&#28857;&#20869;&#23481;&#65292;&#21518;&#38754;&#20250;&#31616;&#21333;&#20171;&#32461;&#19968;&#19979;&#12290;&#19979;&#38754;&#20808;&#26469;&#20998;&#26512; doLocalExport &#26041;&#27861;&#30340;&#36923;&#36753;&#65292;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u095124a9">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="84afef2c">private &lt;T&gt; ExporterChangeableWrapper&lt;T&gt; doLocalExport(final Invoker&lt;T&gt; originInvoker) {
    String key = getCacheKey(originInvoker);
    // &#35775;&#38382;&#32531;&#23384;
    ExporterChangeableWrapper&lt;T&gt; exporter = (ExporterChangeableWrapper&lt;T&gt;) bounds.get(key);
    if (exporter == null) {
        synchronized (bounds) {
            exporter = (ExporterChangeableWrapper&lt;T&gt;) bounds.get(key);
            if (exporter == null) {
                // &#21019;&#24314; Invoker &#20026;&#22996;&#25176;&#31867;&#23545;&#35937;
                final Invoker&lt;?&gt; invokerDelegete = new InvokerDelegete&lt;T&gt;(originInvoker, getProviderUrl(originInvoker));
                // &#35843;&#29992; protocol &#30340; export &#26041;&#27861;&#23548;&#20986;&#26381;&#21153;
                exporter = new ExporterChangeableWrapper&lt;T&gt;((Exporter&lt;T&gt;) protocol.export(invokerDelegete), originInvoker);
                
                // &#20889;&#32531;&#23384;
                bounds.put(key, exporter);
            }
        }
    }
    return exporter;
}</pre>
 <p class="ne-p" id="u1eb6e79d">
  <br>
 </p>
 <p class="ne-p" id="u8201fd81">
  <span class="ne-text">
   &#19978;&#38754;&#30340;&#20195;&#30721;&#26159;&#20856;&#22411;&#30340;&#21452;&#37325;&#26816;&#26597;&#38145;&#65292;&#22823;&#23478;&#22312;&#38405;&#35835; Dubbo &#30340;&#28304;&#30721;&#20013;&#65292;&#20250;&#22810;&#27425;&#35265;&#21040;&#12290;&#25509;&#19979;&#26469;&#65292;&#25105;&#20204;&#25226;&#37325;&#28857;&#25918;&#22312; Protocol &#30340; export &#26041;&#27861;&#19978;&#12290;&#20551;&#35774;&#36816;&#34892;&#26102;&#21327;&#35758;&#20026; dubbo&#65292;&#27492;&#22788;&#30340; protocol &#21464;&#37327;&#20250;&#22312;&#36816;&#34892;&#26102;&#21152;&#36733; DubboProtocol&#65292;&#24182;&#35843;&#29992; DubboProtocol &#30340; export &#26041;&#27861;&#12290;&#25152;&#20197;&#65292;&#25509;&#19979;&#26469;&#25105;&#20204;&#30446;&#20809;&#36716;&#31227;&#21040; DubboProtocol &#30340; export &#26041;&#27861;&#19978;&#65292;&#30456;&#20851;&#20998;&#26512;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u28e224ef">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="d0069aff">public &lt;T&gt; Exporter&lt;T&gt; export(Invoker&lt;T&gt; invoker) throws RpcException {
    URL url = invoker.getUrl();

    // &#33719;&#21462;&#26381;&#21153;&#26631;&#35782;&#65292;&#29702;&#35299;&#25104;&#26381;&#21153;&#22352;&#26631;&#20063;&#34892;&#12290;&#30001;&#26381;&#21153;&#32452;&#21517;&#65292;&#26381;&#21153;&#21517;&#65292;&#26381;&#21153;&#29256;&#26412;&#21495;&#20197;&#21450;&#31471;&#21475;&#32452;&#25104;&#12290;&#27604;&#22914;&#65306;
    // demoGroup/com.alibaba.dubbo.demo.DemoService:1.0.1:20880
    String key = serviceKey(url);
    // &#21019;&#24314; DubboExporter
    DubboExporter&lt;T&gt; exporter = new DubboExporter&lt;T&gt;(invoker, key, exporterMap);
    // &#23558; &lt;key, exporter&gt; &#38190;&#20540;&#23545;&#25918;&#20837;&#32531;&#23384;&#20013;
    exporterMap.put(key, exporter);

    // &#26412;&#22320;&#23384;&#26681;&#30456;&#20851;&#20195;&#30721;
    Boolean isStubSupportEvent = url.getParameter(Constants.STUB_EVENT_KEY, Constants.DEFAULT_STUB_EVENT);
    Boolean isCallbackservice = url.getParameter(Constants.IS_CALLBACK_SERVICE, false);
    if (isStubSupportEvent &amp;&amp; !isCallbackservice) {
        String stubServiceMethods = url.getParameter(Constants.STUB_EVENT_METHODS_KEY);
        if (stubServiceMethods == null || stubServiceMethods.length() == 0) {
            // &#30465;&#30053;&#26085;&#24535;&#25171;&#21360;&#20195;&#30721;
        } else {
            stubServiceMethodsMap.put(url.getServiceKey(), stubServiceMethods);
        }
    }

    // &#21551;&#21160;&#26381;&#21153;&#22120;
    openServer(url);
    // &#20248;&#21270;&#24207;&#21015;&#21270;
    optimizeSerialization(url);
    return exporter;
}</pre>
 <p class="ne-p" id="u02d47d11">
  <br>
 </p>
 <p class="ne-p" id="u1459cb87">
  <span class="ne-text">
   &#22914;&#19978;&#65292;&#25105;&#20204;&#37325;&#28857;&#20851;&#27880; DubboExporter &#30340;&#21019;&#24314;&#20197;&#21450; openServer &#26041;&#27861;&#65292;&#20854;&#20182;&#36923;&#36753;&#30475;&#19981;&#25026;&#20063;&#27809;&#20851;&#31995;&#65292;&#19981;&#24433;&#21709;&#29702;&#35299;&#26381;&#21153;&#23548;&#20986;&#36807;&#31243;&#12290;&#21478;&#22806;&#65292;DubboExporter &#30340;&#20195;&#30721;&#27604;&#36739;&#31616;&#21333;&#65292;&#23601;&#19981;&#20998;&#26512;&#20102;&#12290;&#19979;&#38754;&#20998;&#26512; openServer &#26041;&#27861;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u2206ce87">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="0c4100e7">private void openServer(URL url) {
    // &#33719;&#21462; host:port&#65292;&#24182;&#23558;&#20854;&#20316;&#20026;&#26381;&#21153;&#22120;&#23454;&#20363;&#30340; key&#65292;&#29992;&#20110;&#26631;&#35782;&#24403;&#21069;&#30340;&#26381;&#21153;&#22120;&#23454;&#20363;
    String key = url.getAddress();
    boolean isServer = url.getParameter(Constants.IS_SERVER_KEY, true);
    if (isServer) {
        // &#35775;&#38382;&#32531;&#23384;
        ExchangeServer server = serverMap.get(key);
        if (server == null) {
            // &#21019;&#24314;&#26381;&#21153;&#22120;&#23454;&#20363;
            serverMap.put(key, createServer(url));
        } else {
            // &#26381;&#21153;&#22120;&#24050;&#21019;&#24314;&#65292;&#21017;&#26681;&#25454; url &#20013;&#30340;&#37197;&#32622;&#37325;&#32622;&#26381;&#21153;&#22120;
            server.reset(url);
        }
    }
}</pre>
 <p class="ne-p" id="u52b2f7fc">
  <br>
 </p>
 <p class="ne-p" id="u267e8acd">
  <span class="ne-text">
   &#22914;&#19978;&#65292;&#22312;&#21516;&#19968;&#21488;&#26426;&#22120;&#19978;&#65288;&#21333;&#32593;&#21345;&#65289;&#65292;&#21516;&#19968;&#20010;&#31471;&#21475;&#19978;&#20165;&#20801;&#35768;&#21551;&#21160;&#19968;&#20010;&#26381;&#21153;&#22120;&#23454;&#20363;&#12290;&#33509;&#26576;&#20010;&#31471;&#21475;&#19978;&#24050;&#26377;&#26381;&#21153;&#22120;&#23454;&#20363;&#65292;&#27492;&#26102;&#21017;&#35843;&#29992; reset &#26041;&#27861;&#37325;&#32622;&#26381;&#21153;&#22120;&#30340;&#19968;&#20123;&#37197;&#32622;&#12290;&#32771;&#34385;&#21040;&#31687;&#24133;&#38382;&#39064;&#65292;&#20851;&#20110;&#26381;&#21153;&#22120;&#23454;&#20363;&#37325;&#32622;&#30340;&#20195;&#30721;&#23601;&#19981;&#20998;&#26512;&#20102;&#12290;&#25509;&#19979;&#26469;&#20998;&#26512;&#26381;&#21153;&#22120;&#23454;&#20363;&#30340;&#21019;&#24314;&#36807;&#31243;&#12290;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="ube071a05">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="d4b34547">private ExchangeServer createServer(URL url) {
    url = url.addParameterIfAbsent(Constants.CHANNEL_READONLYEVENT_SENT_KEY,
    // &#28155;&#21152;&#24515;&#36339;&#26816;&#27979;&#37197;&#32622;&#21040; url &#20013;
    url = url.addParameterIfAbsent(Constants.HEARTBEAT_KEY, String.valueOf(Constants.DEFAULT_HEARTBEAT));
	// &#33719;&#21462; server &#21442;&#25968;&#65292;&#40664;&#35748;&#20026; netty
    String str = url.getParameter(Constants.SERVER_KEY, Constants.DEFAULT_REMOTING_SERVER);

	// &#36890;&#36807; SPI &#26816;&#27979;&#26159;&#21542;&#23384;&#22312; server &#21442;&#25968;&#25152;&#20195;&#34920;&#30340; Transporter &#25299;&#23637;&#65292;&#19981;&#23384;&#22312;&#21017;&#25243;&#20986;&#24322;&#24120;
    if (str != null &amp;&amp; str.length() &gt; 0 &amp;&amp; !ExtensionLoader.getExtensionLoader(Transporter.class).hasExtension(str))
        throw new RpcException("Unsupported server type: " + str + ", url: " + url);

    // &#28155;&#21152;&#32534;&#30721;&#35299;&#30721;&#22120;&#21442;&#25968;
    url = url.addParameter(Constants.CODEC_KEY, DubboCodec.NAME);
    ExchangeServer server;
    try {
        // &#21019;&#24314; ExchangeServer
        server = Exchangers.bind(url, requestHandler);
    } catch (RemotingException e) {
        throw new RpcException("Fail to start server...");
    }
                                   
	// &#33719;&#21462; client &#21442;&#25968;&#65292;&#21487;&#25351;&#23450; netty&#65292;mina
    str = url.getParameter(Constants.CLIENT_KEY);
    if (str != null &amp;&amp; str.length() &gt; 0) {
        // &#33719;&#21462;&#25152;&#26377;&#30340; Transporter &#23454;&#29616;&#31867;&#21517;&#31216;&#38598;&#21512;&#65292;&#27604;&#22914; supportedTypes = [netty, mina]
        Set&lt;String&gt; supportedTypes = ExtensionLoader.getExtensionLoader(Transporter.class).getSupportedExtensions();
        // &#26816;&#27979;&#24403;&#21069; Dubbo &#25152;&#25903;&#25345;&#30340; Transporter &#23454;&#29616;&#31867;&#21517;&#31216;&#21015;&#34920;&#20013;&#65292;
        // &#26159;&#21542;&#21253;&#21547; client &#25152;&#34920;&#31034;&#30340; Transporter&#65292;&#33509;&#19981;&#21253;&#21547;&#65292;&#21017;&#25243;&#20986;&#24322;&#24120;
        if (!supportedTypes.contains(str)) {
            throw new RpcException("Unsupported client type...");
        }
    }
    return server;
}</pre>
 <p class="ne-p" id="ua186bbd3">
  <br>
 </p>
 <p class="ne-p" id="u88c6f094">
  <span class="ne-text">
   &#22914;&#19978;&#65292;createServer &#21253;&#21547;&#19977;&#20010;&#26680;&#24515;&#30340;&#36923;&#36753;&#12290;&#31532;&#19968;&#26159;&#26816;&#27979;&#26159;&#21542;&#23384;&#22312; server &#21442;&#25968;&#25152;&#20195;&#34920;&#30340; Transporter &#25299;&#23637;&#65292;&#19981;&#23384;&#22312;&#21017;&#25243;&#20986;&#24322;&#24120;&#12290;&#31532;&#20108;&#26159;&#21019;&#24314;&#26381;&#21153;&#22120;&#23454;&#20363;&#12290;&#31532;&#19977;&#26159;&#26816;&#27979;&#26159;&#21542;&#25903;&#25345; client &#21442;&#25968;&#25152;&#34920;&#31034;&#30340; Transporter &#25299;&#23637;&#65292;&#19981;&#23384;&#22312;&#20063;&#26159;&#25243;&#20986;&#24322;&#24120;&#12290;&#20004;&#27425;&#26816;&#27979;&#25805;&#20316;&#25152;&#23545;&#24212;&#30340;&#20195;&#30721;&#27604;&#36739;&#30452;&#30333;&#20102;&#65292;&#26080;&#38656;&#22810;&#35828;&#12290;&#20294;&#21019;&#24314;&#26381;&#21153;&#22120;&#30340;&#25805;&#20316;&#30446;&#21069;&#36824;&#19981;&#26159;&#24456;&#28165;&#26224;&#65292;&#25105;&#20204;&#32487;&#32493;&#24448;&#19979;&#30475;&#12290;
  </span>
 </p>
 <p class="ne-p" id="uf6b7fbe5">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="af0672ae">public static ExchangeServer bind(URL url, ExchangeHandler handler) throws RemotingException {
    if (url == null) {
        throw new IllegalArgumentException("url == null");
    }
    if (handler == null) {
        throw new IllegalArgumentException("handler == null");
    }
    url = url.addParameterIfAbsent(Constants.CODEC_KEY, "exchange");
    // &#33719;&#21462; Exchanger&#65292;&#40664;&#35748;&#20026; HeaderExchanger&#12290;
    // &#32039;&#25509;&#30528;&#35843;&#29992; HeaderExchanger &#30340; bind &#26041;&#27861;&#21019;&#24314; ExchangeServer &#23454;&#20363;
    return getExchanger(url).bind(url, handler);
}</pre>
 <p class="ne-p" id="ue907cb1b">
  <br>
 </p>
 <p class="ne-p" id="u711b2375">
  <span class="ne-text">
   &#19978;&#38754;&#20195;&#30721;&#27604;&#36739;&#31616;&#21333;&#65292;&#23601;&#19981;&#22810;&#35828;&#20102;&#12290;&#19979;&#38754;&#30475;&#19968;&#19979; HeaderExchanger &#30340; bind &#26041;&#27861;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u49facac7">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="f4fc57f9">public ExchangeServer bind(URL url, ExchangeHandler handler) throws RemotingException {
	// &#21019;&#24314; HeaderExchangeServer &#23454;&#20363;&#65292;&#35813;&#26041;&#27861;&#21253;&#21547;&#20102;&#22810;&#20010;&#36923;&#36753;&#65292;&#20998;&#21035;&#22914;&#19979;&#65306;
	//   1. new HeaderExchangeHandler(handler)
	//	 2. new DecodeHandler(new HeaderExchangeHandler(handler))
	//   3. Transporters.bind(url, new DecodeHandler(new HeaderExchangeHandler(handler)))
    return new HeaderExchangeServer(Transporters.bind(url, new DecodeHandler(new HeaderExchangeHandler(handler))));
}</pre>
 <p class="ne-p" id="uf8367a34">
  <br>
 </p>
 <p class="ne-p" id="uc61d4a64">
  <span class="ne-text">
   HeaderExchanger &#30340; bind &#26041;&#27861;&#21253;&#21547;&#30340;&#36923;&#36753;&#27604;&#36739;&#22810;&#65292;&#20294;&#30446;&#21069;&#25105;&#20204;&#20165;&#38656;&#20851;&#24515; Transporters &#30340; bind &#26041;&#27861;&#36923;&#36753;&#21363;&#21487;&#12290;&#35813;&#26041;&#27861;&#30340;&#20195;&#30721;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="uec27671a">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="06ba1538">public static Server bind(URL url, ChannelHandler... handlers) throws RemotingException {
    if (url == null) {
        throw new IllegalArgumentException("url == null");
    }
    if (handlers == null || handlers.length == 0) {
        throw new IllegalArgumentException("handlers == null");
    }
    ChannelHandler handler;
    if (handlers.length == 1) {
        handler = handlers[0];
    } else {
    	// &#22914;&#26524; handlers &#20803;&#32032;&#25968;&#37327;&#22823;&#20110;1&#65292;&#21017;&#21019;&#24314; ChannelHandler &#20998;&#21457;&#22120;
        handler = new ChannelHandlerDispatcher(handlers);
    }
    // &#33719;&#21462;&#33258;&#36866;&#24212; Transporter &#23454;&#20363;&#65292;&#24182;&#35843;&#29992;&#23454;&#20363;&#26041;&#27861;
    return getTransporter().bind(url, handler);
}</pre>
 <p class="ne-p" id="u090fed49">
  <br>
 </p>
 <p class="ne-p" id="uebb5f2ff">
  <span class="ne-text">
   &#22914;&#19978;&#65292;getTransporter() &#26041;&#27861;&#33719;&#21462;&#30340; Transporter &#26159;&#22312;&#36816;&#34892;&#26102;&#21160;&#24577;&#21019;&#24314;&#30340;&#65292;&#31867;&#21517;&#20026; Transporter
  </span>
  <span class="ne-math" id="jitlc">
   <img src="EPUB/0804f086-17da-11ed-81ff-acde48001122">
  </span>
  <span class="ne-text">
   Adaptive &#20250;&#22312;&#36816;&#34892;&#26102;&#26681;&#25454;&#20256;&#20837;&#30340; URL &#21442;&#25968;&#20915;&#23450;&#21152;&#36733;&#20160;&#20040;&#31867;&#22411;&#30340; Transporter&#65292;&#40664;&#35748;&#20026; NettyTransporter&#12290;&#19979;&#38754;&#25105;&#20204;&#32487;&#32493;&#36319;&#19979;&#21435;&#65292;&#36825;&#27425;&#20998;&#26512;&#30340;&#26159; NettyTransporter &#30340; bind &#26041;&#27861;&#12290;
  </span>
 </p>
 <p class="ne-p" id="ua6c0d422">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="775e1a3a">public Server bind(URL url, ChannelHandler listener) throws RemotingException {
	// &#21019;&#24314; NettyServer
	return new NettyServer(url, listener);
}</pre>
 <p class="ne-p" id="u1e1871cd">
  <br>
 </p>
 <p class="ne-p" id="u31d0977b">
  <span class="ne-text">
   &#36825;&#37324;&#20165;&#26377;&#19968;&#21477;&#21019;&#24314; NettyServer &#30340;&#20195;&#30721;&#65292;&#26080;&#38656;&#22810;&#35828;&#65292;&#25105;&#20204;&#32487;&#32493;&#21521;&#19979;&#30475;&#12290;
  </span>
 </p>
 <p class="ne-p" id="ua0139c74">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="37cbdd74">public class NettyServer extends AbstractServer implements Server {
    public NettyServer(URL url, ChannelHandler handler) throws RemotingException {
        // &#35843;&#29992;&#29238;&#31867;&#26500;&#36896;&#26041;&#27861;
        super(url, ChannelHandlers.wrap(handler, ExecutorUtil.setThreadName(url, SERVER_THREAD_POOL_NAME)));
    }
}


public abstract class AbstractServer extends AbstractEndpoint implements Server {
    public AbstractServer(URL url, ChannelHandler handler) throws RemotingException {
        // &#35843;&#29992;&#29238;&#31867;&#26500;&#36896;&#26041;&#27861;&#65292;&#36825;&#37324;&#23601;&#19981;&#29992;&#36319;&#36827;&#21435;&#20102;&#65292;&#27809;&#20160;&#20040;&#22797;&#26434;&#36923;&#36753;
        super(url, handler);
        localAddress = getUrl().toInetSocketAddress();

        // &#33719;&#21462; ip &#21644;&#31471;&#21475;
        String bindIp = getUrl().getParameter(Constants.BIND_IP_KEY, getUrl().getHost());
        int bindPort = getUrl().getParameter(Constants.BIND_PORT_KEY, getUrl().getPort());
        if (url.getParameter(Constants.ANYHOST_KEY, false) || NetUtils.isInvalidLocalHost(bindIp)) {
            // &#35774;&#32622; ip &#20026; 0.0.0.0
            bindIp = NetUtils.ANYHOST;
        }
        bindAddress = new InetSocketAddress(bindIp, bindPort);
        // &#33719;&#21462;&#26368;&#22823;&#21487;&#25509;&#21463;&#36830;&#25509;&#25968;
        this.accepts = url.getParameter(Constants.ACCEPTS_KEY, Constants.DEFAULT_ACCEPTS);
        this.idleTimeout = url.getParameter(Constants.IDLE_TIMEOUT_KEY, Constants.DEFAULT_IDLE_TIMEOUT);
        try {
            // &#35843;&#29992;&#27169;&#26495;&#26041;&#27861; doOpen &#21551;&#21160;&#26381;&#21153;&#22120;
            doOpen();
        } catch (Throwable t) {
            throw new RemotingException("Failed to bind ");
        }

        DataStore dataStore = ExtensionLoader.getExtensionLoader(DataStore.class).getDefaultExtension();
        executor = (ExecutorService) dataStore.get(Constants.EXECUTOR_SERVICE_COMPONENT_KEY, Integer.toString(url.getPort()));
    }
    
    protected abstract void doOpen() throws Throwable;

    protected abstract void doClose() throws Throwable;
}</pre>
 <p class="ne-p" id="u834d7282">
  <br>
 </p>
 <p class="ne-p" id="ua35c8bb2">
  <span class="ne-text">
   &#19978;&#38754;&#20195;&#30721;&#22810;&#20026;&#36171;&#20540;&#20195;&#30721;&#65292;&#19981;&#38656;&#35201;&#22810;&#35762;&#12290;&#25105;&#20204;&#37325;&#28857;&#20851;&#27880; doOpen &#25277;&#35937;&#26041;&#27861;&#65292;&#35813;&#26041;&#27861;&#38656;&#35201;&#23376;&#31867;&#23454;&#29616;&#12290;&#19979;&#38754;&#22238;&#21040; NettyServer &#20013;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u36e58040">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="1c0cb8dd">protected void doOpen() throws Throwable {
    NettyHelper.setNettyLoggerFactory();
    // &#21019;&#24314; boss &#21644; worker &#32447;&#31243;&#27744;
    ExecutorService boss = Executors.newCachedThreadPool(new NamedThreadFactory("NettyServerBoss", true));
    ExecutorService worker = Executors.newCachedThreadPool(new NamedThreadFactory("NettyServerWorker", true));
    ChannelFactory channelFactory = new NioServerSocketChannelFactory(boss, worker, getUrl().getPositiveParameter(Constants.IO_THREADS_KEY, Constants.DEFAULT_IO_THREADS));
    
    // &#21019;&#24314; ServerBootstrap
    bootstrap = new ServerBootstrap(channelFactory);

    final NettyHandler nettyHandler = new NettyHandler(getUrl(), this);
    channels = nettyHandler.getChannels();
    bootstrap.setOption("child.tcpNoDelay", true);
    // &#35774;&#32622; PipelineFactory
    bootstrap.setPipelineFactory(new ChannelPipelineFactory() {
        @Override
        public ChannelPipeline getPipeline() {
            NettyCodecAdapter adapter = new NettyCodecAdapter(getCodec(), getUrl(), NettyServer.this);
            ChannelPipeline pipeline = Channels.pipeline();
            pipeline.addLast("decoder", adapter.getDecoder());
            pipeline.addLast("encoder", adapter.getEncoder());
            pipeline.addLast("handler", nettyHandler);
            return pipeline;
        }
    });
    // &#32465;&#23450;&#21040;&#25351;&#23450;&#30340; ip &#21644;&#31471;&#21475;&#19978;
    channel = bootstrap.bind(getBindAddress());
}</pre>
 <p class="ne-p" id="udf36beca">
  <br>
 </p>
 <p class="ne-p" id="u68aa7619">
  <span class="ne-text">
   &#20197;&#19978;&#23601;&#26159; NettyServer &#21019;&#24314;&#30340;&#36807;&#31243;&#65292;dubbo &#40664;&#35748;&#20351;&#29992;&#30340; NettyServer &#26159;&#22522;&#20110; netty 3.x &#29256;&#26412;&#23454;&#29616;&#30340;&#65292;&#27604;&#36739;&#32769;&#20102;&#12290;&#22240;&#27492; Dubbo &#21478;&#22806;&#25552;&#20379;&#20102; netty 4.x &#29256;&#26412;&#30340; NettyServer&#65292;&#22823;&#23478;&#21487;&#22312;&#20351;&#29992; Dubbo &#30340;&#36807;&#31243;&#20013;&#25353;&#38656;&#36827;&#34892;&#37197;&#32622;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u15ee6c52">
  <br>
 </p>
 <p class="ne-p" id="u54966b87">
  <span class="ne-text">
   &#21040;&#27492;&#65292;&#20851;&#20110;&#26381;&#21153;&#23548;&#20986;&#30340;&#36807;&#31243;&#23601;&#20998;&#26512;&#23436;&#20102;&#12290;&#25972;&#20010;&#36807;&#31243;&#27604;&#36739;&#22797;&#26434;&#65292;&#22823;&#23478;&#22312;&#20998;&#26512;&#30340;&#36807;&#31243;&#20013;&#32784;&#24515;&#19968;&#20123;&#12290;&#24182;&#19988;&#22810;&#20889; Demo &#36827;&#34892;&#35843;&#35797;&#65292;&#20197;&#20415;&#33021;&#22815;&#26356;&#22909;&#30340;&#29702;&#35299;&#20195;&#30721;&#36923;&#36753;&#12290;
  </span>
 </p>
 <p class="ne-p" id="ubd99e12e">
  <br>
 </p>
 <p class="ne-p" id="u0bc324bb">
  <span class="ne-text">
   &#26412;&#33410;&#20869;&#23481;&#20808;&#21040;&#36825;&#37324;&#65292;&#25509;&#19979;&#26469;&#20998;&#26512;&#26381;&#21153;&#23548;&#20986;&#30340;&#21478;&#19968;&#22359;&#36923;&#36753; &#8212; &#26381;&#21153;&#27880;&#20876;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u8418e121">
  <br>
 </p>
 <h3 id="515c5bf1">
  <span class="ne-text">
   2.2.4 &#26381;&#21153;&#27880;&#20876;
  </span>
 </h3>
 <p class="ne-p" id="u0e81aed6">
  <br>
 </p>
 <p class="ne-p" id="ue423e888">
  <span class="ne-text">
   &#26412;&#33410;&#25105;&#20204;&#26469;&#20998;&#26512;&#26381;&#21153;&#27880;&#20876;&#36807;&#31243;&#65292;&#26381;&#21153;&#27880;&#20876;&#25805;&#20316;&#23545;&#20110; Dubbo &#26469;&#35828;&#19981;&#26159;&#24517;&#38656;&#30340;&#65292;&#36890;&#36807;&#26381;&#21153;&#30452;&#36830;&#30340;&#26041;&#24335;&#23601;&#21487;&#20197;&#32469;&#36807;&#27880;&#20876;&#20013;&#24515;&#12290;&#20294;&#36890;&#24120;&#25105;&#20204;&#19981;&#20250;&#36825;&#20040;&#20570;&#65292;&#30452;&#36830;&#26041;&#24335;&#19981;&#21033;&#20110;&#26381;&#21153;&#27835;&#29702;&#65292;&#20165;&#25512;&#33616;&#22312;&#27979;&#35797;&#26381;&#21153;&#26102;&#20351;&#29992;&#12290;&#23545;&#20110; Dubbo &#26469;&#35828;&#65292;&#27880;&#20876;&#20013;&#24515;&#34429;&#19981;&#26159;&#24517;&#38656;&#65292;&#20294;&#21364;&#26159;&#24517;&#35201;&#30340;&#12290;&#22240;&#27492;&#65292;&#20851;&#20110;&#27880;&#20876;&#20013;&#24515;&#20197;&#21450;&#26381;&#21153;&#27880;&#20876;&#30456;&#20851;&#36923;&#36753;&#65292;&#25105;&#20204;&#20063;&#38656;&#35201;&#25630;&#25026;&#12290;
  </span>
 </p>
 <p class="ne-p" id="uf62743b0">
  <br>
 </p>
 <p class="ne-p" id="ud556b8ee">
  <span class="ne-text">
   &#26412;&#33410;&#20869;&#23481;&#20197; Zookeeper &#27880;&#20876;&#20013;&#24515;&#20316;&#20026;&#20998;&#26512;&#30446;&#26631;&#65292;&#20854;&#20182;&#31867;&#22411;&#27880;&#20876;&#20013;&#24515;&#22823;&#23478;&#21487;&#33258;&#34892;&#20998;&#26512;&#12290;&#19979;&#38754;&#20174;&#26381;&#21153;&#27880;&#20876;&#30340;&#20837;&#21475;&#26041;&#27861;&#24320;&#22987;&#20998;&#26512;&#65292;&#25105;&#20204;&#25226;&#30446;&#20809;&#20877;&#27425;&#31227;&#21040; RegistryProtocol &#30340; export &#26041;&#27861;&#19978;&#12290;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u75a93829">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="36cb3087">public &lt;T&gt; Exporter&lt;T&gt; export(final Invoker&lt;T&gt; originInvoker) throws RpcException {
    
    // ${&#23548;&#20986;&#26381;&#21153;}
    
    // &#30465;&#30053;&#20854;&#20182;&#20195;&#30721;
    
    boolean register = registeredProviderUrl.getParameter("register", true);
    if (register) {
        // &#27880;&#20876;&#26381;&#21153;
        register(registryUrl, registeredProviderUrl);
        ProviderConsumerRegTable.getProviderWrapper(originInvoker).setReg(true);
    }
    
    final URL overrideSubscribeUrl = getSubscribedOverrideUrl(registeredProviderUrl);
    final OverrideListener overrideSubscribeListener = new OverrideListener(overrideSubscribeUrl, originInvoker);
    overrideListeners.put(overrideSubscribeUrl, overrideSubscribeListener);
    // &#35746;&#38405; override &#25968;&#25454;
    registry.subscribe(overrideSubscribeUrl, overrideSubscribeListener);

    // &#30465;&#30053;&#37096;&#20998;&#20195;&#30721;
}</pre>
 <p class="ne-p" id="u566fb833">
  <br>
 </p>
 <p class="ne-p" id="u27392f8e">
  <span class="ne-text">
   RegistryProtocol &#30340; export &#26041;&#27861;&#21253;&#21547;&#20102;&#26381;&#21153;&#23548;&#20986;&#65292;&#27880;&#20876;&#65292;&#20197;&#21450;&#25968;&#25454;&#35746;&#38405;&#31561;&#36923;&#36753;&#12290;&#20854;&#20013;&#26381;&#21153;&#23548;&#20986;&#36923;&#36753;&#19978;&#19968;&#33410;&#24050;&#32463;&#20998;&#26512;&#36807;&#20102;&#65292;&#26412;&#33410;&#23558;&#20998;&#26512;&#26381;&#21153;&#27880;&#20876;&#36923;&#36753;&#65292;&#30456;&#20851;&#20195;&#30721;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u2bbe237c">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="bba6f47a">public void register(URL registryUrl, URL registedProviderUrl) {
    // &#33719;&#21462; Registry
    Registry registry = registryFactory.getRegistry(registryUrl);
    // &#27880;&#20876;&#26381;&#21153;
    registry.register(registedProviderUrl);
}</pre>
 <p class="ne-p" id="u91789c7a">
  <br>
 </p>
 <p class="ne-p" id="u8725a537">
  <span class="ne-text">
   register &#26041;&#27861;&#21253;&#21547;&#20004;&#27493;&#25805;&#20316;&#65292;&#31532;&#19968;&#27493;&#26159;&#33719;&#21462;&#27880;&#20876;&#20013;&#24515;&#23454;&#20363;&#65292;&#31532;&#20108;&#27493;&#26159;&#21521;&#27880;&#20876;&#20013;&#24515;&#27880;&#20876;&#26381;&#21153;&#12290;&#25509;&#19979;&#26469;&#20998;&#20004;&#33410;&#20869;&#23481;&#23545;&#36825;&#20004;&#27493;&#25805;&#20316;&#36827;&#34892;&#20998;&#26512;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u68bad538">
  <br>
 </p>
 <h4 id="327c67d6">
  <span class="ne-text">
   2.2.4.1 &#21019;&#24314;&#27880;&#20876;&#20013;&#24515;
  </span>
 </h4>
 <p class="ne-p" id="u3ba8491f">
  <br>
 </p>
 <p class="ne-p" id="u2ac1e556">
  <span class="ne-text">
   &#26412;&#33410;&#20869;&#23481;&#20197; Zookeeper &#27880;&#20876;&#20013;&#24515;&#20026;&#20363;&#36827;&#34892;&#20998;&#26512;&#12290;&#19979;&#38754;&#20808;&#26469;&#30475;&#19968;&#19979; getRegistry &#26041;&#27861;&#30340;&#28304;&#30721;&#65292;&#36825;&#20010;&#26041;&#27861;&#30001; AbstractRegistryFactory &#23454;&#29616;&#12290;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u8e230c3e">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="743026c4">public Registry getRegistry(URL url) {
    url = url.setPath(RegistryService.class.getName())
            .addParameter(Constants.INTERFACE_KEY, RegistryService.class.getName())
            .removeParameters(Constants.EXPORT_KEY, Constants.REFER_KEY);
    String key = url.toServiceString();
    LOCK.lock();
    try {
    	// &#35775;&#38382;&#32531;&#23384;
        Registry registry = REGISTRIES.get(key);
        if (registry != null) {
            return registry;
        }
        
        // &#32531;&#23384;&#26410;&#21629;&#20013;&#65292;&#21019;&#24314; Registry &#23454;&#20363;
        registry = createRegistry(url);
        if (registry == null) {
            throw new IllegalStateException("Can not create registry...");
        }
        
        // &#20889;&#20837;&#32531;&#23384;
        REGISTRIES.put(key, registry);
        return registry;
    } finally {
        LOCK.unlock();
    }
}

protected abstract Registry createRegistry(URL url);</pre>
 <p class="ne-p" id="u3a48290b">
  <br>
 </p>
 <p class="ne-p" id="ubed8a186">
  <span class="ne-text">
   &#22914;&#19978;&#65292;getRegistry &#26041;&#27861;&#20808;&#35775;&#38382;&#32531;&#23384;&#65292;&#32531;&#23384;&#26410;&#21629;&#20013;&#21017;&#35843;&#29992; createRegistry &#21019;&#24314; Registry&#65292;&#28982;&#21518;&#20889;&#20837;&#32531;&#23384;&#12290;&#36825;&#37324;&#30340; createRegistry &#26159;&#19968;&#20010;&#27169;&#26495;&#26041;&#27861;&#65292;&#30001;&#20855;&#20307;&#30340;&#23376;&#31867;&#23454;&#29616;&#12290;&#22240;&#27492;&#65292;&#19979;&#38754;&#25105;&#20204;&#21040; ZookeeperRegistryFactory &#20013;&#25506;&#31350;&#19968;&#30058;&#12290;
  </span>
 </p>
 <p class="ne-p" id="ue2b2fde4">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="d1dc0890">public class ZookeeperRegistryFactory extends AbstractRegistryFactory {

    // zookeeperTransporter &#30001; SPI &#22312;&#36816;&#34892;&#26102;&#27880;&#20837;&#65292;&#31867;&#22411;&#20026; ZookeeperTransporter$Adaptive
    private ZookeeperTransporter zookeeperTransporter;

    public void setZookeeperTransporter(ZookeeperTransporter zookeeperTransporter) {
        this.zookeeperTransporter = zookeeperTransporter;
    }

    @Override
    public Registry createRegistry(URL url) {
        // &#21019;&#24314; ZookeeperRegistry
        return new ZookeeperRegistry(url, zookeeperTransporter);
    }
}</pre>
 <p class="ne-p" id="u45f30df5">
  <br>
 </p>
 <p class="ne-p" id="u48371801">
  <span class="ne-text">
   ZookeeperRegistryFactory &#30340; createRegistry &#26041;&#27861;&#20165;&#21253;&#21547;&#19968;&#21477;&#20195;&#30721;&#65292;&#26080;&#38656;&#35299;&#37322;&#65292;&#32487;&#32493;&#36319;&#19979;&#21435;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u99b6c7ea">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="78d4c382">public ZookeeperRegistry(URL url, ZookeeperTransporter zookeeperTransporter) {
    super(url);
    if (url.isAnyHost()) {
        throw new IllegalStateException("registry address == null");
    }
    
    // &#33719;&#21462;&#32452;&#21517;&#65292;&#40664;&#35748;&#20026; dubbo
    String group = url.getParameter(Constants.GROUP_KEY, DEFAULT_ROOT);
    if (!group.startsWith(Constants.PATH_SEPARATOR)) {
        // group = "/" + group
        group = Constants.PATH_SEPARATOR + group;
    }
    this.root = group;
    // &#21019;&#24314; Zookeeper &#23458;&#25143;&#31471;&#65292;&#40664;&#35748;&#20026; CuratorZookeeperTransporter
    zkClient = zookeeperTransporter.connect(url);
    // &#28155;&#21152;&#29366;&#24577;&#30417;&#21548;&#22120;
    zkClient.addStateListener(new StateListener() {
        @Override
        public void stateChanged(int state) {
            if (state == RECONNECTED) {
                try {
                    recover();
                } catch (Exception e) {
                    logger.error(e.getMessage(), e);
                }
            }
        }
    });
}</pre>
 <p class="ne-p" id="u6edc4f2a">
  <br>
 </p>
 <p class="ne-p" id="u9e2e855f">
  <span class="ne-text">
   &#22312;&#19978;&#38754;&#30340;&#20195;&#30721;&#20195;&#30721;&#20013;&#65292;&#25105;&#20204;&#37325;&#28857;&#20851;&#27880; ZookeeperTransporter &#30340; connect &#26041;&#27861;&#35843;&#29992;&#65292;&#36825;&#20010;&#26041;&#27861;&#29992;&#20110;&#21019;&#24314; Zookeeper &#23458;&#25143;&#31471;&#12290;&#21019;&#24314;&#22909; Zookeeper &#23458;&#25143;&#31471;&#65292;&#24847;&#21619;&#30528;&#27880;&#20876;&#20013;&#24515;&#30340;&#21019;&#24314;&#36807;&#31243;&#23601;&#32467;&#26463;&#20102;&#12290;&#25509;&#19979;&#26469;&#65292;&#20877;&#26469;&#20998;&#26512;&#19968;&#19979; Zookeeper &#23458;&#25143;&#31471;&#30340;&#21019;&#24314;&#36807;&#31243;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u72328741">
  <br>
 </p>
 <p class="ne-p" id="u6c82c1d5">
  <span class="ne-text">
   &#21069;&#38754;&#35828;&#36807;&#65292;&#36825;&#37324;&#30340; zookeeperTransporter &#31867;&#22411;&#20026;&#33258;&#36866;&#24212;&#25299;&#23637;&#31867;&#65292;&#22240;&#27492; connect &#26041;&#27861;&#20250;&#22312;&#34987;&#35843;&#29992;&#26102;&#20915;&#23450;&#21152;&#36733;&#20160;&#20040;&#31867;&#22411;&#30340; ZookeeperTransporter &#25299;&#23637;&#65292;&#40664;&#35748;&#20026; CuratorZookeeperTransporter&#12290;&#19979;&#38754;&#25105;&#20204;&#21040; CuratorZookeeperTransporter &#20013;&#30475;&#19968;&#30475;&#12290;
  </span>
 </p>
 <p class="ne-p" id="ubcf9c0fb">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="20ac6f8f">public ZookeeperClient connect(URL url) {
    // &#21019;&#24314; CuratorZookeeperClient
    return new CuratorZookeeperClient(url);
}</pre>
 <p class="ne-p" id="ua8076de0">
  <br>
 </p>
 <p class="ne-p" id="udb65c218">
  <span class="ne-text">
   &#32487;&#32493;&#21521;&#19979;&#30475;&#12290;
  </span>
 </p>
 <p class="ne-p" id="ue925a463">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="f1def88c">public class CuratorZookeeperClient extends AbstractZookeeperClient&lt;CuratorWatcher&gt; {

    private final CuratorFramework client;
    
    public CuratorZookeeperClient(URL url) {
        super(url);
        try {
            // &#21019;&#24314; CuratorFramework &#26500;&#36896;&#22120;
            CuratorFrameworkFactory.Builder builder = CuratorFrameworkFactory.builder()
                    .connectString(url.getBackupAddress())
                    .retryPolicy(new RetryNTimes(1, 1000))
                    .connectionTimeoutMs(5000);
            String authority = url.getAuthority();
            if (authority != null &amp;&amp; authority.length() &gt; 0) {
                builder = builder.authorization("digest", authority.getBytes());
            }
            // &#26500;&#24314; CuratorFramework &#23454;&#20363;
            client = builder.build();
            // &#28155;&#21152;&#30417;&#21548;&#22120;
            client.getConnectionStateListenable().addListener(new ConnectionStateListener() {
                @Override
                public void stateChanged(CuratorFramework client, ConnectionState state) {
                    if (state == ConnectionState.LOST) {
                        CuratorZookeeperClient.this.stateChanged(StateListener.DISCONNECTED);
                    } else if (state == ConnectionState.CONNECTED) {
                        CuratorZookeeperClient.this.stateChanged(StateListener.CONNECTED);
                    } else if (state == ConnectionState.RECONNECTED) {
                        CuratorZookeeperClient.this.stateChanged(StateListener.RECONNECTED);
                    }
                }
            });
            
            // &#21551;&#21160;&#23458;&#25143;&#31471;
            client.start();
        } catch (Exception e) {
            throw new IllegalStateException(e.getMessage(), e);
        }
    }
}</pre>
 <p class="ne-p" id="u465bd003">
  <br>
 </p>
 <p class="ne-p" id="uca15306a">
  <span class="ne-text">
   CuratorZookeeperClient &#26500;&#36896;&#26041;&#27861;&#20027;&#35201;&#29992;&#20110;&#21019;&#24314;&#21644;&#21551;&#21160; CuratorFramework &#23454;&#20363;&#12290;&#20197;&#19978;&#22522;&#26412;&#19978;&#37117;&#26159; Curator &#26694;&#26550;&#30340;&#20195;&#30721;&#65292;&#22823;&#23478;&#22914;&#26524;&#23545; Curator &#26694;&#26550;&#19981;&#26159;&#24456;&#20102;&#35299;&#65292;&#21487;&#20197;&#21442;&#32771; Curator &#23448;&#26041;&#25991;&#26723;&#12290;
  </span>
 </p>
 <p class="ne-p" id="uefd72d2c">
  <br>
 </p>
 <p class="ne-p" id="ucbd80e18">
  <span class="ne-text">
   &#26412;&#33410;&#20998;&#26512;&#20102; ZookeeperRegistry &#23454;&#20363;&#30340;&#21019;&#24314;&#36807;&#31243;&#65292;&#25972;&#20010;&#36807;&#31243;&#24182;&#19981;&#26159;&#24456;&#22797;&#26434;&#12290;&#22823;&#23478;&#22312;&#30475;&#23436;&#20998;&#26512;&#21518;&#65292;&#21487;&#20197;&#33258;&#34892;&#35843;&#35797;&#65292;&#20197;&#21152;&#28145;&#29702;&#35299;&#12290;&#29616;&#22312;&#27880;&#20876;&#20013;&#24515;&#23454;&#20363;&#21019;&#24314;&#22909;&#20102;&#65292;&#25509;&#19979;&#26469;&#35201;&#20570;&#30340;&#20107;&#24773;&#26159;&#21521;&#27880;&#20876;&#20013;&#24515;&#27880;&#20876;&#26381;&#21153;&#65292;&#25105;&#20204;&#32487;&#32493;&#24448;&#19979;&#30475;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u7b539b46">
  <br>
 </p>
 <h4 id="1f95ecf1">
  <span class="ne-text">
   2.2.4.2 &#33410;&#28857;&#21019;&#24314;
  </span>
 </h4>
 <p class="ne-p" id="u967c35a1">
  <br>
 </p>
 <p class="ne-p" id="u2d1d3a16">
  <span class="ne-text">
   &#20197; Zookeeper &#20026;&#20363;&#65292;&#25152;&#35859;&#30340;&#26381;&#21153;&#27880;&#20876;&#65292;&#26412;&#36136;&#19978;&#26159;&#23558;&#26381;&#21153;&#37197;&#32622;&#25968;&#25454;&#20889;&#20837;&#21040; Zookeeper &#30340;&#26576;&#20010;&#36335;&#24452;&#30340;&#33410;&#28857;&#19979;&#12290;&#20026;&#20102;&#35753;&#22823;&#23478;&#26377;&#19968;&#20010;&#30452;&#35266;&#30340;&#20102;&#35299;&#65292;&#19979;&#38754;&#25105;&#20204;&#23558; Dubbo &#30340; demo &#36305;&#36215;&#26469;&#65292;&#28982;&#21518;&#36890;&#36807; Zookeeper &#21487;&#35270;&#21270;&#23458;&#25143;&#31471;
  </span>
  <a class="ne-link" data-href="https://github.com/apache/zookeeper/tree/b79af153d0f98a4f3f3516910ed47234d7b3d74e/src/contrib/zooinspector" href="https://github.com/apache/zookeeper/tree/b79af153d0f98a4f3f3516910ed47234d7b3d74e/src/contrib/zooinspector" target="_blank">
   <span class="ne-text">
    ZooInspector
   </span>
  </a>
  <span class="ne-text">
   &#26597;&#30475;&#33410;&#28857;&#25968;&#25454;&#12290;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="ueb628964">
  <br>
 </p>
 <p class="ne-p" id="u25dfa721">
  <img class="ne-image" id="jrfUF" src="EPUB/imgjrfUF">
 </p>
 <p class="ne-p" id="u5d8b976b">
  <br>
 </p>
 <p class="ne-p" id="u5d754bfe">
  <span class="ne-text">
   &#20174;&#19978;&#22270;&#20013;&#21487;&#20197;&#30475;&#21040; com.alibaba.dubbo.demo.DemoService &#36825;&#20010;&#26381;&#21153;&#23545;&#24212;&#30340;&#37197;&#32622;&#20449;&#24687;&#65288;&#23384;&#20648;&#22312; URL &#20013;&#65289;&#26368;&#32456;&#34987;&#27880;&#20876;&#21040;&#20102; /dubbo/com.alibaba.dubbo.demo.DemoService/providers/ &#33410;&#28857;&#19979;&#12290;&#25630;&#25026;&#20102;&#26381;&#21153;&#27880;&#20876;&#30340;&#26412;&#36136;&#65292;&#37027;&#20040;&#25509;&#19979;&#26469;&#25105;&#20204;&#23601;&#21487;&#20197;&#21435;&#38405;&#35835;&#26381;&#21153;&#27880;&#20876;&#30340;&#20195;&#30721;&#20102;&#12290;&#26381;&#21153;&#27880;&#20876;&#30340;&#25509;&#21475;&#20026; register(URL)&#65292;&#36825;&#20010;&#26041;&#27861;&#23450;&#20041;&#22312; FailbackRegistry &#25277;&#35937;&#31867;&#20013;&#12290;&#20195;&#30721;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u2d799904">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="6166f48e">public void register(URL url) {
    super.register(url);
    failedRegistered.remove(url);
    failedUnregistered.remove(url);
    try {
        // &#27169;&#26495;&#26041;&#27861;&#65292;&#30001;&#23376;&#31867;&#23454;&#29616;
        doRegister(url);
    } catch (Exception e) {
        Throwable t = e;

        // &#33719;&#21462; check &#21442;&#25968;&#65292;&#33509; check = true &#23558;&#20250;&#30452;&#25509;&#25243;&#20986;&#24322;&#24120;
        boolean check = getUrl().getParameter(Constants.CHECK_KEY, true)
                &amp;&amp; url.getParameter(Constants.CHECK_KEY, true)
                &amp;&amp; !Constants.CONSUMER_PROTOCOL.equals(url.getProtocol());
        boolean skipFailback = t instanceof SkipFailbackWrapperException;
        if (check || skipFailback) {
            if (skipFailback) {
                t = t.getCause();
            }
            throw new IllegalStateException("Failed to register");
        } else {
            logger.error("Failed to register");
        }

        // &#35760;&#24405;&#27880;&#20876;&#22833;&#36133;&#30340;&#38142;&#25509;
        failedRegistered.add(url);
    }
}

protected abstract void doRegister(URL url);</pre>
 <p class="ne-p" id="ud8e4c4f7">
  <br>
 </p>
 <p class="ne-p" id="u4e2d0ff3">
  <span class="ne-text">
   &#22914;&#19978;&#65292;&#25105;&#20204;&#37325;&#28857;&#20851;&#27880; doRegister &#26041;&#27861;&#35843;&#29992;&#21363;&#21487;&#65292;&#20854;&#20182;&#30340;&#20195;&#30721;&#20808;&#24573;&#30053;&#12290;doRegister &#26041;&#27861;&#26159;&#19968;&#20010;&#27169;&#26495;&#26041;&#27861;&#65292;&#22240;&#27492;&#25105;&#20204;&#21040; FailbackRegistry &#23376;&#31867; ZookeeperRegistry &#20013;&#36827;&#34892;&#20998;&#26512;&#12290;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u2872720b">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="ffc48746">protected void doRegister(URL url) {
    try {
        // &#36890;&#36807; Zookeeper &#23458;&#25143;&#31471;&#21019;&#24314;&#33410;&#28857;&#65292;&#33410;&#28857;&#36335;&#24452;&#30001; toUrlPath &#26041;&#27861;&#29983;&#25104;&#65292;&#36335;&#24452;&#26684;&#24335;&#22914;&#19979;:
        //   /${group}/${serviceInterface}/providers/${url}
        // &#27604;&#22914;
        //   /dubbo/org.apache.dubbo.DemoService/providers/dubbo%3A%2F%2F127.0.0.1......
        zkClient.create(toUrlPath(url), url.getParameter(Constants.DYNAMIC_KEY, true));
    } catch (Throwable e) {
        throw new RpcException("Failed to register...");
    }
}</pre>
 <p class="ne-p" id="ud1d6bdee">
  <br>
 </p>
 <p class="ne-p" id="u0622c1b0">
  <span class="ne-text">
   &#22914;&#19978;&#65292;ZookeeperRegistry &#22312; doRegister &#20013;&#35843;&#29992;&#20102; Zookeeper &#23458;&#25143;&#31471;&#21019;&#24314;&#26381;&#21153;&#33410;&#28857;&#12290;&#33410;&#28857;&#36335;&#24452;&#30001; toUrlPath &#26041;&#27861;&#29983;&#25104;&#65292;&#35813;&#26041;&#27861;&#36923;&#36753;&#19981;&#38590;&#29702;&#35299;&#65292;&#23601;&#19981;&#20998;&#26512;&#20102;&#12290;&#25509;&#19979;&#26469;&#20998;&#26512; create &#26041;&#27861;&#65292;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u03fdabc6">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="b7ad3c14">public void create(String path, boolean ephemeral) {
    if (!ephemeral) {
        // &#22914;&#26524;&#35201;&#21019;&#24314;&#30340;&#33410;&#28857;&#31867;&#22411;&#38750;&#20020;&#26102;&#33410;&#28857;&#65292;&#37027;&#20040;&#36825;&#37324;&#35201;&#26816;&#27979;&#33410;&#28857;&#26159;&#21542;&#23384;&#22312;
        if (checkExists(path)) {
            return;
        }
    }
    int i = path.lastIndexOf('/');
    if (i &gt; 0) {
        // &#36882;&#24402;&#21019;&#24314;&#19978;&#19968;&#32423;&#36335;&#24452;
        create(path.substring(0, i), false);
    }
    
    // &#26681;&#25454; ephemeral &#30340;&#20540;&#21019;&#24314;&#20020;&#26102;&#25110;&#25345;&#20037;&#33410;&#28857;
    if (ephemeral) {
        createEphemeral(path);
    } else {
        createPersistent(path);
    }
}</pre>
 <p class="ne-p" id="uf930299a">
  <br>
 </p>
 <p class="ne-p" id="u46a5834b">
  <span class="ne-text">
   &#19978;&#38754;&#26041;&#27861;&#20808;&#26159;&#36890;&#36807;&#36882;&#24402;&#21019;&#24314;&#24403;&#21069;&#33410;&#28857;&#30340;&#19978;&#19968;&#32423;&#36335;&#24452;&#65292;&#28982;&#21518;&#20877;&#26681;&#25454; ephemeral &#30340;&#20540;&#20915;&#23450;&#21019;&#24314;&#20020;&#26102;&#36824;&#26159;&#25345;&#20037;&#33410;&#28857;&#12290;createEphemeral &#21644; createPersistent &#36825;&#20004;&#20010;&#26041;&#27861;&#37117;&#27604;&#36739;&#31616;&#21333;&#65292;&#36825;&#37324;&#31616;&#21333;&#20998;&#26512;&#20854;&#20013;&#30340;&#19968;&#20010;&#12290;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="ubbffabb8">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="bf5ada89">public void createEphemeral(String path) {
    try {
        // &#36890;&#36807; Curator &#26694;&#26550;&#21019;&#24314;&#33410;&#28857;
        client.create().withMode(CreateMode.EPHEMERAL).forPath(path);
    } catch (NodeExistsException e) {
    } catch (Exception e) {
        throw new IllegalStateException(e.getMessage(), e);
    }
}</pre>
 <p class="ne-p" id="ueb71b731">
  <br>
 </p>
 <p class="ne-p" id="u72f14ecd">
  <span class="ne-text">
   &#22909;&#20102;&#65292;&#21040;&#27492;&#20851;&#20110;&#26381;&#21153;&#27880;&#20876;&#30340;&#36807;&#31243;&#23601;&#20998;&#26512;&#23436;&#20102;&#12290;&#25972;&#20010;&#36807;&#31243;&#21487;&#31616;&#21333;&#24635;&#32467;&#20026;&#65306;&#20808;&#21019;&#24314;&#27880;&#20876;&#20013;&#24515;&#23454;&#20363;&#65292;&#20043;&#21518;&#20877;&#36890;&#36807;&#27880;&#20876;&#20013;&#24515;&#23454;&#20363;&#27880;&#20876;&#26381;&#21153;&#12290;&#26412;&#33410;&#20808;&#21040;&#36825;&#65292;&#25509;&#19979;&#26469;&#20998;&#26512;&#25968;&#25454;&#35746;&#38405;&#36807;&#31243;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u1d5571c4">
  <br>
 </p>
 <h3 id="abb3167f">
  <span class="ne-text">
   2.2.5 &#35746;&#38405; override &#25968;&#25454;
  </span>
 </h3>
 <p class="ne-p" id="u7885b874">
  <br>
 </p>
 <p class="ne-p" id="u7f1ed311">
  <span class="ne-text">
   // &#24453;&#34917;&#20805;
  </span>
 </p>
 <p class="ne-p" id="u84ed26b4">
  <br>
 </p>
 <h2 id="39fd2046">
  <span class="ne-text">
   3.&#24635;&#32467;
  </span>
 </h2>
 <p class="ne-p" id="u4a25f4ef">
  <br>
 </p>
 <p class="ne-p" id="ufc5aa10d">
  <span class="ne-text">
   &#26412;&#31687;&#25991;&#31456;&#35814;&#32454;&#20998;&#26512;&#20102; Dubbo &#26381;&#21153;&#23548;&#20986;&#36807;&#31243;&#65292;&#21253;&#25324;&#37197;&#32622;&#26816;&#27979;&#65292;URL &#32452;&#35013;&#65292;Invoker &#21019;&#24314;&#36807;&#31243;&#12289;&#23548;&#20986;&#26381;&#21153;&#20197;&#21450;&#27880;&#20876;&#26381;&#21153;&#31561;&#31561;&#12290;&#31687;&#24133;&#27604;&#36739;&#22823;&#65292;&#38656;&#35201;&#22823;&#23478;&#32784;&#24515;&#38405;&#35835;&#12290;&#26412;&#31687;&#25991;&#31456;&#20808;&#23601;&#21040;&#36825;&#65292;&#22914;&#26524;&#25991;&#31456;&#26377;&#19981;&#22949;&#38169;&#35823;&#20043;&#22788;&#65292;&#24076;&#26395;&#22823;&#23478;&#33021;&#22815;&#36827;&#34892;&#21453;&#39304;&#25110;&#20462;&#27491;&#12290;
  </span>
 </p>
</div>
</div>
</div>

        </body>
        
        