
        <html lang="en">
        <head>
        <meta charset="UTF-8"/>
        </head>
        <body>
        <div><div class="markdown-body">
    <h1>&#12300;&#28304;&#30721;&#35299;&#35835;&#12301;&#38598;&#32676;</h1><div class="lake-content" typography="classic">
 <div class="ne-quote">
  <p class="ne-p" id="ue4523f69">
   <span class="ne-text">
    &#21407;&#25991;&#22320;&#22336;&#65306;
   </span>
   <a class="ne-link" data-href="https://dubbo.apache.org/zh/docsv2.7/dev/source/cluster/" href="https://dubbo.apache.org/zh/docsv2.7/dev/source/cluster/" target="_blank">
    <span class="ne-text">
     https://dubbo.apache.org/zh/docsv2.7/dev/source/cluster/
    </span>
   </a>
  </p>
  <p class="ne-p" id="u7afadb47">
   <span class="ne-text">
   </span>
  </p>
  <p class="ne-p" id="uc1ea3085">
   <span class="ne-text">
    &#20316;&#32773;&#65306; Dubbo &#23448;&#26041;
   </span>
  </p>
 </div>
 <p class="ne-p" id="uc2595736">
  <br>
 </p>
 <p class="ne-p" id="ud29b69c9">
  <span class="ne-text">
   &#26412;&#25991;&#20171;&#32461;&#20102;&#38598;&#32676;&#30340;&#21407;&#29702;&#21644;&#23454;&#29616;&#32454;&#33410;
  </span>
 </p>
 <p class="ne-p" id="u67b0c17e">
  <br>
 </p>
 <h2 id="8814759b">
  <span class="ne-text">
   1.&#31616;&#20171;
  </span>
 </h2>
 <p class="ne-p" id="u283425fb">
  <br>
 </p>
 <p class="ne-p" id="uf2d77cad">
  <span class="ne-text">
   &#20026;&#20102;&#36991;&#20813;&#21333;&#28857;&#25925;&#38556;&#65292;&#29616;&#22312;&#30340;&#24212;&#29992;&#36890;&#24120;&#33267;&#23569;&#20250;&#37096;&#32626;&#22312;&#20004;&#21488;&#26381;&#21153;&#22120;&#19978;&#12290;&#23545;&#20110;&#19968;&#20123;&#36127;&#36733;&#27604;&#36739;&#39640;&#30340;&#26381;&#21153;&#65292;&#20250;&#37096;&#32626;&#26356;&#22810;&#30340;&#26381;&#21153;&#22120;&#12290;&#36825;&#26679;&#65292;&#22312;&#21516;&#19968;&#29615;&#22659;&#19979;&#30340;&#26381;&#21153;&#25552;&#20379;&#32773;&#25968;&#37327;&#20250;&#22823;&#20110;1&#12290;&#23545;&#20110;&#26381;&#21153;&#28040;&#36153;&#32773;&#26469;&#35828;&#65292;&#21516;&#19968;&#29615;&#22659;&#19979;&#20986;&#29616;&#20102;&#22810;&#20010;&#26381;&#21153;&#25552;&#20379;&#32773;&#12290;&#36825;&#26102;&#20250;&#20986;&#29616;&#19968;&#20010;&#38382;&#39064;&#65292;&#26381;&#21153;&#28040;&#36153;&#32773;&#38656;&#35201;&#20915;&#23450;&#36873;&#25321;&#21738;&#20010;&#26381;&#21153;&#25552;&#20379;&#32773;&#36827;&#34892;&#35843;&#29992;&#12290;&#21478;&#22806;&#26381;&#21153;&#35843;&#29992;&#22833;&#36133;&#26102;&#30340;&#22788;&#29702;&#25514;&#26045;&#20063;&#26159;&#38656;&#35201;&#32771;&#34385;&#30340;&#65292;&#26159;&#37325;&#35797;&#21602;&#65292;&#36824;&#26159;&#25243;&#20986;&#24322;&#24120;&#65292;&#20134;&#25110;&#26159;&#21482;&#25171;&#21360;&#24322;&#24120;&#31561;&#12290;&#20026;&#20102;&#22788;&#29702;&#36825;&#20123;&#38382;&#39064;&#65292;Dubbo &#23450;&#20041;&#20102;&#38598;&#32676;&#25509;&#21475; Cluster &#20197;&#21450; Cluster Invoker&#12290;&#38598;&#32676; Cluster &#29992;&#36884;&#26159;&#23558;&#22810;&#20010;&#26381;&#21153;&#25552;&#20379;&#32773;&#21512;&#24182;&#20026;&#19968;&#20010; Cluster Invoker&#65292;&#24182;&#23558;&#36825;&#20010; Invoker &#26292;&#38706;&#32473;&#26381;&#21153;&#28040;&#36153;&#32773;&#12290;&#36825;&#26679;&#19968;&#26469;&#65292;&#26381;&#21153;&#28040;&#36153;&#32773;&#21482;&#38656;&#36890;&#36807;&#36825;&#20010; Invoker &#36827;&#34892;&#36828;&#31243;&#35843;&#29992;&#21363;&#21487;&#65292;&#33267;&#20110;&#20855;&#20307;&#35843;&#29992;&#21738;&#20010;&#26381;&#21153;&#25552;&#20379;&#32773;&#65292;&#20197;&#21450;&#35843;&#29992;&#22833;&#36133;&#21518;&#22914;&#20309;&#22788;&#29702;&#31561;&#38382;&#39064;&#65292;&#29616;&#22312;&#37117;&#20132;&#32473;&#38598;&#32676;&#27169;&#22359;&#21435;&#22788;&#29702;&#12290;&#38598;&#32676;&#27169;&#22359;&#26159;&#26381;&#21153;&#25552;&#20379;&#32773;&#21644;&#26381;&#21153;&#28040;&#36153;&#32773;&#30340;&#20013;&#38388;&#23618;&#65292;&#20026;&#26381;&#21153;&#28040;&#36153;&#32773;&#23631;&#34109;&#20102;&#26381;&#21153;&#25552;&#20379;&#32773;&#30340;&#24773;&#20917;&#65292;&#36825;&#26679;&#26381;&#21153;&#28040;&#36153;&#32773;&#23601;&#21487;&#20197;&#19987;&#24515;&#22788;&#29702;&#36828;&#31243;&#35843;&#29992;&#30456;&#20851;&#20107;&#23452;&#12290;&#27604;&#22914;&#21457;&#35831;&#27714;&#65292;&#25509;&#21463;&#26381;&#21153;&#25552;&#20379;&#32773;&#36820;&#22238;&#30340;&#25968;&#25454;&#31561;&#12290;&#36825;&#23601;&#26159;&#38598;&#32676;&#30340;&#20316;&#29992;&#12290;
  </span>
 </p>
 <p class="ne-p" id="ue537cedd">
  <br>
 </p>
 <p class="ne-p" id="u9a14a54d">
  <span class="ne-text">
   Dubbo &#25552;&#20379;&#20102;&#22810;&#31181;&#38598;&#32676;&#23454;&#29616;&#65292;&#21253;&#21547;&#20294;&#19981;&#38480;&#20110; Failover Cluster&#12289;Failfast Cluster &#21644; Failsafe Cluster &#31561;&#12290;&#27599;&#31181;&#38598;&#32676;&#23454;&#29616;&#31867;&#30340;&#29992;&#36884;&#19981;&#21516;&#65292;&#25509;&#19979;&#26469;&#20250;&#19968;&#19968;&#36827;&#34892;&#20998;&#26512;&#12290;
  </span>
 </p>
 <p class="ne-p" id="ufc837759">
  <br>
 </p>
 <h2 id="70c967b2">
  <span class="ne-text">
   2. &#38598;&#32676;&#23481;&#38169;
  </span>
 </h2>
 <p class="ne-p" id="u7ba180f3">
  <br>
 </p>
 <p class="ne-p" id="u8232fbd0">
  <span class="ne-text">
   &#22312;&#23545;&#38598;&#32676;&#30456;&#20851;&#20195;&#30721;&#36827;&#34892;&#20998;&#26512;&#20043;&#21069;&#65292;&#36825;&#37324;&#26377;&#24517;&#35201;&#20808;&#26469;&#20171;&#32461;&#19968;&#19979;&#38598;&#32676;&#23481;&#38169;&#30340;&#25152;&#26377;&#32452;&#20214;&#12290;&#21253;&#21547; Cluster&#12289;Cluster Invoker&#12289;Directory&#12289;Router &#21644; LoadBalance &#31561;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u287c343f">
  <br>
 </p>
 <p class="ne-p" id="ub5eac2f8">
  <img class="ne-image" id="D2i5f" src="EPUB/imgD2i5f" width="600">
 </p>
 <p class="ne-p" id="uc9842b65">
  <br>
 </p>
 <p class="ne-p" id="ua1c89f40">
  <span class="ne-text">
   &#38598;&#32676;&#24037;&#20316;&#36807;&#31243;&#21487;&#20998;&#20026;&#20004;&#20010;&#38454;&#27573;&#65292;&#31532;&#19968;&#20010;&#38454;&#27573;&#26159;&#22312;&#26381;&#21153;&#28040;&#36153;&#32773;&#21021;&#22987;&#21270;&#26399;&#38388;&#65292;&#38598;&#32676; Cluster &#23454;&#29616;&#31867;&#20026;&#26381;&#21153;&#28040;&#36153;&#32773;&#21019;&#24314; Cluster Invoker &#23454;&#20363;&#65292;&#21363;&#19978;&#22270;&#20013;&#30340; merge &#25805;&#20316;&#12290;&#31532;&#20108;&#20010;&#38454;&#27573;&#26159;&#22312;&#26381;&#21153;&#28040;&#36153;&#32773;&#36827;&#34892;&#36828;&#31243;&#35843;&#29992;&#26102;&#12290;&#20197; FailoverClusterInvoker &#20026;&#20363;&#65292;&#35813;&#31867;&#22411; Cluster Invoker &#39318;&#20808;&#20250;&#35843;&#29992; Directory &#30340; list &#26041;&#27861;&#21015;&#20030; Invoker &#21015;&#34920;&#65288;&#21487;&#23558; Invoker &#31616;&#21333;&#29702;&#35299;&#20026;&#26381;&#21153;&#25552;&#20379;&#32773;&#65289;&#12290;Directory &#30340;&#29992;&#36884;&#26159;&#20445;&#23384; Invoker&#65292;&#21487;&#31616;&#21333;&#31867;&#27604;&#20026; List&#12290;&#20854;&#23454;&#29616;&#31867; RegistryDirectory &#26159;&#19968;&#20010;&#21160;&#24577;&#26381;&#21153;&#30446;&#24405;&#65292;&#21487;&#24863;&#30693;&#27880;&#20876;&#20013;&#24515;&#37197;&#32622;&#30340;&#21464;&#21270;&#65292;&#23427;&#25152;&#25345;&#26377;&#30340; Invoker &#21015;&#34920;&#20250;&#38543;&#30528;&#27880;&#20876;&#20013;&#24515;&#20869;&#23481;&#30340;&#21464;&#21270;&#32780;&#21464;&#21270;&#12290;&#27599;&#27425;&#21464;&#21270;&#21518;&#65292;RegistryDirectory &#20250;&#21160;&#24577;&#22686;&#21024; Invoker&#65292;&#24182;&#35843;&#29992; Router &#30340; route &#26041;&#27861;&#36827;&#34892;&#36335;&#30001;&#65292;&#36807;&#28388;&#25481;&#19981;&#31526;&#21512;&#36335;&#30001;&#35268;&#21017;&#30340; Invoker&#12290;&#24403; FailoverClusterInvoker &#25343;&#21040; Directory &#36820;&#22238;&#30340; Invoker &#21015;&#34920;&#21518;&#65292;&#23427;&#20250;&#36890;&#36807; LoadBalance &#20174; Invoker &#21015;&#34920;&#20013;&#36873;&#25321;&#19968;&#20010; Invoker&#12290;&#26368;&#21518; FailoverClusterInvoker &#20250;&#23558;&#21442;&#25968;&#20256;&#32473; LoadBalance &#36873;&#25321;&#20986;&#30340; Invoker &#23454;&#20363;&#30340; invoke &#26041;&#27861;&#65292;&#36827;&#34892;&#30495;&#27491;&#30340;&#36828;&#31243;&#35843;&#29992;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u0fe0f6cb">
  <br>
 </p>
 <p class="ne-p" id="u1debf58b">
  <span class="ne-text">
   &#20197;&#19978;&#23601;&#26159;&#38598;&#32676;&#24037;&#20316;&#30340;&#25972;&#20010;&#27969;&#31243;&#65292;&#36825;&#37324;&#24182;&#27809;&#20171;&#32461;&#38598;&#32676;&#26159;&#22914;&#20309;&#23481;&#38169;&#30340;&#12290;Dubbo &#20027;&#35201;&#25552;&#20379;&#20102;&#36825;&#26679;&#20960;&#31181;&#23481;&#38169;&#26041;&#24335;&#65306;
  </span>
 </p>
 <p class="ne-p" id="ua0e33d41">
  <br>
 </p>
 <ul class="ne-ul">
  <li id="ufb537794">
   <span class="ne-text">
    Failover Cluster - &#22833;&#36133;&#33258;&#21160;&#20999;&#25442;
   </span>
  </li>
  <li id="u14cad40f">
   <span class="ne-text">
    Failfast Cluster - &#24555;&#36895;&#22833;&#36133;
   </span>
  </li>
 </ul>
 <ul class="ne-ul">
  <li id="uf0692e3e">
   <span class="ne-text">
    Failsafe Cluster - &#22833;&#36133;&#23433;&#20840;
   </span>
  </li>
  <li id="uaaa91e06">
   <span class="ne-text">
    Failback Cluster - &#22833;&#36133;&#33258;&#21160;&#24674;&#22797;
   </span>
  </li>
 </ul>
 <ul class="ne-ul">
  <li id="u404c4c02">
   <span class="ne-text">
    Forking Cluster - &#24182;&#34892;&#35843;&#29992;&#22810;&#20010;&#26381;&#21153;&#25552;&#20379;&#32773;
   </span>
  </li>
 </ul>
 <p class="ne-p" id="u613d5cb8">
  <br>
 </p>
 <p class="ne-p" id="u13b9aadc">
  <span class="ne-text">
   &#19979;&#38754;&#24320;&#22987;&#20998;&#26512;&#28304;&#30721;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u2de2f386">
  <br>
 </p>
 <h2 id="9efff3e2">
  <span class="ne-text">
   3.&#28304;&#30721;&#20998;&#26512;
  </span>
 </h2>
 <p class="ne-p" id="u9eff4510">
  <br>
 </p>
 <h3 id="2a709898">
  <span class="ne-text">
   3.1 Cluster &#23454;&#29616;&#31867;&#20998;&#26512;
  </span>
 </h3>
 <p class="ne-p" id="u5e38bdf6">
  <br>
 </p>
 <p class="ne-p" id="uabe71f08">
  <span class="ne-text">
   &#25105;&#20204;&#22312;&#19978;&#19968;&#31456;&#30475;&#21040;&#20102;&#20004;&#20010;&#27010;&#24565;&#65292;&#20998;&#21035;&#26159;&#38598;&#32676;&#25509;&#21475; Cluster &#21644; Cluster Invoker&#65292;&#36825;&#20004;&#32773;&#26159;&#19981;&#21516;&#30340;&#12290;Cluster &#26159;&#25509;&#21475;&#65292;&#32780; Cluster Invoker &#26159;&#19968;&#31181; Invoker&#12290;&#26381;&#21153;&#25552;&#20379;&#32773;&#30340;&#36873;&#25321;&#36923;&#36753;&#65292;&#20197;&#21450;&#36828;&#31243;&#35843;&#29992;&#22833;&#36133;&#21518;&#30340;&#30340;&#22788;&#29702;&#36923;&#36753;&#22343;&#26159;&#23553;&#35013;&#22312; Cluster Invoker &#20013;&#12290;&#37027;&#20040; Cluster &#25509;&#21475;&#21644;&#30456;&#20851;&#23454;&#29616;&#31867;&#26377;&#20160;&#20040;&#29992;&#21602;&#65311;&#29992;&#36884;&#27604;&#36739;&#31616;&#21333;&#65292;&#20165;&#29992;&#20110;&#29983;&#25104; Cluster Invoker&#12290;&#19979;&#38754;&#25105;&#20204;&#26469;&#30475;&#19968;&#19979;&#28304;&#30721;&#12290;
  </span>
 </p>
 <p class="ne-p" id="uaf76fea5">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="4c559ac4">public class FailoverCluster implements Cluster {

    public final static String NAME = "failover";

    @Override
    public &lt;T&gt; Invoker&lt;T&gt; join(Directory&lt;T&gt; directory) throws RpcException {
        // &#21019;&#24314;&#24182;&#36820;&#22238; FailoverClusterInvoker &#23545;&#35937;
        return new FailoverClusterInvoker&lt;T&gt;(directory);
    }
}</pre>
 <p class="ne-p" id="u43257e15">
  <br>
 </p>
 <p class="ne-p" id="u6ce5bb6b">
  <span class="ne-text">
   &#22914;&#19978;&#65292;FailoverCluster &#24635;&#20849;&#23601;&#21253;&#21547;&#36825;&#20960;&#34892;&#20195;&#30721;&#65292;&#29992;&#20110;&#21019;&#24314; FailoverClusterInvoker &#23545;&#35937;&#65292;&#24456;&#31616;&#21333;&#12290;&#19979;&#38754;&#20877;&#30475;&#19968;&#20010;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u9edc728f">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="b6acd1c0">public class FailbackCluster implements Cluster {

    public final static String NAME = "failback";

    @Override
    public &lt;T&gt; Invoker&lt;T&gt; join(Directory&lt;T&gt; directory) throws RpcException {
        // &#21019;&#24314;&#24182;&#36820;&#22238; FailbackClusterInvoker &#23545;&#35937;
        return new FailbackClusterInvoker&lt;T&gt;(directory);
    }

}</pre>
 <p class="ne-p" id="ua0d86aac">
  <br>
 </p>
 <p class="ne-p" id="ufd49e937">
  <span class="ne-text">
   &#22914;&#19978;&#65292;FailbackCluster &#30340;&#36923;&#36753;&#20063;&#26159;&#24456;&#31616;&#21333;&#65292;&#26080;&#38656;&#35299;&#37322;&#20102;&#12290;&#25152;&#20197;&#25509;&#19979;&#26469;&#65292;&#25105;&#20204;&#25226;&#37325;&#28857;&#25918;&#22312;&#21508;&#31181; Cluster Invoker &#19978;
  </span>
 </p>
 <p class="ne-p" id="u8df8c2ad">
  <br>
 </p>
 <h3 id="a53eebdb">
  <span class="ne-text">
   3.2 Cluster Invoker &#20998;&#26512;
  </span>
 </h3>
 <p class="ne-p" id="u6769f55f">
  <br>
 </p>
 <p class="ne-p" id="u8fec1964">
  <span class="ne-text">
   &#25105;&#20204;&#39318;&#20808;&#20174;&#21508;&#31181; Cluster Invoker &#30340;&#29238;&#31867; AbstractClusterInvoker &#28304;&#30721;&#24320;&#22987;&#35828;&#36215;&#12290;&#21069;&#38754;&#35828;&#36807;&#65292;&#38598;&#32676;&#24037;&#20316;&#36807;&#31243;&#21487;&#20998;&#20026;&#20004;&#20010;&#38454;&#27573;&#65292;&#31532;&#19968;&#20010;&#38454;&#27573;&#26159;&#22312;&#26381;&#21153;&#28040;&#36153;&#32773;&#21021;&#22987;&#21270;&#26399;&#38388;&#65292;&#36825;&#20010;&#22312;
  </span>
  <a class="ne-link" data-href="https://dubbo.apache.org/zh/docsv2.7/dev/source/refer-service" href="https://dubbo.apache.org/zh/docsv2.7/dev/source/refer-service" target="_blank">
   <span class="ne-text">
    &#26381;&#21153;&#24341;&#29992;
   </span>
  </a>
  <span class="ne-text">
   &#37027;&#31687;&#25991;&#31456;&#20013;&#20998;&#26512;&#36807;&#65292;&#23601;&#19981;&#36184;&#36848;&#12290;&#31532;&#20108;&#20010;&#38454;&#27573;&#26159;&#22312;&#26381;&#21153;&#28040;&#36153;&#32773;&#36827;&#34892;&#36828;&#31243;&#35843;&#29992;&#26102;&#65292;&#27492;&#26102; AbstractClusterInvoker &#30340; invoke &#26041;&#27861;&#20250;&#34987;&#35843;&#29992;&#12290;&#21015;&#20030; Invoker&#65292;&#36127;&#36733;&#22343;&#34913;&#31561;&#25805;&#20316;&#22343;&#20250;&#22312;&#27492;&#38454;&#27573;&#34987;&#25191;&#34892;&#12290;&#22240;&#27492;&#19979;&#38754;&#20808;&#26469;&#30475;&#19968;&#19979; invoke &#26041;&#27861;&#30340;&#36923;&#36753;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u37fb2698">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="ff9d6cff">public Result invoke(final Invocation invocation) throws RpcException {
    checkWhetherDestroyed();
    LoadBalance loadbalance = null;

    // &#32465;&#23450; attachments &#21040; invocation &#20013;.
    Map&lt;String, String&gt; contextAttachments = RpcContext.getContext().getAttachments();
    if (contextAttachments != null &amp;&amp; contextAttachments.size() != 0) {
        ((RpcInvocation) invocation).addAttachments(contextAttachments);
    }

    // &#21015;&#20030; Invoker
    List&lt;Invoker&lt;T&gt;&gt; invokers = list(invocation);
    if (invokers != null &amp;&amp; !invokers.isEmpty()) {
        // &#21152;&#36733; LoadBalance
        loadbalance = ExtensionLoader.getExtensionLoader(LoadBalance.class).getExtension(invokers.get(0).getUrl()
                .getMethodParameter(RpcUtils.getMethodName(invocation), Constants.LOADBALANCE_KEY, Constants.DEFAULT_LOADBALANCE));
    }
    RpcUtils.attachInvocationIdIfAsync(getUrl(), invocation);
    
    // &#35843;&#29992; doInvoke &#36827;&#34892;&#21518;&#32493;&#25805;&#20316;
    return doInvoke(invocation, invokers, loadbalance);
}

// &#25277;&#35937;&#26041;&#27861;&#65292;&#30001;&#23376;&#31867;&#23454;&#29616;
protected abstract Result doInvoke(Invocation invocation, List&lt;Invoker&lt;T&gt;&gt; invokers,
                                       LoadBalance loadbalance) throws RpcException;</pre>
 <p class="ne-p" id="uab2c5393">
  <br>
 </p>
 <p class="ne-p" id="u06ef0497">
  <span class="ne-text">
   AbstractClusterInvoker &#30340; invoke &#26041;&#27861;&#20027;&#35201;&#29992;&#20110;&#21015;&#20030; Invoker&#65292;&#20197;&#21450;&#21152;&#36733; LoadBalance&#12290;&#26368;&#21518;&#20877;&#35843;&#29992;&#27169;&#26495;&#26041;&#27861; doInvoke &#36827;&#34892;&#21518;&#32493;&#25805;&#20316;&#12290;&#19979;&#38754;&#25105;&#20204;&#26469;&#30475;&#19968;&#19979; Invoker &#21015;&#20030;&#26041;&#27861; list(Invocation) &#30340;&#36923;&#36753;&#65292;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="uf8cfa265">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="dd27d8f0">protected List&lt;Invoker&lt;T&gt;&gt; list(Invocation invocation) throws RpcException {
    // &#35843;&#29992; Directory &#30340; list &#26041;&#27861;&#21015;&#20030; Invoker
    List&lt;Invoker&lt;T&gt;&gt; invokers = directory.list(invocation);
    return invokers;
}</pre>
 <p class="ne-p" id="ua15df44c">
  <br>
 </p>
 <p class="ne-p" id="u5d831d1f">
  <span class="ne-text">
   &#22914;&#19978;&#65292;AbstractClusterInvoker &#20013;&#30340; list &#26041;&#27861;&#20570;&#30340;&#20107;&#24773;&#24456;&#31616;&#21333;&#65292;&#21482;&#26159;&#31616;&#21333;&#30340;&#35843;&#29992;&#20102; Directory &#30340; list &#26041;&#27861;&#65292;&#27809;&#26377;&#20854;&#20182;&#26356;&#22810;&#30340;&#36923;&#36753;&#20102;&#12290;Directory &#21363;&#30456;&#20851;&#23454;&#29616;&#31867;&#22312;&#21069;&#25991;&#24050;&#32463;&#20998;&#26512;&#36807;&#65292;&#36825;&#37324;&#23601;&#19981;&#22810;&#35828;&#20102;&#12290;&#25509;&#19979;&#26469;&#65292;&#25105;&#20204;&#25226;&#30446;&#20809;&#36716;&#31227;&#21040; AbstractClusterInvoker &#30340;&#21508;&#31181;&#23454;&#29616;&#31867;&#19978;&#65292;&#26469;&#30475;&#19968;&#19979;&#36825;&#20123;&#23454;&#29616;&#31867;&#26159;&#22914;&#20309;&#23454;&#29616; doInvoke &#26041;&#27861;&#36923;&#36753;&#30340;&#12290;
  </span>
 </p>
 <p class="ne-p" id="uee4a5f43">
  <br>
 </p>
 <h4 id="24ad2d79">
  <span class="ne-text">
   3.2.1 FailoverClusterInvoker
  </span>
 </h4>
 <p class="ne-p" id="ud4e81998">
  <br>
 </p>
 <p class="ne-p" id="u96dad46c">
  <span class="ne-text">
   FailoverClusterInvoker &#22312;&#35843;&#29992;&#22833;&#36133;&#26102;&#65292;&#20250;&#33258;&#21160;&#20999;&#25442; Invoker &#36827;&#34892;&#37325;&#35797;&#12290;&#40664;&#35748;&#37197;&#32622;&#19979;&#65292;Dubbo &#20250;&#20351;&#29992;&#36825;&#20010;&#31867;&#20316;&#20026;&#32570;&#30465; Cluster Invoker&#12290;&#19979;&#38754;&#26469;&#30475;&#19968;&#19979;&#35813;&#31867;&#30340;&#36923;&#36753;&#12290;
  </span>
 </p>
 <p class="ne-p" id="uc42c4229">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="846196f1">public class FailoverClusterInvoker&lt;T&gt; extends AbstractClusterInvoker&lt;T&gt; {

    // &#30465;&#30053;&#37096;&#20998;&#20195;&#30721;

    @Override
    public Result doInvoke(Invocation invocation, final List&lt;Invoker&lt;T&gt;&gt; invokers, LoadBalance loadbalance) throws RpcException {
        List&lt;Invoker&lt;T&gt;&gt; copyinvokers = invokers;
        checkInvokers(copyinvokers, invocation);
        // &#33719;&#21462;&#37325;&#35797;&#27425;&#25968;
        int len = getUrl().getMethodParameter(invocation.getMethodName(), Constants.RETRIES_KEY, Constants.DEFAULT_RETRIES) + 1;
        if (len &lt;= 0) {
            len = 1;
        }
        RpcException le = null;
        List&lt;Invoker&lt;T&gt;&gt; invoked = new ArrayList&lt;Invoker&lt;T&gt;&gt;(copyinvokers.size());
        Set&lt;String&gt; providers = new HashSet&lt;String&gt;(len);
        // &#24490;&#29615;&#35843;&#29992;&#65292;&#22833;&#36133;&#37325;&#35797;
        for (int i = 0; i &lt; len; i++) {
            if (i &gt; 0) {
                checkWhetherDestroyed();
                // &#22312;&#36827;&#34892;&#37325;&#35797;&#21069;&#37325;&#26032;&#21015;&#20030; Invoker&#65292;&#36825;&#26679;&#20570;&#30340;&#22909;&#22788;&#26159;&#65292;&#22914;&#26524;&#26576;&#20010;&#26381;&#21153;&#25346;&#20102;&#65292;
                // &#36890;&#36807;&#35843;&#29992; list &#21487;&#24471;&#21040;&#26368;&#26032;&#21487;&#29992;&#30340; Invoker &#21015;&#34920;
                copyinvokers = list(invocation);
                // &#23545; copyinvokers &#36827;&#34892;&#21028;&#31354;&#26816;&#26597;
                checkInvokers(copyinvokers, invocation);
            }

            // &#36890;&#36807;&#36127;&#36733;&#22343;&#34913;&#36873;&#25321; Invoker
            Invoker&lt;T&gt; invoker = select(loadbalance, invocation, copyinvokers, invoked);
            // &#28155;&#21152;&#21040; invoker &#21040; invoked &#21015;&#34920;&#20013;
            invoked.add(invoker);
            // &#35774;&#32622; invoked &#21040; RPC &#19978;&#19979;&#25991;&#20013;
            RpcContext.getContext().setInvokers((List) invoked);
            try {
                // &#35843;&#29992;&#30446;&#26631; Invoker &#30340; invoke &#26041;&#27861;
                Result result = invoker.invoke(invocation);
                return result;
            } catch (RpcException e) {
                if (e.isBiz()) {
                    throw e;
                }
                le = e;
            } catch (Throwable e) {
                le = new RpcException(e.getMessage(), e);
            } finally {
                providers.add(invoker.getUrl().getAddress());
            }
        }
        
        // &#33509;&#37325;&#35797;&#22833;&#36133;&#65292;&#21017;&#25243;&#20986;&#24322;&#24120;
        throw new RpcException(..., "Failed to invoke the method ...");
    }
}</pre>
 <p class="ne-p" id="u7c16f64d">
  <br>
 </p>
 <p class="ne-p" id="ufb78377a">
  <span class="ne-text">
   &#22914;&#19978;&#65292;FailoverClusterInvoker &#30340; doInvoke &#26041;&#27861;&#39318;&#20808;&#26159;&#33719;&#21462;&#37325;&#35797;&#27425;&#25968;&#65292;&#28982;&#21518;&#26681;&#25454;&#37325;&#35797;&#27425;&#25968;&#36827;&#34892;&#24490;&#29615;&#35843;&#29992;&#65292;&#22833;&#36133;&#21518;&#36827;&#34892;&#37325;&#35797;&#12290;&#22312; for &#24490;&#29615;&#20869;&#65292;&#39318;&#20808;&#26159;&#36890;&#36807;&#36127;&#36733;&#22343;&#34913;&#32452;&#20214;&#36873;&#25321;&#19968;&#20010; Invoker&#65292;&#28982;&#21518;&#20877;&#36890;&#36807;&#36825;&#20010; Invoker &#30340; invoke &#26041;&#27861;&#36827;&#34892;&#36828;&#31243;&#35843;&#29992;&#12290;&#22914;&#26524;&#22833;&#36133;&#20102;&#65292;&#35760;&#24405;&#19979;&#24322;&#24120;&#65292;&#24182;&#36827;&#34892;&#37325;&#35797;&#12290;&#37325;&#35797;&#26102;&#20250;&#20877;&#27425;&#35843;&#29992;&#29238;&#31867;&#30340; list &#26041;&#27861;&#21015;&#20030; Invoker&#12290;&#25972;&#20010;&#27969;&#31243;&#22823;&#33268;&#22914;&#27492;&#65292;&#19981;&#26159;&#24456;&#38590;&#29702;&#35299;&#12290;&#19979;&#38754;&#25105;&#20204;&#30475;&#19968;&#19979; select &#26041;&#27861;&#30340;&#36923;&#36753;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u78bc3eb2">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="1f0d1d06">protected Invoker&lt;T&gt; select(LoadBalance loadbalance, Invocation invocation, List&lt;Invoker&lt;T&gt;&gt; invokers, List&lt;Invoker&lt;T&gt;&gt; selected) throws RpcException {
    if (invokers == null || invokers.isEmpty())
        return null;
    // &#33719;&#21462;&#35843;&#29992;&#26041;&#27861;&#21517;
    String methodName = invocation == null ? "" : invocation.getMethodName();

    // &#33719;&#21462; sticky &#37197;&#32622;&#65292;sticky &#34920;&#31034;&#31896;&#28382;&#36830;&#25509;&#12290;&#25152;&#35859;&#31896;&#28382;&#36830;&#25509;&#26159;&#25351;&#35753;&#26381;&#21153;&#28040;&#36153;&#32773;&#23613;&#21487;&#33021;&#30340;
    // &#35843;&#29992;&#21516;&#19968;&#20010;&#26381;&#21153;&#25552;&#20379;&#32773;&#65292;&#38500;&#38750;&#35813;&#25552;&#20379;&#32773;&#25346;&#20102;&#20877;&#36827;&#34892;&#20999;&#25442;
    boolean sticky = invokers.get(0).getUrl().getMethodParameter(methodName, Constants.CLUSTER_STICKY_KEY, Constants.DEFAULT_CLUSTER_STICKY);
    {
        // &#26816;&#27979; invokers &#21015;&#34920;&#26159;&#21542;&#21253;&#21547; stickyInvoker&#65292;&#22914;&#26524;&#19981;&#21253;&#21547;&#65292;
        // &#35828;&#26126; stickyInvoker &#20195;&#34920;&#30340;&#26381;&#21153;&#25552;&#20379;&#32773;&#25346;&#20102;&#65292;&#27492;&#26102;&#38656;&#35201;&#23558;&#20854;&#32622;&#31354;
        if (stickyInvoker != null &amp;&amp; !invokers.contains(stickyInvoker)) {
            stickyInvoker = null;
        }
        
        // &#22312; sticky &#20026; true&#65292;&#19988; stickyInvoker != null &#30340;&#24773;&#20917;&#19979;&#12290;&#22914;&#26524; selected &#21253;&#21547; 
        // stickyInvoker&#65292;&#34920;&#26126; stickyInvoker &#23545;&#24212;&#30340;&#26381;&#21153;&#25552;&#20379;&#32773;&#21487;&#33021;&#22240;&#32593;&#32476;&#21407;&#22240;&#26410;&#33021;&#25104;&#21151;&#25552;&#20379;&#26381;&#21153;&#12290;
        // &#20294;&#26159;&#35813;&#25552;&#20379;&#32773;&#24182;&#27809;&#25346;&#65292;&#27492;&#26102; invokers &#21015;&#34920;&#20013;&#20173;&#23384;&#22312;&#35813;&#26381;&#21153;&#25552;&#20379;&#32773;&#23545;&#24212;&#30340; Invoker&#12290;
        if (sticky &amp;&amp; stickyInvoker != null &amp;&amp; (selected == null || !selected.contains(stickyInvoker))) {
            // availablecheck &#34920;&#31034;&#26159;&#21542;&#24320;&#21551;&#20102;&#21487;&#29992;&#24615;&#26816;&#26597;&#65292;&#22914;&#26524;&#24320;&#21551;&#20102;&#65292;&#21017;&#35843;&#29992; stickyInvoker &#30340; 
            // isAvailable &#26041;&#27861;&#36827;&#34892;&#26816;&#26597;&#65292;&#22914;&#26524;&#26816;&#26597;&#36890;&#36807;&#65292;&#21017;&#30452;&#25509;&#36820;&#22238; stickyInvoker&#12290;
            if (availablecheck &amp;&amp; stickyInvoker.isAvailable()) {
                return stickyInvoker;
            }
        }
    }
    
    // &#22914;&#26524;&#32447;&#31243;&#36208;&#21040;&#24403;&#21069;&#20195;&#30721;&#22788;&#65292;&#35828;&#26126;&#21069;&#38754;&#30340; stickyInvoker &#20026;&#31354;&#65292;&#25110;&#32773;&#19981;&#21487;&#29992;&#12290;
    // &#27492;&#26102;&#32487;&#32493;&#35843;&#29992; doSelect &#36873;&#25321; Invoker
    Invoker&lt;T&gt; invoker = doSelect(loadbalance, invocation, invokers, selected);

    // &#22914;&#26524; sticky &#20026; true&#65292;&#21017;&#23558;&#36127;&#36733;&#22343;&#34913;&#32452;&#20214;&#36873;&#20986;&#30340; Invoker &#36171;&#20540;&#32473; stickyInvoker
    if (sticky) {
        stickyInvoker = invoker;
    }
    return invoker;
}</pre>
 <p class="ne-p" id="u2ed5ece1">
  <br>
 </p>
 <p class="ne-p" id="ubcc0259f">
  <span class="ne-text">
   &#22914;&#19978;&#65292;select &#26041;&#27861;&#30340;&#20027;&#35201;&#36923;&#36753;&#38598;&#20013;&#22312;&#20102;&#23545;&#31896;&#28382;&#36830;&#25509;&#29305;&#24615;&#30340;&#25903;&#25345;&#19978;&#12290;&#39318;&#20808;&#26159;&#33719;&#21462; sticky &#37197;&#32622;&#65292;&#28982;&#21518;&#20877;&#26816;&#27979; invokers &#21015;&#34920;&#20013;&#26159;&#21542;&#21253;&#21547; stickyInvoker&#65292;&#22914;&#26524;&#19981;&#21253;&#21547;&#65292;&#21017;&#35748;&#20026;&#35813; stickyInvoker &#19981;&#21487;&#29992;&#65292;&#27492;&#26102;&#23558;&#20854;&#32622;&#31354;&#12290;&#36825;&#37324;&#30340; invokers &#21015;&#34920;&#21487;&#20197;&#30475;&#20570;&#26159;
  </span>
  <strong>
   <span class="ne-text">
    &#23384;&#27963;&#30528;&#30340;&#26381;&#21153;&#25552;&#20379;&#32773;
   </span>
  </strong>
  <span class="ne-text">
   &#21015;&#34920;&#65292;&#22914;&#26524;&#36825;&#20010;&#21015;&#34920;&#19981;&#21253;&#21547; stickyInvoker&#65292;&#37027;&#33258;&#28982;&#32780;&#28982;&#30340;&#35748;&#20026; stickyInvoker &#25346;&#20102;&#65292;&#25152;&#20197;&#32622;&#31354;&#12290;&#22914;&#26524; stickyInvoker &#23384;&#22312;&#20110; invokers &#21015;&#34920;&#20013;&#65292;&#27492;&#26102;&#35201;&#36827;&#34892;&#19979;&#19968;&#39033;&#26816;&#27979; &#8212; &#26816;&#27979; selected &#20013;&#26159;&#21542;&#21253;&#21547; stickyInvoker&#12290;&#22914;&#26524;&#21253;&#21547;&#30340;&#35805;&#65292;&#35828;&#26126; stickyInvoker &#22312;&#27492;&#20043;&#21069;&#27809;&#26377;&#25104;&#21151;&#25552;&#20379;&#26381;&#21153;&#65288;&#20294;&#20854;&#20173;&#28982;&#22788;&#20110;&#23384;&#27963;&#29366;&#24577;&#65289;&#12290;&#27492;&#26102;&#25105;&#20204;&#35748;&#20026;&#36825;&#20010;&#26381;&#21153;&#19981;&#21487;&#38752;&#65292;&#19981;&#24212;&#35813;&#22312;&#37325;&#35797;&#26399;&#38388;&#20869;&#20877;&#27425;&#34987;&#35843;&#29992;&#65292;&#22240;&#27492;&#36825;&#20010;&#26102;&#20505;&#19981;&#20250;&#36820;&#22238;&#35813; stickyInvoker&#12290;&#22914;&#26524; selected &#19981;&#21253;&#21547; stickyInvoker&#65292;&#27492;&#26102;&#36824;&#38656;&#35201;&#36827;&#34892;&#21487;&#29992;&#24615;&#26816;&#27979;&#65292;&#27604;&#22914;&#26816;&#27979;&#26381;&#21153;&#25552;&#20379;&#32773;&#32593;&#32476;&#36830;&#36890;&#24615;&#31561;&#12290;&#24403;&#21487;&#29992;&#24615;&#26816;&#27979;&#36890;&#36807;&#65292;&#25165;&#21487;&#36820;&#22238; stickyInvoker&#65292;&#21542;&#21017;&#35843;&#29992; doSelect &#26041;&#27861;&#36873;&#25321; Invoker&#12290;&#22914;&#26524; sticky &#20026; true&#65292;&#27492;&#26102;&#20250;&#23558; doSelect &#26041;&#27861;&#36873;&#20986;&#30340; Invoker &#36171;&#20540;&#32473; stickyInvoker&#12290;
  </span>
 </p>
 <p class="ne-p" id="u37ee5300">
  <br>
 </p>
 <p class="ne-p" id="u9bdfe783">
  <span class="ne-text">
   &#20197;&#19978;&#23601;&#26159; select &#26041;&#27861;&#30340;&#36923;&#36753;&#65292;&#36825;&#27573;&#36923;&#36753;&#30475;&#36215;&#26469;&#19981;&#26159;&#24456;&#22797;&#26434;&#65292;&#20294;&#26159;&#20449;&#24687;&#37327;&#27604;&#36739;&#22823;&#12290;&#19981;&#25630;&#25026; invokers &#21644; selected &#20004;&#20010;&#20837;&#21442;&#30340;&#21547;&#20041;&#65292;&#20197;&#21450;&#31896;&#28382;&#36830;&#25509;&#29305;&#24615;&#65292;&#36825;&#27573;&#20195;&#30721;&#26159;&#19981;&#23481;&#26131;&#30475;&#25026;&#30340;&#12290;&#25152;&#20197;&#22823;&#23478;&#22312;&#38405;&#35835;&#36825;&#27573;&#20195;&#30721;&#26102;&#65292;&#19981;&#35201;&#24573;&#30053;&#20102;&#23545;&#32972;&#26223;&#30693;&#35782;&#30340;&#29702;&#35299;&#12290;&#20851;&#20110; select &#26041;&#27861;&#20808;&#20998;&#26512;&#36825;&#20040;&#22810;&#65292;&#32487;&#32493;&#21521;&#19979;&#20998;&#26512;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u7ce44f9c">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="dd489778">private Invoker&lt;T&gt; doSelect(LoadBalance loadbalance, Invocation invocation, List&lt;Invoker&lt;T&gt;&gt; invokers, List&lt;Invoker&lt;T&gt;&gt; selected) throws RpcException {
    if (invokers == null || invokers.isEmpty())
        return null;
    if (invokers.size() == 1)
        return invokers.get(0);
    if (loadbalance == null) {
        // &#22914;&#26524; loadbalance &#20026;&#31354;&#65292;&#36825;&#37324;&#36890;&#36807; SPI &#21152;&#36733; Loadbalance&#65292;&#40664;&#35748;&#20026; RandomLoadBalance
        loadbalance = ExtensionLoader.getExtensionLoader(LoadBalance.class).getExtension(Constants.DEFAULT_LOADBALANCE);
    }
    
    // &#36890;&#36807;&#36127;&#36733;&#22343;&#34913;&#32452;&#20214;&#36873;&#25321; Invoker
    Invoker&lt;T&gt; invoker = loadbalance.select(invokers, getUrl(), invocation);

	// &#22914;&#26524; selected &#21253;&#21547;&#36127;&#36733;&#22343;&#34913;&#36873;&#25321;&#20986;&#30340; Invoker&#65292;&#25110;&#32773;&#35813; Invoker &#26080;&#27861;&#32463;&#36807;&#21487;&#29992;&#24615;&#26816;&#26597;&#65292;&#27492;&#26102;&#36827;&#34892;&#37325;&#36873;
    if ((selected != null &amp;&amp; selected.contains(invoker))
            || (!invoker.isAvailable() &amp;&amp; getUrl() != null &amp;&amp; availablecheck)) {
        try {
            // &#36827;&#34892;&#37325;&#36873;
            Invoker&lt;T&gt; rinvoker = reselect(loadbalance, invocation, invokers, selected, availablecheck);
            if (rinvoker != null) {
                // &#22914;&#26524; rinvoker &#19981;&#20026;&#31354;&#65292;&#21017;&#23558;&#20854;&#36171;&#20540;&#32473; invoker
                invoker = rinvoker;
            } else {
                // rinvoker &#20026;&#31354;&#65292;&#23450;&#20301; invoker &#22312; invokers &#20013;&#30340;&#20301;&#32622;
                int index = invokers.indexOf(invoker);
                try {
                    // &#33719;&#21462; index + 1 &#20301;&#32622;&#22788;&#30340; Invoker&#65292;&#20197;&#19979;&#20195;&#30721;&#31561;&#20215;&#20110;&#65306;
                    //     invoker = invokers.get((index + 1) % invokers.size());
                    invoker = index &lt; invokers.size() - 1 ? invokers.get(index + 1) : invokers.get(0);
                } catch (Exception e) {
                    logger.warn("... may because invokers list dynamic change, ignore.");
                }
            }
        } catch (Throwable t) {
            logger.error("cluster reselect fail reason is : ...");
        }
    }
    return invoker;
}</pre>
 <p class="ne-p" id="u2bbf8a88">
  <br>
 </p>
 <p class="ne-p" id="uf9473b4d">
  <span class="ne-text">
   doSelect &#20027;&#35201;&#20570;&#20102;&#20004;&#20214;&#20107;&#65292;&#31532;&#19968;&#26159;&#36890;&#36807;&#36127;&#36733;&#22343;&#34913;&#32452;&#20214;&#36873;&#25321; Invoker&#12290;&#31532;&#20108;&#26159;&#65292;&#22914;&#26524;&#36873;&#20986;&#26469;&#30340; Invoker &#19981;&#31283;&#23450;&#65292;&#25110;&#19981;&#21487;&#29992;&#65292;&#27492;&#26102;&#38656;&#35201;&#35843;&#29992; reselect &#26041;&#27861;&#36827;&#34892;&#37325;&#36873;&#12290;&#33509; reselect &#36873;&#20986;&#26469;&#30340; Invoker &#20026;&#31354;&#65292;&#27492;&#26102;&#23450;&#20301; invoker &#22312; invokers &#21015;&#34920;&#20013;&#30340;&#20301;&#32622; index&#65292;&#28982;&#21518;&#33719;&#21462; index + 1 &#22788;&#30340; invoker&#65292;&#36825;&#20063;&#21487;&#20197;&#30475;&#20570;&#26159;&#37325;&#36873;&#36923;&#36753;&#30340;&#19968;&#37096;&#20998;&#12290;&#19979;&#38754;&#25105;&#20204;&#26469;&#30475;&#19968;&#19979; reselect &#26041;&#27861;&#30340;&#36923;&#36753;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u57ed1976">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="ebe8ccc2">private Invoker&lt;T&gt; reselect(LoadBalance loadbalance, Invocation invocation,
    List&lt;Invoker&lt;T&gt;&gt; invokers, List&lt;Invoker&lt;T&gt;&gt; selected, boolean availablecheck) throws RpcException {

    List&lt;Invoker&lt;T&gt;&gt; reselectInvokers = new ArrayList&lt;Invoker&lt;T&gt;&gt;(invokers.size() &gt; 1 ? (invokers.size() - 1) : invokers.size());

    // &#19979;&#38754;&#30340; if-else &#20998;&#25903;&#36923;&#36753;&#26377;&#20123;&#20887;&#20313;&#65292;pull request #2826 &#23545;&#36825;&#27573;&#20195;&#30721;&#36827;&#34892;&#20102;&#31616;&#21270;&#65292;&#21487;&#20197;&#21442;&#32771;&#19968;&#19979;
    // &#26681;&#25454; availablecheck &#36827;&#34892;&#19981;&#21516;&#30340;&#22788;&#29702;
    if (availablecheck) {
        // &#36941;&#21382; invokers &#21015;&#34920;
        for (Invoker&lt;T&gt; invoker : invokers) {
            // &#26816;&#27979;&#21487;&#29992;&#24615;
            if (invoker.isAvailable()) {
                // &#22914;&#26524; selected &#21015;&#34920;&#19981;&#21253;&#21547;&#24403;&#21069; invoker&#65292;&#21017;&#23558;&#20854;&#28155;&#21152;&#21040; reselectInvokers &#20013;
                if (selected == null || !selected.contains(invoker)) {
                    reselectInvokers.add(invoker);
                }
            }
        }
        
        // reselectInvokers &#19981;&#20026;&#31354;&#65292;&#27492;&#26102;&#36890;&#36807;&#36127;&#36733;&#22343;&#34913;&#32452;&#20214;&#36827;&#34892;&#36873;&#25321;
        if (!reselectInvokers.isEmpty()) {
            return loadbalance.select(reselectInvokers, getUrl(), invocation);
        }

    // &#19981;&#26816;&#26597; Invoker &#21487;&#29992;&#24615;
    } else {
        for (Invoker&lt;T&gt; invoker : invokers) {
            // &#22914;&#26524; selected &#21015;&#34920;&#19981;&#21253;&#21547;&#24403;&#21069; invoker&#65292;&#21017;&#23558;&#20854;&#28155;&#21152;&#21040; reselectInvokers &#20013;
            if (selected == null || !selected.contains(invoker)) {
                reselectInvokers.add(invoker);
            }
        }
        if (!reselectInvokers.isEmpty()) {
            // &#36890;&#36807;&#36127;&#36733;&#22343;&#34913;&#32452;&#20214;&#36827;&#34892;&#36873;&#25321;
            return loadbalance.select(reselectInvokers, getUrl(), invocation);
        }
    }

    {
        // &#33509;&#32447;&#31243;&#36208;&#21040;&#27492;&#22788;&#65292;&#35828;&#26126; reselectInvokers &#38598;&#21512;&#20026;&#31354;&#65292;&#27492;&#26102;&#19981;&#20250;&#35843;&#29992;&#36127;&#36733;&#22343;&#34913;&#32452;&#20214;&#36827;&#34892;&#31579;&#36873;&#12290;
        // &#36825;&#37324;&#20174; selected &#21015;&#34920;&#20013;&#26597;&#25214;&#21487;&#29992;&#30340; Invoker&#65292;&#24182;&#23558;&#20854;&#28155;&#21152;&#21040; reselectInvokers &#38598;&#21512;&#20013;
        if (selected != null) {
            for (Invoker&lt;T&gt; invoker : selected) {
                if ((invoker.isAvailable())
                        &amp;&amp; !reselectInvokers.contains(invoker)) {
                    reselectInvokers.add(invoker);
                }
            }
        }
        if (!reselectInvokers.isEmpty()) {
            // &#20877;&#27425;&#36827;&#34892;&#36873;&#25321;&#65292;&#24182;&#36820;&#22238;&#36873;&#25321;&#32467;&#26524;
            return loadbalance.select(reselectInvokers, getUrl(), invocation);
        }
    }
    return null;
}</pre>
 <p class="ne-p" id="u77e7c076">
  <br>
 </p>
 <p class="ne-p" id="ub84180b7">
  <span class="ne-text">
   reselect &#26041;&#27861;&#24635;&#32467;&#19979;&#26469;&#20854;&#23454;&#21482;&#20570;&#20102;&#20004;&#20214;&#20107;&#24773;&#65292;&#31532;&#19968;&#26159;&#26597;&#25214;&#21487;&#29992;&#30340; Invoker&#65292;&#24182;&#23558;&#20854;&#28155;&#21152;&#21040; reselectInvokers &#38598;&#21512;&#20013;&#12290;&#31532;&#20108;&#65292;&#22914;&#26524; reselectInvokers &#19981;&#20026;&#31354;&#65292;&#21017;&#36890;&#36807;&#36127;&#36733;&#22343;&#34913;&#32452;&#20214;&#20877;&#27425;&#36827;&#34892;&#36873;&#25321;&#12290;&#20854;&#20013;&#31532;&#19968;&#20214;&#20107;&#24773;&#21448;&#21487;&#36827;&#34892;&#32454;&#20998;&#65292;&#19968;&#24320;&#22987;&#65292;reselect &#20174; invokers &#21015;&#34920;&#20013;&#26597;&#25214;&#26377;&#25928;&#21487;&#29992;&#30340; Invoker&#65292;&#33509;&#26410;&#33021;&#25214;&#21040;&#65292;&#27492;&#26102;&#20877;&#21040; selected &#21015;&#34920;&#20013;&#32487;&#32493;&#26597;&#25214;&#12290;&#20851;&#20110; reselect &#26041;&#27861;&#23601;&#20808;&#20998;&#26512;&#21040;&#36825;&#65292;&#32487;&#32493;&#20998;&#26512;&#20854;&#20182;&#30340; Cluster Invoker&#12290;
  </span>
 </p>
 <p class="ne-p" id="u7300acb7">
  <br>
 </p>
 <h4 id="8aa9fabc">
  <span class="ne-text">
   3.2.2 FailbackClusterInvoker
  </span>
 </h4>
 <p class="ne-p" id="uc80be893">
  <br>
 </p>
 <p class="ne-p" id="u8ff79b4c">
  <span class="ne-text">
   FailbackClusterInvoker &#20250;&#22312;&#35843;&#29992;&#22833;&#36133;&#21518;&#65292;&#36820;&#22238;&#19968;&#20010;&#31354;&#32467;&#26524;&#32473;&#26381;&#21153;&#28040;&#36153;&#32773;&#12290;&#24182;&#36890;&#36807;&#23450;&#26102;&#20219;&#21153;&#23545;&#22833;&#36133;&#30340;&#35843;&#29992;&#36827;&#34892;&#37325;&#20256;&#65292;&#36866;&#21512;&#25191;&#34892;&#28040;&#24687;&#36890;&#30693;&#31561;&#25805;&#20316;&#12290;&#19979;&#38754;&#26469;&#30475;&#19968;&#19979;&#23427;&#30340;&#23454;&#29616;&#36923;&#36753;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u994da6ca">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="39753980">public class FailbackClusterInvoker&lt;T&gt; extends AbstractClusterInvoker&lt;T&gt; {

    private static final long RETRY_FAILED_PERIOD = 5 * 1000;

    private final ScheduledExecutorService scheduledExecutorService = Executors.newScheduledThreadPool(2,
            new NamedInternalThreadFactory("failback-cluster-timer", true));

    private final ConcurrentMap&lt;Invocation, AbstractClusterInvoker&lt;?&gt;&gt; failed = new ConcurrentHashMap&lt;Invocation, AbstractClusterInvoker&lt;?&gt;&gt;();
    private volatile ScheduledFuture&lt;?&gt; retryFuture;

    @Override
    protected Result doInvoke(Invocation invocation, List&lt;Invoker&lt;T&gt;&gt; invokers, LoadBalance loadbalance) throws RpcException {
        try {
            checkInvokers(invokers, invocation);
            // &#36873;&#25321; Invoker
            Invoker&lt;T&gt; invoker = select(loadbalance, invocation, invokers, null);
            // &#36827;&#34892;&#35843;&#29992;
            return invoker.invoke(invocation);
        } catch (Throwable e) {
            // &#22914;&#26524;&#35843;&#29992;&#36807;&#31243;&#20013;&#21457;&#29983;&#24322;&#24120;&#65292;&#27492;&#26102;&#20165;&#25171;&#21360;&#38169;&#35823;&#26085;&#24535;&#65292;&#19981;&#25243;&#20986;&#24322;&#24120;
            logger.error("Failback to invoke method ...");
            
            // &#35760;&#24405;&#35843;&#29992;&#20449;&#24687;
            addFailed(invocation, this);
            // &#36820;&#22238;&#19968;&#20010;&#31354;&#32467;&#26524;&#32473;&#26381;&#21153;&#28040;&#36153;&#32773;
            return new RpcResult();
        }
    }

    private void addFailed(Invocation invocation, AbstractClusterInvoker&lt;?&gt; router) {
        if (retryFuture == null) {
            synchronized (this) {
                if (retryFuture == null) {
                    // &#21019;&#24314;&#23450;&#26102;&#20219;&#21153;&#65292;&#27599;&#38548;5&#31186;&#25191;&#34892;&#19968;&#27425;
                    retryFuture = scheduledExecutorService.scheduleWithFixedDelay(new Runnable() {

                        @Override
                        public void run() {
                            try {
                                // &#23545;&#22833;&#36133;&#30340;&#35843;&#29992;&#36827;&#34892;&#37325;&#35797;
                                retryFailed();
                            } catch (Throwable t) {
                                // &#22914;&#26524;&#21457;&#29983;&#24322;&#24120;&#65292;&#20165;&#25171;&#21360;&#24322;&#24120;&#26085;&#24535;&#65292;&#19981;&#25243;&#20986;
                                logger.error("Unexpected error occur at collect statistic", t);
                            }
                        }
                    }, RETRY_FAILED_PERIOD, RETRY_FAILED_PERIOD, TimeUnit.MILLISECONDS);
                }
            }
        }
        
        // &#28155;&#21152; invocation &#21644; invoker &#21040; failed &#20013;
        failed.put(invocation, router);
    }

    void retryFailed() {
        if (failed.size() == 0) {
            return;
        }
        
        // &#36941;&#21382; failed&#65292;&#23545;&#22833;&#36133;&#30340;&#35843;&#29992;&#36827;&#34892;&#37325;&#35797;
        for (Map.Entry&lt;Invocation, AbstractClusterInvoker&lt;?&gt;&gt; entry : new HashMap&lt;Invocation, AbstractClusterInvoker&lt;?&gt;&gt;(failed).entrySet()) {
            Invocation invocation = entry.getKey();
            Invoker&lt;?&gt; invoker = entry.getValue();
            try {
                // &#20877;&#27425;&#36827;&#34892;&#35843;&#29992;
                invoker.invoke(invocation);
                // &#35843;&#29992;&#25104;&#21151;&#21518;&#65292;&#20174; failed &#20013;&#31227;&#38500; invoker
                failed.remove(invocation);
            } catch (Throwable e) {
                // &#20165;&#25171;&#21360;&#24322;&#24120;&#65292;&#19981;&#25243;&#20986;
                logger.error("Failed retry to invoke method ...");
            }
        }
    }
}</pre>
 <p class="ne-p" id="ucecb4030">
  <br>
 </p>
 <p class="ne-p" id="uafe824d1">
  <span class="ne-text">
   &#36825;&#20010;&#31867;&#20027;&#35201;&#30001;3&#20010;&#26041;&#27861;&#32452;&#25104;&#65292;&#39318;&#20808;&#26159; doInvoker&#65292;&#35813;&#26041;&#27861;&#36127;&#36131;&#21021;&#27425;&#30340;&#36828;&#31243;&#35843;&#29992;&#12290;&#33509;&#36828;&#31243;&#35843;&#29992;&#22833;&#36133;&#65292;&#21017;&#36890;&#36807; addFailed &#26041;&#27861;&#23558;&#35843;&#29992;&#20449;&#24687;&#23384;&#20837;&#21040; failed &#20013;&#65292;&#31561;&#24453;&#23450;&#26102;&#37325;&#35797;&#12290;addFailed &#22312;&#24320;&#22987;&#38454;&#27573;&#20250;&#26681;&#25454; retryFuture &#20026;&#31354;&#19982;&#21542;&#65292;&#26469;&#20915;&#23450;&#26159;&#21542;&#24320;&#21551;&#23450;&#26102;&#20219;&#21153;&#12290;retryFailed &#26041;&#27861;&#21017;&#26159;&#21253;&#21547;&#20102;&#22833;&#36133;&#37325;&#35797;&#30340;&#36923;&#36753;&#65292;&#35813;&#26041;&#27861;&#20250;&#23545; failed &#36827;&#34892;&#36941;&#21382;&#65292;&#28982;&#21518;&#20381;&#27425;&#23545; Invoker &#36827;&#34892;&#35843;&#29992;&#12290;&#35843;&#29992;&#25104;&#21151;&#21017;&#23558; Invoker &#20174; failed &#20013;&#31227;&#38500;&#65292;&#35843;&#29992;&#22833;&#36133;&#21017;&#24573;&#30053;&#22833;&#36133;&#21407;&#22240;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u800f20ae">
  <br>
 </p>
 <p class="ne-p" id="ud7e11c95">
  <span class="ne-text">
   &#20197;&#19978;&#23601;&#26159; FailbackClusterInvoker &#30340;&#25191;&#34892;&#36923;&#36753;&#65292;&#19981;&#26159;&#24456;&#22797;&#26434;&#65292;&#32487;&#32493;&#24448;&#19979;&#30475;&#12290;
  </span>
 </p>
 <p class="ne-p" id="uc4bf0dc1">
  <br>
 </p>
 <h4 id="ec7a7a58">
  <span class="ne-text">
   3.2.3 FailfastClusterInvoker
  </span>
 </h4>
 <p class="ne-p" id="ue1664150">
  <br>
 </p>
 <p class="ne-p" id="u9c695cf5">
  <span class="ne-text">
   FailfastClusterInvoker &#21482;&#20250;&#21457;&#36215;&#19968;&#27425;&#35843;&#29992;&#65292;&#22833;&#36133;&#21518;&#31435;&#21363;&#25243;&#20986;&#24322;&#24120;&#12290;&#36890;&#24120;&#29992;&#20110;&#38750;&#24130;&#31561;&#24615;&#30340;&#20889;&#25805;&#20316;&#65292;&#27604;&#22914;&#26032;&#22686;&#35760;&#24405;&#12290;&#28304;&#30721;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u43da1307">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="392d1fdd">public class FailfastClusterInvoker&lt;T&gt; extends AbstractClusterInvoker&lt;T&gt; {

    @Override
    public Result doInvoke(Invocation invocation, List&lt;Invoker&lt;T&gt;&gt; invokers, LoadBalance loadbalance) throws RpcException {
        checkInvokers(invokers, invocation);
        // &#36873;&#25321; Invoker
        Invoker&lt;T&gt; invoker = select(loadbalance, invocation, invokers, null);
        try {
            // &#35843;&#29992; Invoker
            return invoker.invoke(invocation);
        } catch (Throwable e) {
            if (e instanceof RpcException &amp;&amp; ((RpcException) e).isBiz()) {
                // &#25243;&#20986;&#24322;&#24120;
                throw (RpcException) e;
            }
            // &#25243;&#20986;&#24322;&#24120;
            throw new RpcException(..., "Failfast invoke providers ...");
        }
    }
}</pre>
 <p class="ne-p" id="u588bbd3d">
  <br>
 </p>
 <p class="ne-p" id="ua6a6b03e">
  <span class="ne-text">
   &#22914;&#19978;&#65292;&#39318;&#20808;&#26159;&#36890;&#36807; select &#26041;&#27861;&#36873;&#25321; Invoker&#65292;&#28982;&#21518;&#36827;&#34892;&#36828;&#31243;&#35843;&#29992;&#12290;&#22914;&#26524;&#35843;&#29992;&#22833;&#36133;&#65292;&#21017;&#31435;&#21363;&#25243;&#20986;&#24322;&#24120;&#12290;FailfastClusterInvoker &#23601;&#20808;&#20998;&#26512;&#21040;&#36825;&#65292;&#19979;&#38754;&#20998;&#26512; FailsafeClusterInvoker&#12290;
  </span>
 </p>
 <p class="ne-p" id="u99c397df">
  <br>
 </p>
 <h4 id="e79bd3d4">
  <span class="ne-text">
   3.2.4 FailsafeClusterInvoker
  </span>
 </h4>
 <p class="ne-p" id="uf62464f5">
  <br>
 </p>
 <p class="ne-p" id="ud6177ddc">
  <span class="ne-text">
   FailsafeClusterInvoker &#26159;&#19968;&#31181;&#22833;&#36133;&#23433;&#20840;&#30340; Cluster Invoker&#12290;&#25152;&#35859;&#30340;&#22833;&#36133;&#23433;&#20840;&#26159;&#25351;&#65292;&#24403;&#35843;&#29992;&#36807;&#31243;&#20013;&#20986;&#29616;&#24322;&#24120;&#26102;&#65292;FailsafeClusterInvoker &#20165;&#20250;&#25171;&#21360;&#24322;&#24120;&#65292;&#32780;&#19981;&#20250;&#25243;&#20986;&#24322;&#24120;&#12290;&#36866;&#29992;&#20110;&#20889;&#20837;&#23457;&#35745;&#26085;&#24535;&#31561;&#25805;&#20316;&#12290;&#19979;&#38754;&#20998;&#26512;&#28304;&#30721;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u54304ec7">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="c8d5386e">public class FailsafeClusterInvoker&lt;T&gt; extends AbstractClusterInvoker&lt;T&gt; {

    @Override
    public Result doInvoke(Invocation invocation, List&lt;Invoker&lt;T&gt;&gt; invokers, LoadBalance loadbalance) throws RpcException {
        try {
            checkInvokers(invokers, invocation);
            // &#36873;&#25321; Invoker
            Invoker&lt;T&gt; invoker = select(loadbalance, invocation, invokers, null);
            // &#36827;&#34892;&#36828;&#31243;&#35843;&#29992;
            return invoker.invoke(invocation);
        } catch (Throwable e) {
			// &#25171;&#21360;&#38169;&#35823;&#26085;&#24535;&#65292;&#20294;&#19981;&#25243;&#20986;
            logger.error("Failsafe ignore exception: " + e.getMessage(), e);
            // &#36820;&#22238;&#31354;&#32467;&#26524;&#24573;&#30053;&#38169;&#35823;
            return new RpcResult();
        }
    }
}</pre>
 <p class="ne-p" id="ue0e5bb1f">
  <br>
 </p>
 <p class="ne-p" id="ue6187631">
  <span class="ne-text">
   FailsafeClusterInvoker &#30340;&#36923;&#36753;&#21644; FailfastClusterInvoker &#30340;&#36923;&#36753;&#19968;&#26679;&#31616;&#21333;&#65292;&#26080;&#38656;&#36807;&#22810;&#35828;&#26126;&#12290;&#32487;&#32493;&#21521;&#19979;&#20998;&#26512;&#12290;
  </span>
 </p>
 <p class="ne-p" id="uf3557eea">
  <br>
 </p>
 <h4 id="5912f845">
  <span class="ne-text">
   3.2.5 ForkingClusterInvoker
  </span>
 </h4>
 <p class="ne-p" id="ue5c32132">
  <br>
 </p>
 <p class="ne-p" id="u3e5b6685">
  <span class="ne-text">
   ForkingClusterInvoker &#20250;&#22312;&#36816;&#34892;&#26102;&#36890;&#36807;&#32447;&#31243;&#27744;&#21019;&#24314;&#22810;&#20010;&#32447;&#31243;&#65292;&#24182;&#21457;&#35843;&#29992;&#22810;&#20010;&#26381;&#21153;&#25552;&#20379;&#32773;&#12290;&#21482;&#35201;&#26377;&#19968;&#20010;&#26381;&#21153;&#25552;&#20379;&#32773;&#25104;&#21151;&#36820;&#22238;&#20102;&#32467;&#26524;&#65292;doInvoke &#26041;&#27861;&#23601;&#20250;&#31435;&#21363;&#32467;&#26463;&#36816;&#34892;&#12290;ForkingClusterInvoker &#30340;&#24212;&#29992;&#22330;&#26223;&#26159;&#22312;&#19968;&#20123;&#23545;&#23454;&#26102;&#24615;&#35201;&#27714;&#27604;&#36739;&#39640;
  </span>
  <strong>
   <span class="ne-text">
    &#35835;&#25805;&#20316;
   </span>
  </strong>
  <span class="ne-text">
   &#65288;&#27880;&#24847;&#26159;&#35835;&#25805;&#20316;&#65292;&#24182;&#34892;&#20889;&#25805;&#20316;&#21487;&#33021;&#19981;&#23433;&#20840;&#65289;&#19979;&#20351;&#29992;&#65292;&#20294;&#36825;&#23558;&#20250;&#32791;&#36153;&#26356;&#22810;&#30340;&#36164;&#28304;&#12290;&#19979;&#38754;&#26469;&#30475;&#35813;&#31867;&#30340;&#23454;&#29616;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u6dece7e4">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="6112bd7c">public class ForkingClusterInvoker&lt;T&gt; extends AbstractClusterInvoker&lt;T&gt; {
    
    private final ExecutorService executor = Executors.newCachedThreadPool(
            new NamedInternalThreadFactory("forking-cluster-timer", true));

    @Override
    public Result doInvoke(final Invocation invocation, List&lt;Invoker&lt;T&gt;&gt; invokers, LoadBalance loadbalance) throws RpcException {
        try {
            checkInvokers(invokers, invocation);
            final List&lt;Invoker&lt;T&gt;&gt; selected;
            // &#33719;&#21462; forks &#37197;&#32622;
            final int forks = getUrl().getParameter(Constants.FORKS_KEY, Constants.DEFAULT_FORKS);
            // &#33719;&#21462;&#36229;&#26102;&#37197;&#32622;
            final int timeout = getUrl().getParameter(Constants.TIMEOUT_KEY, Constants.DEFAULT_TIMEOUT);
            // &#22914;&#26524; forks &#37197;&#32622;&#19981;&#21512;&#29702;&#65292;&#21017;&#30452;&#25509;&#23558; invokers &#36171;&#20540;&#32473; selected
            if (forks &lt;= 0 || forks &gt;= invokers.size()) {
                selected = invokers;
            } else {
                selected = new ArrayList&lt;Invoker&lt;T&gt;&gt;();
                // &#24490;&#29615;&#36873;&#20986; forks &#20010; Invoker&#65292;&#24182;&#28155;&#21152;&#21040; selected &#20013;
                for (int i = 0; i &lt; forks; i++) {
                    // &#36873;&#25321; Invoker
                    Invoker&lt;T&gt; invoker = select(loadbalance, invocation, invokers, selected);
                    if (!selected.contains(invoker)) {
                        selected.add(invoker);
                    }
                }
            }
            
            // ----------------------&#10024; &#20998;&#21106;&#32447;1 &#10024;---------------------- //
            
            RpcContext.getContext().setInvokers((List) selected);
            final AtomicInteger count = new AtomicInteger();
            final BlockingQueue&lt;Object&gt; ref = new LinkedBlockingQueue&lt;Object&gt;();
            // &#36941;&#21382; selected &#21015;&#34920;
            for (final Invoker&lt;T&gt; invoker : selected) {
                // &#20026;&#27599;&#20010; Invoker &#21019;&#24314;&#19968;&#20010;&#25191;&#34892;&#32447;&#31243;
                executor.execute(new Runnable() {
                    @Override
                    public void run() {
                        try {
                            // &#36827;&#34892;&#36828;&#31243;&#35843;&#29992;
                            Result result = invoker.invoke(invocation);
                            // &#23558;&#32467;&#26524;&#23384;&#21040;&#38459;&#22622;&#38431;&#21015;&#20013;
                            ref.offer(result);
                        } catch (Throwable e) {
                            int value = count.incrementAndGet();
                            // &#20165;&#22312; value &#22823;&#20110;&#31561;&#20110; selected.size() &#26102;&#65292;&#25165;&#23558;&#24322;&#24120;&#23545;&#35937;
                            // &#25918;&#20837;&#38459;&#22622;&#38431;&#21015;&#20013;&#65292;&#35831;&#22823;&#23478;&#24605;&#32771;&#19968;&#19979;&#20026;&#20160;&#20040;&#35201;&#36825;&#26679;&#20570;&#12290;
                            if (value &gt;= selected.size()) {
                                // &#23558;&#24322;&#24120;&#23545;&#35937;&#23384;&#20837;&#21040;&#38459;&#22622;&#38431;&#21015;&#20013;
                                ref.offer(e);
                            }
                        }
                    }
                });
            }
            
            // ----------------------&#10024; &#20998;&#21106;&#32447;2 &#10024;---------------------- //
            
            try {
                // &#20174;&#38459;&#22622;&#38431;&#21015;&#20013;&#21462;&#20986;&#36828;&#31243;&#35843;&#29992;&#32467;&#26524;
                Object ret = ref.poll(timeout, TimeUnit.MILLISECONDS);
                
                // &#22914;&#26524;&#32467;&#26524;&#31867;&#22411;&#20026; Throwable&#65292;&#21017;&#25243;&#20986;&#24322;&#24120;
                if (ret instanceof Throwable) {
                    Throwable e = (Throwable) ret;
                    throw new RpcException(..., "Failed to forking invoke provider ...");
                }
                
                // &#36820;&#22238;&#32467;&#26524;
                return (Result) ret;
            } catch (InterruptedException e) {
                throw new RpcException("Failed to forking invoke provider ...");
            }
        } finally {
            RpcContext.getContext().clearAttachments();
        }
    }
}</pre>
 <p class="ne-p" id="u6dc9645c">
  <br>
 </p>
 <p class="ne-p" id="uc05455c2">
  <span class="ne-text">
   ForkingClusterInvoker &#30340; doInvoker &#26041;&#27861;&#27604;&#36739;&#38271;&#65292;&#36825;&#37324;&#36890;&#36807;&#20004;&#20010;&#20998;&#21106;&#32447;&#23558;&#25972;&#20010;&#26041;&#27861;&#21010;&#20998;&#20026;&#19977;&#20010;&#36923;&#36753;&#22359;&#12290;&#20174;&#26041;&#27861;&#24320;&#22987;&#21040;&#20998;&#21106;&#32447;1&#20043;&#38388;&#30340;&#20195;&#30721;&#20027;&#35201;&#26159;&#29992;&#20110;&#36873;&#20986; forks &#20010; Invoker&#65292;&#20026;&#25509;&#19979;&#26469;&#30340;&#24182;&#21457;&#35843;&#29992;&#25552;&#20379;&#36755;&#20837;&#12290;&#20998;&#21106;&#32447;1&#21644;&#20998;&#21106;&#32447;2&#20043;&#38388;&#30340;&#36923;&#36753;&#36890;&#36807;&#32447;&#31243;&#27744;&#24182;&#21457;&#35843;&#29992;&#22810;&#20010; Invoker&#65292;&#24182;&#23558;&#32467;&#26524;&#23384;&#20648;&#22312;&#38459;&#22622;&#38431;&#21015;&#20013;&#12290;&#20998;&#21106;&#32447;2&#21040;&#26041;&#27861;&#32467;&#23614;&#20043;&#38388;&#30340;&#36923;&#36753;&#20027;&#35201;&#29992;&#20110;&#20174;&#38459;&#22622;&#38431;&#21015;&#20013;&#33719;&#21462;&#36820;&#22238;&#32467;&#26524;&#65292;&#24182;&#23545;&#36820;&#22238;&#32467;&#26524;&#31867;&#22411;&#36827;&#34892;&#21028;&#26029;&#12290;&#22914;&#26524;&#20026;&#24322;&#24120;&#31867;&#22411;&#65292;&#21017;&#30452;&#25509;&#25243;&#20986;&#65292;&#21542;&#21017;&#36820;&#22238;&#12290;
  </span>
 </p>
 <p class="ne-p" id="ucd8c4fbf">
  <br>
 </p>
 <p class="ne-p" id="u6f225a32">
  <span class="ne-text">
   &#20197;&#19978;&#23601;&#26159;ForkingClusterInvoker &#30340; doInvoker &#26041;&#27861;&#22823;&#33268;&#36807;&#31243;&#12290;&#25105;&#20204;&#22312;&#20998;&#21106;&#32447;1&#21644;&#20998;&#21106;&#32447;2&#20043;&#38388;&#30340;&#20195;&#30721;&#19978;&#30041;&#20102;&#19968;&#20010;&#38382;&#39064;&#65292;&#38382;&#39064;&#26159;&#36825;&#26679;&#30340;&#65306;&#20026;&#20160;&#20040;&#35201;&#22312;
  </span>
  <code class="ne-code">
   <span class="ne-text">
    value &gt;= selected.size()
   </span>
  </code>
  <span class="ne-text">
   &#30340;&#24773;&#20917;&#19979;&#65292;&#25165;&#23558;&#24322;&#24120;&#23545;&#35937;&#28155;&#21152;&#21040;&#38459;&#22622;&#38431;&#21015;&#20013;&#65311;&#36825;&#37324;&#26469;&#35299;&#31572;&#19968;&#19979;&#12290;&#21407;&#22240;&#26159;&#36825;&#26679;&#30340;&#65292;&#22312;&#24182;&#34892;&#35843;&#29992;&#22810;&#20010;&#26381;&#21153;&#25552;&#20379;&#32773;&#30340;&#24773;&#20917;&#19979;&#65292;&#21482;&#35201;&#26377;&#19968;&#20010;&#26381;&#21153;&#25552;&#20379;&#32773;&#33021;&#22815;&#25104;&#21151;&#36820;&#22238;&#32467;&#26524;&#65292;&#32780;&#20854;&#20182;&#20840;&#37096;&#22833;&#36133;&#12290;&#27492;&#26102; ForkingClusterInvoker &#20173;&#24212;&#35813;&#36820;&#22238;&#25104;&#21151;&#30340;&#32467;&#26524;&#65292;&#32780;&#38750;&#25243;&#20986;&#24322;&#24120;&#12290;&#22312;
  </span>
  <code class="ne-code">
   <span class="ne-text">
    value &gt;= selected.size()
   </span>
  </code>
  <span class="ne-text">
   &#26102;&#23558;&#24322;&#24120;&#23545;&#35937;&#25918;&#20837;&#38459;&#22622;&#38431;&#21015;&#20013;&#65292;&#21487;&#20197;&#20445;&#35777;&#24322;&#24120;&#23545;&#35937;&#19981;&#20250;&#20986;&#29616;&#22312;&#27491;&#24120;&#32467;&#26524;&#30340;&#21069;&#38754;&#65292;&#36825;&#26679;&#21487;&#20174;&#38459;&#22622;&#38431;&#21015;&#20013;&#20248;&#20808;&#21462;&#20986;&#27491;&#24120;&#30340;&#32467;&#26524;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u23e49c57">
  <br>
 </p>
 <p class="ne-p" id="ufa82fb13">
  <span class="ne-text">
   &#20851;&#20110; ForkingClusterInvoker &#23601;&#20808;&#20998;&#26512;&#21040;&#36825;&#65292;&#25509;&#19979;&#26469;&#20998;&#26512;&#26368;&#21518;&#19968;&#20010; Cluster Invoker&#12290;
  </span>
 </p>
 <p class="ne-p" id="u5767e482">
  <br>
 </p>
 <h4 id="76b154fb">
  <span class="ne-text">
   3.2.6 BroadcastClusterInvoker
  </span>
 </h4>
 <p class="ne-p" id="u673aa6bc">
  <br>
 </p>
 <p class="ne-p" id="u3c7d731c">
  <span class="ne-text">
   &#26412;&#31456;&#30340;&#26368;&#21518;&#65292;&#25105;&#20204;&#20877;&#26469;&#30475;&#19968;&#19979; BroadcastClusterInvoker&#12290;BroadcastClusterInvoker &#20250;&#36880;&#20010;&#35843;&#29992;&#27599;&#20010;&#26381;&#21153;&#25552;&#20379;&#32773;&#65292;&#22914;&#26524;&#20854;&#20013;&#19968;&#21488;&#25253;&#38169;&#65292;&#22312;&#24490;&#29615;&#35843;&#29992;&#32467;&#26463;&#21518;&#65292;BroadcastClusterInvoker &#20250;&#25243;&#20986;&#24322;&#24120;&#12290;&#35813;&#31867;&#36890;&#24120;&#29992;&#20110;&#36890;&#30693;&#25152;&#26377;&#25552;&#20379;&#32773;&#26356;&#26032;&#32531;&#23384;&#25110;&#26085;&#24535;&#31561;&#26412;&#22320;&#36164;&#28304;&#20449;&#24687;&#12290;&#28304;&#30721;&#22914;&#19979;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u386b1c42">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="fa05eec0">public class BroadcastClusterInvoker&lt;T&gt; extends AbstractClusterInvoker&lt;T&gt; {

    @Override
    public Result doInvoke(final Invocation invocation, List&lt;Invoker&lt;T&gt;&gt; invokers, LoadBalance loadbalance) throws RpcException {
        checkInvokers(invokers, invocation);
        RpcContext.getContext().setInvokers((List) invokers);
        RpcException exception = null;
        Result result = null;
        // &#36941;&#21382; Invoker &#21015;&#34920;&#65292;&#36880;&#20010;&#35843;&#29992;
        for (Invoker&lt;T&gt; invoker : invokers) {
            try {
                // &#36827;&#34892;&#36828;&#31243;&#35843;&#29992;
                result = invoker.invoke(invocation);
            } catch (RpcException e) {
                exception = e;
                logger.warn(e.getMessage(), e);
            } catch (Throwable e) {
                exception = new RpcException(e.getMessage(), e);
                logger.warn(e.getMessage(), e);
            }
        }
        
        // exception &#19981;&#20026;&#31354;&#65292;&#21017;&#25243;&#20986;&#24322;&#24120;
        if (exception != null) {
            throw exception;
        }
        return result;
    }
}</pre>
 <p class="ne-p" id="u5f58d90d">
  <br>
 </p>
 <p class="ne-p" id="ud278ed58">
  <span class="ne-text">
   &#20197;&#19978;&#23601;&#26159; BroadcastClusterInvoker &#30340;&#20195;&#30721;&#65292;&#27604;&#36739;&#31616;&#21333;&#65292;&#23601;&#19981;&#22810;&#35828;&#20102;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u34564f89">
  <br>
 </p>
 <h2 id="76304aaf">
  <span class="ne-text">
   4.&#24635;&#32467;
  </span>
 </h2>
 <p class="ne-p" id="u44fb73e2">
  <br>
 </p>
 <p class="ne-p" id="ud84ed759">
  <span class="ne-text">
   &#26412;&#31687;&#25991;&#31456;&#35814;&#32454;&#20998;&#26512;&#20102;&#38598;&#32676;&#23481;&#38169;&#30340;&#20960;&#31181;&#23454;&#29616;&#26041;&#24335;&#12290;&#38598;&#32676;&#23481;&#38169;&#23545;&#20110; Dubbo &#26694;&#26550;&#26469;&#35828;&#65292;&#26159;&#24456;&#37325;&#35201;&#30340;&#36923;&#36753;&#12290;&#38598;&#32676;&#27169;&#22359;&#22788;&#20110;&#26381;&#21153;&#25552;&#20379;&#32773;&#21644;&#28040;&#36153;&#32773;&#20043;&#38388;&#65292;&#23545;&#20110;&#26381;&#21153;&#28040;&#36153;&#32773;&#26469;&#35828;&#65292;&#38598;&#32676;&#21487;&#21521;&#20854;&#23631;&#34109;&#26381;&#21153;&#25552;&#20379;&#32773;&#38598;&#32676;&#30340;&#24773;&#20917;&#65292;&#20351;&#20854;&#33021;&#22815;&#19987;&#24515;&#36827;&#34892;&#36828;&#31243;&#35843;&#29992;&#12290;&#38500;&#27492;&#20043;&#22806;&#65292;&#36890;&#36807;&#38598;&#32676;&#27169;&#22359;&#65292;&#25105;&#20204;&#36824;&#21487;&#20197;&#23545;&#26381;&#21153;&#20043;&#38388;&#30340;&#35843;&#29992;&#38142;&#36335;&#36827;&#34892;&#32534;&#25490;&#20248;&#21270;&#65292;&#27835;&#29702;&#26381;&#21153;&#12290;&#24635;&#30340;&#26469;&#35828;&#65292;&#23545;&#20110; Dubbo &#32780;&#35328;&#65292;&#38598;&#32676;&#23481;&#38169;&#30456;&#20851;&#36923;&#36753;&#26159;&#38750;&#24120;&#37325;&#35201;&#30340;&#12290;&#24819;&#35201;&#23545; Dubbo &#26377;&#27604;&#36739;&#28145;&#30340;&#29702;&#35299;&#65292;&#38598;&#32676;&#23481;&#38169;&#26159;&#24517;&#39035;&#35201;&#25484;&#25569;&#30340;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u5c24a692">
  <br>
 </p>
 <p class="ne-p" id="ubfdc9c77">
  <span class="ne-text">
   &#20851;&#20110;&#38598;&#32676;&#27169;&#22359;&#23601;&#20808;&#20998;&#26512;&#21040;&#36825;&#65292;&#24863;&#35874;&#38405;&#35835;&#12290;
  </span>
 </p>
</div>
</div>
</div>

        </body>
        
        