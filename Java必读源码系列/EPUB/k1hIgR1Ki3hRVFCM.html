
        <html lang="en">
        <head>
        <meta charset="UTF-8"/>
        </head>
        <body>
        <div><div class="markdown-body">
    <h1>&#12300;&#28304;&#30721;&#35299;&#35835;&#12301;Dubbo SPI&#33258;&#36866;&#24212;&#25193;&#23637;</h1><div class="lake-content" typography="classic">
 <div class="ne-quote">
  <p class="ne-p" id="uc55b2a9f">
   <span class="ne-text">
    &#21407;&#25991;&#22320;&#22336;&#65306;
   </span>
   <a class="ne-link" data-href="https://dubbo.apache.org/zh/docsv2.7/dev/source/adaptive-extension/" href="https://dubbo.apache.org/zh/docsv2.7/dev/source/adaptive-extension/" target="_blank">
    <span class="ne-text">
     https://dubbo.apache.org/zh/docsv2.7/dev/source/adaptive-extension/
    </span>
   </a>
  </p>
  <p class="ne-p" id="ucb5f5132">
   <span class="ne-text">
   </span>
  </p>
  <p class="ne-p" id="ubb67153b">
   <span class="ne-text">
    &#20316;&#32773;&#65306; Dubbo &#23448;&#26041;
   </span>
  </p>
 </div>
 <p class="ne-p" id="u300fd81c">
  <br>
 </p>
 <h2 id="19cd45a1">
  <span class="ne-text">
   1.&#21407;&#29702;
  </span>
 </h2>
 <p class="ne-p" id="u1dfd4f64">
  <br>
 </p>
 <p class="ne-p" id="uddd90748">
  <span class="ne-text">
   &#22312; Dubbo &#20013;&#65292;&#24456;&#22810;&#25299;&#23637;&#37117;&#26159;&#36890;&#36807; SPI &#26426;&#21046;&#36827;&#34892;&#21152;&#36733;&#30340;&#65292;&#27604;&#22914; Protocol&#12289;Cluster&#12289;LoadBalance &#31561;&#12290;&#26377;&#26102;&#65292;&#26377;&#20123;&#25299;&#23637;&#24182;&#19981;&#24819;&#22312;&#26694;&#26550;&#21551;&#21160;&#38454;&#27573;&#34987;&#21152;&#36733;&#65292;&#32780;&#26159;&#24076;&#26395;&#22312;&#25299;&#23637;&#26041;&#27861;&#34987;&#35843;&#29992;&#26102;&#65292;&#26681;&#25454;&#36816;&#34892;&#26102;&#21442;&#25968;&#36827;&#34892;&#21152;&#36733;&#12290;&#36825;&#21548;&#36215;&#26469;&#26377;&#20123;&#30683;&#30462;&#12290;&#25299;&#23637;&#26410;&#34987;&#21152;&#36733;&#65292;&#37027;&#20040;&#25299;&#23637;&#26041;&#27861;&#23601;&#26080;&#27861;&#34987;&#35843;&#29992;&#65288;&#38745;&#24577;&#26041;&#27861;&#38500;&#22806;&#65289;&#12290;&#25299;&#23637;&#26041;&#27861;&#26410;&#34987;&#35843;&#29992;&#65292;&#25299;&#23637;&#23601;&#26080;&#27861;&#34987;&#21152;&#36733;&#12290;&#23545;&#20110;&#36825;&#20010;&#30683;&#30462;&#30340;&#38382;&#39064;&#65292;Dubbo &#36890;&#36807;&#33258;&#36866;&#24212;&#25299;&#23637;&#26426;&#21046;&#24456;&#22909;&#30340;&#35299;&#20915;&#20102;&#12290;&#33258;&#36866;&#24212;&#25299;&#23637;&#26426;&#21046;&#30340;&#23454;&#29616;&#36923;&#36753;&#27604;&#36739;&#22797;&#26434;&#65292;&#39318;&#20808; Dubbo &#20250;&#20026;&#25299;&#23637;&#25509;&#21475;&#29983;&#25104;&#20855;&#26377;&#20195;&#29702;&#21151;&#33021;&#30340;&#20195;&#30721;&#12290;&#28982;&#21518;&#36890;&#36807; javassist &#25110; jdk &#32534;&#35793;&#36825;&#27573;&#20195;&#30721;&#65292;&#24471;&#21040; Class &#31867;&#12290;&#26368;&#21518;&#20877;&#36890;&#36807;&#21453;&#23556;&#21019;&#24314;&#20195;&#29702;&#31867;&#65292;&#25972;&#20010;&#36807;&#31243;&#27604;&#36739;&#22797;&#26434;&#12290;&#20026;&#20102;&#35753;&#22823;&#23478;&#23545;&#33258;&#36866;&#24212;&#25299;&#23637;&#26377;&#19968;&#20010;&#24863;&#24615;&#30340;&#35748;&#35782;&#65292;&#19979;&#38754;&#25105;&#20204;&#36890;&#36807;&#19968;&#20010;&#31034;&#20363;&#36827;&#34892;&#28436;&#31034;&#12290;&#36825;&#26159;&#19968;&#20010;&#19982;&#27773;&#36710;&#30456;&#20851;&#30340;&#20363;&#23376;&#65292;&#25105;&#20204;&#26377;&#19968;&#20010;&#36710;&#36718;&#21046;&#36896;&#21378;&#25509;&#21475; WheelMaker&#65306;
  </span>
 </p>
 <p class="ne-p" id="u153f4a36">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="eca6ad6e">public interface WheelMaker {
    Wheel makeWheel(URL url);
}</pre>
 <p class="ne-p" id="uda7cb719">
  <br>
 </p>
 <p class="ne-p" id="ub7aad8e3">
  <span class="ne-text">
   WheelMaker &#25509;&#21475;&#30340;&#33258;&#36866;&#24212;&#23454;&#29616;&#31867;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u6c6793d4">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="94c3272b">public class AdaptiveWheelMaker implements WheelMaker {
    public Wheel makeWheel(URL url) {
        if (url == null) {
            throw new IllegalArgumentException("url == null");
        }
        
    	// 1.&#20174; URL &#20013;&#33719;&#21462; WheelMaker &#21517;&#31216;
        String wheelMakerName = url.getParameter("Wheel.maker");
        if (wheelMakerName == null) {
            throw new IllegalArgumentException("wheelMakerName == null");
        }
        
        // 2.&#36890;&#36807; SPI &#21152;&#36733;&#20855;&#20307;&#30340; WheelMaker
        WheelMaker wheelMaker = ExtensionLoader
            .getExtensionLoader(WheelMaker.class).getExtension(wheelMakerName);
        
        // 3.&#35843;&#29992;&#30446;&#26631;&#26041;&#27861;
        return wheelMaker.makeWheel(url);
    }
}</pre>
 <p class="ne-p" id="u64123811">
  <br>
 </p>
 <p class="ne-p" id="u9e71f508">
  <span class="ne-text">
   AdaptiveWheelMaker &#26159;&#19968;&#20010;&#20195;&#29702;&#31867;&#65292;&#19982;&#20256;&#32479;&#30340;&#20195;&#29702;&#36923;&#36753;&#19981;&#21516;&#65292;AdaptiveWheelMaker &#25152;&#20195;&#29702;&#30340;&#23545;&#35937;&#26159;&#22312; makeWheel &#26041;&#27861;&#20013;&#36890;&#36807; SPI &#21152;&#36733;&#24471;&#21040;&#30340;&#12290;makeWheel &#26041;&#27861;&#20027;&#35201;&#20570;&#20102;&#19977;&#20214;&#20107;&#24773;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u00c404cb">
  <br>
 </p>
 <ol class="ne-ol">
  <li id="u7f6606a4">
   <span class="ne-text">
    &#20174; URL &#20013;&#33719;&#21462; WheelMaker &#21517;&#31216;
   </span>
  </li>
  <li id="udf0f7333">
   <span class="ne-text">
    &#36890;&#36807; SPI &#21152;&#36733;&#20855;&#20307;&#30340; WheelMaker &#23454;&#29616;&#31867;
   </span>
  </li>
 </ol>
 <ol class="ne-ol" start="3">
  <li id="uc4463013">
   <span class="ne-text">
    &#35843;&#29992;&#30446;&#26631;&#26041;&#27861;
   </span>
  </li>
 </ol>
 <p class="ne-p" id="u03d1dab3">
  <br>
 </p>
 <p class="ne-p" id="u5bb3fdf1">
  <span class="ne-text">
   &#25509;&#19979;&#26469;&#65292;&#25105;&#20204;&#26469;&#30475;&#30475;&#27773;&#36710;&#21046;&#36896;&#21378; CarMaker &#25509;&#21475;&#19982;&#20854;&#23454;&#29616;&#31867;&#12290;
  </span>
 </p>
 <p class="ne-p" id="ud813274f">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="09329dc0">public interface CarMaker {
    Car makeCar(URL url);
}

public class RaceCarMaker implements CarMaker {
    WheelMaker wheelMaker;
 
    // &#36890;&#36807; setter &#27880;&#20837; AdaptiveWheelMaker
    public setWheelMaker(WheelMaker wheelMaker) {
        this.wheelMaker = wheelMaker;
    }
 
    public Car makeCar(URL url) {
        Wheel wheel = wheelMaker.makeWheel(url);
        return new RaceCar(wheel, ...);
    }
}</pre>
 <p class="ne-p" id="u837f2160">
  <br>
 </p>
 <p class="ne-p" id="u09d320d1">
  <span class="ne-text">
   RaceCarMaker &#25345;&#26377;&#19968;&#20010; WheelMaker &#31867;&#22411;&#30340;&#25104;&#21592;&#21464;&#37327;&#65292;&#22312;&#31243;&#24207;&#21551;&#21160;&#26102;&#65292;&#25105;&#20204;&#21487;&#20197;&#23558; AdaptiveWheelMaker &#36890;&#36807; setter &#26041;&#27861;&#27880;&#20837;&#21040; RaceCarMaker &#20013;&#12290;&#22312;&#36816;&#34892;&#26102;&#65292;&#20551;&#35774;&#26377;&#36825;&#26679;&#19968;&#20010; url &#21442;&#25968;&#20256;&#20837;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u3144f623">
  <br>
 </p>
 <pre class="ne-codeblock language-fallback" data-language="fallback" id="ea0954df">dubbo://192.168.0.101:20880/XxxService?wheel.maker=MichelinWheelMaker</pre>
 <p class="ne-p" id="u9af8f710">
  <br>
 </p>
 <p class="ne-p" id="u9d97de20">
  <span class="ne-text">
   RaceCarMaker &#30340; makeCar &#26041;&#27861;&#23558;&#19978;&#38754;&#30340; url &#20316;&#20026;&#21442;&#25968;&#20256;&#32473; AdaptiveWheelMaker &#30340; makeWheel &#26041;&#27861;&#65292;makeWheel &#26041;&#27861;&#20174; url &#20013;&#25552;&#21462; wheel.maker &#21442;&#25968;&#65292;&#24471;&#21040; MichelinWheelMaker&#12290;&#20043;&#21518;&#20877;&#36890;&#36807; SPI &#21152;&#36733;&#37197;&#32622;&#21517;&#20026; MichelinWheelMaker &#30340;&#23454;&#29616;&#31867;&#65292;&#24471;&#21040;&#20855;&#20307;&#30340; WheelMaker &#23454;&#20363;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u73d86ed0">
  <br>
 </p>
 <p class="ne-p" id="u42856a1e">
  <span class="ne-text">
   &#19978;&#38754;&#30340;&#31034;&#20363;&#23637;&#31034;&#20102;&#33258;&#36866;&#24212;&#25299;&#23637;&#31867;&#30340;&#26680;&#24515;&#23454;&#29616; &#8212;- &#22312;&#25299;&#23637;&#25509;&#21475;&#30340;&#26041;&#27861;&#34987;&#35843;&#29992;&#26102;&#65292;&#36890;&#36807; SPI &#21152;&#36733;&#20855;&#20307;&#30340;&#25299;&#23637;&#23454;&#29616;&#31867;&#65292;&#24182;&#35843;&#29992;&#25299;&#23637;&#23545;&#35937;&#30340;&#21516;&#21517;&#26041;&#27861;&#12290;&#25509;&#19979;&#26469;&#65292;&#25105;&#20204;&#28145;&#20837;&#21040;&#28304;&#30721;&#20013;&#65292;&#25506;&#32034;&#33258;&#36866;&#24212;&#25299;&#23637;&#31867;&#29983;&#25104;&#30340;&#36807;&#31243;&#12290;
  </span>
 </p>
 <p class="ne-p" id="ubbd3d0dc">
  <br>
 </p>
 <h2 id="4bb2d8a9">
  <span class="ne-text">
   2.&#28304;&#30721;&#20998;&#26512;
  </span>
 </h2>
 <p class="ne-p" id="u2e9cb6a6">
  <br>
 </p>
 <p class="ne-p" id="u12b1d097">
  <span class="ne-text">
   &#22312;&#23545;&#33258;&#36866;&#24212;&#25299;&#23637;&#29983;&#25104;&#36807;&#31243;&#36827;&#34892;&#28145;&#20837;&#20998;&#26512;&#20043;&#21069;&#65292;&#25105;&#20204;&#20808;&#26469;&#30475;&#19968;&#19979;&#19982;&#33258;&#36866;&#24212;&#25299;&#23637;&#24687;&#24687;&#30456;&#20851;&#30340;&#19968;&#20010;&#27880;&#35299;&#65292;&#21363; Adaptive &#27880;&#35299;&#12290;&#35813;&#27880;&#35299;&#30340;&#23450;&#20041;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u6fafc897">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="bff2091d">@Documented
@Retention(RetentionPolicy.RUNTIME)
@Target({ElementType.TYPE, ElementType.METHOD})
public @interface Adaptive {
    String[] value() default {};
}</pre>
 <p class="ne-p" id="u67556c49">
  <br>
 </p>
 <p class="ne-p" id="u66759708">
  <span class="ne-text">
   &#20174;&#19978;&#38754;&#30340;&#20195;&#30721;&#20013;&#21487;&#30693;&#65292;Adaptive &#21487;&#27880;&#35299;&#22312;&#31867;&#25110;&#26041;&#27861;&#19978;&#12290;&#24403; Adaptive &#27880;&#35299;&#22312;&#31867;&#19978;&#26102;&#65292;Dubbo &#19981;&#20250;&#20026;&#35813;&#31867;&#29983;&#25104;&#20195;&#29702;&#31867;&#12290;&#27880;&#35299;&#22312;&#26041;&#27861;&#65288;&#25509;&#21475;&#26041;&#27861;&#65289;&#19978;&#26102;&#65292;Dubbo &#21017;&#20250;&#20026;&#35813;&#26041;&#27861;&#29983;&#25104;&#20195;&#29702;&#36923;&#36753;&#12290;Adaptive &#27880;&#35299;&#22312;&#31867;&#19978;&#30340;&#24773;&#20917;&#24456;&#23569;&#65292;&#22312; Dubbo &#20013;&#65292;&#20165;&#26377;&#20004;&#20010;&#31867;&#34987; Adaptive &#27880;&#35299;&#20102;&#65292;&#20998;&#21035;&#26159; AdaptiveCompiler &#21644; AdaptiveExtensionFactory&#12290;&#27492;&#31181;&#24773;&#20917;&#65292;&#34920;&#31034;&#25299;&#23637;&#30340;&#21152;&#36733;&#36923;&#36753;&#30001;&#20154;&#24037;&#32534;&#30721;&#23436;&#25104;&#12290;&#26356;&#22810;&#26102;&#20505;&#65292;Adaptive &#26159;&#27880;&#35299;&#22312;&#25509;&#21475;&#26041;&#27861;&#19978;&#30340;&#65292;&#34920;&#31034;&#25299;&#23637;&#30340;&#21152;&#36733;&#36923;&#36753;&#38656;&#30001;&#26694;&#26550;&#33258;&#21160;&#29983;&#25104;&#12290;Adaptive &#27880;&#35299;&#30340;&#22320;&#26041;&#19981;&#21516;&#65292;&#30456;&#24212;&#30340;&#22788;&#29702;&#36923;&#36753;&#20063;&#26159;&#19981;&#21516;&#30340;&#12290;&#27880;&#35299;&#22312;&#31867;&#19978;&#26102;&#65292;&#22788;&#29702;&#36923;&#36753;&#27604;&#36739;&#31616;&#21333;&#65292;&#26412;&#25991;&#23601;&#19981;&#20998;&#26512;&#20102;&#12290;&#27880;&#35299;&#22312;&#25509;&#21475;&#26041;&#27861;&#19978;&#26102;&#65292;&#22788;&#29702;&#36923;&#36753;&#36739;&#20026;&#22797;&#26434;&#65292;&#26412;&#31456;&#23558;&#20250;&#37325;&#28857;&#20998;&#26512;&#27492;&#22359;&#36923;&#36753;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u7c0a6d5d">
  <br>
 </p>
 <h3 id="0dd7226b">
  <span class="ne-text">
   2.1 &#33719;&#21462;&#33258;&#36866;&#24212;&#25299;&#23637;
  </span>
 </h3>
 <p class="ne-p" id="u3552c86f">
  <br>
 </p>
 <p class="ne-p" id="ua4eb5473">
  <span class="ne-text">
   getAdaptiveExtension &#26041;&#27861;&#26159;&#33719;&#21462;&#33258;&#36866;&#24212;&#25299;&#23637;&#30340;&#20837;&#21475;&#26041;&#27861;&#65292;&#22240;&#27492;&#19979;&#38754;&#25105;&#20204;&#20174;&#36825;&#20010;&#26041;&#27861;&#36827;&#34892;&#20998;&#26512;&#12290;&#30456;&#20851;&#20195;&#30721;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="ue99b1b7c">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="1fbda1f8">public T getAdaptiveExtension() {
    // &#20174;&#32531;&#23384;&#20013;&#33719;&#21462;&#33258;&#36866;&#24212;&#25299;&#23637;
    Object instance = cachedAdaptiveInstance.get();
    if (instance == null) {    // &#32531;&#23384;&#26410;&#21629;&#20013;
        if (createAdaptiveInstanceError == null) {
            synchronized (cachedAdaptiveInstance) {
                instance = cachedAdaptiveInstance.get();
                if (instance == null) {
                    try {
                        // &#21019;&#24314;&#33258;&#36866;&#24212;&#25299;&#23637;
                        instance = createAdaptiveExtension();
                        // &#35774;&#32622;&#33258;&#36866;&#24212;&#25299;&#23637;&#21040;&#32531;&#23384;&#20013;
                        cachedAdaptiveInstance.set(instance);
                    } catch (Throwable t) {
                        createAdaptiveInstanceError = t;
                        throw new IllegalStateException("fail to create adaptive instance: ...");
                    }
                }
            }
        } else {
            throw new IllegalStateException("fail to create adaptive instance:  ...");
        }
    }

    return (T) instance;
}</pre>
 <p class="ne-p" id="ub2bf37e1">
  <br>
 </p>
 <p class="ne-p" id="ubdfaeb48">
  <span class="ne-text">
   getAdaptiveExtension &#26041;&#27861;&#39318;&#20808;&#20250;&#26816;&#26597;&#32531;&#23384;&#65292;&#32531;&#23384;&#26410;&#21629;&#20013;&#65292;&#21017;&#35843;&#29992; createAdaptiveExtension &#26041;&#27861;&#21019;&#24314;&#33258;&#36866;&#24212;&#25299;&#23637;&#12290;&#19979;&#38754;&#65292;&#25105;&#20204;&#30475;&#19968;&#19979; createAdaptiveExtension &#26041;&#27861;&#30340;&#20195;&#30721;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u669aa15b">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="8532cc3b">private T createAdaptiveExtension() {
    try {
        // &#33719;&#21462;&#33258;&#36866;&#24212;&#25299;&#23637;&#31867;&#65292;&#24182;&#36890;&#36807;&#21453;&#23556;&#23454;&#20363;&#21270;
        return injectExtension((T) getAdaptiveExtensionClass().newInstance());
    } catch (Exception e) {
        throw new IllegalStateException("Can not create adaptive extension ...");
    }
}</pre>
 <p class="ne-p" id="u7b93cae5">
  <br>
 </p>
 <p class="ne-p" id="u4b17c45e">
  <span class="ne-text">
   createAdaptiveExtension &#26041;&#27861;&#30340;&#20195;&#30721;&#27604;&#36739;&#23569;&#65292;&#20294;&#21364;&#21253;&#21547;&#20102;&#19977;&#20010;&#36923;&#36753;&#65292;&#20998;&#21035;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u8ef7d931">
  <br>
 </p>
 <ol class="ne-ol">
  <li id="u942c510e">
   <span class="ne-text">
    &#35843;&#29992; getAdaptiveExtensionClass &#26041;&#27861;&#33719;&#21462;&#33258;&#36866;&#24212;&#25299;&#23637; Class &#23545;&#35937;
   </span>
  </li>
  <li id="ucadce044">
   <span class="ne-text">
    &#36890;&#36807;&#21453;&#23556;&#36827;&#34892;&#23454;&#20363;&#21270;
   </span>
  </li>
 </ol>
 <ol class="ne-ol" start="3">
  <li id="uf47c5723">
   <span class="ne-text">
    &#35843;&#29992; injectExtension &#26041;&#27861;&#21521;&#25299;&#23637;&#23454;&#20363;&#20013;&#27880;&#20837;&#20381;&#36182;
   </span>
  </li>
 </ol>
 <p class="ne-p" id="u80946f4a">
  <br>
 </p>
 <p class="ne-p" id="u6e3e3630">
  <span class="ne-text">
   &#21069;&#20004;&#20010;&#36923;&#36753;&#27604;&#36739;&#22909;&#29702;&#35299;&#65292;&#31532;&#19977;&#20010;&#36923;&#36753;&#29992;&#20110;&#21521;&#33258;&#36866;&#24212;&#25299;&#23637;&#23545;&#35937;&#20013;&#27880;&#20837;&#20381;&#36182;&#12290;&#36825;&#20010;&#36923;&#36753;&#30475;&#20284;&#22810;&#20313;&#65292;&#20294;&#26377;&#23384;&#22312;&#30340;&#24517;&#35201;&#65292;&#36825;&#37324;&#31616;&#21333;&#35828;&#26126;&#19968;&#19979;&#12290;&#21069;&#38754;&#35828;&#36807;&#65292;Dubbo &#20013;&#26377;&#20004;&#31181;&#31867;&#22411;&#30340;&#33258;&#36866;&#24212;&#25299;&#23637;&#65292;&#19968;&#31181;&#26159;&#25163;&#24037;&#32534;&#30721;&#30340;&#65292;&#19968;&#31181;&#26159;&#33258;&#21160;&#29983;&#25104;&#30340;&#12290;&#25163;&#24037;&#32534;&#30721;&#30340;&#33258;&#36866;&#24212;&#25299;&#23637;&#20013;&#21487;&#33021;&#23384;&#22312;&#30528;&#19968;&#20123;&#20381;&#36182;&#65292;&#32780;&#33258;&#21160;&#29983;&#25104;&#30340; Adaptive &#25299;&#23637;&#21017;&#19981;&#20250;&#20381;&#36182;&#20854;&#20182;&#31867;&#12290;&#36825;&#37324;&#35843;&#29992; injectExtension &#26041;&#27861;&#30340;&#30446;&#30340;&#26159;&#20026;&#25163;&#24037;&#32534;&#30721;&#30340;&#33258;&#36866;&#24212;&#25299;&#23637;&#27880;&#20837;&#20381;&#36182;&#65292;&#36825;&#19968;&#28857;&#38656;&#35201;&#22823;&#23478;&#27880;&#24847;&#19968;&#19979;&#12290;&#20851;&#20110; injectExtension &#26041;&#27861;&#65292;&#21069;&#25991;&#24050;&#32463;&#20998;&#26512;&#36807;&#20102;&#65292;&#36825;&#37324;&#19981;&#20877;&#36184;&#36848;&#12290;&#25509;&#19979;&#26469;&#65292;&#20998;&#26512; getAdaptiveExtensionClass &#26041;&#27861;&#30340;&#36923;&#36753;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u10aae991">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="355f0282">private Class&lt;?&gt; getAdaptiveExtensionClass() {
    // &#36890;&#36807; SPI &#33719;&#21462;&#25152;&#26377;&#30340;&#25299;&#23637;&#31867;
    getExtensionClasses();
    // &#26816;&#26597;&#32531;&#23384;&#65292;&#33509;&#32531;&#23384;&#19981;&#20026;&#31354;&#65292;&#21017;&#30452;&#25509;&#36820;&#22238;&#32531;&#23384;
    if (cachedAdaptiveClass != null) {
        return cachedAdaptiveClass;
    }
    // &#21019;&#24314;&#33258;&#36866;&#24212;&#25299;&#23637;&#31867;
    return cachedAdaptiveClass = createAdaptiveExtensionClass();
}</pre>
 <p class="ne-p" id="ua53c9e40">
  <br>
 </p>
 <p class="ne-p" id="u6426d86a">
  <span class="ne-text">
   getAdaptiveExtensionClass &#26041;&#27861;&#21516;&#26679;&#21253;&#21547;&#20102;&#19977;&#20010;&#36923;&#36753;&#65292;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="uef606035">
  <br>
 </p>
 <ol class="ne-ol">
  <li id="u56c6a0aa">
   <span class="ne-text">
    &#35843;&#29992; getExtensionClasses &#33719;&#21462;&#25152;&#26377;&#30340;&#25299;&#23637;&#31867;
   </span>
  </li>
  <li id="u9e9d07e3">
   <span class="ne-text">
    &#26816;&#26597;&#32531;&#23384;&#65292;&#33509;&#32531;&#23384;&#19981;&#20026;&#31354;&#65292;&#21017;&#36820;&#22238;&#32531;&#23384;
   </span>
  </li>
 </ol>
 <ol class="ne-ol" start="3">
  <li id="u432f441e">
   <span class="ne-text">
    &#33509;&#32531;&#23384;&#20026;&#31354;&#65292;&#21017;&#35843;&#29992; createAdaptiveExtensionClass &#21019;&#24314;&#33258;&#36866;&#24212;&#25299;&#23637;&#31867;
   </span>
  </li>
 </ol>
 <p class="ne-p" id="u01290011">
  <br>
 </p>
 <p class="ne-p" id="u0ea3ef35">
  <span class="ne-text">
   &#36825;&#19977;&#20010;&#36923;&#36753;&#30475;&#36215;&#26469;&#24179;&#28129;&#26080;&#22855;&#65292;&#20284;&#20046;&#27809;&#26377;&#22810;&#35762;&#30340;&#24517;&#35201;&#12290;&#20294;&#26159;&#36825;&#20123;&#24179;&#28129;&#26080;&#22855;&#30340;&#20195;&#30721;&#20013;&#38544;&#34255;&#20102;&#30528;&#19968;&#20123;&#32454;&#33410;&#65292;&#38656;&#35201;&#35828;&#26126;&#19968;&#19979;&#12290;&#39318;&#20808;&#20174;&#31532;&#19968;&#20010;&#36923;&#36753;&#35828;&#36215;&#65292;getExtensionClasses &#36825;&#20010;&#26041;&#27861;&#29992;&#20110;&#33719;&#21462;&#26576;&#20010;&#25509;&#21475;&#30340;&#25152;&#26377;&#23454;&#29616;&#31867;&#12290;&#27604;&#22914;&#35813;&#26041;&#27861;&#21487;&#20197;&#33719;&#21462; Protocol &#25509;&#21475;&#30340; DubboProtocol&#12289;HttpProtocol&#12289;InjvmProtocol &#31561;&#23454;&#29616;&#31867;&#12290;&#22312;&#33719;&#21462;&#23454;&#29616;&#31867;&#30340;&#36807;&#31243;&#20013;&#65292;&#22914;&#26524;&#26576;&#20010;&#23454;&#29616;&#31867;&#34987; Adaptive &#27880;&#35299;&#20462;&#39280;&#20102;&#65292;&#37027;&#20040;&#35813;&#31867;&#23601;&#20250;&#34987;&#36171;&#20540;&#32473; cachedAdaptiveClass &#21464;&#37327;&#12290;&#27492;&#26102;&#65292;&#19978;&#38754;&#27493;&#39588;&#20013;&#30340;&#31532;&#20108;&#27493;&#26465;&#20214;&#25104;&#31435;&#65288;&#32531;&#23384;&#19981;&#20026;&#31354;&#65289;&#65292;&#30452;&#25509;&#36820;&#22238; cachedAdaptiveClass &#21363;&#21487;&#12290;&#22914;&#26524;&#25152;&#26377;&#30340;&#23454;&#29616;&#31867;&#22343;&#26410;&#34987; Adaptive &#27880;&#35299;&#20462;&#39280;&#65292;&#37027;&#20040;&#25191;&#34892;&#31532;&#19977;&#27493;&#36923;&#36753;&#65292;&#21019;&#24314;&#33258;&#36866;&#24212;&#25299;&#23637;&#31867;&#12290;&#30456;&#20851;&#20195;&#30721;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u2a258bbf">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="de75858a">private Class&lt;?&gt; createAdaptiveExtensionClass() {
    // &#26500;&#24314;&#33258;&#36866;&#24212;&#25299;&#23637;&#20195;&#30721;
    String code = createAdaptiveExtensionClassCode();
    ClassLoader classLoader = findClassLoader();
    // &#33719;&#21462;&#32534;&#35793;&#22120;&#23454;&#29616;&#31867;
    com.alibaba.dubbo.common.compiler.Compiler compiler = ExtensionLoader.getExtensionLoader(com.alibaba.dubbo.common.compiler.Compiler.class).getAdaptiveExtension();
    // &#32534;&#35793;&#20195;&#30721;&#65292;&#29983;&#25104; Class
    return compiler.compile(code, classLoader);
}</pre>
 <p class="ne-p" id="u43b8fdd2">
  <br>
 </p>
 <p class="ne-p" id="u0cad695d">
  <span class="ne-text">
   createAdaptiveExtensionClass &#26041;&#27861;&#29992;&#20110;&#29983;&#25104;&#33258;&#36866;&#24212;&#25299;&#23637;&#31867;&#65292;&#35813;&#26041;&#27861;&#39318;&#20808;&#20250;&#29983;&#25104;&#33258;&#36866;&#24212;&#25299;&#23637;&#31867;&#30340;&#28304;&#30721;&#65292;&#28982;&#21518;&#36890;&#36807; Compiler &#23454;&#20363;&#65288;Dubbo &#40664;&#35748;&#20351;&#29992; javassist &#20316;&#20026;&#32534;&#35793;&#22120;&#65289;&#32534;&#35793;&#28304;&#30721;&#65292;&#24471;&#21040;&#20195;&#29702;&#31867; Class &#23454;&#20363;&#12290;&#25509;&#19979;&#26469;&#65292;&#25105;&#20204;&#25226;&#37325;&#28857;&#25918;&#22312;&#20195;&#29702;&#31867;&#20195;&#30721;&#29983;&#25104;&#30340;&#36923;&#36753;&#19978;&#65292;&#20854;&#20182;&#36923;&#36753;&#22823;&#23478;&#33258;&#34892;&#20998;&#26512;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u5eb01989">
  <br>
 </p>
 <h3 id="1a8255d9">
  <span class="ne-text">
   2.2 &#33258;&#36866;&#24212;&#25299;&#23637;&#31867;&#20195;&#30721;&#29983;&#25104;
  </span>
 </h3>
 <p class="ne-p" id="u771d27c2">
  <br>
 </p>
 <p class="ne-p" id="ufed24ba0">
  <span class="ne-text">
   createAdaptiveExtensionClassCode &#26041;&#27861;&#20195;&#30721;&#30053;&#22810;&#65292;&#32422;&#26377;&#20004;&#30334;&#34892;&#20195;&#30721;&#12290;&#22240;&#27492;&#26412;&#33410;&#23558;&#20250;&#23545;&#35813;&#26041;&#27861;&#30340;&#20195;&#30721;&#36827;&#34892;&#25286;&#20998;&#20998;&#26512;&#65292;&#20197;&#24110;&#21161;&#22823;&#23478;&#26356;&#22909;&#30340;&#29702;&#35299;&#20195;&#30721;&#36923;&#36753;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u85f21c56">
  <br>
 </p>
 <h4 id="f042ae99">
  <span class="ne-text">
   2.2.1 Adaptive &#27880;&#35299;&#26816;&#27979;
  </span>
 </h4>
 <p class="ne-p" id="u0c6b9d75">
  <br>
 </p>
 <p class="ne-p" id="u7dd88705">
  <span class="ne-text">
   &#22312;&#29983;&#25104;&#20195;&#29702;&#31867;&#28304;&#30721;&#20043;&#21069;&#65292;createAdaptiveExtensionClassCode &#26041;&#27861;&#39318;&#20808;&#20250;&#36890;&#36807;&#21453;&#23556;&#26816;&#27979;&#25509;&#21475;&#26041;&#27861;&#26159;&#21542;&#21253;&#21547; Adaptive &#27880;&#35299;&#12290;&#23545;&#20110;&#35201;&#29983;&#25104;&#33258;&#36866;&#24212;&#25299;&#23637;&#30340;&#25509;&#21475;&#65292;Dubbo &#35201;&#27714;&#35813;&#25509;&#21475;&#33267;&#23569;&#26377;&#19968;&#20010;&#26041;&#27861;&#34987; Adaptive &#27880;&#35299;&#20462;&#39280;&#12290;&#33509;&#19981;&#28385;&#36275;&#27492;&#26465;&#20214;&#65292;&#23601;&#20250;&#25243;&#20986;&#36816;&#34892;&#26102;&#24322;&#24120;&#12290;&#30456;&#20851;&#20195;&#30721;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="ua1d4bb06">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="1761d72b">// &#36890;&#36807;&#21453;&#23556;&#33719;&#21462;&#25152;&#26377;&#30340;&#26041;&#27861;
Method[] methods = type.getMethods();
boolean hasAdaptiveAnnotation = false;
// &#36941;&#21382;&#26041;&#27861;&#21015;&#34920;
for (Method m : methods) {
    // &#26816;&#27979;&#26041;&#27861;&#19978;&#26159;&#21542;&#26377; Adaptive &#27880;&#35299;
    if (m.isAnnotationPresent(Adaptive.class)) {
        hasAdaptiveAnnotation = true;
        break;
    }
}

if (!hasAdaptiveAnnotation)
    // &#33509;&#25152;&#26377;&#30340;&#26041;&#27861;&#19978;&#22343;&#26080; Adaptive &#27880;&#35299;&#65292;&#21017;&#25243;&#20986;&#24322;&#24120;
    throw new IllegalStateException("No adaptive method on extension ...");</pre>
 <p class="ne-p" id="u554a2dd7">
  <br>
 </p>
 <h4 id="715a7241">
  <span class="ne-text">
   2.2.2 &#29983;&#25104;&#31867;
  </span>
 </h4>
 <p class="ne-p" id="u2d98d279">
  <br>
 </p>
 <p class="ne-p" id="u899fbe50">
  <span class="ne-text">
   &#36890;&#36807; Adaptive &#27880;&#35299;&#26816;&#27979;&#21518;&#65292;&#21363;&#21487;&#24320;&#22987;&#29983;&#25104;&#20195;&#30721;&#12290;&#20195;&#30721;&#29983;&#25104;&#30340;&#39034;&#24207;&#19982; Java &#25991;&#20214;&#20869;&#23481;&#39034;&#24207;&#19968;&#33268;&#65292;&#39318;&#20808;&#20250;&#29983;&#25104; package &#35821;&#21477;&#65292;&#28982;&#21518;&#29983;&#25104; import &#35821;&#21477;&#65292;&#32039;&#25509;&#30528;&#29983;&#25104;&#31867;&#21517;&#31561;&#20195;&#30721;&#12290;&#25972;&#20010;&#36923;&#36753;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="ueda14558">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="637e9f9b">// &#29983;&#25104; package &#20195;&#30721;&#65306;package + type &#25152;&#22312;&#21253;
codeBuilder.append("package ").append(type.getPackage().getName()).append(";");
// &#29983;&#25104; import &#20195;&#30721;&#65306;import + ExtensionLoader &#20840;&#38480;&#23450;&#21517;
codeBuilder.append("\nimport ").append(ExtensionLoader.class.getName()).append(";");
// &#29983;&#25104;&#31867;&#20195;&#30721;&#65306;public class + type&#31616;&#21333;&#21517;&#31216; + $Adaptive + implements + type&#20840;&#38480;&#23450;&#21517; + {
codeBuilder.append("\npublic class ")
    .append(type.getSimpleName())
    .append("$Adaptive")
    .append(" implements ")
    .append(type.getCanonicalName())
    .append(" {");

// ${&#29983;&#25104;&#26041;&#27861;}

codeBuilder.append("\n}");</pre>
 <p class="ne-p" id="u4dadaff4">
  <br>
 </p>
 <p class="ne-p" id="u3453c799">
  <span class="ne-text">
   &#36825;&#37324;&#20351;&#29992; ${&#8230;} &#21344;&#20301;&#31526;&#20195;&#34920;&#20854;&#20182;&#20195;&#30721;&#30340;&#29983;&#25104;&#36923;&#36753;&#65292;&#35813;&#37096;&#20998;&#36923;&#36753;&#23558;&#22312;&#38543;&#21518;&#36827;&#34892;&#20998;&#26512;&#12290;&#19978;&#38754;&#20195;&#30721;&#19981;&#26159;&#24456;&#38590;&#29702;&#35299;&#65292;&#19979;&#38754;&#30452;&#25509;&#36890;&#36807;&#19968;&#20010;&#20363;&#23376;&#23637;&#31034;&#35813;&#27573;&#20195;&#30721;&#25152;&#29983;&#25104;&#30340;&#20869;&#23481;&#12290;&#20197; Dubbo &#30340; Protocol &#25509;&#21475;&#20026;&#20363;&#65292;&#29983;&#25104;&#30340;&#20195;&#30721;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u05228bed">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="53e00995">package com.alibaba.dubbo.rpc;
import com.alibaba.dubbo.common.extension.ExtensionLoader;
public class Protocol$Adaptive implements com.alibaba.dubbo.rpc.Protocol {
    // &#30465;&#30053;&#26041;&#27861;&#20195;&#30721;
}</pre>
 <p class="ne-p" id="u0f04047d">
  <br>
 </p>
 <h4 id="727a3be4">
  <span class="ne-text">
   2.2.3 &#29983;&#25104;&#26041;&#27861;
  </span>
 </h4>
 <p class="ne-p" id="u1fde7898">
  <br>
 </p>
 <p class="ne-p" id="ude2d4486">
  <span class="ne-text">
   &#19968;&#20010;&#26041;&#27861;&#21487;&#20197;&#34987; Adaptive &#27880;&#35299;&#20462;&#39280;&#65292;&#20063;&#21487;&#20197;&#19981;&#34987;&#20462;&#39280;&#12290;&#36825;&#37324;&#23558;&#26410;&#34987; Adaptive &#27880;&#35299;&#20462;&#39280;&#30340;&#26041;&#27861;&#31216;&#20026;&#8220;&#26080; Adaptive &#27880;&#35299;&#26041;&#27861;&#8221;&#65292;&#19979;&#38754;&#25105;&#20204;&#20808;&#26469;&#30475;&#30475;&#27492;&#31181;&#26041;&#27861;&#30340;&#20195;&#30721;&#29983;&#25104;&#36923;&#36753;&#26159;&#24590;&#26679;&#30340;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u8408a99b">
  <br>
 </p>
 <h5 id="97062df4">
  <span class="ne-text">
   2.2.3.1 &#26080; Adaptive &#27880;&#35299;&#26041;&#27861;&#20195;&#30721;&#29983;&#25104;&#36923;&#36753;
  </span>
 </h5>
 <p class="ne-p" id="u1f16a87b">
  <br>
 </p>
 <p class="ne-p" id="u6e38e58d">
  <span class="ne-text">
   &#23545;&#20110;&#25509;&#21475;&#26041;&#27861;&#65292;&#25105;&#20204;&#21487;&#20197;&#25353;&#29031;&#38656;&#27714;&#26631;&#27880; Adaptive &#27880;&#35299;&#12290;&#20197; Protocol &#25509;&#21475;&#20026;&#20363;&#65292;&#35813;&#25509;&#21475;&#30340; destroy &#21644; getDefaultPort &#26410;&#26631;&#27880; Adaptive &#27880;&#35299;&#65292;&#20854;&#20182;&#26041;&#27861;&#22343;&#26631;&#27880;&#20102; Adaptive &#27880;&#35299;&#12290;Dubbo &#19981;&#20250;&#20026;&#27809;&#26377;&#26631;&#27880; Adaptive &#27880;&#35299;&#30340;&#26041;&#27861;&#29983;&#25104;&#20195;&#29702;&#36923;&#36753;&#65292;&#23545;&#20110;&#35813;&#31181;&#31867;&#22411;&#30340;&#26041;&#27861;&#65292;&#20165;&#20250;&#29983;&#25104;&#19968;&#21477;&#25243;&#20986;&#24322;&#24120;&#30340;&#20195;&#30721;&#12290;&#29983;&#25104;&#36923;&#36753;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u74aed340">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="00a4e12b">for (Method method : methods) {
    
    // &#30465;&#30053;&#26080;&#20851;&#36923;&#36753;

    Adaptive adaptiveAnnotation = method.getAnnotation(Adaptive.class);
    StringBuilder code = new StringBuilder(512);
    // &#22914;&#26524;&#26041;&#27861;&#19978;&#26080; Adaptive &#27880;&#35299;&#65292;&#21017;&#29983;&#25104; throw new UnsupportedOperationException(...) &#20195;&#30721;
    if (adaptiveAnnotation == null) {
        // &#29983;&#25104;&#30340;&#20195;&#30721;&#26684;&#24335;&#22914;&#19979;&#65306;
        // throw new UnsupportedOperationException(
        //     "method " + &#26041;&#27861;&#31614;&#21517; + of interface + &#20840;&#38480;&#23450;&#25509;&#21475;&#21517; + is not adaptive method!&#8221;)
        code.append("throw new UnsupportedOperationException(\"method ")
            .append(method.toString()).append(" of interface ")
            .append(type.getName()).append(" is not adaptive method!\");");
    } else {
        // &#30465;&#30053;&#26080;&#20851;&#36923;&#36753;
    }
    
    // &#30465;&#30053;&#26080;&#20851;&#36923;&#36753;
}</pre>
 <p class="ne-p" id="ua1264662">
  <br>
 </p>
 <p class="ne-p" id="ub47d2ab5">
  <span class="ne-text">
   &#20197; Protocol &#25509;&#21475;&#30340; destroy &#26041;&#27861;&#20026;&#20363;&#65292;&#19978;&#38754;&#20195;&#30721;&#29983;&#25104;&#30340;&#20869;&#23481;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u766741f0">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="bb17dc8c">throw new UnsupportedOperationException(
            "method public abstract void com.alibaba.dubbo.rpc.Protocol.destroy() of interface com.alibaba.dubbo.rpc.Protocol is not adaptive method!");</pre>
 <p class="ne-p" id="u3e5cd073">
  <br>
 </p>
 <h5 id="772db68b">
  <span class="ne-text">
   2.2.3.2 &#33719;&#21462; URL &#25968;&#25454;
  </span>
 </h5>
 <p class="ne-p" id="u178c9d2e">
  <br>
 </p>
 <p class="ne-p" id="uf05a05cf">
  <span class="ne-text">
   &#21069;&#38754;&#35828;&#36807;&#26041;&#27861;&#20195;&#29702;&#36923;&#36753;&#20250;&#20174; URL &#20013;&#25552;&#21462;&#30446;&#26631;&#25299;&#23637;&#30340;&#21517;&#31216;&#65292;&#22240;&#27492;&#20195;&#30721;&#29983;&#25104;&#36923;&#36753;&#30340;&#19968;&#20010;&#37325;&#35201;&#30340;&#20219;&#21153;&#26159;&#20174;&#26041;&#27861;&#30340;&#21442;&#25968;&#21015;&#34920;&#25110;&#32773;&#20854;&#20182;&#21442;&#25968;&#20013;&#33719;&#21462; URL &#25968;&#25454;&#12290;&#20030;&#20363;&#35828;&#26126;&#19968;&#19979;&#65292;&#25105;&#20204;&#35201;&#20026; Protocol &#25509;&#21475;&#30340; refer &#21644; export &#26041;&#27861;&#29983;&#25104;&#20195;&#29702;&#36923;&#36753;&#12290;&#22312;&#36816;&#34892;&#26102;&#65292;&#36890;&#36807;&#21453;&#23556;&#24471;&#21040;&#30340;&#26041;&#27861;&#23450;&#20041;&#22823;&#33268;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="uc2cef75a">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="0c104076">Invoker refer(Class&lt;T&gt; arg0, URL arg1) throws RpcException;
Exporter export(Invoker&lt;T&gt; arg0) throws RpcException;</pre>
 <p class="ne-p" id="ud542b2c2">
  <br>
 </p>
 <p class="ne-p" id="u46d91e32">
  <span class="ne-text">
   &#23545;&#20110; refer &#26041;&#27861;&#65292;&#36890;&#36807;&#36941;&#21382; refer &#30340;&#21442;&#25968;&#21015;&#34920;&#21363;&#21487;&#33719;&#21462; URL &#25968;&#25454;&#65292;&#36825;&#20010;&#36824;&#27604;&#36739;&#31616;&#21333;&#12290;&#23545;&#20110; export &#26041;&#27861;&#65292;&#33719;&#21462; URL &#25968;&#25454;&#21017;&#35201;&#40635;&#28902;&#19968;&#20123;&#12290;export &#21442;&#25968;&#21015;&#34920;&#20013;&#27809;&#26377; URL &#21442;&#25968;&#65292;&#22240;&#27492;&#38656;&#35201;&#20174; Invoker &#21442;&#25968;&#20013;&#33719;&#21462; URL &#25968;&#25454;&#12290;&#33719;&#21462;&#26041;&#24335;&#26159;&#35843;&#29992; Invoker &#20013;&#21487;&#36820;&#22238; URL &#30340; getter &#26041;&#27861;&#65292;&#27604;&#22914; getUrl&#12290;&#22914;&#26524; Invoker &#20013;&#26080;&#30456;&#20851; getter &#26041;&#27861;&#65292;&#27492;&#26102;&#21017;&#20250;&#25243;&#20986;&#24322;&#24120;&#12290;&#25972;&#20010;&#36923;&#36753;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u910c3add">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="c5da7a01">for (Method method : methods) {
    Class&lt;?&gt; rt = method.getReturnType();
    Class&lt;?&gt;[] pts = method.getParameterTypes();
    Class&lt;?&gt;[] ets = method.getExceptionTypes();

    Adaptive adaptiveAnnotation = method.getAnnotation(Adaptive.class);
    StringBuilder code = new StringBuilder(512);
    if (adaptiveAnnotation == null) {
        // ${&#26080; Adaptive &#27880;&#35299;&#26041;&#27861;&#20195;&#30721;&#29983;&#25104;&#36923;&#36753;}
    } else {
    	int urlTypeIndex = -1;
        // &#36941;&#21382;&#21442;&#25968;&#21015;&#34920;&#65292;&#30830;&#23450; URL &#21442;&#25968;&#20301;&#32622;
        for (int i = 0; i &lt; pts.length; ++i) {
            if (pts[i].equals(URL.class)) {
                urlTypeIndex = i;
                break;
            }
        }
        
        // urlTypeIndex != -1&#65292;&#34920;&#31034;&#21442;&#25968;&#21015;&#34920;&#20013;&#23384;&#22312; URL &#21442;&#25968;
        if (urlTypeIndex != -1) {
            // &#20026; URL &#31867;&#22411;&#21442;&#25968;&#29983;&#25104;&#21028;&#31354;&#20195;&#30721;&#65292;&#26684;&#24335;&#22914;&#19979;&#65306;
            // if (arg + urlTypeIndex == null) 
            //     throw new IllegalArgumentException("url == null");
            String s = String.format("\nif (arg%d == null) throw new IllegalArgumentException(\"url == null\");",
                                     urlTypeIndex);
            code.append(s);

            // &#20026; URL &#31867;&#22411;&#21442;&#25968;&#29983;&#25104;&#36171;&#20540;&#20195;&#30721;&#65292;&#24418;&#22914; URL url = arg1
            s = String.format("\n%s url = arg%d;", URL.class.getName(), urlTypeIndex);
            code.append(s);
            
        // &#21442;&#25968;&#21015;&#34920;&#20013;&#19981;&#23384;&#22312; URL &#31867;&#22411;&#21442;&#25968;
        } else {
            String attribMethod = null;

            LBL_PTS:
            // &#36941;&#21382;&#26041;&#27861;&#30340;&#21442;&#25968;&#31867;&#22411;&#21015;&#34920;
            for (int i = 0; i &lt; pts.length; ++i) {
                // &#33719;&#21462;&#26576;&#19968;&#31867;&#22411;&#21442;&#25968;&#30340;&#20840;&#37096;&#26041;&#27861;
                Method[] ms = pts[i].getMethods();
                // &#36941;&#21382;&#26041;&#27861;&#21015;&#34920;&#65292;&#23547;&#25214;&#21487;&#36820;&#22238; URL &#30340; getter &#26041;&#27861;
                for (Method m : ms) {
                    String name = m.getName();
                    // 1. &#26041;&#27861;&#21517;&#20197; get &#24320;&#22836;&#65292;&#25110;&#26041;&#27861;&#21517;&#22823;&#20110;3&#20010;&#23383;&#31526;
                    // 2. &#26041;&#27861;&#30340;&#35775;&#38382;&#26435;&#38480;&#20026; public
                    // 3. &#38750;&#38745;&#24577;&#26041;&#27861;
                    // 4. &#26041;&#27861;&#21442;&#25968;&#25968;&#37327;&#20026;0
                    // 5. &#26041;&#27861;&#36820;&#22238;&#20540;&#31867;&#22411;&#20026; URL
                    if ((name.startsWith("get") || name.length() &gt; 3)
                        &amp;&amp; Modifier.isPublic(m.getModifiers())
                        &amp;&amp; !Modifier.isStatic(m.getModifiers())
                        &amp;&amp; m.getParameterTypes().length == 0
                        &amp;&amp; m.getReturnType() == URL.class) {
                        urlTypeIndex = i;
                        attribMethod = name;
                        
                        // &#32467;&#26463; for (int i = 0; i &lt; pts.length; ++i) &#24490;&#29615;
                        break LBL_PTS;
                    }
                }
            }
            if (attribMethod == null) {
                // &#22914;&#26524;&#25152;&#26377;&#21442;&#25968;&#20013;&#22343;&#19981;&#21253;&#21547;&#21487;&#36820;&#22238; URL &#30340; getter &#26041;&#27861;&#65292;&#21017;&#25243;&#20986;&#24322;&#24120;
                throw new IllegalStateException("fail to create adaptive class for interface ...");
            }

            // &#20026;&#21487;&#36820;&#22238; URL &#30340;&#21442;&#25968;&#29983;&#25104;&#21028;&#31354;&#20195;&#30721;&#65292;&#26684;&#24335;&#22914;&#19979;&#65306;
            // if (arg + urlTypeIndex == null) 
            //     throw new IllegalArgumentException("&#21442;&#25968;&#20840;&#38480;&#23450;&#21517; + argument == null");
            String s = String.format("\nif (arg%d == null) throw new IllegalArgumentException(\"%s argument == null\");",
                                     urlTypeIndex, pts[urlTypeIndex].getName());
            code.append(s);

            // &#20026; getter &#26041;&#27861;&#36820;&#22238;&#30340; URL &#29983;&#25104;&#21028;&#31354;&#20195;&#30721;&#65292;&#26684;&#24335;&#22914;&#19979;&#65306;
            // if (argN.getter&#26041;&#27861;&#21517;() == null) 
            //     throw new IllegalArgumentException(&#21442;&#25968;&#20840;&#38480;&#23450;&#21517; + argument getUrl() == null);
            s = String.format("\nif (arg%d.%s() == null) throw new IllegalArgumentException(\"%s argument %s() == null\");",
                              urlTypeIndex, attribMethod, pts[urlTypeIndex].getName(), attribMethod);
            code.append(s);

            // &#29983;&#25104;&#36171;&#20540;&#35821;&#21477;&#65292;&#26684;&#24335;&#22914;&#19979;&#65306;
            // URL&#20840;&#38480;&#23450;&#21517; url = argN.getter&#26041;&#27861;&#21517;()&#65292;&#27604;&#22914; 
            // com.alibaba.dubbo.common.URL url = invoker.getUrl();
            s = String.format("%s url = arg%d.%s();", URL.class.getName(), urlTypeIndex, attribMethod);
            code.append(s);
        }
        
        // &#30465;&#30053;&#26080;&#20851;&#20195;&#30721;
    }
    
    // &#30465;&#30053;&#26080;&#20851;&#20195;&#30721;
}</pre>
 <p class="ne-p" id="u287e990c">
  <br>
 </p>
 <p class="ne-p" id="u03546ef0">
  <span class="ne-text">
   &#19978;&#38754;&#20195;&#30721;&#26377;&#28857;&#22810;&#65292;&#38656;&#35201;&#32784;&#24515;&#30475;&#19968;&#19979;&#12290;&#36825;&#27573;&#20195;&#30721;&#20027;&#35201;&#30446;&#30340;&#26159;&#20026;&#20102;&#33719;&#21462; URL &#25968;&#25454;&#65292;&#24182;&#20026;&#20043;&#29983;&#25104;&#21028;&#31354;&#21644;&#36171;&#20540;&#20195;&#30721;&#12290;&#20197; Protocol &#30340; refer &#21644; export &#26041;&#27861;&#20026;&#20363;&#65292;&#19978;&#38754;&#30340;&#20195;&#30721;&#20026;&#23427;&#20204;&#29983;&#25104;&#22914;&#19979;&#20869;&#23481;&#65288;&#20195;&#30721;&#24050;&#26684;&#24335;&#21270;&#65289;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u03cb0135">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="09d78e96">refer:
if (arg1 == null) 
    throw new IllegalArgumentException("url == null");
com.alibaba.dubbo.common.URL url = arg1;

export:
if (arg0 == null) 
    throw new IllegalArgumentException("com.alibaba.dubbo.rpc.Invoker argument == null");
if (arg0.getUrl() == null) 
    throw new IllegalArgumentException("com.alibaba.dubbo.rpc.Invoker argument getUrl() == null");
com.alibaba.dubbo.common.URL url = arg0.getUrl();</pre>
 <p class="ne-p" id="ueaac3370">
  <br>
 </p>
 <h5 id="3222cf43">
  <span class="ne-text">
   2.2.3.3 &#33719;&#21462; Adaptive &#27880;&#35299;&#20540;
  </span>
 </h5>
 <p class="ne-p" id="uc9b3da69">
  <br>
 </p>
 <p class="ne-p" id="uae5b5717">
  <span class="ne-text">
   Adaptive &#27880;&#35299;&#20540; value &#31867;&#22411;&#20026; String[]&#65292;&#21487;&#22635;&#20889;&#22810;&#20010;&#20540;&#65292;&#40664;&#35748;&#24773;&#20917;&#19979;&#20026;&#31354;&#25968;&#32452;&#12290;&#33509; value &#20026;&#38750;&#31354;&#25968;&#32452;&#65292;&#30452;&#25509;&#33719;&#21462;&#25968;&#32452;&#20869;&#23481;&#21363;&#21487;&#12290;&#33509; value &#20026;&#31354;&#25968;&#32452;&#65292;&#21017;&#38656;&#36827;&#34892;&#39069;&#22806;&#22788;&#29702;&#12290;&#22788;&#29702;&#36807;&#31243;&#26159;&#23558;&#31867;&#21517;&#36716;&#25442;&#20026;&#23383;&#31526;&#25968;&#32452;&#65292;&#28982;&#21518;&#36941;&#21382;&#23383;&#31526;&#25968;&#32452;&#65292;&#24182;&#23558;&#23383;&#31526;&#25918;&#20837; StringBuilder &#20013;&#12290;&#33509;&#23383;&#31526;&#20026;&#22823;&#20889;&#23383;&#27597;&#65292;&#21017;&#21521; StringBuilder &#20013;&#28155;&#21152;&#28857;&#21495;&#65292;&#38543;&#21518;&#23558;&#23383;&#31526;&#21464;&#20026;&#23567;&#20889;&#23384;&#20837; StringBuilder &#20013;&#12290;&#27604;&#22914; LoadBalance &#32463;&#36807;&#22788;&#29702;&#21518;&#65292;&#24471;&#21040; load.balance&#12290;
  </span>
 </p>
 <p class="ne-p" id="u37566853">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="c1701da6">for (Method method : methods) {
    Class&lt;?&gt; rt = method.getReturnType();
    Class&lt;?&gt;[] pts = method.getParameterTypes();
    Class&lt;?&gt;[] ets = method.getExceptionTypes();

    Adaptive adaptiveAnnotation = method.getAnnotation(Adaptive.class);
    StringBuilder code = new StringBuilder(512);
    if (adaptiveAnnotation == null) {
        // ${&#26080; Adaptive &#27880;&#35299;&#26041;&#27861;&#20195;&#30721;&#29983;&#25104;&#36923;&#36753;}
    } else {
        // ${&#33719;&#21462; URL &#25968;&#25454;}
        
        String[] value = adaptiveAnnotation.value();
        // value &#20026;&#31354;&#25968;&#32452;
        if (value.length == 0) {
            // &#33719;&#21462;&#31867;&#21517;&#65292;&#24182;&#23558;&#31867;&#21517;&#36716;&#25442;&#20026;&#23383;&#31526;&#25968;&#32452;
            char[] charArray = type.getSimpleName().toCharArray();
            StringBuilder sb = new StringBuilder(128);
            // &#36941;&#21382;&#23383;&#33410;&#25968;&#32452;
            for (int i = 0; i &lt; charArray.length; i++) {
                // &#26816;&#27979;&#24403;&#21069;&#23383;&#31526;&#26159;&#21542;&#20026;&#22823;&#20889;&#23383;&#27597;
                if (Character.isUpperCase(charArray[i])) {
                    if (i != 0) {
                        // &#21521; sb &#20013;&#28155;&#21152;&#28857;&#21495;
                        sb.append(".");
                    }
                    // &#23558;&#23383;&#31526;&#21464;&#20026;&#23567;&#20889;&#65292;&#24182;&#28155;&#21152;&#21040; sb &#20013;
                    sb.append(Character.toLowerCase(charArray[i]));
                } else {
                    // &#28155;&#21152;&#23383;&#31526;&#21040; sb &#20013;
                    sb.append(charArray[i]);
                }
            }
            value = new String[]{sb.toString()};
        }
        
        // &#30465;&#30053;&#26080;&#20851;&#20195;&#30721;
    }
    
    // &#30465;&#30053;&#26080;&#20851;&#36923;&#36753;
}</pre>
 <p class="ne-p" id="u9ab14b70">
  <br>
 </p>
 <h5 id="7812f28e">
  <span class="ne-text">
   2.2.3.4 &#26816;&#27979; Invocation &#21442;&#25968;
  </span>
 </h5>
 <p class="ne-p" id="u2b5e9844">
  <br>
 </p>
 <p class="ne-p" id="ube2f49b4">
  <span class="ne-text">
   &#27492;&#27573;&#36923;&#36753;&#26159;&#26816;&#27979;&#26041;&#27861;&#21015;&#34920;&#20013;&#26159;&#21542;&#23384;&#22312; Invocation &#31867;&#22411;&#30340;&#21442;&#25968;&#65292;&#33509;&#23384;&#22312;&#65292;&#21017;&#20026;&#20854;&#29983;&#25104;&#21028;&#31354;&#20195;&#30721;&#21644;&#20854;&#20182;&#19968;&#20123;&#20195;&#30721;&#12290;&#30456;&#24212;&#30340;&#36923;&#36753;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u731be12b">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="5a344782">for (Method method : methods) {
    Class&lt;?&gt; rt = method.getReturnType();
    Class&lt;?&gt;[] pts = method.getParameterTypes();    // &#33719;&#21462;&#21442;&#25968;&#31867;&#22411;&#21015;&#34920;
    Class&lt;?&gt;[] ets = method.getExceptionTypes();

    Adaptive adaptiveAnnotation = method.getAnnotation(Adaptive.class);
    StringBuilder code = new StringBuilder(512);
    if (adaptiveAnnotation == null) {
        // ${&#26080; Adaptive &#27880;&#35299;&#26041;&#27861;&#20195;&#30721;&#29983;&#25104;&#36923;&#36753;}
    } else {
        // ${&#33719;&#21462; URL &#25968;&#25454;}
        
        // ${&#33719;&#21462; Adaptive &#27880;&#35299;&#20540;}
        
        boolean hasInvocation = false;
        // &#36941;&#21382;&#21442;&#25968;&#31867;&#22411;&#21015;&#34920;
        for (int i = 0; i &lt; pts.length; ++i) {
            // &#21028;&#26029;&#24403;&#21069;&#21442;&#25968;&#21517;&#31216;&#26159;&#21542;&#31561;&#20110; com.alibaba.dubbo.rpc.Invocation
            if (pts[i].getName().equals("com.alibaba.dubbo.rpc.Invocation")) {
                // &#20026; Invocation &#31867;&#22411;&#21442;&#25968;&#29983;&#25104;&#21028;&#31354;&#20195;&#30721;
                String s = String.format("\nif (arg%d == null) throw new IllegalArgumentException(\"invocation == null\");", i);
                code.append(s);
                // &#29983;&#25104; getMethodName &#26041;&#27861;&#35843;&#29992;&#20195;&#30721;&#65292;&#26684;&#24335;&#20026;&#65306;
                //    String methodName = argN.getMethodName();
                s = String.format("\nString methodName = arg%d.getMethodName();", i);
                code.append(s);
                
                // &#35774;&#32622; hasInvocation &#20026; true
                hasInvocation = true;
                break;
            }
        }
    }
    
    // &#30465;&#30053;&#26080;&#20851;&#36923;&#36753;
}</pre>
 <p class="ne-p" id="u4ea70dc4">
  <br>
 </p>
 <h5 id="99aee809">
  <span class="ne-text">
   2.2.3.5 &#29983;&#25104;&#25299;&#23637;&#21517;&#33719;&#21462;&#36923;&#36753;
  </span>
 </h5>
 <p class="ne-p" id="uae31c73c">
  <br>
 </p>
 <p class="ne-p" id="ua8ead2b2">
  <span class="ne-text">
   &#26412;&#27573;&#36923;&#36753;&#29992;&#20110;&#26681;&#25454; SPI &#21644; Adaptive &#27880;&#35299;&#20540;&#29983;&#25104;&#8220;&#33719;&#21462;&#25299;&#23637;&#21517;&#36923;&#36753;&#8221;&#65292;&#21516;&#26102;&#29983;&#25104;&#36923;&#36753;&#20063;&#21463; Invocation &#31867;&#22411;&#21442;&#25968;&#24433;&#21709;&#65292;&#32508;&#21512;&#22240;&#32032;&#23548;&#33268;&#26412;&#27573;&#36923;&#36753;&#30456;&#23545;&#22797;&#26434;&#12290;&#26412;&#27573;&#36923;&#36753;&#21487;&#33021;&#20250;&#29983;&#25104;&#20294;&#19981;&#38480;&#20110;&#19979;&#38754;&#30340;&#20195;&#30721;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u9c296511">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="f4791c01">String extName = (url.getProtocol() == null ? "dubbo" : url.getProtocol());</pre>
 <p class="ne-p" id="ue877c9eb">
  <br>
 </p>
 <p class="ne-p" id="u3278a6ce">
  <span class="ne-text">
   &#25110;
  </span>
 </p>
 <p class="ne-p" id="u06daf6f7">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="472f40be">String extName = url.getMethodParameter(methodName, "loadbalance", "random");</pre>
 <p class="ne-p" id="ub404c1bc">
  <br>
 </p>
 <p class="ne-p" id="u0fe209ad">
  <span class="ne-text">
   &#20134;&#25110;&#26159;
  </span>
 </p>
 <p class="ne-p" id="ue353f419">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="b37e9228">String extName = url.getParameter("client", url.getParameter("transporter", "netty"));</pre>
 <p class="ne-p" id="ubc92cd8a">
  <br>
 </p>
 <p class="ne-p" id="u5c3506c1">
  <span class="ne-text">
   &#26412;&#27573;&#36923;&#36753;&#22797;&#26434;&#20043;&#22788;&#22312;&#20110;&#26465;&#20214;&#20998;&#25903;&#27604;&#36739;&#22810;&#65292;&#22823;&#23478;&#22312;&#38405;&#35835;&#28304;&#30721;&#26102;&#38656;&#35201;&#30693;&#36947;&#27599;&#20010;&#26465;&#20214;&#20998;&#25903;&#30340;&#24847;&#20041;&#26159;&#20160;&#20040;&#65292;&#21542;&#21017;&#19981;&#22826;&#23481;&#26131;&#30475;&#25026;&#30456;&#20851;&#20195;&#30721;&#12290;&#19979;&#38754;&#24320;&#22987;&#20998;&#26512;&#26412;&#27573;&#36923;&#36753;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u7ec6218c">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="c6f5c5bc">for (Method method : methods) {
    Class&lt;?&gt; rt = method.getReturnType();
    Class&lt;?&gt;[] pts = method.getParameterTypes();
    Class&lt;?&gt;[] ets = method.getExceptionTypes();

    Adaptive adaptiveAnnotation = method.getAnnotation(Adaptive.class);
    StringBuilder code = new StringBuilder(512);
    if (adaptiveAnnotation == null) {
        // $&#26080; Adaptive &#27880;&#35299;&#26041;&#27861;&#20195;&#30721;&#29983;&#25104;&#36923;&#36753;}
    } else {
        // ${&#33719;&#21462; URL &#25968;&#25454;}
        
        // ${&#33719;&#21462; Adaptive &#27880;&#35299;&#20540;}
        
        // ${&#26816;&#27979; Invocation &#21442;&#25968;}
        
        // &#35774;&#32622;&#40664;&#35748;&#25299;&#23637;&#21517;&#65292;cachedDefaultName &#28304;&#20110; SPI &#27880;&#35299;&#20540;&#65292;&#40664;&#35748;&#24773;&#20917;&#19979;&#65292;
        // SPI &#27880;&#35299;&#20540;&#20026;&#31354;&#20018;&#65292;&#27492;&#26102; cachedDefaultName = null
        String defaultExtName = cachedDefaultName;
        String getNameCode = null;
        
        // &#36941;&#21382; value&#65292;&#36825;&#37324;&#30340; value &#26159; Adaptive &#30340;&#27880;&#35299;&#20540;&#65292;2.2.3.3 &#33410;&#20998;&#26512;&#36807; value &#21464;&#37327;&#30340;&#33719;&#21462;&#36807;&#31243;&#12290;
        // &#27492;&#22788;&#24490;&#29615;&#30446;&#30340;&#26159;&#29983;&#25104;&#20174; URL &#20013;&#33719;&#21462;&#25299;&#23637;&#21517;&#30340;&#20195;&#30721;&#65292;&#29983;&#25104;&#30340;&#20195;&#30721;&#20250;&#36171;&#20540;&#32473; getNameCode &#21464;&#37327;&#12290;&#27880;&#24847;&#36825;
        // &#20010;&#24490;&#29615;&#30340;&#36941;&#21382;&#39034;&#24207;&#26159;&#30001;&#21518;&#21521;&#21069;&#36941;&#21382;&#30340;&#12290;
        for (int i = value.length - 1; i &gt;= 0; --i) {
            // &#24403; i &#20026;&#26368;&#21518;&#19968;&#20010;&#20803;&#32032;&#30340;&#22352;&#26631;&#26102;
            if (i == value.length - 1) {
                // &#40664;&#35748;&#25299;&#23637;&#21517;&#38750;&#31354;
                if (null != defaultExtName) {
                    // protocol &#26159; url &#30340;&#19968;&#37096;&#20998;&#65292;&#21487;&#36890;&#36807; getProtocol &#26041;&#27861;&#33719;&#21462;&#65292;&#20854;&#20182;&#30340;&#21017;&#26159;&#20174;
                    // URL &#21442;&#25968;&#20013;&#33719;&#21462;&#12290;&#22240;&#20026;&#33719;&#21462;&#26041;&#24335;&#19981;&#21516;&#65292;&#25152;&#20197;&#36825;&#37324;&#35201;&#21028;&#26029; value[i] &#26159;&#21542;&#20026; protocol
                    if (!"protocol".equals(value[i]))
                    	// hasInvocation &#29992;&#20110;&#26631;&#35782;&#26041;&#27861;&#21442;&#25968;&#21015;&#34920;&#20013;&#26159;&#21542;&#26377; Invocation &#31867;&#22411;&#21442;&#25968;
                        if (hasInvocation)
                            // &#29983;&#25104;&#30340;&#20195;&#30721;&#21151;&#33021;&#31561;&#20215;&#20110;&#19979;&#38754;&#30340;&#20195;&#30721;&#65306;
                            //   url.getMethodParameter(methodName, value[i], defaultExtName)
                            // &#20197; LoadBalance &#25509;&#21475;&#30340; select &#26041;&#27861;&#20026;&#20363;&#65292;&#26368;&#32456;&#29983;&#25104;&#30340;&#20195;&#30721;&#22914;&#19979;&#65306;
                            //   url.getMethodParameter(methodName, "loadbalance", "random")
                            getNameCode = String.format("url.getMethodParameter(methodName, \"%s\", \"%s\")", value[i], defaultExtName);
                    	else
                    		// &#29983;&#25104;&#30340;&#20195;&#30721;&#21151;&#33021;&#31561;&#20215;&#20110;&#19979;&#38754;&#30340;&#20195;&#30721;&#65306;
	                        //   url.getParameter(value[i], defaultExtName)
	                        getNameCode = String.format("url.getParameter(\"%s\", \"%s\")", value[i], defaultExtName);
                    else
                    	// &#29983;&#25104;&#30340;&#20195;&#30721;&#21151;&#33021;&#31561;&#20215;&#20110;&#19979;&#38754;&#30340;&#20195;&#30721;&#65306;
                        //   ( url.getProtocol() == null ? defaultExtName : url.getProtocol() )
                        getNameCode = String.format("( url.getProtocol() == null ? \"%s\" : url.getProtocol() )", defaultExtName);
                    
                // &#40664;&#35748;&#25299;&#23637;&#21517;&#20026;&#31354;
                } else {
                    if (!"protocol".equals(value[i]))
                        if (hasInvocation)
                        	// &#29983;&#25104;&#20195;&#30721;&#26684;&#24335;&#21516;&#19978;
                            getNameCode = String.format("url.getMethodParameter(methodName, \"%s\", \"%s\")", value[i], defaultExtName);
	                    else
	                    	// &#29983;&#25104;&#30340;&#20195;&#30721;&#21151;&#33021;&#31561;&#20215;&#20110;&#19979;&#38754;&#30340;&#20195;&#30721;&#65306;
	                        //   url.getParameter(value[i])
	                        getNameCode = String.format("url.getParameter(\"%s\")", value[i]);
                    else
                    	// &#29983;&#25104;&#20174; url &#20013;&#33719;&#21462;&#21327;&#35758;&#30340;&#20195;&#30721;&#65292;&#27604;&#22914; "dubbo"
                        getNameCode = "url.getProtocol()";
                }
            } else {
                if (!"protocol".equals(value[i]))
                    if (hasInvocation)
                        // &#29983;&#25104;&#20195;&#30721;&#26684;&#24335;&#21516;&#19978;
                        getNameCode = String.format("url.getMethodParameter(methodName, \"%s\", \"%s\")", value[i], defaultExtName);
	                else
	                	// &#29983;&#25104;&#30340;&#20195;&#30721;&#21151;&#33021;&#31561;&#20215;&#20110;&#19979;&#38754;&#30340;&#20195;&#30721;&#65306;
	                    //   url.getParameter(value[i], getNameCode)
	                    // &#20197; Transporter &#25509;&#21475;&#30340; connect &#26041;&#27861;&#20026;&#20363;&#65292;&#26368;&#32456;&#29983;&#25104;&#30340;&#20195;&#30721;&#22914;&#19979;&#65306;
	                    //   url.getParameter("client", url.getParameter("transporter", "netty"))
	                    getNameCode = String.format("url.getParameter(\"%s\", %s)", value[i], getNameCode);
                else
                    // &#29983;&#25104;&#30340;&#20195;&#30721;&#21151;&#33021;&#31561;&#20215;&#20110;&#19979;&#38754;&#30340;&#20195;&#30721;&#65306;
                    //   url.getProtocol() == null ? getNameCode : url.getProtocol()
                    // &#20197; Protocol &#25509;&#21475;&#30340; connect &#26041;&#27861;&#20026;&#20363;&#65292;&#26368;&#32456;&#29983;&#25104;&#30340;&#20195;&#30721;&#22914;&#19979;&#65306;
                    //   url.getProtocol() == null ? "dubbo" : url.getProtocol()
                    getNameCode = String.format("url.getProtocol() == null ? (%s) : url.getProtocol()", getNameCode);
            }
        }
        // &#29983;&#25104; extName &#36171;&#20540;&#20195;&#30721;
        code.append("\nString extName = ").append(getNameCode).append(";");
        // &#29983;&#25104; extName &#21028;&#31354;&#20195;&#30721;
        String s = String.format("\nif(extName == null) " +
                                 "throw new IllegalStateException(\"Fail to get extension(%s) name from url(\" + url.toString() + \") use keys(%s)\");",
                                 type.getName(), Arrays.toString(value));
        code.append(s);
    }
    
    // &#30465;&#30053;&#26080;&#20851;&#36923;&#36753;
}</pre>
 <p class="ne-p" id="u09e79433">
  <br>
 </p>
 <p class="ne-p" id="u91ff6e4e">
  <span class="ne-text">
   &#19978;&#38754;&#20195;&#30721;&#27604;&#36739;&#22797;&#26434;&#65292;&#19981;&#26159;&#24456;&#22909;&#29702;&#35299;&#12290;&#23545;&#20110;&#36825;&#27573;&#20195;&#30721;&#65292;&#24314;&#35758;&#22823;&#23478;&#20889;&#28857;&#27979;&#35797;&#29992;&#20363;&#65292;&#23545; Protocol&#12289;LoadBalance &#20197;&#21450; Transporter &#31561;&#25509;&#21475;&#30340;&#33258;&#36866;&#24212;&#25299;&#23637;&#31867;&#20195;&#30721;&#29983;&#25104;&#36807;&#31243;&#36827;&#34892;&#35843;&#35797;&#12290;&#36825;&#37324;&#25105;&#20197; Transporter &#25509;&#21475;&#30340;&#33258;&#36866;&#24212;&#25299;&#23637;&#31867;&#20195;&#30721;&#29983;&#25104;&#36807;&#31243;&#20030;&#20363;&#35828;&#26126;&#12290;&#39318;&#20808;&#30475;&#19968;&#19979; Transporter &#25509;&#21475;&#30340;&#23450;&#20041;&#65292;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u07d7c3f0">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="d9301de1">@SPI("netty")
public interface Transporter {
	// @Adaptive({server, transporter})
    @Adaptive({Constants.SERVER_KEY, Constants.TRANSPORTER_KEY}) 
    Server bind(URL url, ChannelHandler handler) throws RemotingException;

    // @Adaptive({client, transporter})
    @Adaptive({Constants.CLIENT_KEY, Constants.TRANSPORTER_KEY})
    Client connect(URL url, ChannelHandler handler) throws RemotingException;
}</pre>
 <p class="ne-p" id="u0e273934">
  <br>
 </p>
 <p class="ne-p" id="uaa57ff5e">
  <span class="ne-text">
   &#19979;&#38754;&#23545; connect &#26041;&#27861;&#20195;&#29702;&#36923;&#36753;&#29983;&#25104;&#30340;&#36807;&#31243;&#36827;&#34892;&#20998;&#26512;&#65292;&#27492;&#26102;&#29983;&#25104;&#20195;&#29702;&#36923;&#36753;&#25152;&#29992;&#21040;&#30340;&#21464;&#37327;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u0c330b6f">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="8342cc69">String defaultExtName = "netty";
boolean hasInvocation = false;
String getNameCode = null;
String[] value = ["client", "transporter"];</pre>
 <p class="ne-p" id="u929a0512">
  <br>
 </p>
 <p class="ne-p" id="u3bbe45fb">
  <span class="ne-text">
   &#19979;&#38754;&#23545; value &#25968;&#32452;&#36827;&#34892;&#36941;&#21382;&#65292;&#27492;&#26102; i = 1, value[i] = &#8220;transporter&#8221;&#65292;&#29983;&#25104;&#30340;&#20195;&#30721;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u4a1cc9c3">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="7b1f0215">getNameCode = url.getParameter("transporter", "netty");</pre>
 <p class="ne-p" id="u380f3fb7">
  <br>
 </p>
 <p class="ne-p" id="u76bcaafd">
  <span class="ne-text">
   &#25509;&#19979;&#26469;&#65292;for &#24490;&#29615;&#32487;&#32493;&#25191;&#34892;&#65292;&#27492;&#26102; i = 0, value[i] = &#8220;client&#8221;&#65292;&#29983;&#25104;&#30340;&#20195;&#30721;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u5b863300">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="db9e3862">getNameCode = url.getParameter("client", url.getParameter("transporter", "netty"));</pre>
 <p class="ne-p" id="u1e102f0e">
  <br>
 </p>
 <p class="ne-p" id="uf5b9041d">
  <span class="ne-text">
   for &#24490;&#29615;&#32467;&#26463;&#36816;&#34892;&#65292;&#29616;&#22312;&#20026; extName &#21464;&#37327;&#29983;&#25104;&#36171;&#20540;&#21644;&#21028;&#31354;&#20195;&#30721;&#65292;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u26dcbc93">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="ca111990">String extName = url.getParameter("client", url.getParameter("transporter", "netty"));
if (extName == null) {
    throw new IllegalStateException(
        "Fail to get extension(com.alibaba.dubbo.remoting.Transporter) name from url(" + url.toString()
        + ") use keys([client, transporter])");
}</pre>
 <p class="ne-p" id="u27d33d05">
  <br>
 </p>
 <h5 id="ab54dc97">
  <span class="ne-text">
   2.2.3.6 &#29983;&#25104;&#25299;&#23637;&#21152;&#36733;&#19982;&#30446;&#26631;&#26041;&#27861;&#35843;&#29992;&#36923;&#36753;
  </span>
 </h5>
 <p class="ne-p" id="u559644c6">
  <br>
 </p>
 <p class="ne-p" id="u7a72e897">
  <span class="ne-text">
   &#26412;&#27573;&#20195;&#30721;&#36923;&#36753;&#29992;&#20110;&#26681;&#25454;&#25299;&#23637;&#21517;&#21152;&#36733;&#25299;&#23637;&#23454;&#20363;&#65292;&#24182;&#35843;&#29992;&#25299;&#23637;&#23454;&#20363;&#30340;&#30446;&#26631;&#26041;&#27861;&#12290;&#30456;&#20851;&#36923;&#36753;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="ud010ed5f">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="0d1f4b0b">for (Method method : methods) {
    Class&lt;?&gt; rt = method.getReturnType();
    Class&lt;?&gt;[] pts = method.getParameterTypes();
    Class&lt;?&gt;[] ets = method.getExceptionTypes();

    Adaptive adaptiveAnnotation = method.getAnnotation(Adaptive.class);
    StringBuilder code = new StringBuilder(512);
    if (adaptiveAnnotation == null) {
        // $&#26080; Adaptive &#27880;&#35299;&#26041;&#27861;&#20195;&#30721;&#29983;&#25104;&#36923;&#36753;}
    } else {
        // ${&#33719;&#21462; URL &#25968;&#25454;}
        
        // ${&#33719;&#21462; Adaptive &#27880;&#35299;&#20540;}
        
        // ${&#26816;&#27979; Invocation &#21442;&#25968;}
        
        // ${&#29983;&#25104;&#25299;&#23637;&#21517;&#33719;&#21462;&#36923;&#36753;}
        
        // &#29983;&#25104;&#25299;&#23637;&#33719;&#21462;&#20195;&#30721;&#65292;&#26684;&#24335;&#22914;&#19979;&#65306;
        // type&#20840;&#38480;&#23450;&#21517; extension = (type&#20840;&#38480;&#23450;&#21517;)ExtensionLoader&#20840;&#38480;&#23450;&#21517;
        //     .getExtensionLoader(type&#20840;&#38480;&#23450;&#21517;.class).getExtension(extName);
        // Tips: &#26684;&#24335;&#21270;&#23383;&#31526;&#20018;&#20013;&#30340; %&lt;s &#34920;&#31034;&#20351;&#29992;&#21069;&#19968;&#20010;&#36716;&#25442;&#31526;&#25152;&#25551;&#36848;&#30340;&#21442;&#25968;&#65292;&#21363; type &#20840;&#38480;&#23450;&#21517;
        s = String.format("\n%s extension = (%&lt;s)%s.getExtensionLoader(%s.class).getExtension(extName);",
                        type.getName(), ExtensionLoader.class.getSimpleName(), type.getName());
        code.append(s);

		// &#22914;&#26524;&#26041;&#27861;&#36820;&#22238;&#20540;&#31867;&#22411;&#38750; void&#65292;&#21017;&#29983;&#25104; return &#35821;&#21477;&#12290;
        if (!rt.equals(void.class)) {
            code.append("\nreturn ");
        }

        // &#29983;&#25104;&#30446;&#26631;&#26041;&#27861;&#35843;&#29992;&#36923;&#36753;&#65292;&#26684;&#24335;&#20026;&#65306;
        //     extension.&#26041;&#27861;&#21517;(arg0, arg2, ..., argN);
        s = String.format("extension.%s(", method.getName());
        code.append(s);
        for (int i = 0; i &lt; pts.length; i++) {
            if (i != 0)
                code.append(", ");
            code.append("arg").append(i);
        }
        code.append(");");   
    }
    
    // &#30465;&#30053;&#26080;&#20851;&#36923;&#36753;
}</pre>
 <p class="ne-p" id="u03642a90">
  <br>
 </p>
 <p class="ne-p" id="ud43776ad">
  <span class="ne-text">
   &#20197; Protocol &#25509;&#21475;&#20030;&#20363;&#35828;&#26126;&#65292;&#19978;&#38754;&#20195;&#30721;&#29983;&#25104;&#30340;&#20869;&#23481;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u075175c3">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="94c470ad">com.alibaba.dubbo.rpc.Protocol extension = (com.alibaba.dubbo.rpc.Protocol) ExtensionLoader
    .getExtensionLoader(com.alibaba.dubbo.rpc.Protocol.class).getExtension(extName);
return extension.refer(arg0, arg1);</pre>
 <p class="ne-p" id="uce10efb2">
  <br>
 </p>
 <h5 id="f75057be">
  <span class="ne-text">
   2.2.3.7 &#29983;&#25104;&#23436;&#25972;&#30340;&#26041;&#27861;
  </span>
 </h5>
 <p class="ne-p" id="uad12d31d">
  <br>
 </p>
 <p class="ne-p" id="uaff62e22">
  <span class="ne-text">
   &#26412;&#33410;&#36827;&#34892;&#20195;&#30721;&#29983;&#25104;&#30340;&#25910;&#23614;&#24037;&#20316;&#65292;&#20027;&#35201;&#29992;&#20110;&#29983;&#25104;&#26041;&#27861;&#23450;&#20041;&#30340;&#20195;&#30721;&#12290;&#30456;&#20851;&#36923;&#36753;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u806785f3">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="b2a1f4e6">for (Method method : methods) {
    Class&lt;?&gt; rt = method.getReturnType();
    Class&lt;?&gt;[] pts = method.getParameterTypes();
    Class&lt;?&gt;[] ets = method.getExceptionTypes();

    Adaptive adaptiveAnnotation = method.getAnnotation(Adaptive.class);
    StringBuilder code = new StringBuilder(512);
    if (adaptiveAnnotation == null) {
        // $&#26080; Adaptive &#27880;&#35299;&#26041;&#27861;&#20195;&#30721;&#29983;&#25104;&#36923;&#36753;}
    } else {
        // ${&#33719;&#21462; URL &#25968;&#25454;}
        
        // ${&#33719;&#21462; Adaptive &#27880;&#35299;&#20540;}
        
        // ${&#26816;&#27979; Invocation &#21442;&#25968;}
        
        // ${&#29983;&#25104;&#25299;&#23637;&#21517;&#33719;&#21462;&#36923;&#36753;}
        
        // ${&#29983;&#25104;&#25299;&#23637;&#21152;&#36733;&#19982;&#30446;&#26631;&#26041;&#27861;&#35843;&#29992;&#36923;&#36753;}
    }
}
    
// public + &#36820;&#22238;&#20540;&#20840;&#38480;&#23450;&#21517; + &#26041;&#27861;&#21517; + (
codeBuilder.append("\npublic ")
    .append(rt.getCanonicalName())
    .append(" ")
    .append(method.getName())
    .append("(");

// &#28155;&#21152;&#21442;&#25968;&#21015;&#34920;&#20195;&#30721;
for (int i = 0; i &lt; pts.length; i++) {
    if (i &gt; 0) {
        codeBuilder.append(", ");
    }
    codeBuilder.append(pts[i].getCanonicalName());
    codeBuilder.append(" ");
    codeBuilder.append("arg").append(i);
}
codeBuilder.append(")");

// &#28155;&#21152;&#24322;&#24120;&#25243;&#20986;&#20195;&#30721;
if (ets.length &gt; 0) {
    codeBuilder.append(" throws ");
    for (int i = 0; i &lt; ets.length; i++) {
        if (i &gt; 0) {
            codeBuilder.append(", ");
        }
        codeBuilder.append(ets[i].getCanonicalName());
    }
}
codeBuilder.append(" {");
codeBuilder.append(code.toString());
codeBuilder.append("\n}");</pre>
 <p class="ne-p" id="u7d527e1e">
  <br>
 </p>
 <p class="ne-p" id="ue348187e">
  <span class="ne-text">
   &#20197; Protocol &#30340; refer &#26041;&#27861;&#20026;&#20363;&#65292;&#19978;&#38754;&#20195;&#30721;&#29983;&#25104;&#30340;&#20869;&#23481;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u129f8b82">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="5b3ae823">public com.alibaba.dubbo.rpc.Invoker refer(java.lang.Class arg0, com.alibaba.dubbo.common.URL arg1) {
    // &#26041;&#27861;&#20307;
}</pre>
 <p class="ne-p" id="u906fc599">
  <br>
 </p>
 <h2 id="39fd2046">
  <span class="ne-text">
   3.&#24635;&#32467;
  </span>
 </h2>
 <p class="ne-p" id="u719157b5">
  <br>
 </p>
 <p class="ne-p" id="ubbccab0d">
  <span class="ne-text">
   &#21040;&#27492;&#65292;&#20851;&#20110;&#33258;&#36866;&#24212;&#25299;&#23637;&#30340;&#21407;&#29702;&#65292;&#23454;&#29616;&#23601;&#20998;&#26512;&#23436;&#20102;&#12290;&#24635;&#30340;&#26469;&#35828;&#33258;&#36866;&#24212;&#25299;&#23637;&#25972;&#20010;&#36923;&#36753;&#36824;&#26159;&#24456;&#22797;&#26434;&#30340;&#65292;&#24182;&#19981;&#26159;&#24456;&#23481;&#26131;&#24324;&#25026;&#12290;&#22240;&#27492;&#65292;&#22823;&#23478;&#22312;&#38405;&#35835;&#35813;&#37096;&#20998;&#28304;&#30721;&#26102;&#65292;&#32784;&#24515;&#19968;&#20123;&#12290;&#21516;&#26102;&#22810;&#36827;&#34892;&#35843;&#35797;&#65292;&#20063;&#21487;&#20197;&#36890;&#36807;&#29983;&#25104;&#22909;&#30340;&#20195;&#30721;&#24605;&#32771;&#20195;&#30721;&#30340;&#29983;&#25104;&#36923;&#36753;&#12290;&#22909;&#20102;&#65292;&#26412;&#31687;&#25991;&#31456;&#23601;&#20998;&#26512;&#21040;&#36825;&#37324;&#12290;
  </span>
 </p>
</div>
</div>
</div>

        </body>
        
        