
        <html lang="en">
        <head>
        <meta charset="UTF-8"/>
        </head>
        <body>
        <div><div class="markdown-body">
    <h1>&#12300;&#28304;&#30721;&#35299;&#35835;&#12301;&#26381;&#21153;&#36335;&#30001;</h1><div class="lake-content" typography="classic">
 <div class="ne-quote">
  <p class="ne-p" id="u7f091e9b">
   <span class="ne-text">
    &#21407;&#25991;&#22320;&#22336;&#65306;
   </span>
   <a class="ne-link" data-href="https://dubbo.apache.org/zh/docsv2.7/dev/source/router/" href="https://dubbo.apache.org/zh/docsv2.7/dev/source/router/" target="_blank">
    <span class="ne-text">
     https://dubbo.apache.org/zh/docsv2.7/dev/source/router/
    </span>
   </a>
  </p>
  <p class="ne-p" id="ue90cee20">
   <span class="ne-text">
   </span>
  </p>
  <p class="ne-p" id="u9b5b6384">
   <span class="ne-text">
    &#20316;&#32773;&#65306; Dubbo &#23448;&#26041;
   </span>
  </p>
 </div>
 <p class="ne-p" id="u27b66f5a">
  <br>
 </p>
 <h2 id="25970172">
  <span class="ne-text">
   1. &#31616;&#20171;
  </span>
 </h2>
 <p class="ne-p" id="ufa15aa73">
  <br>
 </p>
 <p class="ne-p" id="u0d2f0d1f">
  <span class="ne-text">
   &#19978;&#19968;&#31687;&#25991;&#31456;&#20998;&#26512;&#20102;&#38598;&#32676;&#23481;&#38169;&#30340;&#31532;&#19968;&#37096;&#20998; &#8212; &#26381;&#21153;&#30446;&#24405; Directory&#12290;&#26381;&#21153;&#30446;&#24405;&#22312;&#21047;&#26032; Invoker &#21015;&#34920;&#30340;&#36807;&#31243;&#20013;&#65292;&#20250;&#36890;&#36807; Router &#36827;&#34892;&#26381;&#21153;&#36335;&#30001;&#65292;&#31579;&#36873;&#20986;&#31526;&#21512;&#36335;&#30001;&#35268;&#21017;&#30340;&#26381;&#21153;&#25552;&#20379;&#32773;&#12290;&#22312;&#35814;&#32454;&#20998;&#26512;&#26381;&#21153;&#36335;&#30001;&#30340;&#28304;&#30721;&#20043;&#21069;&#65292;&#20808;&#26469;&#20171;&#32461;&#19968;&#19979;&#26381;&#21153;&#36335;&#30001;&#26159;&#20160;&#20040;&#12290;&#26381;&#21153;&#36335;&#30001;&#21253;&#21547;&#19968;&#26465;&#36335;&#30001;&#35268;&#21017;&#65292;&#36335;&#30001;&#35268;&#21017;&#20915;&#23450;&#20102;&#26381;&#21153;&#28040;&#36153;&#32773;&#30340;&#35843;&#29992;&#30446;&#26631;&#65292;&#21363;&#35268;&#23450;&#20102;&#26381;&#21153;&#28040;&#36153;&#32773;&#21487;&#35843;&#29992;&#21738;&#20123;&#26381;&#21153;&#25552;&#20379;&#32773;&#12290;Dubbo &#30446;&#21069;&#25552;&#20379;&#20102;&#19977;&#31181;&#26381;&#21153;&#36335;&#30001;&#23454;&#29616;&#65292;&#20998;&#21035;&#20026;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u5d1e4fed">
  <br>
 </p>
 <ul class="ne-ul">
  <li id="ue906ee55">
   <span class="ne-text">
    &#26465;&#20214;&#36335;&#30001; ConditionRouter
   </span>
  </li>
  <li id="u4715a7c7">
   <span class="ne-text">
    &#33050;&#26412;&#36335;&#30001; ScriptRouter
   </span>
  </li>
 </ul>
 <ul class="ne-ul">
  <li id="u68ee4336">
   <span class="ne-text">
    &#26631;&#31614;&#36335;&#30001; TagRouter&#12290;
   </span>
  </li>
 </ul>
 <p class="ne-p" id="u9aef3c51">
  <br>
 </p>
 <p class="ne-p" id="uc28c3b7b">
  <span class="ne-text">
   &#26465;&#20214;&#36335;&#30001;&#26159;&#25105;&#20204;&#26368;&#24120;&#20351;&#29992;&#30340;&#65292;&#26631;&#31614;&#36335;&#30001;&#26159;&#19968;&#20010;&#26032;&#30340;&#23454;&#29616;&#65292;&#26242;&#26102;&#36824;&#26410;&#21457;&#24067;&#65292;&#35813;&#23454;&#29616;&#39044;&#35745;&#20250;&#22312; 2.7.x &#29256;&#26412;&#20013;&#21457;&#24067;&#12290;&#26412;&#31687;&#25991;&#31456;&#23558;&#20998;&#26512;&#26465;&#20214;&#36335;&#30001;&#30456;&#20851;&#28304;&#30721;&#65292;&#33050;&#26412;&#36335;&#30001;&#21644;&#26631;&#31614;&#36335;&#30001;&#36825;&#37324;&#23601;&#19981;&#20998;&#26512;&#20102;&#12290;
  </span>
 </p>
 <p class="ne-p" id="ubc1f82cd">
  <br>
 </p>
 <h2 id="12d5e36b">
  <span class="ne-text">
   2. &#28304;&#30721;&#20998;&#26512;
  </span>
 </h2>
 <p class="ne-p" id="ue29ce092">
  <br>
 </p>
 <p class="ne-p" id="u4bb64b06">
  <span class="ne-text">
   &#26465;&#20214;&#36335;&#30001;&#35268;&#21017;&#30001;&#20004;&#20010;&#26465;&#20214;&#32452;&#25104;&#65292;&#20998;&#21035;&#29992;&#20110;&#23545;&#26381;&#21153;&#28040;&#36153;&#32773;&#21644;&#25552;&#20379;&#32773;&#36827;&#34892;&#21305;&#37197;&#12290;&#27604;&#22914;&#26377;&#36825;&#26679;&#19968;&#26465;&#35268;&#21017;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u07598671">
  <br>
 </p>
 <pre class="ne-codeblock language-plain" data-language="plain" id="29dca282">host = 10.20.153.10 =&gt; host = 10.20.153.11</pre>
 <p class="ne-p" id="u0b514023">
  <br>
 </p>
 <p class="ne-p" id="ue53eae97">
  <span class="ne-text">
   &#35813;&#26465;&#35268;&#21017;&#34920;&#31034; IP &#20026; 10.20.153.10 &#30340;&#26381;&#21153;&#28040;&#36153;&#32773;
  </span>
  <strong>
   <span class="ne-text">
    &#21482;&#21487;
   </span>
  </strong>
  <span class="ne-text">
   &#35843;&#29992; IP &#20026; 10.20.153.11 &#26426;&#22120;&#19978;&#30340;&#26381;&#21153;&#65292;&#19981;&#21487;&#35843;&#29992;&#20854;&#20182;&#26426;&#22120;&#19978;&#30340;&#26381;&#21153;&#12290;&#26465;&#20214;&#36335;&#30001;&#35268;&#21017;&#30340;&#26684;&#24335;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="uc1825b03">
  <br>
 </p>
 <pre class="ne-codeblock language-plain" data-language="plain" id="86453bdc">[&#26381;&#21153;&#28040;&#36153;&#32773;&#21305;&#37197;&#26465;&#20214;] =&gt; [&#26381;&#21153;&#25552;&#20379;&#32773;&#21305;&#37197;&#26465;&#20214;]</pre>
 <p class="ne-p" id="u3504f2e0">
  <br>
 </p>
 <p class="ne-p" id="u75e36c3f">
  <span class="ne-text">
   &#22914;&#26524;&#26381;&#21153;&#28040;&#36153;&#32773;&#21305;&#37197;&#26465;&#20214;&#20026;&#31354;&#65292;&#34920;&#31034;&#19981;&#23545;&#26381;&#21153;&#28040;&#36153;&#32773;&#36827;&#34892;&#38480;&#21046;&#12290;&#22914;&#26524;&#26381;&#21153;&#25552;&#20379;&#32773;&#21305;&#37197;&#26465;&#20214;&#20026;&#31354;&#65292;&#34920;&#31034;&#23545;&#26576;&#20123;&#26381;&#21153;&#28040;&#36153;&#32773;&#31105;&#29992;&#26381;&#21153;&#12290;&#23448;&#26041;&#25991;&#26723;&#20013;&#23545;&#26465;&#20214;&#36335;&#30001;&#36827;&#34892;&#20102;&#27604;&#36739;&#35814;&#32454;&#30340;&#20171;&#32461;&#65292;&#22823;&#23478;&#21487;&#20197;&#21442;&#32771;&#19979;&#65292;&#36825;&#37324;&#23601;&#19981;&#36807;&#22810;&#35828;&#26126;&#20102;&#12290;
  </span>
 </p>
 <p class="ne-p" id="uf8d66bd9">
  <br>
 </p>
 <p class="ne-p" id="uaef34498">
  <span class="ne-text">
   &#26465;&#20214;&#36335;&#30001;&#23454;&#29616;&#31867; ConditionRouter &#22312;&#36827;&#34892;&#24037;&#20316;&#21069;&#65292;&#38656;&#35201;&#20808;&#23545;&#29992;&#25143;&#37197;&#32622;&#30340;&#36335;&#30001;&#35268;&#21017;&#36827;&#34892;&#35299;&#26512;&#65292;&#24471;&#21040;&#19968;&#31995;&#21015;&#30340;&#26465;&#20214;&#12290;&#28982;&#21518;&#20877;&#26681;&#25454;&#36825;&#20123;&#26465;&#20214;&#23545;&#26381;&#21153;&#36827;&#34892;&#36335;&#30001;&#12290;&#26412;&#31456;&#23558;&#20998;&#20004;&#33410;&#36827;&#34892;&#35828;&#26126;&#65292;2.1&#33410;&#20171;&#32461;&#34920;&#36798;&#24335;&#35299;&#26512;&#36807;&#31243;&#12290;2.2 &#33410;&#20171;&#32461;&#26381;&#21153;&#36335;&#30001;&#30340;&#36807;&#31243;&#12290;&#19979;&#38754;&#65292;&#25105;&#20204;&#20808;&#20174;&#34920;&#36798;&#24335;&#35299;&#26512;&#36807;&#31243;&#30475;&#36215;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u88576fea">
  <br>
 </p>
 <h3 id="e418ef69">
  <span class="ne-text">
   2.1 &#34920;&#36798;&#24335;&#35299;&#26512;
  </span>
 </h3>
 <p class="ne-p" id="u54eda2d8">
  <br>
 </p>
 <p class="ne-p" id="u61d18118">
  <span class="ne-text">
   &#26465;&#20214;&#36335;&#30001;&#35268;&#21017;&#26159;&#19968;&#26465;&#23383;&#31526;&#20018;&#65292;&#23545;&#20110; Dubbo &#26469;&#35828;&#65292;&#23427;&#24182;&#19981;&#33021;&#30452;&#25509;&#29702;&#35299;&#23383;&#31526;&#20018;&#30340;&#24847;&#24605;&#65292;&#38656;&#35201;&#23558;&#20854;&#35299;&#26512;&#25104;&#20869;&#37096;&#26684;&#24335;&#25165;&#34892;&#12290;&#26465;&#20214;&#34920;&#36798;&#24335;&#30340;&#35299;&#26512;&#36807;&#31243;&#22987;&#20110; ConditionRouter &#30340;&#26500;&#36896;&#26041;&#27861;&#65292;&#19979;&#38754;&#19968;&#36215;&#30475;&#19968;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u912193c2">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="b90c2cea">public ConditionRouter(URL url) {
    this.url = url;
    // &#33719;&#21462; priority &#21644; force &#37197;&#32622;
    this.priority = url.getParameter(Constants.PRIORITY_KEY, 0);
    this.force = url.getParameter(Constants.FORCE_KEY, false);
    try {
        // &#33719;&#21462;&#36335;&#30001;&#35268;&#21017;
        String rule = url.getParameterAndDecoded(Constants.RULE_KEY);
        if (rule == null || rule.trim().length() == 0) {
            throw new IllegalArgumentException("Illegal route rule!");
        }
        rule = rule.replace("consumer.", "").replace("provider.", "");
        // &#23450;&#20301; =&gt; &#20998;&#38548;&#31526;
        int i = rule.indexOf("=&gt;");
        // &#20998;&#21035;&#33719;&#21462;&#26381;&#21153;&#28040;&#36153;&#32773;&#21644;&#25552;&#20379;&#32773;&#21305;&#37197;&#35268;&#21017;
        String whenRule = i &lt; 0 ? null : rule.substring(0, i).trim();
        String thenRule = i &lt; 0 ? rule.trim() : rule.substring(i + 2).trim();
        // &#35299;&#26512;&#26381;&#21153;&#28040;&#36153;&#32773;&#21305;&#37197;&#35268;&#21017;
        Map&lt;String, MatchPair&gt; when = 
            StringUtils.isBlank(whenRule) || "true".equals(whenRule) 
                ? new HashMap&lt;String, MatchPair&gt;() : parseRule(whenRule);
        // &#35299;&#26512;&#26381;&#21153;&#25552;&#20379;&#32773;&#21305;&#37197;&#35268;&#21017;
        Map&lt;String, MatchPair&gt; then = 
            StringUtils.isBlank(thenRule) || "false".equals(thenRule) 
                ? null : parseRule(thenRule);
        // &#23558;&#35299;&#26512;&#20986;&#30340;&#21305;&#37197;&#35268;&#21017;&#20998;&#21035;&#36171;&#20540;&#32473; whenCondition &#21644; thenCondition &#25104;&#21592;&#21464;&#37327;
        this.whenCondition = when;
        this.thenCondition = then;
    } catch (ParseException e) {
        throw new IllegalStateException(e.getMessage(), e);
    }
}</pre>
 <p class="ne-p" id="u17c56440">
  <br>
 </p>
 <p class="ne-p" id="u3d264766">
  <span class="ne-text">
   &#22914;&#19978;&#65292;ConditionRouter &#26500;&#36896;&#26041;&#27861;&#20808;&#26159;&#23545;&#36335;&#30001;&#35268;&#21017;&#20570;&#39044;&#22788;&#29702;&#65292;&#28982;&#21518;&#35843;&#29992; parseRule &#26041;&#27861;&#20998;&#21035;&#23545;&#26381;&#21153;&#25552;&#20379;&#32773;&#21644;&#28040;&#36153;&#32773;&#35268;&#21017;&#36827;&#34892;&#35299;&#26512;&#65292;&#26368;&#21518;&#23558;&#35299;&#26512;&#32467;&#26524;&#36171;&#20540;&#32473; whenCondition &#21644; thenCondition &#25104;&#21592;&#21464;&#37327;&#12290;ConditionRouter &#26500;&#36896;&#26041;&#27861;&#19981;&#26159;&#24456;&#22797;&#26434;&#65292;&#36825;&#37324;&#23601;&#19981;&#22810;&#35828;&#20102;&#12290;&#19979;&#38754;&#25105;&#20204;&#25226;&#37325;&#28857;&#25918;&#22312; parseRule &#26041;&#27861;&#19978;&#65292;&#22312;&#35814;&#32454;&#20171;&#32461;&#36825;&#20010;&#26041;&#27861;&#20043;&#21069;&#65292;&#25105;&#20204;&#20808;&#26469;&#30475;&#19968;&#20010;&#20869;&#37096;&#31867;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u82ebc918">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="e8ad3986">private static final class MatchPair {
    final Set&lt;String&gt; matches = new HashSet&lt;String&gt;();
    final Set&lt;String&gt; mismatches = new HashSet&lt;String&gt;();
}</pre>
 <p class="ne-p" id="ud81aec4a">
  <br>
 </p>
 <p class="ne-p" id="u6f13d2d8">
  <span class="ne-text">
   MatchPair &#20869;&#37096;&#21253;&#21547;&#20102;&#20004;&#20010; Set &#31867;&#22411;&#30340;&#25104;&#21592;&#21464;&#37327;&#65292;&#20998;&#21035;&#29992;&#20110;&#23384;&#25918;&#21305;&#37197;&#21644;&#19981;&#21305;&#37197;&#30340;&#26465;&#20214;&#12290;&#36825;&#20010;&#31867;&#20004;&#20010;&#25104;&#21592;&#21464;&#37327;&#20250;&#22312; parseRule &#26041;&#27861;&#20013;&#34987;&#29992;&#21040;&#65292;&#19979;&#38754;&#26469;&#30475;&#19968;&#19979;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u7eafaf53">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="b011be7a">private static Map&lt;String, MatchPair&gt; parseRule(String rule)
        throws ParseException {
    // &#23450;&#20041;&#26465;&#20214;&#26144;&#23556;&#38598;&#21512;
    Map&lt;String, MatchPair&gt; condition = new HashMap&lt;String, MatchPair&gt;();
    if (StringUtils.isBlank(rule)) {
        return condition;
    }
    MatchPair pair = null;
    Set&lt;String&gt; values = null;
    // &#36890;&#36807;&#27491;&#21017;&#34920;&#36798;&#24335;&#21305;&#37197;&#36335;&#30001;&#35268;&#21017;&#65292;ROUTE_PATTERN = ([&amp;!=,]*)\s*([^&amp;!=,\s]+)
    // &#36825;&#20010;&#34920;&#36798;&#24335;&#30475;&#36215;&#26469;&#19981;&#26159;&#24456;&#22909;&#29702;&#35299;&#65292;&#31532;&#19968;&#20010;&#25324;&#21495;&#20869;&#30340;&#34920;&#36798;&#24335;&#29992;&#20110;&#21305;&#37197;"&amp;", "!", "=" &#21644; "," &#31561;&#31526;&#21495;&#12290;
    // &#31532;&#20108;&#25324;&#21495;&#20869;&#30340;&#29992;&#20110;&#21305;&#37197;&#33521;&#25991;&#23383;&#27597;&#65292;&#25968;&#23383;&#31561;&#23383;&#31526;&#12290;&#20030;&#20010;&#20363;&#23376;&#35828;&#26126;&#19968;&#19979;&#65306;
    //    host = 2.2.2.2 &amp; host != 1.1.1.1 &amp; method = hello
    // &#21305;&#37197;&#32467;&#26524;&#22914;&#19979;&#65306;
    //     &#25324;&#21495;&#19968;      &#25324;&#21495;&#20108;
    // 1.  null       host
    // 2.   =         2.2.2.2
    // 3.   &amp;         host
    // 4.   !=        1.1.1.1 
    // 5.   &amp;         method
    // 6.   =         hello
    final Matcher matcher = ROUTE_PATTERN.matcher(rule);
    while (matcher.find()) {
       	// &#33719;&#21462;&#25324;&#21495;&#19968;&#20869;&#30340;&#21305;&#37197;&#32467;&#26524;
        String separator = matcher.group(1);
        // &#33719;&#21462;&#25324;&#21495;&#20108;&#20869;&#30340;&#21305;&#37197;&#32467;&#26524;
        String content = matcher.group(2);
        // &#20998;&#38548;&#31526;&#20026;&#31354;&#65292;&#34920;&#31034;&#21305;&#37197;&#30340;&#26159;&#34920;&#36798;&#24335;&#30340;&#24320;&#22987;&#37096;&#20998;
        if (separator == null || separator.length() == 0) {
            // &#21019;&#24314; MatchPair &#23545;&#35937;
            pair = new MatchPair();
            // &#23384;&#20648; &lt;&#21305;&#37197;&#39033;, MatchPair&gt; &#38190;&#20540;&#23545;&#65292;&#27604;&#22914; &lt;host, MatchPair&gt;
            condition.put(content, pair); 
        } 
        
        // &#22914;&#26524;&#20998;&#38548;&#31526;&#20026; &amp;&#65292;&#34920;&#26126;&#25509;&#19979;&#26469;&#20063;&#26159;&#19968;&#20010;&#26465;&#20214;
        else if ("&amp;".equals(separator)) {
            // &#23581;&#35797;&#20174; condition &#33719;&#21462; MatchPair
            if (condition.get(content) == null) {
                // &#26410;&#33719;&#21462;&#21040; MatchPair&#65292;&#37325;&#26032;&#21019;&#24314;&#19968;&#20010;&#65292;&#24182;&#25918;&#20837; condition &#20013;
                pair = new MatchPair();
                condition.put(content, pair);
            } else {
                pair = condition.get(content);
            }
        } 
        
        // &#20998;&#38548;&#31526;&#20026; =
        else if ("=".equals(separator)) {
            if (pair == null)
                throw new ParseException("Illegal route rule ...");

            values = pair.matches;
            // &#23558; content &#23384;&#20837;&#21040; MatchPair &#30340; matches &#38598;&#21512;&#20013;
            values.add(content);
        } 
        
        //  &#20998;&#38548;&#31526;&#20026; != 
        else if ("!=".equals(separator)) {
            if (pair == null)
                throw new ParseException("Illegal route rule ...");

            values = pair.mismatches;
            // &#23558; content &#23384;&#20837;&#21040; MatchPair &#30340; mismatches &#38598;&#21512;&#20013;
            values.add(content);
        }
        
        // &#20998;&#38548;&#31526;&#20026; ,
        else if (",".equals(separator)) {
            if (values == null || values.isEmpty())
                throw new ParseException("Illegal route rule ...");
            // &#23558; content &#23384;&#20837;&#21040;&#19978;&#19968;&#27493;&#33719;&#21462;&#21040;&#30340; values &#20013;&#65292;&#21487;&#33021;&#26159; matches&#65292;&#20063;&#21487;&#33021;&#26159; mismatches
            values.add(content);
        } else {
            throw new ParseException("Illegal route rule ...");
        }
    }
    return condition;
}</pre>
 <p class="ne-p" id="ubde1658c">
  <br>
 </p>
 <p class="ne-p" id="u43f41e0f">
  <span class="ne-text">
   &#20197;&#19978;&#23601;&#26159;&#36335;&#30001;&#35268;&#21017;&#30340;&#35299;&#26512;&#36923;&#36753;&#65292;&#35813;&#36923;&#36753;&#30001;&#27491;&#21017;&#34920;&#36798;&#24335;&#21644;&#19968;&#20010; while &#24490;&#29615;&#20197;&#21450;&#25968;&#20010;&#26465;&#20214;&#20998;&#25903;&#32452;&#25104;&#12290;&#19979;&#38754;&#36890;&#36807;&#19968;&#20010;&#31034;&#20363;&#23545;&#35299;&#26512;&#36923;&#36753;&#36827;&#34892;&#28436;&#32462;&#12290;&#31034;&#20363;&#20026;
  </span>
  <code class="ne-code">
   <span class="ne-text">
    host = 2.2.2.2 &amp; host != 1.1.1.1 &amp; method = hello
   </span>
  </code>
  <span class="ne-text">
   &#12290;&#27491;&#21017;&#35299;&#26512;&#32467;&#26524;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="uceae2fc0">
  <br>
 </p>
 <pre class="ne-codeblock language-fallback" data-language="fallback" id="18482516">    &#25324;&#21495;&#19968;      &#25324;&#21495;&#20108;
1.  null       host
2.   =         2.2.2.2
3.   &amp;         host
4.   !=        1.1.1.1
5.   &amp;         method
6.   =         hello</pre>
 <p class="ne-p" id="u945d54b2">
  <br>
 </p>
 <p class="ne-p" id="u14550b1e">
  <span class="ne-text">
   &#29616;&#22312;&#32447;&#31243;&#36827;&#20837; while &#24490;&#29615;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u8f979e6d">
  <br>
 </p>
 <p class="ne-p" id="u58ad814f">
  <span class="ne-text">
   &#31532;&#19968;&#27425;&#24490;&#29615;&#65306;&#20998;&#38548;&#31526; separator = null&#65292;content = &#8220;host&#8221;&#12290;&#27492;&#26102;&#21019;&#24314; MatchPair &#23545;&#35937;&#65292;&#24182;&#23384;&#20837;&#21040; condition &#20013;&#65292;condition = {&#8220;host&#8221;: MatchPair@123}
  </span>
 </p>
 <p class="ne-p" id="u58c0242a">
  <br>
 </p>
 <p class="ne-p" id="u19accf52">
  <span class="ne-text">
   &#31532;&#20108;&#27425;&#24490;&#29615;&#65306;&#20998;&#38548;&#31526; separator = &#8220;="&#65292;content = &#8220;2.2.2.2&#8221;&#65292;pair = MatchPair@123&#12290;&#27492;&#26102;&#23558; 2.2.2.2 &#25918;&#20837;&#21040; MatchPair
  </span>
  <a class="ne-link" data-href="/123 " href="/123%20">
   <span class="ne-text">
    @123
   </span>
  </a>
  <span class="ne-text">
   &#23545;&#35937;&#30340; matches &#38598;&#21512;&#20013;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u5dd530a8">
  <br>
 </p>
 <p class="ne-p" id="u237a2460">
  <span class="ne-text">
   &#31532;&#19977;&#27425;&#24490;&#29615;&#65306;&#20998;&#38548;&#31526; separator = &#8220;&amp;"&#65292;content = &#8220;host&#8221;&#12290;host &#24050;&#23384;&#22312;&#20110; condition &#20013;&#65292;&#22240;&#27492; pair = MatchPair@123&#12290;
  </span>
 </p>
 <p class="ne-p" id="u5bd97173">
  <br>
 </p>
 <p class="ne-p" id="uaca2e974">
  <span class="ne-text">
   &#31532;&#22235;&#27425;&#24490;&#29615;&#65306;&#20998;&#38548;&#31526; separator = &#8220;!="&#65292;content = &#8220;1.1.1.1&#8221;&#65292;pair = MatchPair@123&#12290;&#27492;&#26102;&#23558; 1.1.1.1 &#25918;&#20837;&#21040; MatchPair
  </span>
  <a class="ne-link" data-href="/123 " href="/123%20">
   <span class="ne-text">
    @123
   </span>
  </a>
  <span class="ne-text">
   &#23545;&#35937;&#30340; mismatches &#38598;&#21512;&#20013;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u964ffd8f">
  <br>
 </p>
 <p class="ne-p" id="u18124438">
  <span class="ne-text">
   &#31532;&#20116;&#27425;&#24490;&#29615;&#65306;&#20998;&#38548;&#31526; separator = &#8220;&amp;"&#65292;content = &#8220;method&#8221;&#12290;condition.get(&#8220;method&#8221;) = null&#65292;&#22240;&#27492;&#26032;&#24314;&#19968;&#20010; MatchPair &#23545;&#35937;&#65292;&#24182;&#25918;&#20837;&#21040; condition &#20013;&#12290;&#27492;&#26102; condition = {&#8220;host&#8221;: MatchPair@123, &#8220;method&#8221;: MatchPair@ 456}
  </span>
 </p>
 <p class="ne-p" id="uf83314c2">
  <br>
 </p>
 <p class="ne-p" id="ufc6e11c1">
  <span class="ne-text">
   &#31532;&#20845;&#27425;&#24490;&#29615;&#65306;&#20998;&#38548;&#31526; separator = &#8220;="&#65292;content = &#8220;2.2.2.2&#8221;&#65292;pair = MatchPair@456&#12290;&#27492;&#26102;&#23558; hello &#25918;&#20837;&#21040; MatchPair
  </span>
  <a class="ne-link" data-href="/456 " href="/456%20">
   <span class="ne-text">
    @456
   </span>
  </a>
  <span class="ne-text">
   &#23545;&#35937;&#30340; matches &#38598;&#21512;&#20013;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u4b2d9406">
  <br>
 </p>
 <p class="ne-p" id="ued0522aa">
  <span class="ne-text">
   &#24490;&#29615;&#32467;&#26463;&#65292;&#27492;&#26102; condition &#30340;&#20869;&#23481;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="udc3305c0">
  <br>
 </p>
 <pre class="ne-codeblock language-json" data-language="json" id="b606a16a">{
    "host": {
        "matches": ["2.2.2.2"],
        "mismatches": ["1.1.1.1"]
    },
    "method": {
        "matches": ["hello"],
        "mismatches": []
    }
}</pre>
 <p class="ne-p" id="u1493ea55">
  <br>
 </p>
 <p class="ne-p" id="u6103c26b">
  <span class="ne-text">
   &#36335;&#30001;&#35268;&#21017;&#30340;&#35299;&#26512;&#36807;&#31243;&#31245;&#24494;&#26377;&#28857;&#22797;&#26434;&#65292;&#22823;&#23478;&#21487;&#36890;&#36807; ConditionRouter &#30340;&#27979;&#35797;&#31867;&#23545;&#35813;&#36923;&#36753;&#36827;&#34892;&#27979;&#35797;&#12290;&#24182;&#19988;&#25214;&#19968;&#20010;&#34920;&#36798;&#24335;&#65292;&#23545;&#29031;&#19978;&#38754;&#30340;&#20195;&#30721;&#36208;&#19968;&#36941;&#65292;&#21152;&#28145;&#29702;&#35299;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u70d9500c">
  <br>
 </p>
 <h3 id="933c5560">
  <span class="ne-text">
   2.2 &#26381;&#21153;&#36335;&#30001;
  </span>
 </h3>
 <p class="ne-p" id="ueaab769f">
  <br>
 </p>
 <p class="ne-p" id="u16849581">
  <span class="ne-text">
   &#26381;&#21153;&#36335;&#30001;&#30340;&#20837;&#21475;&#26041;&#27861;&#26159; ConditionRouter &#30340; route &#26041;&#27861;&#65292;&#35813;&#26041;&#27861;&#23450;&#20041;&#22312; Router &#25509;&#21475;&#20013;&#12290;&#23454;&#29616;&#20195;&#30721;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u11d9d473">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="2254aaf5">public &lt;T&gt; List&lt;Invoker&lt;T&gt;&gt; route(List&lt;Invoker&lt;T&gt;&gt; invokers, URL url, Invocation invocation) throws RpcException {
    if (invokers == null || invokers.isEmpty()) {
        return invokers;
    }
    try {
        // &#20808;&#23545;&#26381;&#21153;&#28040;&#36153;&#32773;&#26465;&#20214;&#36827;&#34892;&#21305;&#37197;&#65292;&#22914;&#26524;&#21305;&#37197;&#22833;&#36133;&#65292;&#34920;&#26126;&#26381;&#21153;&#28040;&#36153;&#32773; url &#19981;&#31526;&#21512;&#21305;&#37197;&#35268;&#21017;&#65292;
        // &#26080;&#38656;&#36827;&#34892;&#21518;&#32493;&#21305;&#37197;&#65292;&#30452;&#25509;&#36820;&#22238; Invoker &#21015;&#34920;&#21363;&#21487;&#12290;&#27604;&#22914;&#19979;&#38754;&#30340;&#35268;&#21017;&#65306;
        //     host = 10.20.153.10 =&gt; host = 10.0.0.10
        // &#36825;&#26465;&#36335;&#30001;&#35268;&#21017;&#24076;&#26395; IP &#20026; 10.20.153.10 &#30340;&#26381;&#21153;&#28040;&#36153;&#32773;&#35843;&#29992; IP &#20026; 10.0.0.10 &#26426;&#22120;&#19978;&#30340;&#26381;&#21153;&#12290;
        // &#24403;&#28040;&#36153;&#32773; ip &#20026; 10.20.153.11 &#26102;&#65292;matchWhen &#36820;&#22238; false&#65292;&#34920;&#26126;&#24403;&#21069;&#36825;&#26465;&#36335;&#30001;&#35268;&#21017;&#19981;&#36866;&#29992;&#20110;
        // &#24403;&#21069;&#30340;&#26381;&#21153;&#28040;&#36153;&#32773;&#65292;&#27492;&#26102;&#26080;&#38656;&#20877;&#36827;&#34892;&#21518;&#32493;&#21305;&#37197;&#65292;&#30452;&#25509;&#36820;&#22238;&#21363;&#21487;&#12290;
        if (!matchWhen(url, invocation)) {
            return invokers;
        }
        List&lt;Invoker&lt;T&gt;&gt; result = new ArrayList&lt;Invoker&lt;T&gt;&gt;();
        // &#26381;&#21153;&#25552;&#20379;&#32773;&#21305;&#37197;&#26465;&#20214;&#26410;&#37197;&#32622;&#65292;&#34920;&#26126;&#23545;&#25351;&#23450;&#30340;&#26381;&#21153;&#28040;&#36153;&#32773;&#31105;&#29992;&#26381;&#21153;&#65292;&#20063;&#23601;&#26159;&#26381;&#21153;&#28040;&#36153;&#32773;&#22312;&#40657;&#21517;&#21333;&#20013;
        if (thenCondition == null) {
            logger.warn("The current consumer in the service blacklist...");
            return result;
        }
        // &#36825;&#37324;&#21487;&#20197;&#31616;&#21333;&#30340;&#25226; Invoker &#29702;&#35299;&#20026;&#26381;&#21153;&#25552;&#20379;&#32773;&#65292;&#29616;&#22312;&#20351;&#29992;&#26381;&#21153;&#25552;&#20379;&#32773;&#21305;&#37197;&#35268;&#21017;&#23545; 
        // Invoker &#21015;&#34920;&#36827;&#34892;&#21305;&#37197;
        for (Invoker&lt;T&gt; invoker : invokers) {
            // &#33509;&#21305;&#37197;&#25104;&#21151;&#65292;&#34920;&#26126;&#24403;&#21069; Invoker &#31526;&#21512;&#26381;&#21153;&#25552;&#20379;&#32773;&#21305;&#37197;&#35268;&#21017;&#12290;
            // &#27492;&#26102;&#23558; Invoker &#28155;&#21152;&#21040; result &#21015;&#34920;&#20013;
            if (matchThen(invoker.getUrl(), url)) {
                result.add(invoker);
            }
        }
        
        // &#36820;&#22238;&#21305;&#37197;&#32467;&#26524;&#65292;&#22914;&#26524; result &#20026;&#31354;&#21015;&#34920;&#65292;&#19988; force = true&#65292;&#34920;&#31034;&#24378;&#21046;&#36820;&#22238;&#31354;&#21015;&#34920;&#65292;
        // &#21542;&#21017;&#36335;&#30001;&#32467;&#26524;&#20026;&#31354;&#30340;&#36335;&#30001;&#35268;&#21017;&#23558;&#33258;&#21160;&#22833;&#25928;
        if (!result.isEmpty()) {
            return result;
        } else if (force) {
            logger.warn("The route result is empty and force execute ...");
            return result;
        }
    } catch (Throwable t) {
        logger.error("Failed to execute condition router rule: ...");
    }
    
    // &#21407;&#26679;&#36820;&#22238;&#65292;&#27492;&#26102; force = false&#65292;&#34920;&#31034;&#35813;&#26465;&#36335;&#30001;&#35268;&#21017;&#22833;&#25928;
    return invokers;
}</pre>
 <p class="ne-p" id="uaae998a1">
  <br>
 </p>
 <p class="ne-p" id="ud8cdba0d">
  <span class="ne-text">
   route &#26041;&#27861;&#20808;&#26159;&#35843;&#29992; matchWhen &#23545;&#26381;&#21153;&#28040;&#36153;&#32773;&#36827;&#34892;&#21305;&#37197;&#65292;&#22914;&#26524;&#21305;&#37197;&#22833;&#36133;&#65292;&#30452;&#25509;&#36820;&#22238; Invoker &#21015;&#34920;&#12290;&#22914;&#26524;&#21305;&#37197;&#25104;&#21151;&#65292;&#20877;&#23545;&#26381;&#21153;&#25552;&#20379;&#32773;&#36827;&#34892;&#21305;&#37197;&#65292;&#21305;&#37197;&#36923;&#36753;&#23553;&#35013;&#22312;&#20102; matchThen &#26041;&#27861;&#20013;&#12290;&#19979;&#38754;&#26469;&#30475;&#19968;&#19979;&#36825;&#20004;&#20010;&#26041;&#27861;&#30340;&#36923;&#36753;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u61eb0445">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="3a1aa64b">boolean matchWhen(URL url, Invocation invocation) {
    // &#26381;&#21153;&#28040;&#36153;&#32773;&#26465;&#20214;&#20026; null &#25110;&#31354;&#65292;&#22343;&#36820;&#22238; true&#65292;&#27604;&#22914;&#65306;
    //     =&gt; host != 172.22.3.91
    // &#34920;&#31034;&#25152;&#26377;&#30340;&#26381;&#21153;&#28040;&#36153;&#32773;&#37117;&#19981;&#24471;&#35843;&#29992; IP &#20026; 172.22.3.91 &#30340;&#26426;&#22120;&#19978;&#30340;&#26381;&#21153;
    return whenCondition == null || whenCondition.isEmpty() 
        || matchCondition(whenCondition, url, null, invocation);  // &#36827;&#34892;&#26465;&#20214;&#21305;&#37197;
}

private boolean matchThen(URL url, URL param) {
    // &#26381;&#21153;&#25552;&#20379;&#32773;&#26465;&#20214;&#20026; null &#25110;&#31354;&#65292;&#34920;&#31034;&#31105;&#29992;&#26381;&#21153;
    return !(thenCondition == null || thenCondition.isEmpty()) 
        &amp;&amp; matchCondition(thenCondition, url, param, null);  // &#36827;&#34892;&#26465;&#20214;&#21305;&#37197;
}</pre>
 <p class="ne-p" id="u10f3d036">
  <br>
 </p>
 <p class="ne-p" id="ud0f3efe6">
  <span class="ne-text">
   &#36825;&#20004;&#20010;&#26041;&#27861;&#38271;&#30340;&#26377;&#28857;&#20687;&#65292;&#19981;&#36807;&#36923;&#36753;&#19978;&#36824;&#26159;&#26377;&#24046;&#21035;&#30340;&#65292;&#22823;&#23478;&#27880;&#24847;&#30475;&#12290;&#36825;&#20004;&#20010;&#26041;&#27861;&#22343;&#35843;&#29992;&#20102; matchCondition &#26041;&#27861;&#65292;&#20294;&#23427;&#20204;&#25152;&#20256;&#20837;&#30340;&#21442;&#25968;&#26159;&#19981;&#21516;&#30340;&#12290;&#36825;&#20010;&#38656;&#35201;&#29305;&#21035;&#27880;&#24847;&#19968;&#19979;&#65292;&#19981;&#28982;&#21518;&#38754;&#30340;&#36923;&#36753;&#19981;&#22909;&#24324;&#25026;&#12290;&#19979;&#38754;&#25105;&#20204;&#23545;&#36825;&#20960;&#20010;&#21442;&#25968;&#36827;&#34892;&#28335;&#28304;&#12290;matchWhen &#26041;&#27861;&#21521; matchCondition &#26041;&#27861;&#20256;&#20837;&#30340;&#21442;&#25968;&#20026; [whenCondition, url, null, invocation]&#65292;&#31532;&#19968;&#20010;&#21442;&#25968; whenCondition &#20026;&#26381;&#21153;&#28040;&#36153;&#32773;&#21305;&#37197;&#26465;&#20214;&#65292;&#36825;&#20010;&#21069;&#38754;&#20998;&#26512;&#36807;&#12290;&#31532;&#20108;&#20010;&#21442;&#25968; url &#28304;&#33258; route &#26041;&#27861;&#30340;&#21442;&#25968;&#21015;&#34920;&#65292;&#35813;&#21442;&#25968;&#30001;&#22806;&#37096;&#31867;&#35843;&#29992; route &#26041;&#27861;&#26102;&#20256;&#20837;&#12290;&#27604;&#22914;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u2e3020ab">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="0c4dc9fa">private List&lt;Invoker&lt;T&gt;&gt; route(List&lt;Invoker&lt;T&gt;&gt; invokers, String method) {
    Invocation invocation = new RpcInvocation(method, new Class&lt;?&gt;[0], new Object[0]);
    List&lt;Router&gt; routers = getRouters();
    if (routers != null) {
        for (Router router : routers) {
            if (router.getUrl() != null) {
                // &#27880;&#24847;&#31532;&#20108;&#20010;&#21442;&#25968;
                invokers = router.route(invokers, getConsumerUrl(), invocation);
            }
        }
    }
    return invokers;
}</pre>
 <p class="ne-p" id="u7f0f26e9">
  <br>
 </p>
 <p class="ne-p" id="uee51c9b9">
  <span class="ne-text">
   &#19978;&#38754;&#36825;&#27573;&#20195;&#30721;&#26469;&#33258; RegistryDirectory&#65292;&#31532;&#20108;&#20010;&#21442;&#25968;&#34920;&#31034;&#30340;&#26159;&#26381;&#21153;&#28040;&#36153;&#32773; url&#12290;matchCondition &#30340; invocation &#21442;&#25968;&#20063;&#26159;&#20174;&#36825;&#37324;&#20256;&#20837;&#30340;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u799ca49d">
  <br>
 </p>
 <p class="ne-p" id="u8c662799">
  <span class="ne-text">
   &#25509;&#19979;&#26469;&#20877;&#26469;&#30475;&#30475; matchThen &#21521; matchCondition &#26041;&#27861;&#20256;&#20837;&#30340;&#21442;&#25968; [thenCondition, url, param, null]&#12290;&#31532;&#19968;&#20010;&#21442;&#25968;&#19981;&#29992;&#35299;&#37322;&#20102;&#12290;&#31532;&#20108;&#20010;&#21644;&#31532;&#19977;&#20010;&#21442;&#25968;&#26469;&#33258; matchThen &#26041;&#27861;&#30340;&#21442;&#25968;&#21015;&#34920;&#65292;&#36825;&#20004;&#20010;&#21442;&#25968;&#20998;&#21035;&#20026;&#26381;&#21153;&#25552;&#20379;&#32773; url &#21644;&#26381;&#21153;&#28040;&#36153;&#32773; url&#12290;&#25630;&#28165;&#26970;&#36825;&#20123;&#21442;&#25968;&#26469;&#28304;&#21518;&#65292;&#25509;&#19979;&#26469;&#23601;&#21487;&#20197;&#20998;&#26512; matchCondition &#26041;&#27861;&#20102;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u250f3ac1">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="f79781f6">private boolean matchCondition(Map&lt;String, MatchPair&gt; condition, URL url, URL param, Invocation invocation) {
    // &#23558;&#26381;&#21153;&#25552;&#20379;&#32773;&#25110;&#28040;&#36153;&#32773; url &#36716;&#25104; Map
    Map&lt;String, String&gt; sample = url.toMap();
    boolean result = false;
    // &#36941;&#21382; condition &#21015;&#34920;
    for (Map.Entry&lt;String, MatchPair&gt; matchPair : condition.entrySet()) {
        // &#33719;&#21462;&#21305;&#37197;&#39033;&#21517;&#31216;&#65292;&#27604;&#22914; host&#12289;method &#31561;
        String key = matchPair.getKey();
        String sampleValue;
        // &#22914;&#26524; invocation &#19981;&#20026;&#31354;&#65292;&#19988; key &#20026; method(s)&#65292;&#34920;&#31034;&#36827;&#34892;&#26041;&#27861;&#21305;&#37197;
        if (invocation != null &amp;&amp; (Constants.METHOD_KEY.equals(key) || Constants.METHODS_KEY.equals(key))) {
            // &#20174; invocation &#33719;&#21462;&#34987;&#35843;&#29992;&#26041;&#27861;&#30340;&#21517;&#31216;
            sampleValue = invocation.getMethodName();
        } else {
            // &#20174;&#26381;&#21153;&#25552;&#20379;&#32773;&#25110;&#28040;&#36153;&#32773; url &#20013;&#33719;&#21462;&#25351;&#23450;&#23383;&#27573;&#20540;&#65292;&#27604;&#22914; host&#12289;application &#31561;
            sampleValue = sample.get(key);
            if (sampleValue == null) {
                // &#23581;&#35797;&#36890;&#36807; default.xxx &#33719;&#21462;&#30456;&#24212;&#30340;&#20540;
                sampleValue = sample.get(Constants.DEFAULT_KEY_PREFIX + key);
            }
        }
        
        // --------------------&#10024; &#20998;&#21106;&#32447; &#10024;-------------------- //
        
        if (sampleValue != null) {
            // &#35843;&#29992; MatchPair &#30340; isMatch &#26041;&#27861;&#36827;&#34892;&#21305;&#37197;
            if (!matchPair.getValue().isMatch(sampleValue, param)) {
                // &#21482;&#35201;&#26377;&#19968;&#20010;&#35268;&#21017;&#21305;&#37197;&#22833;&#36133;&#65292;&#31435;&#21363;&#36820;&#22238; false &#32467;&#26463;&#26041;&#27861;&#36923;&#36753;
                return false;
            } else {
                result = true;
            }
        } else {
            // sampleValue &#20026;&#31354;&#65292;&#34920;&#26126;&#26381;&#21153;&#25552;&#20379;&#32773;&#25110;&#28040;&#36153;&#32773; url &#20013;&#19981;&#21253;&#21547;&#30456;&#20851;&#23383;&#27573;&#12290;&#27492;&#26102;&#22914;&#26524; 
            // MatchPair &#30340; matches &#19981;&#20026;&#31354;&#65292;&#34920;&#31034;&#21305;&#37197;&#22833;&#36133;&#65292;&#36820;&#22238; false&#12290;&#27604;&#22914;&#25105;&#20204;&#26377;&#36825;&#26679;
            // &#19968;&#26465;&#21305;&#37197;&#26465;&#20214; loadbalance = random&#65292;&#20551;&#35774; url &#20013;&#24182;&#19981;&#21253;&#21547; loadbalance &#21442;&#25968;&#65292;
            // &#27492;&#26102; sampleValue = null&#12290;&#26082;&#28982;&#36335;&#30001;&#35268;&#21017;&#37324;&#38480;&#21046;&#20102; loadbalance &#24517;&#39035;&#20026; random&#65292;
            // &#20294; sampleValue = null&#65292;&#26126;&#26174;&#19981;&#31526;&#21512;&#35268;&#21017;&#65292;&#22240;&#27492;&#36820;&#22238; false
            if (!matchPair.getValue().matches.isEmpty()) {
                return false;
            } else {
                result = true;
            }
        }
    }
    return result;
}</pre>
 <p class="ne-p" id="uc74105fa">
  <br>
 </p>
 <p class="ne-p" id="u67bb63a6">
  <span class="ne-text">
   &#22914;&#19978;&#65292;matchCondition &#26041;&#27861;&#30475;&#36215;&#26469;&#26377;&#28857;&#22797;&#26434;&#65292;&#36825;&#37324;&#31616;&#21333;&#35828;&#26126;&#19968;&#19979;&#12290;&#20998;&#21106;&#32447;&#20197;&#19978;&#30340;&#20195;&#30721;&#23454;&#38469;&#19978;&#29992;&#20110;&#33719;&#21462; sampleValue &#30340;&#20540;&#65292;&#20998;&#21106;&#32447;&#20197;&#19979;&#25165;&#26159;&#36827;&#34892;&#26465;&#20214;&#21305;&#37197;&#12290;&#26465;&#20214;&#21305;&#37197;&#35843;&#29992;&#30340;&#36923;&#36753;&#23553;&#35013;&#22312; isMatch &#20013;&#65292;&#20195;&#30721;&#22914;&#19979;&#65306;
  </span>
 </p>
 <p class="ne-p" id="u7d62c416">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="e25c6f96">private boolean isMatch(String value, URL param) {
    // &#24773;&#20917;&#19968;&#65306;matches &#38750;&#31354;&#65292;mismatches &#20026;&#31354;
    if (!matches.isEmpty() &amp;&amp; mismatches.isEmpty()) {
        // &#36941;&#21382; matches &#38598;&#21512;&#65292;&#26816;&#27979;&#20837;&#21442; value &#26159;&#21542;&#33021;&#34987; matches &#38598;&#21512;&#20803;&#32032;&#21305;&#37197;&#21040;&#12290;
        // &#20030;&#20010;&#20363;&#23376;&#65292;&#22914;&#26524; value = 10.20.153.11&#65292;matches = [10.20.153.*],
        // &#27492;&#26102; isMatchGlobPattern &#26041;&#27861;&#36820;&#22238; true
        for (String match : matches) {
            if (UrlUtils.isMatchGlobPattern(match, value, param)) {
                return true;
            }
        }
        
        // &#22914;&#26524;&#25152;&#26377;&#21305;&#37197;&#39033;&#37117;&#26080;&#27861;&#21305;&#37197;&#21040;&#20837;&#21442;&#65292;&#21017;&#36820;&#22238; false
        return false;
    }

    // &#24773;&#20917;&#20108;&#65306;matches &#20026;&#31354;&#65292;mismatches &#38750;&#31354;
    if (!mismatches.isEmpty() &amp;&amp; matches.isEmpty()) {
        for (String mismatch : mismatches) {
            // &#21482;&#35201;&#20837;&#21442;&#34987; mismatches &#38598;&#21512;&#20013;&#30340;&#20219;&#24847;&#19968;&#20010;&#20803;&#32032;&#21305;&#37197;&#21040;&#65292;&#23601;&#36820;&#22238; false
            if (UrlUtils.isMatchGlobPattern(mismatch, value, param)) {
                return false;
            }
        }
        // mismatches &#38598;&#21512;&#20013;&#25152;&#26377;&#20803;&#32032;&#37117;&#26080;&#27861;&#21305;&#37197;&#21040;&#20837;&#21442;&#65292;&#27492;&#26102;&#36820;&#22238; true
        return true;
    }

    // &#24773;&#20917;&#19977;&#65306;matches &#38750;&#31354;&#65292;mismatches &#38750;&#31354;
    if (!matches.isEmpty() &amp;&amp; !mismatches.isEmpty()) {
        // matches &#21644; mismatches &#22343;&#20026;&#38750;&#31354;&#65292;&#27492;&#26102;&#20248;&#20808;&#20351;&#29992; mismatches &#38598;&#21512;&#20803;&#32032;&#23545;&#20837;&#21442;&#36827;&#34892;&#21305;&#37197;&#12290;
        // &#21482;&#35201; mismatches &#38598;&#21512;&#20013;&#20219;&#24847;&#19968;&#20010;&#20803;&#32032;&#19982;&#20837;&#21442;&#21305;&#37197;&#25104;&#21151;&#65292;&#23601;&#31435;&#21363;&#36820;&#22238; false&#65292;&#32467;&#26463;&#26041;&#27861;&#36923;&#36753;
        for (String mismatch : mismatches) {
            if (UrlUtils.isMatchGlobPattern(mismatch, value, param)) {
                return false;
            }
        }
        // mismatches &#38598;&#21512;&#20803;&#32032;&#26080;&#27861;&#21305;&#37197;&#21040;&#20837;&#21442;&#65292;&#27492;&#26102;&#20877;&#20351;&#29992; matches &#32487;&#32493;&#21305;&#37197;
        for (String match : matches) {
            // &#21482;&#35201; matches &#38598;&#21512;&#20013;&#20219;&#24847;&#19968;&#20010;&#20803;&#32032;&#19982;&#20837;&#21442;&#21305;&#37197;&#25104;&#21151;&#65292;&#23601;&#31435;&#21363;&#36820;&#22238; true
            if (UrlUtils.isMatchGlobPattern(match, value, param)) {
                return true;
            }
        }
        
        // &#20840;&#37096;&#22833;&#37197;&#65292;&#21017;&#36820;&#22238; false
        return false;
    }
    
    // &#24773;&#20917;&#22235;&#65306;matches &#21644; mismatches &#22343;&#20026;&#31354;&#65292;&#27492;&#26102;&#36820;&#22238; false
    return false;
}</pre>
 <p class="ne-p" id="u4212ef65">
  <br>
 </p>
 <p class="ne-p" id="ub367aaae">
  <span class="ne-text">
   isMatch &#26041;&#27861;&#36923;&#36753;&#27604;&#36739;&#28165;&#26224;&#65292;&#30001;&#19977;&#20010;&#26465;&#20214;&#20998;&#25903;&#32452;&#25104;&#65292;&#29992;&#20110;&#22788;&#29702;&#22235;&#31181;&#24773;&#20917;&#12290;&#36825;&#37324;&#23545;&#22235;&#31181;&#24773;&#20917;&#19979;&#30340;&#21305;&#37197;&#36923;&#36753;&#36827;&#34892;&#31616;&#21333;&#30340;&#24635;&#32467;&#65292;&#22914;&#19979;&#65306;
  </span>
 </p>
 <table class="ne-table" id="75522422" style="width: 750px">
  <tbody>
   <tr style="height: 33px">
    <td width="250">
    </td>
    <td width="250">
     <p class="ne-p" id="ub12f462f">
      <span class="ne-text">
       &#26465;&#20214;
      </span>
     </p>
    </td>
    <td width="250">
     <p class="ne-p" id="u97c17211">
      <span class="ne-text">
       &#36807;&#31243;
      </span>
     </p>
    </td>
   </tr>
   <tr style="height: 33px">
    <td width="250">
     <p class="ne-p" id="uae1dc60e">
      <span class="ne-text">
       &#24773;&#20917;&#19968;
      </span>
     </p>
    </td>
    <td width="250">
     <p class="ne-p" id="u1aa91daa">
      <span class="ne-text">
       matches &#38750;&#31354;&#65292;mismatches &#20026;&#31354;
      </span>
     </p>
    </td>
    <td width="250">
     <p class="ne-p" id="ue565e13b">
      <span class="ne-text">
       &#36941;&#21382; matches &#38598;&#21512;&#20803;&#32032;&#65292;&#24182;&#19982;&#20837;&#21442;&#36827;&#34892;&#21305;&#37197;&#12290;&#21482;&#35201;&#26377;&#19968;&#20010;&#20803;&#32032;&#25104;&#21151;&#21305;&#37197;&#20837;&#21442;&#65292;&#21363;&#21487;&#36820;&#22238; true&#12290;&#33509;&#20840;&#37096;&#22833;&#37197;&#65292;&#21017;&#36820;&#22238; false&#12290;
      </span>
     </p>
    </td>
   </tr>
   <tr style="height: 33px">
    <td width="250">
     <p class="ne-p" id="u70c121f6">
      <span class="ne-text">
       &#24773;&#20917;&#20108;
      </span>
     </p>
    </td>
    <td width="250">
     <p class="ne-p" id="ueb4e3e69">
      <span class="ne-text">
       matches &#20026;&#31354;&#65292;mismatches &#38750;&#31354;
      </span>
     </p>
    </td>
    <td width="250">
     <p class="ne-p" id="uc993bcfd">
      <span class="ne-text">
       &#36941;&#21382; mismatches &#38598;&#21512;&#20803;&#32032;&#65292;&#24182;&#19982;&#20837;&#21442;&#36827;&#34892;&#21305;&#37197;&#12290;&#21482;&#35201;&#26377;&#19968;&#20010;&#20803;&#32032;&#25104;&#21151;&#21305;&#37197;&#20837;&#21442;&#65292;&#31435;&#21363; false&#12290;&#33509;&#20840;&#37096;&#22833;&#37197;&#65292;&#21017;&#36820;&#22238; true&#12290;
      </span>
     </p>
    </td>
   </tr>
   <tr style="height: 33px">
    <td width="250">
     <p class="ne-p" id="u3d9b4e30">
      <span class="ne-text">
       &#24773;&#20917;&#19977;
      </span>
     </p>
    </td>
    <td width="250">
     <p class="ne-p" id="u6fa04840">
      <span class="ne-text">
       matches &#38750;&#31354;&#65292;mismatches &#38750;&#31354;
      </span>
     </p>
    </td>
    <td width="250">
     <p class="ne-p" id="uc9845a6c">
      <span class="ne-text">
       &#20248;&#20808;&#20351;&#29992; mismatches &#38598;&#21512;&#20803;&#32032;&#23545;&#20837;&#21442;&#36827;&#34892;&#21305;&#37197;&#65292;&#21482;&#35201;&#20219;&#19968;&#20803;&#32032;&#19982;&#20837;&#21442;&#21305;&#37197;&#25104;&#21151;&#65292;&#23601;&#31435;&#21363;&#36820;&#22238; false&#65292;&#32467;&#26463;&#26041;&#27861;&#36923;&#36753;&#12290;&#21542;&#21017;&#20877;&#20351;&#29992; matches &#20013;&#30340;&#38598;&#21512;&#20803;&#32032;&#36827;&#34892;&#21305;&#37197;&#65292;&#21482;&#35201;&#26377;&#20219;&#24847;&#19968;&#20010;&#20803;&#32032;&#21305;&#37197;&#25104;&#21151;&#65292;&#21363;&#21487;&#36820;&#22238; true&#12290;&#33509;&#20840;&#37096;&#22833;&#37197;&#65292;&#21017;&#36820;&#22238; false
      </span>
     </p>
    </td>
   </tr>
   <tr style="height: 33px">
    <td width="250">
     <p class="ne-p" id="u3889071f">
      <span class="ne-text">
       &#24773;&#20917;&#22235;
      </span>
     </p>
    </td>
    <td width="250">
     <p class="ne-p" id="uf249a16c">
      <span class="ne-text">
       matches &#20026;&#31354;&#65292;mismatches &#20026;&#31354;
      </span>
     </p>
    </td>
    <td width="250">
     <p class="ne-p" id="u553e2959">
      <span class="ne-text">
       &#30452;&#25509;&#36820;&#22238; false
      </span>
     </p>
    </td>
   </tr>
  </tbody>
 </table>
 <p class="ne-p" id="ue8084960">
  <br>
 </p>
 <p class="ne-p" id="udf5713bb">
  <span class="ne-text">
   isMatch &#26041;&#27861;&#26159;&#36890;&#36807; UrlUtils &#30340; isMatchGlobPattern &#26041;&#27861;&#36827;&#34892;&#21305;&#37197;&#65292;&#22240;&#27492;&#19979;&#38754;&#25105;&#20204;&#20877;&#26469;&#30475;&#30475; isMatchGlobPattern &#26041;&#27861;&#30340;&#36923;&#36753;&#12290;
  </span>
 </p>
 <p class="ne-p" id="u704808cf">
  <br>
 </p>
 <pre class="ne-codeblock language-java" data-language="java" id="26cbd2ab">public static boolean isMatchGlobPattern(String pattern, String value, URL param) {
    if (param != null &amp;&amp; pattern.startsWith("$")) {
        // &#24341;&#29992;&#26381;&#21153;&#28040;&#36153;&#32773;&#21442;&#25968;&#65292;param &#21442;&#25968;&#20026;&#26381;&#21153;&#28040;&#36153;&#32773; url
        pattern = param.getRawParameter(pattern.substring(1));
    }
    // &#35843;&#29992;&#37325;&#36733;&#26041;&#27861;&#32487;&#32493;&#27604;&#36739;
    return isMatchGlobPattern(pattern, value);
}

public static boolean isMatchGlobPattern(String pattern, String value) {
    // &#23545; * &#36890;&#37197;&#31526;&#25552;&#20379;&#25903;&#25345;
    if ("*".equals(pattern))
        // &#21305;&#37197;&#35268;&#21017;&#20026;&#36890;&#37197;&#31526; *&#65292;&#30452;&#25509;&#36820;&#22238; true &#21363;&#21487;
        return true;
    if ((pattern == null || pattern.length() == 0)
            &amp;&amp; (value == null || value.length() == 0))
        // pattern &#21644; value &#22343;&#20026;&#31354;&#65292;&#27492;&#26102;&#21487;&#35748;&#20026;&#20004;&#32773;&#30456;&#31561;&#65292;&#36820;&#22238; true
        return true;
    if ((pattern == null || pattern.length() == 0)
            || (value == null || value.length() == 0))
        // pattern &#21644; value &#20854;&#20013;&#26377;&#19968;&#20010;&#20026;&#31354;&#65292;&#34920;&#26126;&#20004;&#32773;&#19981;&#30456;&#31561;&#65292;&#36820;&#22238; false
        return false;

    // &#23450;&#20301; * &#36890;&#37197;&#31526;&#20301;&#32622;
    int i = pattern.lastIndexOf('*');
    if (i == -1) {
        // &#21305;&#37197;&#35268;&#21017;&#20013;&#19981;&#21253;&#21547;&#36890;&#37197;&#31526;&#65292;&#27492;&#26102;&#30452;&#25509;&#27604;&#36739; value &#21644; pattern &#26159;&#21542;&#30456;&#31561;&#21363;&#21487;&#65292;&#24182;&#36820;&#22238;&#27604;&#36739;&#32467;&#26524;
        return value.equals(pattern);
    }
    // &#36890;&#37197;&#31526; "*" &#22312;&#21305;&#37197;&#35268;&#21017;&#23614;&#37096;&#65292;&#27604;&#22914; 10.0.21.*
    else if (i == pattern.length() - 1) {
        // &#26816;&#27979; value &#26159;&#21542;&#20197;&#8220;&#19981;&#21547;&#36890;&#37197;&#31526;&#30340;&#21305;&#37197;&#35268;&#21017;&#8221;&#24320;&#22836;&#65292;&#24182;&#36820;&#22238;&#32467;&#26524;&#12290;&#27604;&#22914;:
        // pattern = 10.0.21.*&#65292;value = 10.0.21.12&#65292;&#27492;&#26102;&#36820;&#22238; true
        return value.startsWith(pattern.substring(0, i));
    }
    // &#36890;&#37197;&#31526; "*" &#22312;&#21305;&#37197;&#35268;&#21017;&#22836;&#37096;
    else if (i == 0) {
        // &#26816;&#27979; value &#26159;&#21542;&#20197;&#8220;&#19981;&#21547;&#36890;&#37197;&#31526;&#30340;&#21305;&#37197;&#35268;&#21017;&#8221;&#32467;&#23614;&#65292;&#24182;&#36820;&#22238;&#32467;&#26524;
        return value.endsWith(pattern.substring(i + 1));
    }
    // &#36890;&#37197;&#31526; "*" &#22312;&#21305;&#37197;&#35268;&#21017;&#20013;&#38388;&#20301;&#32622;
    else {
        // &#36890;&#36807;&#36890;&#37197;&#31526;&#23558; pattern &#20998;&#25104;&#20004;&#21322;&#65292;&#24471;&#21040; prefix &#21644; suffix
        String prefix = pattern.substring(0, i);
        String suffix = pattern.substring(i + 1);
        // &#26816;&#27979; value &#26159;&#21542;&#20197; prefix &#24320;&#22836;&#65292;&#19988;&#20197; suffix &#32467;&#23614;&#65292;&#24182;&#36820;&#22238;&#32467;&#26524;
        return value.startsWith(prefix) &amp;&amp; value.endsWith(suffix);
    }
}</pre>
 <p class="ne-p" id="uf3572b2a">
  <br>
 </p>
 <p class="ne-p" id="ue8a66c46">
  <span class="ne-text">
   &#20197;&#19978;&#23601;&#26159; isMatchGlobPattern &#20004;&#20010;&#37325;&#36733;&#26041;&#27861;&#30340;&#20840;&#37096;&#36923;&#36753;&#65292;&#36825;&#20004;&#20010;&#26041;&#27861;&#20998;&#21035;&#23545;&#26222;&#36890;&#30340;&#21305;&#37197;&#36807;&#31243;&#65292;&#20197;&#21450;&#8221;&#24341;&#29992;&#28040;&#36153;&#32773;&#21442;&#25968;&#8220;&#21644;&#36890;&#37197;&#31526;&#21305;&#37197;&#31561;&#29305;&#24615;&#25552;&#20379;&#20102;&#25903;&#25345;&#12290;&#36825;&#20004;&#20010;&#26041;&#27861;&#30340;&#36923;&#36753;&#19981;&#26159;&#24456;&#22797;&#26434;&#65292;&#19988;&#20195;&#30721;&#20013;&#20063;&#36827;&#34892;&#20102;&#27604;&#36739;&#35814;&#32454;&#30340;&#27880;&#37322;&#65292;&#22240;&#27492;&#23601;&#19981;&#22810;&#35828;&#20102;&#12290;
  </span>
 </p>
 <p class="ne-p" id="uadc03fda">
  <br>
 </p>
 <h2 id="393a3509">
  <span class="ne-text">
   3. &#24635;&#32467;
  </span>
 </h2>
 <p class="ne-p" id="ua61c12f8">
  <br>
 </p>
 <p class="ne-p" id="ubd826bb9">
  <span class="ne-text">
   &#26412;&#31687;&#25991;&#31456;&#23545;&#26465;&#20214;&#36335;&#30001;&#30340;&#34920;&#36798;&#24335;&#35299;&#26512;&#21644;&#26381;&#21153;&#36335;&#30001;&#36807;&#31243;&#36827;&#34892;&#20102;&#36739;&#20026;&#32454;&#33268;&#30340;&#20998;&#26512;&#12290;&#24635;&#30340;&#26469;&#35828;&#65292;&#26465;&#20214;&#36335;&#30001;&#30340;&#20195;&#30721;&#36824;&#26159;&#26377;&#19968;&#20123;&#22797;&#26434;&#30340;&#65292;&#38656;&#35201;&#38745;&#19979;&#24515;&#26469;&#30475;&#12290;&#22312;&#38405;&#35835;&#26465;&#20214;&#36335;&#30001;&#20195;&#30721;&#30340;&#36807;&#31243;&#20013;&#65292;&#35201;&#22810;&#35843;&#35797;&#12290;&#19968;&#33324;&#30340;&#26694;&#26550;&#37117;&#20250;&#26377;&#21333;&#20803;&#27979;&#35797;&#65292;Dubbo &#20063;&#19981;&#20363;&#22806;&#65292;&#22240;&#27492;&#22823;&#23478;&#21487;&#20197;&#30452;&#25509;&#36890;&#36807; ConditionRouterTest &#23545;&#26465;&#20214;&#36335;&#30001;&#36827;&#34892;&#35843;&#35797;&#65292;&#26080;&#38656;&#37325;&#22836;&#26500;&#24314;&#27979;&#35797;&#29992;&#20363;&#12290;
  </span>
 </p>
</div>
</div>
</div>

        </body>
        
        