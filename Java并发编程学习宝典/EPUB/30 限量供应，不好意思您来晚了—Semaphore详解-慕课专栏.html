
        <html lang="en">
        <head>
        <meta charset="UTF-8"/>
        </head>
        <body>
        <div><div class="markdown-body">
    

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="style/style.css" type="text/css">

<div class="markdown-body">
    <div class="article-con">
 <!-- &#20080;&#36807;&#30340;&#38405;&#35835; -->
 <div class="art-title" style="margin-top: 0px;">
  30 &#38480;&#37327;&#20379;&#24212;&#65292;&#19981;&#22909;&#24847;&#24605;&#24744;&#26469;&#26202;&#20102;&#8212;Semaphore&#35814;&#35299;
 </div>
 <div class="art-info clearfix">
  <span class="l">
   &#26356;&#26032;&#26102;&#38388;&#65306;2019-12-10 09:50:17
  </span>
 </div>
 <div class="art-top">
  <img alt="" src="EPUB/c93f6b6c-186d-11ed-a978-acde48001122">
  <div class="famous-word-box">
   <img alt="" class="bg1 bg" src="EPUB/c95a7466-186d-11ed-a978-acde48001122">
   <img alt="" class="bg2 bg" src="EPUB/c98b9e42-186d-11ed-a978-acde48001122">
   <div class="famous-word">
    &#32784;&#24515;&#21644;&#24658;&#24515;&#24635;&#20250;&#24471;&#21040;&#25253;&#37228;&#30340;&#12290;
    <p class="author">
     &#8212;&#8212;&#29233;&#22240;&#26031;&#22374;
    </p>
   </div>
  </div>
 </div>
 <div class="art-content js-lookimg">
  <div id="article_content">
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#21069;&#20960;&#33410;&#25105;&#20204;&#23398;&#20064;&#20102;&#20960;&#31181;&#22810;&#32447;&#31243;&#32447;&#31243;&#21516;&#27493;&#24037;&#20855;&#65292;&#26377;&#19968;&#27425;&#24615;&#20351;&#29992;&#30340;&#20498;&#25968;&#35745;&#25968;&#30340; CountDownLatch&#65292;&#26377;&#24490;&#29615;&#20351;&#29992;&#30340; CyclicBarrier&#65292;&#36824;&#26377;&#21487;&#20197;&#20570;&#25968;&#25454;&#20132;&#25442;&#30340; Exchanger&#12290;&#20170;&#22825;&#25105;&#20204;&#20877;&#35762;&#35299;&#19968;&#31181;&#21516;&#27493;&#24037;&#20855; Semaphore&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <h2 id="&#12289;semaphore-&#31616;&#20171;" style="font-size: 30px;">
     1&#12289;Semaphore &#31616;&#20171;
    </h2>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     Semaphore &#26159;&#20449;&#21495;&#37327;&#30340;&#24847;&#24605;&#65292;&#36890;&#36807;&#20449;&#21495;&#37327;&#21487;&#20197;&#23545;&#21516;&#19968;&#36164;&#28304;&#35775;&#38382;&#20570;&#25968;&#37327;&#30340;&#38480;&#21046;&#12290;&#25105;&#20204;&#22238;&#24518;&#19968;&#19979;&#26080;&#35770;&#26159; Synchronized &#36824;&#26159; ReentrantLock &#37117;&#26159;&#38480;&#21046;&#27599;&#27425;&#21482;&#26377;&#19968;&#20010;&#32447;&#31243;&#24182;&#21457;&#35775;&#38382;&#36164;&#28304;&#12290;&#32780;&#20449;&#21495;&#37327;&#21487;&#20197;&#25511;&#21046;&#26356;&#22810;&#25968;&#37327;&#30340;&#32447;&#31243;&#35775;&#38382;&#36164;&#28304;&#65292;&#20294;&#26159;&#19981;&#33021;&#36229;&#36807;&#20449;&#21495;&#37327;&#30340;&#20934;&#20837;&#25968;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#36825;&#23601;&#20687;&#20572;&#36710;&#22330;&#65292;&#22914;&#26524;&#20572;&#36710;&#20301;&#36164;&#28304;&#19981;&#32039;&#24352;&#65292;&#36710;&#21487;&#20197;&#38543;&#20415;&#36827;&#12290;&#20294;&#26159;&#24403;&#20572;&#36710;&#22330;&#20572;&#28385;&#20102;&#36710;&#65292;&#37027;&#20040;&#19981;&#22909;&#24847;&#24605;&#65292;&#24744;&#26469;&#26202;&#20102;&#12290;&#20320;&#21482;&#33021;&#22312;&#20837;&#21475;&#31561;&#24453;&#12290;&#20986;&#21435;&#20960;&#36742;&#65292;&#25165;&#33021;&#25918;&#20960;&#36742;&#36827;&#26469;&#12290;&#36825;&#20010;&#20363;&#23376;&#20013;&#65292;&#20572;&#36710;&#22330;&#23601;&#26159;&#20849;&#20139;&#36164;&#28304;&#65292;&#20572;&#36710;&#20301;&#30340;&#25968;&#37327;&#23601;&#26159;&#20449;&#21495;&#37327;&#20934;&#20837;&#25968;&#12290;&#32780;&#27599;&#36742;&#36710;&#23601;&#26159;&#19968;&#20010;&#32447;&#31243;&#12290;&#20572;&#36710;&#22330;&#25511;&#21046;&#31995;&#32479;&#23601;&#26159;&#20170;&#22825;&#35201;&#23398;&#20064;&#30340; Semaphore&#12290;
     <br>
     <img alt="&#22270;&#29255;&#25551;&#36848;" class="" data-original="//img.mukewang.com/5deef9cd0001631f08600575.jpg" src="EPUB/c9a5c6e6-186d-11ed-a978-acde48001122">
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#19979;&#38754;&#25105;&#20204;&#30475;&#30475;&#22914;&#20309;&#29992;&#20195;&#30721;&#23454;&#29616;&#20197;&#19978;&#30340;&#20363;&#23376;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <h2 id="&#12289;&#22914;&#20309;&#20351;&#29992;-semaphore" style="font-size: 30px;">
     2&#12289;&#22914;&#20309;&#20351;&#29992; Semaphore
    </h2>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#19979;&#38754;&#30340;&#20195;&#30721;&#27169;&#25311; 10 &#20010;&#36710;&#20301;&#30340;&#20572;&#36710;&#22330;&#65292;&#20170;&#22825;&#19981;&#30693;&#36947;&#38468;&#36817;&#26377;&#20160;&#20040;&#27963;&#21160;&#65292;&#31361;&#28982;&#36807;&#26469;&#20102; 500 &#36742;&#36710;&#35201;&#20572;&#20837;&#20572;&#36710;&#22330;&#12290;&#36825;&#26679;&#24517;&#28982;&#20250;&#36896;&#25104;&#25490;&#38431;&#65292;&#21069;&#38754;&#30340;&#36710;&#20986;&#21435;&#19968;&#36742;&#21518;&#38754;&#30340;&#36710;&#25165;&#33021;&#36827;&#26469;&#19968;&#36742;&#12290;&#20195;&#30721;&#22914;&#19979;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//&#29992;&#20110;&#29983;&#25104;&#38543;&#26426;&#20572;&#36710;&#26102;&#38271;</span>
        Random random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//&#29992;Semaphore&#27169;&#25311;&#26377;10&#20010;&#20572;&#36710;&#20301;&#30340;&#20572;&#36710;&#22330;&#31649;&#29702;&#31995;&#32479;</span>
        <span class="token keyword">final</span> Semaphore parkingSystem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//&#27169;&#25311;500&#36742;&#27773;&#36710;&#26469;&#20572;&#36710;</span>
        IntStream<span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>i<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>
                <span class="token comment">//&#21462;&#24471;&#21040;&#36798;&#20572;&#36710;&#22330;&#30340;&#26102;&#38388;</span>
                Long startWaitTime <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&#31532;"</span><span class="token operator">+</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"&#36742;&#27773;&#36710;&#26469;&#21040;&#36710;&#24211;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">//&#31561;&#24453;&#20572;&#36710;&#22330;&#31995;&#32479;&#25511;&#21046;&#25260;&#26438;&#12290;&#22914;&#26524;&#36824;&#26377;&#31354;&#20301;&#65292;&#31435;&#21363;&#25260;&#26438;&#65292;&#21542;&#21017;&#19968;&#30452;&#31561;&#21040;&#26377;&#31354;&#20301;&#25165;&#25260;&#26438;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                  <span class="token comment">//acquire&#26041;&#27861;&#29992;&#20110;&#33719;&#21462;&#36164;&#28304;&#65292;&#36825;&#37324;&#27169;&#25311;&#21457;&#20986;&#25260;&#26438;&#25918;&#34892;&#30340;&#35831;&#27714;</span>
                    parkingSystem<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">//&#24050;&#32463;&#25260;&#36214;&#65292;&#35745;&#31639;&#31561;&#24453;&#26102;&#38271;</span>
                Long waitingTime <span class="token operator">=</span> <span class="token punctuation">(</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startWaitTime<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">1000</span><span class="token punctuation">;</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&#31532;"</span><span class="token operator">+</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"&#36742;&#27773;&#36710;&#31561;&#24453;"</span><span class="token operator">+</span>waitingTime<span class="token operator">+</span><span class="token string">"&#27627;&#31186;&#21518;&#36827;&#20837;&#36710;&#24211;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//&#36890;&#36807;sleep&#27169;&#25311;&#20572;&#36710;&#26102;&#38271;</span>
                <span class="token keyword">int</span> parkingTime <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>parkingTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
              	<span class="token comment">//release&#26041;&#27861;&#29992;&#20110;&#37322;&#25918;&#36164;&#28304;&#65292;&#27169;&#25311;&#39542;&#20986;&#20572;&#36710;&#22330;</span>
                parkingSystem<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&#31532;"</span><span class="token operator">+</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"&#36742;&#27773;&#36710;&#20572;&#36710;"</span><span class="token operator">+</span>parkingTime<span class="token operator">+</span><span class="token string">"&#27627;&#31186;&#31163;&#24320;&#36710;&#24211;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#36755;&#20986;&#27604;&#36739;&#22810;&#65292;&#25105;&#20204;&#20808;&#30475;&#24320;&#22987;&#30340;&#36755;&#20986;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre><code>&#31532;1&#36742;&#27773;&#36710;&#26469;&#21040;&#36710;&#24211;
&#31532;3&#36742;&#27773;&#36710;&#26469;&#21040;&#36710;&#24211;
&#31532;2&#36742;&#27773;&#36710;&#26469;&#21040;&#36710;&#24211;
&#31532;3&#36742;&#27773;&#36710;&#31561;&#24453;0&#27627;&#31186;&#21518;&#36827;&#20837;&#36710;&#24211;
&#31532;5&#36742;&#27773;&#36710;&#26469;&#21040;&#36710;&#24211;
&#31532;4&#36742;&#27773;&#36710;&#26469;&#21040;&#36710;&#24211;
&#31532;1&#36742;&#27773;&#36710;&#31561;&#24453;0&#27627;&#31186;&#21518;&#36827;&#20837;&#36710;&#24211;
&#31532;6&#36742;&#27773;&#36710;&#26469;&#21040;&#36710;&#24211;
&#31532;4&#36742;&#27773;&#36710;&#31561;&#24453;0&#27627;&#31186;&#21518;&#36827;&#20837;&#36710;&#24211;
&#31532;5&#36742;&#27773;&#36710;&#31561;&#24453;0&#27627;&#31186;&#21518;&#36827;&#20837;&#36710;&#24211;
&#31532;2&#36742;&#27773;&#36710;&#31561;&#24453;0&#27627;&#31186;&#21518;&#36827;&#20837;&#36710;&#24211;
&#31532;7&#36742;&#27773;&#36710;&#26469;&#21040;&#36710;&#24211;
&#31532;6&#36742;&#27773;&#36710;&#31561;&#24453;0&#27627;&#31186;&#21518;&#36827;&#20837;&#36710;&#24211;
&#31532;9&#36742;&#27773;&#36710;&#26469;&#21040;&#36710;&#24211;
&#31532;9&#36742;&#27773;&#36710;&#31561;&#24453;0&#27627;&#31186;&#21518;&#36827;&#20837;&#36710;&#24211;
&#31532;7&#36742;&#27773;&#36710;&#31561;&#24453;0&#27627;&#31186;&#21518;&#36827;&#20837;&#36710;&#24211;
&#31532;8&#36742;&#27773;&#36710;&#26469;&#21040;&#36710;&#24211;
&#31532;8&#36742;&#27773;&#36710;&#31561;&#24453;0&#27627;&#31186;&#21518;&#36827;&#20837;&#36710;&#24211;
&#31532;10&#36742;&#27773;&#36710;&#26469;&#21040;&#36710;&#24211;
&#31532;10&#36742;&#27773;&#36710;&#31561;&#24453;0&#27627;&#31186;&#21518;&#36827;&#20837;&#36710;&#24211;
&#31532;11&#36742;&#27773;&#36710;&#26469;&#21040;&#36710;&#24211;
&#31532;12&#36742;&#27773;&#36710;&#26469;&#21040;&#36710;&#24211;
&#31532;13&#36742;&#27773;&#36710;&#26469;&#21040;&#36710;&#24211;
&#31532;14&#36742;&#27773;&#36710;&#26469;&#21040;&#36710;&#24211;
......
</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#21487;&#20197;&#30475;&#21040;&#21069; 10 &#36742;&#36710;&#36827;&#20837;&#36710;&#24211;&#37117;&#26159;&#19981;&#38656;&#35201;&#31561;&#24453;&#30340;&#65292;&#20174;&#31532; 11 &#36742;&#36710;&#24320;&#22987;&#24050;&#32463;&#26080;&#27861;&#36827;&#20837;&#36710;&#24211;&#20102;&#12290;&#25105;&#20204;&#32487;&#32493;&#30475;&#21518;&#20080;&#38754;&#30340;&#36755;&#20986;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre><code>......
&#31532;495&#36742;&#27773;&#36710;&#26469;&#21040;&#36710;&#24211;
&#31532;496&#36742;&#27773;&#36710;&#26469;&#21040;&#36710;&#24211;
&#31532;497&#36742;&#27773;&#36710;&#26469;&#21040;&#36710;&#24211;
&#31532;498&#36742;&#27773;&#36710;&#26469;&#21040;&#36710;&#24211;
&#31532;499&#36742;&#27773;&#36710;&#26469;&#21040;&#36710;&#24211;
&#31532;500&#36742;&#27773;&#36710;&#26469;&#21040;&#36710;&#24211;
......
</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#30001;&#20110;&#27773;&#36710;&#32447;&#31243;&#21551;&#21160;&#27809;&#26377;&#38388;&#38548;&#65292;&#20063;&#23601;&#24847;&#21619;&#30528; 500 &#36742;&#36710;&#30636;&#38388;&#25380;&#21387;&#21040;&#20572;&#36710;&#22330;&#38376;&#21475;&#65292;&#31561;&#24453;&#20837;&#22330;&#12290;&#32487;&#32493;&#30475;&#19979;&#38754;&#30340;&#36755;&#20986;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre><code>&#31532;3&#36742;&#27773;&#36710;&#20572;&#36710;4&#27627;&#31186;&#31163;&#24320;&#36710;&#24211;
&#31532;11&#36742;&#27773;&#36710;&#31561;&#24453;4&#27627;&#31186;&#21518;&#36827;&#20837;&#36710;&#24211;
&#31532;6&#36742;&#27773;&#36710;&#20572;&#36710;5&#27627;&#31186;&#31163;&#24320;&#36710;&#24211;
&#31532;12&#36742;&#27773;&#36710;&#31561;&#24453;5&#27627;&#31186;&#21518;&#36827;&#20837;&#36710;&#24211;
&#31532;5&#36742;&#27773;&#36710;&#20572;&#36710;7&#27627;&#31186;&#31163;&#24320;&#36710;&#24211;
&#31532;2&#36742;&#27773;&#36710;&#20572;&#36710;7&#27627;&#31186;&#31163;&#24320;&#36710;&#24211;
&#31532;13&#36742;&#27773;&#36710;&#31561;&#24453;7&#27627;&#31186;&#21518;&#36827;&#20837;&#36710;&#24211;
&#31532;14&#36742;&#27773;&#36710;&#31561;&#24453;7&#27627;&#31186;&#21518;&#36827;&#20837;&#36710;&#24211;
&#31532;10&#36742;&#27773;&#36710;&#20572;&#36710;8&#27627;&#31186;&#31163;&#24320;&#36710;&#24211;
&#31532;15&#36742;&#27773;&#36710;&#31561;&#24453;8&#27627;&#31186;&#21518;&#36827;&#20837;&#36710;&#24211;
&#31532;1&#36742;&#27773;&#36710;&#20572;&#36710;9&#27627;&#31186;&#31163;&#24320;&#36710;&#24211;
&#31532;4&#36742;&#27773;&#36710;&#20572;&#36710;9&#27627;&#31186;&#31163;&#24320;&#36710;&#24211;
</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#21487;&#20197;&#30475;&#21040;&#31532;&#19968;&#25209;&#36827;&#20837;&#36710;&#24211;&#30340;&#27773;&#36710;&#65292;&#36880;&#27493;&#31163;&#24320;&#36710;&#24211;&#12290;&#21518;&#38754;&#25490;&#38431;&#30340;&#36710;&#38470;&#32493;&#36827;&#26469;&#12290;&#21478;&#22806;&#20063;&#21487;&#20197;&#35266;&#23519;&#21040;&#65292;&#31163;&#24320;&#27773;&#36710;&#30340;&#20572;&#36710;&#26102;&#38271;&#21644;&#36827;&#20837;&#27773;&#36710;&#30340;&#31561;&#24453;&#26102;&#38271;&#26159;&#19968;&#33268;&#65292;&#36825;&#20063;&#35777;&#26126;&#20102;&#21482;&#26377;&#36208;&#20102;&#19968;&#36742;&#65292;&#25165;&#33021;&#36827;&#20837;&#19968;&#36742;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#19981;&#36807;&#30001;&#20110;&#22810;&#32447;&#31243;&#36755;&#20986;&#26085;&#24535;&#65292;&#25152;&#20197;&#39034;&#24207;&#19978;&#24182;&#19981;&#19968;&#23450;&#26159;&#19968;&#36742;&#31163;&#24320;&#65292;&#19968;&#36742;&#36827;&#20837;&#12290;&#20294;&#23454;&#38469;&#36816;&#34892;&#24773;&#20917;&#30830;&#23454;&#26159;&#36208;&#20102;&#19968;&#36742;&#25165;&#25918;&#20837;&#19968;&#36742;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     Semaphore &#21487;&#20197;&#36873;&#25321;&#31454;&#20105;&#31574;&#30053;&#26159;&#21542;&#20844;&#24179;&#12290;&#26500;&#36896; Semaphore &#26102;&#21487;&#20197;&#20256;&#20837;&#31532;&#20108;&#20010;&#21442;&#25968;&#65292;&#22914;&#19979;&#38754;&#20195;&#30721;&#25152;&#31034;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java"><span class="token keyword">final</span> Semaphore parkingSystem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#22914;&#26524;&#26500;&#36896;&#26102;&#20256;&#20837;&#31532;&#20108;&#20010;&#21442;&#25968;&#20026; true&#65292;&#37027;&#20040;&#23601;&#26159;&#20844;&#24179;&#30340;&#65292;&#19981;&#20256;&#40664;&#35748;&#20063;&#26159;&#20844;&#24179;&#30340;&#12290;&#36825;&#19968;&#28857;&#36890;&#36807;&#20197;&#19978;&#20363;&#23376;&#30340;&#36755;&#20986;&#20063;&#26377;&#25152;&#20307;&#29616;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <h2 id="&#12289;semaphore-&#28304;&#30721;&#20998;&#26512;" style="font-size: 30px;">
     3&#12289;Semaphore &#28304;&#30721;&#20998;&#26512;
    </h2>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#25105;&#20204;&#20808;&#30475; Semaphore &#30340;&#26500;&#36896;&#26041;&#27861;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java"><span class="token keyword">public</span> <span class="token function">Semaphore</span><span class="token punctuation">(</span><span class="token keyword">int</span> permits<span class="token punctuation">,</span> <span class="token keyword">boolean</span> fair<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sync <span class="token operator">=</span> fair <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">FairSync</span><span class="token punctuation">(</span>permits<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">NonfairSync</span><span class="token punctuation">(</span>permits<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#26681;&#25454;&#20256;&#20837; fair &#30340;&#19981;&#21516;&#65292;&#36873;&#25321; sync &#23545;&#35937;&#26159;&#20844;&#24179;&#36824;&#26159;&#19981;&#20844;&#24179;&#12290;FairSync &#21644; NonfairSync &#37117;&#26159; Semaphore &#20869;&#37096;&#38745;&#24577;&#31867;&#65292;&#32487;&#25215;&#33258; AQS&#12290;Semaphore &#20063;&#26159;&#20511;&#21161; AQS &#26469;&#23454;&#29616;&#30340;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#25105;&#20204;&#20877;&#30475; acquire &#26041;&#27861;&#20195;&#30721;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> InterruptedException <span class="token punctuation">{</span>
    sync<span class="token punctuation">.</span><span class="token function">acquireSharedInterruptibly</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#35843;&#29992;&#20102; AQS &#20013;&#30340; acquireSharedInterruptibly &#26041;&#27861;&#12290;&#32487;&#32493;&#30475;&#27492;&#26041;&#27861;&#20195;&#30721;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">acquireSharedInterruptibly</span><span class="token punctuation">(</span><span class="token keyword">int</span> arg<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> InterruptedException <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">interrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">tryAcquireShared</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token function">doAcquireSharedInterruptibly</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#26680;&#24515;&#26159;&#20808;&#35843;&#29992; tryAcquireShared&#65292;&#23581;&#35797;&#33719;&#21462;&#65292;&#22914;&#26524;&#33719;&#21462;&#22833;&#36133;&#21017;&#35843;&#29992; doAcquireSharedInterruptibly&#65292;&#33258;&#26059;&#36827;&#20837;&#31561;&#24453;&#38431;&#21015;&#65292;&#22914;&#26524;&#25490;&#21040;&#33258;&#24049;&#65292;&#37027;&#20040;&#20877;&#27425;&#23581;&#35797;&#35843;&#29992; tryAcquireShared&#12290;&#36825;&#20010;&#26041;&#27861;&#20043;&#21069;&#35814;&#32454;&#20998;&#26512;&#36807;&#65292;&#36825;&#37324;&#23601;&#19981;&#20877;&#23637;&#24320;&#26469;&#35762;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#25509;&#19979;&#26469;&#25105;&#20204;&#30475;&#30475;&#23581;&#35797;&#33719;&#21462;&#36164;&#28304;&#30340;&#26041;&#27861; tryAcquireShared&#65292;&#23427;&#30340;&#23454;&#29616;&#22312; Semaphore &#20869;&#37096;&#38745;&#24577;&#31867; Sync &#20013;&#65292;&#22914;&#19979;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java"><span class="token keyword">protected</span> <span class="token keyword">int</span> <span class="token function">tryAcquireShared</span><span class="token punctuation">(</span><span class="token keyword">int</span> acquires<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//&#30475;&#26159;&#21542;&#26377;&#26356;&#26089;&#31561;&#24453;&#30340;&#32447;&#31243;&#65292;&#22914;&#26524;&#26377;&#65292;&#33719;&#21462;&#22833;&#36133;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasQueuedPredecessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token comment">//&#26597;&#35810;&#21097;&#20313;&#30340;&#20449;&#21495;&#37327;&#20934;&#20837;&#25968;&#37327;</span>
        <span class="token keyword">int</span> available <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//&#26597;&#35810;&#21097;&#20313;&#30340;&#20449;&#21495;&#37327;&#20934;&#20837;&#25968;&#37327;&#65292;&#30475;&#26159;&#21542;&#28385;&#36275;&#24819;&#35201;&#33719;&#21462;&#30340;&#25968;&#37327;</span>
        <span class="token keyword">int</span> remaining <span class="token operator">=</span> available <span class="token operator">-</span> acquires<span class="token punctuation">;</span>
      <span class="token comment">//&#21097;&#20313;&#30340;&#25968;&#37327;&gt;0&#21017;&#20250;&#36890;&#36807;CAS&#30340;&#26041;&#24335;&#21047;&#26032;&#21097;&#20313;&#20449;&#21495;&#37327;&#12290;&#24182;&#19988;&#36820;&#22238;&#21097;&#20313;&#20449;&#21495;&#37327;&#12290;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>remaining <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span>
            <span class="token function">compareAndSetState</span><span class="token punctuation">(</span>available<span class="token punctuation">,</span> remaining<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> remaining<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#19979;&#38754;&#25105;&#20204;&#20877;&#26469;&#30475;&#19968;&#19979; release &#30340;&#28304;&#20195;&#30721;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sync<span class="token punctuation">.</span><span class="token function">releaseShared</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#21487;&#20197;&#30475;&#21040;&#27599;&#27425;&#37322;&#25918;&#25968;&#37327;&#20026; 1&#12290;&#21478;&#22806;&#36824;&#26377;&#21487;&#20197;&#20256;&#20837; release &#36164;&#28304;&#25968;&#37327;&#30340;&#37325;&#36733;&#26041;&#27861;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     releaseShared &#20195;&#30721;&#22914;&#19979;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">releaseShared</span><span class="token punctuation">(</span><span class="token keyword">int</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">tryReleaseShared</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">doReleaseShared</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#35843;&#29992; tryReleaseShared &#26041;&#27861;&#36827;&#34892;&#36164;&#28304;&#37322;&#25918;&#65292;&#28982;&#21518;&#35843;&#29992; doReleaseShared &#26469;&#21457;&#36865;&#20449;&#21495;&#36890;&#30693;&#19979;&#19968;&#20010;&#33410;&#28857;&#26469;&#33719;&#21462;&#36164;&#28304;&#12290;tryReleaseShared &#30340;&#23454;&#29616;&#20063;&#22312; Semaphore &#20869;&#37096;&#38745;&#24577;&#31867; Sync &#20013;&#65292;&#22914;&#19979;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java"><span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">tryReleaseShared</span><span class="token punctuation">(</span><span class="token keyword">int</span> releases<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> current <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> next <span class="token operator">=</span> current <span class="token operator">+</span> releases<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">&lt;</span> current<span class="token punctuation">)</span> <span class="token comment">// overflow</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Maximum permit count exceeded"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">compareAndSetState</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#33719;&#21462;&#24403;&#21069;&#21097;&#20313;&#20449;&#21495;&#37327;&#35745;&#25968;&#65292;&#28982;&#21518;&#25226;&#37322;&#25918;&#30340;&#36164;&#28304;&#25968;&#37327;&#21152;&#22238;&#26469;&#12290;&#26368;&#21518;&#36890;&#36807; CAS &#26041;&#24335;&#21047;&#26032;&#20449;&#21495;&#37327;&#30340;&#35745;&#25968;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <h2 id="&#12289;&#24635;&#32467;" style="font-size: 30px;">
     4&#12289;&#24635;&#32467;
    </h2>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#20449;&#21495;&#37327;&#29992;&#26469;&#25511;&#21046;&#20849;&#20139;&#36164;&#28304;&#30340;&#35775;&#38382;&#25968;&#37327;&#12290;&#25152;&#20197;&#24456;&#36866;&#21512;&#25511;&#21046;&#26377; &#8220;&#27744;&#8221; &#27010;&#24565;&#30340;&#36164;&#28304;&#35775;&#38382;&#12290;&#22240;&#20026;&#27744;&#30340;&#24847;&#24605;&#23601;&#26159;&#27744;&#20869;&#26377;&#26377;&#38480;&#25968;&#37327;&#30340;&#36164;&#28304;&#21487;&#20197;&#20351;&#29992;&#12290;&#22914;&#26524;&#22312;&#27744;&#36825;&#20010;&#23618;&#38754;&#25277;&#35937;&#20026;&#19968;&#20010;&#36164;&#28304;&#26469;&#23545;&#24453;&#65292;&#37027;&#20040;&#20351;&#29992; Semaphore &#26469;&#20570;&#25511;&#21046;&#23601;&#38750;&#24120;&#21512;&#36866;&#12290;
    </p>
   </div>
   }
  </div>
 </div>
 <!-- &#20080;&#36807;&#30340;&#38405;&#35835; -->
 <div class="art-next-prev clearfix">
  <!-- &#24050;&#20080;&#19988;&#24320;&#25918; &#25110;&#32773;&#21487;&#20197;&#35797;&#35835; -->
  <a href="/read/49/article/963">
   <div class="prev l clearfix">
    <div class="icon l">
     <i class="imv2-arrow3_l">
     </i>
    </div>
    <p>
     29 &#19968;&#25163;&#20132;&#38065;&#65292;&#19968;&#25163;&#20132;&#36135;&#8212;Exchanger&#35814;&#35299;
    </p>
   </div>
  </a>
  <!-- &#24050;&#20080;&#19988;&#24320;&#25918; &#25110;&#32773;&#21487;&#20197;&#35797;&#35835; -->
  <a href="/read/49/article/965">
   <div class="next r clearfix">
    <p>
     31 &#20973;&#31080;&#21462;&#39184;&#8212;Future&#27169;&#24335;&#35814;&#35299;
    </p>
    <div class="icon r">
     <i class="imv2-arrow3_r">
     </i>
    </div>
   </div>
  </a>
 </div>
</div>

</div>

</div>
</div>

        </body>
        
        