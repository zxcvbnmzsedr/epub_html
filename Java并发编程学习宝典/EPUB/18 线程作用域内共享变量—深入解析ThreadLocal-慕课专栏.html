
        <html lang="en">
        <head>
        <meta charset="UTF-8"/>
        </head>
        <body>
        <div><div class="markdown-body">
    

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="style/style.css" type="text/css">

<div class="markdown-body">
    <div class="article-con">
 <!-- &#20080;&#36807;&#30340;&#38405;&#35835; -->
 <div class="art-title" style="margin-top: 0px;">
  18 &#32447;&#31243;&#20316;&#29992;&#22495;&#20869;&#20849;&#20139;&#21464;&#37327;&#8212;&#28145;&#20837;&#35299;&#26512;ThreadLocal
 </div>
 <div class="art-info clearfix">
  <span class="l">
   &#26356;&#26032;&#26102;&#38388;&#65306;2019-10-29 11:05:24
  </span>
 </div>
 <div class="art-top">
  <img alt="" src="EPUB/c00fadc2-186d-11ed-a978-acde48001122">
  <div class="famous-word-box">
   <img alt="" class="bg1 bg" src="EPUB/c025ea24-186d-11ed-a978-acde48001122">
   <img alt="" class="bg2 bg" src="EPUB/c043f2a8-186d-11ed-a978-acde48001122">
   <div class="famous-word">
    &#19968;&#20010;&#20154;&#36861;&#27714;&#30340;&#30446;&#26631;&#36234;&#39640;&#65292;&#20182;&#30340;&#25165;&#21147;&#23601;&#21457;&#23637;&#24471;&#36234;&#24555;&#65292;&#23545;&#31038;&#20250;&#23601;&#36234;&#26377;&#30410;&#12290;
    <p class="author">
     &#8212;&#8212;&#39640;&#23572;&#22522;
    </p>
   </div>
  </div>
 </div>
 <div class="art-content js-lookimg">
  <div id="article_content">
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#26412;&#31456;&#21069;&#38754;&#19977;&#33410;&#20998;&#21035;&#35762;&#35299;&#20102;&#32447;&#31243;&#21516;&#27493;&#30340;&#19977;&#31181;&#26041;&#24335;&#12290;&#26080;&#35770;&#26159;&#36731;&#37327;&#32423;&#30340;Atomic&#12289;volatile&#65292;&#36824;&#26159;synchronized&#65292;&#20854;&#23454;&#37117;&#26159;&#37319;&#29992;&#21516;&#27493;&#30340;&#26041;&#24335;&#35299;&#20915;&#20102;&#32447;&#31243;&#23433;&#20840;&#38382;&#39064;&#12290;&#26412;&#33410;&#25105;&#20204;&#23558;&#20171;&#32461;&#21478;&#22806;&#19968;&#31181;&#35299;&#20915;&#32447;&#31243;&#23433;&#20840;&#38382;&#39064;&#30340;&#24605;&#36335;&#65292;&#32447;&#31243;&#23553;&#38381;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#22914;&#26524;&#20320;&#26377;&#19968;&#20010;&#20840;&#23616;&#20849;&#20139;&#30340;&#21464;&#37327;&#65292;&#37027;&#20040;&#22810;&#32447;&#31243;&#24182;&#21457;&#30340;&#26102;&#20505;&#65292;&#23545;&#36825;&#20010;&#20849;&#20139;&#21464;&#37327;&#30340;&#35775;&#38382;&#26159;&#19981;&#23433;&#20840;&#30340;&#12290;&#26041;&#27861;&#20869;&#30340;&#23616;&#37096;&#21464;&#37327;&#26159;&#32447;&#31243;&#23433;&#20840;&#30340;&#65292;&#30001;&#20110;&#27599;&#20010;&#32447;&#31243;&#37117;&#20250;&#26377;&#33258;&#24049;&#30340;&#21103;&#26412;&#12290;&#20063;&#23601;&#26159;&#35828;&#23616;&#37096;&#21464;&#37327;&#34987;&#23553;&#38381;&#22312;&#32447;&#31243;&#20869;&#37096;&#65292;&#20854;&#23427;&#32447;&#31243;&#26080;&#27861;&#35775;&#38382;&#65288;&#24341;&#29992;&#22411;&#26377;&#25152;&#21306;&#21035;&#65289;&#12290;&#37027;&#20040;&#26377;&#27809;&#26377;&#20316;&#29992;&#22495;&#20171;&#20110;&#20004;&#32773;&#20043;&#38388;&#65292;&#26082;&#33021;&#20445;&#35777;&#32447;&#31243;&#23433;&#20840;&#65292;&#21448;&#19981;&#33267;&#20110;&#21482;&#23616;&#38480;&#20110;&#26041;&#27861;&#20869;&#37096;&#30340;&#26041;&#24335;&#21602;&#65311;&#31572;&#26696;&#26159;&#32943;&#23450;&#30340;&#65292;&#25105;&#20204;&#20351;&#29992;ThreadLocal&#23601;&#21487;&#20197;&#20570;&#21040;&#36825;&#19968;&#28857;&#12290;ThreadLocal&#21464;&#37327;&#30340;&#20316;&#29992;&#22495;&#26159;&#20026;&#32447;&#31243;&#65292;&#20063;&#23601;&#26159;&#35828;&#32447;&#31243;&#20869;&#36328;&#26041;&#27861;&#20849;&#20139;&#12290;&#20363;&#22914;&#26576;&#20010;&#23545;&#35937;&#30340;&#26041;&#27861;A&#23545;threadLocal&#21464;&#37327;&#36171;&#20540;&#65292;&#22312;&#21516;&#19968;&#20010;&#32447;&#31243;&#20013;&#30340;&#21478;&#22806;&#19968;&#20010;&#23545;&#35937;&#30340;&#26041;&#27861;B&#33021;&#22815;&#35835;&#21462;&#21040;&#35813;&#20540;&#12290;&#22240;&#20026;&#20316;&#29992;&#22495;&#20026;&#21516;&#19968;&#20010;&#32447;&#31243;&#65292;&#37027;&#20040;&#33258;&#28982;&#23601;&#26159;&#32447;&#31243;&#23433;&#20840;&#30340;&#12290;&#20294;&#26159;&#38656;&#35201;&#27880;&#24847;&#30340;&#26159;&#65292;&#22914;&#26524;threadLocal&#23384;&#20648;&#30340;&#26159;&#20849;&#20139;&#21464;&#37327;&#30340;&#24341;&#29992;&#65292;&#37027;&#20040;&#21516;&#26679;&#20250;&#26377;&#32447;&#31243;&#23433;&#20840;&#38382;&#39064;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <h2 id="&#12289;threadlocal-&#30340;&#20351;&#29992;&#22330;&#26223;" style="font-size: 30px;">
     1&#12289;ThreadLocal &#30340;&#20351;&#29992;&#22330;&#26223;
    </h2>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     ThreadLocal&#30340;&#29305;&#24615;&#20915;&#23450;&#20102;&#23427;&#30340;&#20351;&#29992;&#22330;&#26223;&#12290;&#30001;&#20110;ThreadLocal&#20013;&#23384;&#20648;&#30340;&#21464;&#37327;&#26159;&#32447;&#31243;&#38548;&#31163;&#30340;&#65292;&#25152;&#20197;&#19968;&#33324;&#22312;&#20197;&#19979;&#24773;&#20917;&#20351;&#29992;ThreadLocal&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     1&#12289;&#23384;&#20648;&#38656;&#35201;&#22312;&#32447;&#31243;&#38548;&#31163;&#30340;&#25968;&#25454;&#12290;&#27604;&#22914;&#32447;&#31243;&#25191;&#34892;&#30340;&#19978;&#19979;&#25991;&#20449;&#24687;&#65292;&#27599;&#20010;&#32447;&#31243;&#26159;&#19981;&#21516;&#30340;&#65292;&#20294;&#26159;&#23545;&#20110;&#21516;&#19968;&#20010;&#32447;&#31243;&#26469;&#35828;&#20250;&#20849;&#20139;&#21516;&#19968;&#20221;&#25968;&#25454;&#12290;Spring MVC&#30340; RequestContextHolder &#30340;&#23454;&#29616;&#23601;&#26159;&#20351;&#29992;&#20102;ThreadLocal&#65307;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     2&#12289;&#36328;&#23618;&#20256;&#36882;&#21442;&#25968;&#12290;&#23618;&#27425;&#21010;&#20998;&#22312;&#36719;&#20214;&#35774;&#35745;&#20013;&#21313;&#20998;&#24120;&#35265;&#12290;&#23618;&#27425;&#21010;&#20998;&#21518;&#65292;&#20307;&#29616;&#22312;&#20195;&#30721;&#23618;&#38754;&#23601;&#26159;&#27599;&#23618;&#36127;&#36131;&#19981;&#21516;&#32844;&#36131;&#65292;&#19968;&#20010;&#23436;&#25972;&#30340;&#19994;&#21153;&#25805;&#20316;&#65292;&#20250;&#30001;&#19968;&#31995;&#21015;&#19981;&#21516;&#23618;&#30340;&#31867;&#30340;&#26041;&#27861;&#35843;&#29992;&#20018;&#36215;&#26469;&#23436;&#25104;&#12290;&#26377;&#20123;&#26102;&#20505;&#31532;&#19968;&#23618;&#33719;&#24471;&#30340;&#19968;&#20010;&#21464;&#37327;&#20540;&#21487;&#33021;&#22312;&#31532;&#19977;&#23618;&#12289;&#29978;&#33267;&#26356;&#28145;&#23618;&#30340;&#26041;&#27861;&#20013;&#25165;&#20250;&#34987;&#20351;&#29992;&#12290;&#22914;&#26524;&#25105;&#20204;&#19981;&#20511;&#21161;ThreadLocal&#65292;&#23601;&#21482;&#33021;&#19968;&#23618;&#23618;&#22320;&#36890;&#36807;&#26041;&#27861;&#21442;&#25968;&#36827;&#34892;&#20256;&#36882;&#12290;&#20351;&#29992;ThreadLocal&#21518;&#65292;&#22312;&#31532;&#19968;&#23618;&#25226;&#21464;&#37327;&#20540;&#20445;&#23384;&#21040;ThreadLocal&#20013;&#65292;&#22312;&#20351;&#29992;&#30340;&#23618;&#27425;&#26041;&#27861;&#20013;&#30452;&#25509;&#20174;ThreadLocal&#20013;&#21462;&#20986;&#65292;&#32780;&#19981;&#29992;&#20316;&#20026;&#21442;&#25968;&#22312;&#19981;&#21516;&#26041;&#27861;&#20013;&#20256;&#26469;&#20256;&#21435;&#12290;&#19981;&#36807;&#21315;&#19975;&#19981;&#35201;&#28389;&#29992;ThreadLocal&#65292;&#23427;&#30340;&#26412;&#24847;&#24182;&#19981;&#26159;&#29992;&#26469;&#36328;&#26041;&#27861;&#20849;&#20139;&#21464;&#37327;&#30340;&#12290;&#32467;&#21512;&#31532;&#19968;&#31181;&#24773;&#20917;&#65292;&#25105;&#20204;&#25918;&#20837;ThreadLocal&#36328;&#23618;&#20256;&#36882;&#30340;&#21464;&#37327;&#19968;&#33324;&#20063;&#26159;&#20855;&#26377;&#19978;&#19979;&#25991;&#23646;&#24615;&#30340;&#12290;&#27604;&#22914;&#29992;&#25143;&#30340;&#20449;&#24687;&#31561;&#12290;&#36825;&#26679;&#25105;&#20204;&#22312;AOP&#22788;&#29702;&#24322;&#24120;&#25110;&#32773;&#20854;&#20182;&#25805;&#20316;&#26102;&#21487;&#20197;&#24456;&#26041;&#20415;&#22320;&#33719;&#21462;&#24403;&#21069;&#30331;&#24405;&#29992;&#25143;&#30340;&#20449;&#24687;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <h2 id="&#12289;&#22914;&#20309;&#20351;&#29992;-threadlocal" style="font-size: 30px;">
     2&#12289;&#22914;&#20309;&#20351;&#29992; ThreadLocal
    </h2>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     ThreadLocal&#20351;&#29992;&#36215;&#26469;&#38750;&#24120;&#31616;&#21333;&#65292;&#25105;&#20204;&#20808;&#30475;&#19968;&#20010;&#31616;&#21333;&#30340;&#20363;&#23376;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#21487;&#20197;&#30475;&#21040;&#27599;&#20010;&#32447;&#31243;&#20026;&#21516;&#19968;&#20010;ThreadLocal&#23545;&#35937;set&#19981;&#21516;&#30340;&#20540;&#65292;&#20294;&#21508;&#20010;&#32447;&#31243;&#25171;&#21360;&#20986;&#26469;&#30340;&#20381;&#26087;&#26159;&#33258;&#24049;&#20445;&#23384;&#36827;&#21435;&#30340;&#20540;&#65292;&#24182;&#27809;&#26377;&#34987;&#20854;&#23427;&#32447;&#31243;&#25152;&#35206;&#30422;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#19968;&#33324;&#26469;&#35828;&#65292;&#22312;&#23454;&#36341;&#20013;&#65292;&#25105;&#20204;&#20250;&#25226;ThreadLocal&#23545;&#35937;&#22768;&#21517;&#20026;static final&#65292;&#20316;&#20026;&#31169;&#26377;&#21464;&#37327;&#23553;&#35013;&#21040;&#33258;&#23450;&#20041;&#30340;&#31867;&#20013;&#12290;&#21478;&#22806;&#25552;&#20379;static&#30340;set&#21644;get&#26041;&#27861;&#12290;&#22914;&#19979;&#38754;&#30340;&#20195;&#30721;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">OperationInfoRecorder</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> ThreadLocal<span class="token operator">&lt;</span>OperationInfoDTO<span class="token operator">&gt;</span> THREAD_LOCAL <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocal</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token function">OperationInfoRecorder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> OperationInfoDTO <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> THREAD_LOCAL<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span>OperationInfoDTO operationInfoDTO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        THREAD_LOCAL<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>operationInfoDTO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        THREAD_LOCAL<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#36825;&#26679;&#20570;&#30340;&#30446;&#30340;&#26377;&#20108;:
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     1&#12289;static &#30830;&#20445;&#20840;&#23616;&#21482;&#26377;&#19968;&#20010;&#20445;&#23384;OperationInfoDTO&#23545;&#35937;&#30340;ThreadLocal&#23454;&#20363;&#65307;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     2&#12289;final &#30830;&#20445;ThreadLocal&#30340;&#23454;&#20363;&#19981;&#21487;&#26356;&#25913;&#12290;&#38450;&#27490;&#34987;&#24847;&#22806;&#25913;&#21464;&#65292;&#23548;&#33268;&#25918;&#20837;&#30340;&#20540;&#21644;&#21462;&#20986;&#26469;&#30340;&#19981;&#19968;&#33268;&#12290;&#21478;&#22806;&#36824;&#33021;&#38450;&#27490;ThreadLocal&#30340;&#20869;&#23384;&#27844;&#28431;&#65292;&#20855;&#20307;&#21407;&#22240;&#19979;&#25991;&#20013;&#20250;&#26377;&#35762;&#35299;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#20351;&#29992;&#30340;&#26102;&#20505;&#21487;&#20197;&#22312;&#20219;&#20309;&#26041;&#27861;&#30340;&#20219;&#20309;&#20301;&#32622;&#35843;&#29992;OperationInfoRecorder&#30340;set&#25110;&#32773;get&#26041;&#27861;&#65292;&#20445;&#23384;&#21644;&#21462;&#20986;&#12290;&#22914;&#19979;&#38754;&#20195;&#30721;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre><code>OperationInfoRecorder.set(operationInfoDTO)
OperationInfoRecorder.get()
</code></pre>
   </div>
   <div class="cl-preview-section">
    <h2 id="&#12289;threadlocal&#28304;&#20195;&#30721;&#35299;&#26512;" style="font-size: 30px;">
     3&#12289;ThreadLocal&#28304;&#20195;&#30721;&#35299;&#26512;
    </h2>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#23398;&#20064;&#21040;&#36825;&#37324;&#65292;&#20320;&#19968;&#23450;&#24456;&#22909;&#22855;ThreadLocal&#26159;&#22914;&#20309;&#20570;&#21040;&#22810;&#20010;&#32447;&#31243;&#23545;&#21516;&#19968;&#20010;&#23545;&#35937;set&#25805;&#20316;&#65292;&#20294;&#21482;&#20250;get&#20986;&#33258;&#24049;set&#36827;&#21435;&#30340;&#20540;&#21602;&#65311;&#36825;&#20010;&#29616;&#35937;&#26377;&#28857;&#36829;&#32972;&#25105;&#20204;&#30340;&#35748;&#30693;&#12290;&#25509;&#19979;&#26469;&#25105;&#20204;&#23601;&#20174;set&#26041;&#27861;&#20837;&#25163;&#65292;&#26469;&#30475;&#30475;ThreadLocal&#30340;&#28304;&#20195;&#30721;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java">   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span>T value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Thread t <span class="token operator">=</span> Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ThreadLocalMap map <span class="token operator">=</span> <span class="token function">getMap</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>map <span class="token operator">!=</span> null<span class="token punctuation">)</span>
            map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            <span class="token function">createMap</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#19968;&#30524;&#30475;&#36807;&#21435;&#65292;&#19968;&#19979;&#23601;&#21487;&#20197;&#30475;&#21040;map&#12290;&#27809;&#38169;&#65292;&#22914;&#26524;ThreadLocal&#33021;&#22815;&#20445;&#23384;&#22810;&#20010;&#32447;&#31243;&#30340;&#21464;&#37327;&#20540;&#65292;&#37027;&#20040;&#23427;&#19968;&#23450;&#26159;&#20511;&#21161;&#23481;&#22120;&#26469;&#23454;&#29616;&#30340;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#36825;&#20010;map&#19981;&#26159;&#19968;&#33324;&#30340;map&#65292;&#21487;&#20197;&#30475;&#21040;&#23427;&#26159;&#36890;&#36807;&#24403;&#21069;&#32447;&#31243;&#23545;&#35937;&#33719;&#21462;&#21040;&#30340;ThreadLocalMap&#12290;&#30475;&#21040;&#36825;&#37324;&#24212;&#35813;&#30475;&#20986;&#20123;&#31471;&#20522;&#65292;&#36825;&#20010;map&#20854;&#23454;&#26159;&#21644;Thread&#32465;&#23450;&#30340;&#12290;&#25509;&#19979;&#26469;&#25105;&#20204;&#30475;getMap&#26041;&#27861;&#30340;&#20195;&#30721;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java">    ThreadLocalMap <span class="token function">getMap</span><span class="token punctuation">(</span>Thread t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> t<span class="token punctuation">.</span>threadLocals<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#21407;&#26469;&#36825;&#20010;ThreadLocal&#23601;&#23384;&#26041;&#27861;Thread&#23545;&#35937;&#19978;&#12290;&#19979;&#38754;&#25105;&#20204;&#30475;&#30475;Thread&#20013;&#30340;&#30456;&#20851;&#20195;&#30721;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java">    <span class="token comment">/* ThreadLocal values pertaining to this thread. This map is maintained
     * by the ThreadLocal class. */</span>
    ThreadLocal<span class="token punctuation">.</span>ThreadLocalMap threadLocals <span class="token operator">=</span> null<span class="token punctuation">;</span>
</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#27880;&#37322;&#20013;&#20889;&#30340;&#24456;&#28165;&#26970;&#65292;&#36825;&#20010;&#23646;&#24615;&#30001;ThreadLocal&#26469;&#32500;&#25252;&#12290;threadLocals&#30340;&#35775;&#38382;&#25511;&#21046;&#20915;&#23450;&#22312;&#21253;&#22806;&#26159;&#26080;&#27861;&#30452;&#25509;&#35775;&#38382;&#30340;&#12290;&#25152;&#20197;&#25105;&#20204;&#22312;&#20351;&#29992;&#30340;&#26102;&#20505;&#21482;&#33021;&#36890;&#36807;ThreadLocal&#23545;&#35937;&#26469;&#35775;&#38382;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     set&#26102;&#65292;&#20250;&#25226;&#24403;&#21069;threadLocal&#23545;&#35937;&#20316;&#20026;key&#65292;&#20320;&#24819;&#35201;&#20445;&#23384;&#30340;&#23545;&#35937;&#20316;&#20026;value&#65292;&#23384;&#20837;map&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#30475;&#21040;&#36825;&#37324;&#65292;&#25105;&#20204;&#22823;&#33267;&#24050;&#32463;&#29702;&#28165;&#20102;ThreadLocal&#21644;Thread&#30340;&#20851;&#31995;&#65292;&#25105;&#20204;&#30475;&#19979;&#22270;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     <img alt="&#22270;&#29255;&#25551;&#36848;" class="" data-original="//img.mukewang.com/5db79dc30001b6b008800515.jpg" src="EPUB/c062aacc-186d-11ed-a978-acde48001122">
     <br>
     &#25105;&#20204;&#25509;&#19979;&#26469;&#20998;&#26512;get&#26041;&#27861;&#65292;&#20195;&#30721;&#22914;&#19979;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java"><span class="token keyword">public</span> T <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Thread t <span class="token operator">=</span> Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ThreadLocalMap map <span class="token operator">=</span> <span class="token function">getMap</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>map <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ThreadLocalMap<span class="token punctuation">.</span>Entry e <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">getEntry</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>
      T result <span class="token operator">=</span> <span class="token punctuation">(</span>T<span class="token punctuation">)</span>e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
      <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">setInitialValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     get&#26041;&#27861;&#20063;&#26159;&#20808;&#21462;&#24471;&#24403;&#21069;&#32447;&#31243;&#23545;&#35937;&#20013;&#20445;&#23384;&#30340;ThreadLocalMap&#23545;&#35937;&#65292;&#28982;&#21518;&#20351;&#29992;&#24403;&#21069;threadLocal&#23545;&#35937;&#20174;map&#20013;&#21462;&#24471;&#30456;&#24212;&#30340;value&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#27599;&#20010;Thread&#30340;ThreadMap&#20197;threadLocal&#20316;&#20026;key&#65292;&#20445;&#23384;&#33258;&#24049;&#32447;&#31243;&#30340;value&#21103;&#26412;&#12290;&#25105;&#20204;&#21487;&#20197;&#36825;&#20040;&#26469;&#29702;&#35299;ThreadLocal&#65292;&#20854;&#23454;ThreadLocal&#23545;&#35937;&#26159;&#20320;&#35201;&#30495;&#27491;&#20445;&#23384;&#23545;&#35937;&#30340;&#36523;&#20221;&#20195;&#34920;&#12290;&#32780;&#36825;&#20010;&#36523;&#20221;&#22312;&#27599;&#20010;&#32447;&#31243;&#20013;&#23545;&#24212;&#30340;&#20540;&#65292;&#20854;&#23454;&#26159;&#20445;&#23384;&#22312;&#27599;&#20010;&#32447;&#31243;&#20013;&#65292;&#24182;&#27809;&#26377;&#20445;&#23384;&#22312;ThreadLocal&#23545;&#35937;&#20013;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#36825;&#37324;&#21487;&#20197;&#20030;&#20010;&#20363;&#23376;&#65292;&#23398;&#26657;&#37324;&#35201;&#27599;&#29677;&#35780;&#36873;&#19968;&#21517;&#23398;&#20064;&#26631;&#20853;&#65292;&#19968;&#21517;&#36947;&#24503;&#26631;&#20853;&#12290;&#29677;&#20027;&#20219;&#20250;&#36827;&#34892;&#35780;&#36873;&#28982;&#21518;&#35760;&#24405;&#19979;&#26469;&#12290;&#23398;&#29983;&#26631;&#20853;&#21450;&#36947;&#24503;&#26631;&#20853;&#30340;&#36523;&#20221;&#23601;&#26159;&#20004;&#20010;ThreadLocal&#23545;&#35937;&#65292;&#32780;&#27599;&#20010;&#29677;&#20027;&#20219;&#26159;&#19968;&#20010;&#32447;&#31243;&#65292;&#35760;&#24405;&#30340;&#35780;&#36873;&#32467;&#26524;&#30340;&#23567;&#26412;&#23376;&#23601;&#26159;ThreadLocalMap&#23545;&#35937;&#12290;&#27599;&#20010;&#29677;&#20027;&#20219;&#20250;&#22312;&#33258;&#24049;&#30340;&#23567;&#26412;&#23376;&#19978;&#35760;&#24405;&#19979;&#35780;&#36873;&#32467;&#26524;&#65292;&#27604;&#22914;&#35828;&#19968;&#29677;&#29677;&#20027;&#20219;&#35760;&#24405;&#65306;&#36947;&#24503;&#26631;&#20853;&#65306;&#23567;&#26126;&#65292;&#23398;&#20064;&#26631;&#20853;&#65306;&#23567;&#32418;&#12290;&#20108;&#29677;&#29677;&#20027;&#20219;&#35760;&#24405;&#65306;&#36947;&#24503;&#26631;&#20853;&#65306;&#23567;&#36213;&#65292;&#23398;&#20064;&#26631;&#20853;&#65306;&#23567;&#23721;&#12290;&#36890;&#36807;&#36825;&#20010;&#20363;&#23376;&#22823;&#23478;&#24212;&#35813;&#24456;&#28165;&#26970;ThreadLocal&#30340;&#21407;&#29702;&#20102;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     ThreadLocal&#30340;&#35774;&#35745;&#30495;&#30340;&#38750;&#24120;&#24039;&#22937;&#65292;&#30475;&#20284;&#33258;&#24049;&#20445;&#23384;&#20102;&#27599;&#20010;&#32447;&#31243;&#30340;&#21464;&#37327;&#21103;&#26412;&#65292;&#20854;&#23454;&#27599;&#20010;&#32447;&#31243;&#30340;&#21464;&#37327;&#21103;&#26412;&#26159;&#20445;&#23384;&#22312;&#32447;&#31243;&#23545;&#35937;&#20013;&#65292;&#37027;&#20040;&#33258;&#28982;&#23601;&#32447;&#31243;&#38548;&#31163;&#20102;&#12290;&#22914;&#27492;&#20998;&#26512;&#36215;&#26469;&#65292;&#26159;&#19981;&#26159;&#26377;&#19968;&#31181;ThreadLocal&#27809;&#20570;&#20160;&#20040;&#20107;&#24773;&#65292;&#21364;&#25250;&#20102;&#22836;&#21151;&#30340;&#24863;&#35273;&#65311;&#20854;&#23454;&#19981;&#28982;&#12290;Thread&#23545;&#35937;&#20013;&#29992;&#26469;&#20445;&#23384;&#21464;&#37327;&#21103;&#26412;&#30340;ThreadLocalMap&#30340;&#23450;&#20041;&#23601;&#22312;ThreadLocal&#20013;&#12290;&#25105;&#20204;&#25509;&#19979;&#26469;&#20998;&#26512;ThreadLocalMap&#30340;&#28304;&#20195;&#30721;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <h2 id="&#12289;threadlocalmap&#20998;&#26512;" style="font-size: 30px;">
     4&#12289;ThreadLocalMap&#20998;&#26512;
    </h2>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     ThreadLocalMap&#26159;ThreadLocal&#30340;&#38745;&#24577;&#20869;&#37096;&#31867;&#65292;&#25105;&#20204;&#21333;&#29420;&#19968;&#23567;&#33410;&#26469;&#35762;&#35299;&#23427;&#12290;ThreadLocalMap&#30340;&#21151;&#33021;&#20854;&#23454;&#26159;&#21644;HashMap&#31867;&#20284;&#30340;&#65292;&#20294;&#26159;&#20026;&#20160;&#20040;&#19981;&#30452;&#25509;&#20351;&#29992;HashMap&#21602;&#65311;&#729;&#22312;ThreadLocalMap&#20013;&#20351;&#29992;WeakReference&#21253;&#35013;&#21518;&#30340;ThreadLocal&#23545;&#35937;&#20316;&#20026;key&#65292;&#20063;&#23601;&#26159;&#35828;&#36825;&#37324;&#23545;ThreadLocal&#23545;&#35937;&#20026;&#24369;&#24341;&#29992;&#12290;&#24403;ThreadLocal&#23545;&#35937;&#22312;ThreadLocalMap&#24341;&#29992;&#20043;&#22806;&#65292;&#20877;&#26080;&#20854;&#20182;&#24341;&#29992;&#30340;&#26102;&#20505;&#33021;&#22815;&#34987;&#22403;&#22334;&#22238;&#25910;&#12290;&#22914;&#19979;&#38754;&#20195;&#30721;&#25152;&#31034;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java"><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Entry</span> <span class="token keyword">extends</span> <span class="token class-name">WeakReference</span><span class="token operator">&lt;</span>ThreadLocal<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">/** The value associated with this ThreadLocal. */</span>
            Object value<span class="token punctuation">;</span>

            <span class="token function">Entry</span><span class="token punctuation">(</span>ThreadLocal<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;</span> k<span class="token punctuation">,</span> Object v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">super</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
                value <span class="token operator">=</span> v<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#36825;&#26679;&#20570;&#20250;&#24102;&#26469;&#26032;&#30340;&#38382;&#39064;&#12290;&#22914;&#26524;ThreadLocal&#23545;&#35937;&#34987;&#22238;&#25910;&#65292;&#37027;&#20040;ThreadLocalMap&#20013;&#20445;&#23384;&#30340;key&#20540;&#23601;&#21464;&#25104;&#20102;null&#65292;&#32780;value&#20250;&#19968;&#30452;&#34987;Entry&#24341;&#29992;&#65292;&#32780;Entry&#21448;&#34987;threadLocalMap&#23545;&#35937;&#24341;&#29992;&#65292;threadLocalMap&#23545;&#35937;&#21448;&#34987;Thread&#23545;&#35937;&#25152;&#24341;&#29992;&#65292;&#37027;&#20040;&#24403;Thread&#19968;&#30452;&#19981;&#32456;&#32467;&#30340;&#35805;&#65292;value&#23545;&#35937;&#23601;&#20250;&#19968;&#30452;&#39547;&#30041;&#22312;&#20869;&#23384;&#20013;&#65292;&#30452;&#33267;Thread&#34987;&#38144;&#27585;&#21518;&#65292;&#25165;&#20250;&#34987;&#22238;&#25910;&#12290;&#36825;&#23601;&#26159;ThreadLocal&#24341;&#36215;&#20869;&#23384;&#27844;&#28431;&#38382;&#39064;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#32780;ThreadLocalMap&#22312;&#35774;&#35745;&#30340;&#26102;&#20505;&#20063;&#32771;&#34385;&#21040;&#36825;&#19968;&#28857;&#65292;&#22312;get&#21644;set&#30340;&#26102;&#20505;&#65292;&#20250;&#25226;&#36935;&#21040;&#30340;key&#20026;null&#30340;entry&#28165;&#29702;&#25481;&#12290;&#19981;&#36807;&#36825;&#26679;&#20570;&#20063;&#19981;&#33021;100%&#20445;&#35777;&#33021;&#22815;&#28165;&#29702;&#24178;&#20928;&#12290;&#25105;&#20204;&#21487;&#20197;&#36890;&#36807;&#20197;&#19979;&#20004;&#31181;&#26041;&#24335;&#26469;&#36991;&#20813;&#36825;&#20010;&#38382;&#39064;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     1&#12289;&#25226;ThreadLocal&#23545;&#35937;&#22768;&#26126;&#20026;static&#65292;&#36825;&#26679;ThreadLocal&#25104;&#20026;&#20102;&#31867;&#21464;&#37327;&#65292;&#29983;&#21629;&#21608;&#26399;&#19981;&#26159;&#21644;&#23545;&#35937;&#32465;&#23450;&#65292;&#32780;&#26159;&#21644;&#31867;&#32465;&#23450;&#65292;&#24310;&#38271;&#20102;&#22768;&#26126;&#21608;&#26399;&#65292;&#36991;&#20813;&#20102;&#34987;&#22238;&#25910;&#65307;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     2&#12289;&#22312;&#20351;&#29992;&#23436;ThreadLocal&#21464;&#37327;&#21518;&#65292;&#25163;&#21160;remove&#25481;&#65292;&#38450;&#27490;ThreadLocalMap&#20013;Entry&#19968;&#30452;&#20445;&#25345;&#23545;value&#30340;&#24378;&#24341;&#29992;&#12290;&#23548;&#33268;value&#19981;&#33021;&#34987;&#22238;&#25910;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <h2 id="&#12289;&#24635;&#32467;" style="font-size: 30px;">
     4&#12289;&#24635;&#32467;
    </h2>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#36890;&#36807;&#26412;&#33410;&#23398;&#20064;&#65292;&#25105;&#20204;&#25484;&#25569;&#20102;ThreadLocal &#30340;&#21407;&#29702;&#21644;&#20854;&#20351;&#29992;&#22330;&#26223;&#12290;&#32477;&#22823;&#22810;&#25968;&#24773;&#20917;&#19979;&#65292;ThreadLocal&#29992;&#20110;&#23384;&#20648;&#21644;&#32447;&#31243;&#30456;&#20851;&#30340;&#19978;&#19979;&#25991;&#20449;&#24687;&#65292;&#20063;&#23601;&#26159;&#32447;&#31243;&#20849;&#20139;&#30340;&#20449;&#24687;&#65292;&#20415;&#20110;&#21516;&#19968;&#32447;&#31243;&#30340;&#19981;&#21516;&#26041;&#27861;&#20013;&#21462;&#20540;&#65292;&#32780;&#19981;&#29992;&#20316;&#20026;&#26041;&#27861;&#21442;&#25968;&#23618;&#23618;&#20256;&#36882;&#12290;
    </p>
   </div>
   }
  </div>
 </div>
 <!-- &#20080;&#36807;&#30340;&#38405;&#35835; -->
 <div class="art-next-prev clearfix">
  <!-- &#24050;&#20080;&#19988;&#24320;&#25918; &#25110;&#32773;&#21487;&#20197;&#35797;&#35835; -->
  <a href="/read/49/article/952">
   <div class="prev l clearfix">
    <div class="icon l">
     <i class="imv2-arrow3_l">
     </i>
    </div>
    <p>
     17 &#36164;&#28304;&#26377;&#38480;&#65292;&#35831;&#25490;&#38431;&#31561;&#20505;&#8212;Synchronized&#20351;&#29992;&#12289;&#21407;&#29702;&#21450;&#32570;&#38519;
    </p>
   </div>
  </a>
  <!-- &#24050;&#20080;&#19988;&#24320;&#25918; &#25110;&#32773;&#21487;&#20197;&#35797;&#35835; -->
  <a href="/read/49/article/954">
   <div class="next r clearfix">
    <p>
     19 &#33258;&#24049;&#21160;&#25163;&#20016;&#34915;&#36275;&#39135;&#8212;&#31616;&#21333;&#32447;&#31243;&#27744;&#23454;&#29616;
    </p>
    <div class="icon r">
     <i class="imv2-arrow3_r">
     </i>
    </div>
   </div>
  </a>
 </div>
</div>

</div>

</div>
</div>

        </body>
        
        