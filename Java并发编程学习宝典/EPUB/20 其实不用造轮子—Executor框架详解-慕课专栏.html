
        <html lang="en">
        <head>
        <meta charset="UTF-8"/>
        </head>
        <body>
        <div><div class="markdown-body">
    

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="style/style.css" type="text/css">

<div class="markdown-body">
    <div class="article-con">
 <!-- &#20080;&#36807;&#30340;&#38405;&#35835; -->
 <div class="art-title" style="margin-top: 0px;">
  20 &#20854;&#23454;&#19981;&#29992;&#36896;&#36718;&#23376;&#8212;Executor&#26694;&#26550;&#35814;&#35299;
 </div>
 <div class="art-info clearfix">
  <span class="l">
   &#26356;&#26032;&#26102;&#38388;&#65306;2019-11-05 10:29:05
  </span>
 </div>
 <div class="art-top">
  <img alt="" src="EPUB/c1867244-186d-11ed-a978-acde48001122">
  <div class="famous-word-box">
   <img alt="" class="bg1 bg" src="EPUB/c19f0d54-186d-11ed-a978-acde48001122">
   <img alt="" class="bg2 bg" src="EPUB/c1bad908-186d-11ed-a978-acde48001122">
   <div class="famous-word">
    &#20154;&#30340;&#19968;&#29983;&#21487;&#33021;&#29123;&#28903;&#20063;&#21487;&#33021;&#33104;&#26429;&#65292;&#25105;&#19981;&#33021;&#33104;&#26429;&#65292;&#25105;&#24895;&#24847;&#29123;&#28903;&#36215;&#26469;&#65281;
    <p class="author">
     &#8212;&#8212;&#22885;&#26031;&#29305;&#27931;&#22827;&#26031;&#22522;
    </p>
   </div>
  </div>
 </div>
 <div class="art-content js-lookimg">
  <div id="article_content">
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#19978;&#19968;&#33410;&#25105;&#20204;&#21160;&#25163;&#23454;&#29616;&#20102;&#19968;&#20010;&#38750;&#24120;&#31616;&#21333;&#30340;&#32447;&#31243;&#27744;&#12290;&#20854;&#23454; JDK &#24050;&#32463;&#20026;&#25105;&#20204;&#20934;&#22791;&#20102;&#21151;&#33021;&#20016;&#23500;&#30340;&#32447;&#31243;&#27744;&#24037;&#20855;&#12290;&#26412;&#31456;&#25105;&#20204;&#23601;&#26469;&#23398;&#20064;&#19968;&#19979; JDK &#20013;&#30340;&#32447;&#31243;&#27744;&#8212;Executor &#26694;&#26550;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <h2 id="&#12289;executor-&#26694;&#26550;&#30340;&#20351;&#29992;" style="font-size: 30px;">
     1&#12289;Executor &#26694;&#26550;&#30340;&#20351;&#29992;
    </h2>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#25105;&#20204;&#39318;&#20808;&#26469;&#30475;&#30475; Executor &#26694;&#26550;&#26159;&#22914;&#20309;&#23454;&#29992;&#30340;&#12290;&#30475;&#22914;&#19979;&#20195;&#30721;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> Executor executor <span class="token operator">=</span> Executors<span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Stream<span class="token punctuation">.</span><span class="token function">iterate</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> item <span class="token operator">-</span><span class="token operator">&gt;</span> item <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
                    executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
                        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" hello!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#21487;&#20197;&#30475;&#21040;&#22312;&#20351;&#29992;&#19978;&#21644;&#25105;&#20204;&#33258;&#24049;&#23454;&#29616;&#30340;&#32447;&#31243;&#27744;&#20960;&#20046;&#19968;&#27169;&#19968;&#26679;&#12290;&#21482;&#19981;&#36807;&#22312;&#22768;&#26126; Executor &#30340;&#26102;&#20505;&#65292;&#27809;&#26377;&#30452;&#25509; new &#23545;&#35937;&#12290;&#32780;&#26159;&#36890;&#36807;Executors&#30340;&#38745;&#24577;&#26041;&#27861; newFixedThreadPool &#26469;&#21019;&#24314; Executor&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#32780;&#25191;&#34892;&#20219;&#21153;&#30340;&#26041;&#24335;&#21017;&#26159;&#21644;&#25105;&#20204;&#33258;&#24049;&#23454;&#29616;&#30340;&#19968;&#27169;&#19968;&#26679;&#12290;&#37117;&#26159;&#35843;&#29992; executor &#26041;&#27861;&#65292;&#20256;&#20837; Runnable &#25509;&#21475;&#30340;&#23454;&#29616;&#65292;&#20063;&#23601;&#26159;&#36816;&#34892;&#30340;&#36923;&#36753;&#12290;&#37027;&#20040;&#23427;&#30340;&#20869;&#37096;&#23454;&#29616;&#26159;&#21542;&#20063;&#21644;&#25105;&#20204;&#23454;&#29616;&#30340;&#19968;&#26679;&#21602;&#65311;&#20808;&#21035;&#24613;&#65292;&#25105;&#20204;&#19968;&#28857;&#28857;&#23637;&#24320;&#26469;&#20998;&#26512;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <h2 id="&#12289;executor-&#26694;&#26550;&#35774;&#35745;&#31616;&#20171;" style="font-size: 30px;">
     2&#12289;Executor &#26694;&#26550;&#35774;&#35745;&#31616;&#20171;
    </h2>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#25105;&#20204;&#20808;&#26469;&#30475;&#19979;Executor&#26694;&#26550;&#30340;&#32487;&#25215;&#20851;&#31995;&#65306;
     <br>
     <img alt="&#22270;&#29255;&#25551;&#36848;" class="" data-original="//img.mukewang.com/5dba76b6000189b606480516.jpg" src="EPUB/c1d49e60-186d-11ed-a978-acde48001122">
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     <strong>
      1&#12289;Executor
     </strong>
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#21487;&#20197;&#30475;&#21040;&#26368;&#39030;&#23618;&#26159; Executor &#30340;&#25509;&#21475;&#12290;&#36825;&#20010;&#25509;&#21475;&#24456;&#31616;&#21333;&#65292;&#21482;&#26377;&#19968;&#20010; execute &#26041;&#27861;&#12290;&#27492;&#25509;&#21475;&#30340;&#30446;&#30340;&#26159;&#20026;&#20102;&#25226;&#20219;&#21153;&#25552;&#20132;&#21644;&#20219;&#21153;&#25191;&#34892;&#35299;&#32806;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     <strong>
      2&#12289;ExecutorService
     </strong>
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#36825;&#36824;&#26159;&#19968;&#20010;&#25509;&#21475;&#65292;&#32487;&#25215;&#33258; Executor&#65292;&#23427;&#25193;&#23637;&#20102; Executor &#25509;&#21475;&#65292;&#23450;&#20041;&#20102;&#26356;&#22810;&#32447;&#31243;&#27744;&#30456;&#20851;&#30340;&#25805;&#20316;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     <strong>
      3&#12289;AbstractExecutorService
     </strong>
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#25552;&#20379;&#20102; ExecutorService &#30340;&#37096;&#20998;&#40664;&#35748;&#23454;&#29616;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     <strong>
      4&#12289;ThreadPoolExecutor
     </strong>
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#23454;&#38469;&#19978;&#25105;&#20204;&#20351;&#29992;&#30340;&#32447;&#31243;&#27744;&#30340;&#23454;&#29616;&#26159; ThreadPoolExecutor&#12290;&#23427;&#23454;&#29616;&#20102;&#32447;&#31243;&#27744;&#24037;&#20316;&#30340;&#23436;&#25972;&#26426;&#21046;&#12290;&#20063;&#26159;&#25105;&#20204;&#25509;&#19979;&#26469;&#20998;&#26512;&#30340;&#37325;&#28857;&#23545;&#35937;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     <strong>
      5&#12289;ForkJoinPool
     </strong>
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#23454;&#29616; Fork/Join &#27169;&#24335;&#30340;&#32447;&#31243;&#27744;&#65292;&#21518;&#38754;&#20250;&#26377;&#23567;&#33410;&#19987;&#38376;&#35762;&#35299;&#12290;&#26412;&#33410;&#19981;&#20570;&#28145;&#20837;&#20998;&#26512;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     <strong>
      6&#12289;ScheduledExecutorService
     </strong>
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#36825;&#20010;&#25509;&#21475;&#25193;&#23637;&#20102;ExecutorService&#65292;&#23450;&#20041;&#20010;&#24310;&#36831;&#25191;&#34892;&#21644;&#21608;&#26399;&#24615;&#25191;&#34892;&#20219;&#21153;&#30340;&#26041;&#27861;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     <strong>
      7&#12289;ScheduledThreadPoolExecutor
     </strong>
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#27492;&#25509;&#21475;&#21017;&#26159;&#22312;&#32487;&#25215; ThreadPoolExecutor &#30340;&#22522;&#30784;&#19978;&#23454;&#29616; ScheduledExecutorService &#25509;&#21475;&#65292;&#25552;&#20379;&#23450;&#26102;&#21644;&#21608;&#26399;&#25191;&#34892;&#20219;&#21153;&#30340;&#29305;&#24615;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     <strong>
      Executors
     </strong>
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     Executor &#26694;&#26550;&#36824;&#25552;&#20379; Executors &#23545;&#35937;&#12290;&#27880;&#24847;&#30475;&#36825;&#20010;&#23545;&#35937;&#27604; Executor &#25509;&#21475;&#21518;&#38754;&#23545;&#20102;&#20010; s&#65292;&#35201;&#21306;&#20998;&#24320;&#65292;&#19981;&#35201;&#25630;&#28151;&#12290;Executors &#26159;&#19968;&#20010;&#24037;&#21378;&#21450;&#24037;&#20855;&#31867;&#12290;&#25552;&#20379;&#20102;&#20363;&#22914; newFixedThreadPool(10) &#30340;&#26041;&#27861;&#65292;&#26469;&#21019;&#24314;&#21508;&#31181;&#19981;&#21516;&#30340; Executor&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <h2 id="&#12289;executor-&#26694;&#26550;&#28304;&#30721;&#20998;&#26512;" style="font-size: 30px;">
     3&#12289;Executor &#26694;&#26550;&#28304;&#30721;&#20998;&#26512;
    </h2>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     Executor &#35774;&#35745;&#30340;&#31867;&#21644;&#23454;&#29616;&#27604;&#36739;&#22810;&#12290;&#26412;&#33410;&#23545; Executor &#26694;&#26550;&#30340;&#28304;&#30721;&#20998;&#26512;&#20197; ThreadPoolExecutor &#20316;&#20026;&#20027;&#32447;&#65292;&#20854;&#23427;&#30340;&#20869;&#23481;&#20063;&#20250;&#26377;&#25152;&#25552;&#21450;&#65292;&#19981;&#36807;&#35831;&#21516;&#23398;&#20204;&#25235;&#20303;&#37325;&#28857;&#65292;&#21035;&#20559;&#31163;&#20102;&#20027;&#32447;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <h3 id="executor">
     3.1 Executor
    </h3>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#20195;&#30721;&#22914;&#19979;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Executor</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span>Runnable command<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#24456;&#31616;&#21333;&#65292;&#21482;&#26159;&#20026;&#20102;&#25226;&#25552;&#20132;&#20219;&#21153;&#35299;&#32806;&#20986;&#26469;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <h3 id="executorservice">
     3.2 ExecutorService
    </h3>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     ExecutorService &#23450;&#20041;&#20102;&#32447;&#31243;&#27744;&#31649;&#29702;&#21644;&#26356;&#22810;&#25191;&#34892;&#20219;&#21153;&#30340;&#26041;&#27861;&#65292;&#22914;&#19979;&#65306;
     <br>
     <img alt="&#22270;&#29255;&#25551;&#36848;" class="" data-original="//img.mukewang.com/5dba76d70001cff905560264.jpg" src="EPUB/c1e9c33a-186d-11ed-a978-acde48001122">
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#25361;&#36873;&#20960;&#20010;&#37325;&#28857;&#30340;&#35828;&#19968;&#19979;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     <strong>
      shutdown &#26041;&#27861;
     </strong>
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#32456;&#27490; executorService&#65292;&#19981;&#20877;&#25191;&#34892;&#20219;&#21153;&#26032;&#30340;&#20219;&#21153;&#65292;&#24050;&#32463;&#25191;&#34892;&#30340;&#20219;&#21153;&#20250;&#34987;&#25191;&#34892;&#23436;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     <strong>
      shutdownNow &#26041;&#27861;
     </strong>
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#19981;&#31561;&#24453;&#27491;&#22312;&#25191;&#34892;&#30340;&#20219;&#21153;&#23436;&#25104;&#65292;&#24378;&#34892;&#20851;&#38381;&#12290;&#19981;&#36807;&#27492;&#26041;&#27861;&#24182;&#19981;&#20445;&#35777;&#27491;&#22312;&#25191;&#34892;&#30340;&#20219;&#21153;&#33021;&#34987;&#24378;&#34892;&#32456;&#27490;&#12290;&#36820;&#22238;&#20174;&#26469;&#27809;&#26377;&#34987;&#25191;&#34892;&#30340;&#20219;&#21153;&#21015;&#34920;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     <strong>
      submit &#26041;&#27861;
     </strong>
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#23545; execute &#26041;&#27861;&#30340;&#25193;&#23637;&#65292;&#20250;&#36820;&#22238;&#19968;&#20010; Future &#23545;&#35937;&#65292;&#25345;&#26377;&#20219;&#21153;&#25191;&#34892;&#32467;&#26524;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     <strong>
      invokeAll &#26041;&#27861;
     </strong>
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#25191;&#34892;&#19968;&#32452;&#20219;&#21153;&#65292;&#25152;&#26377;&#20219;&#21153;&#37117;&#36820;&#22238;&#25110;&#32773; timeout &#30340;&#26102;&#20505;&#65292;invokeAll &#26041;&#27861;&#36820;&#22238;&#25191;&#34892;&#32467;&#26524;&#21015;&#34920;&#12290;&#35813;&#26041;&#27861;&#19968;&#26086;&#36820;&#22238;&#32467;&#26524;&#65292;&#27809;&#26377;&#23436;&#25104;&#30340;&#20219;&#21153;&#21017;&#34987;&#21462;&#28040;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     <strong>
      invokeAny &#26041;&#27861;
     </strong>
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#25191;&#34892;&#19968;&#32452;&#20219;&#21153;&#65292;&#20219;&#24847;&#19968;&#20010;&#20219;&#21153;&#26377;&#36820;&#22238;&#26102;&#65292;invokeAny &#36820;&#22238;&#35813;&#20219;&#21153;&#30340;&#25191;&#34892;&#32467;&#26524;&#12290;&#20854;&#20313;&#27809;&#26377;&#23436;&#25104;&#30340;&#20219;&#21153;&#21017;&#34987;&#21462;&#28040;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <h3 id="abstractexecutorservice">
     3.3 AbstractExecutorService
    </h3>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#25552;&#20379;&#20102; newTaskFor &#26041;&#27861;&#23545; Runnable &#36827;&#34892;&#21253;&#35013;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java"><span class="token keyword">protected</span> <span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> RunnableFuture<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token function">newTaskFor</span><span class="token punctuation">(</span>Runnable runnable<span class="token punctuation">,</span> T value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">(</span>runnable<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#23427;&#23545; submit &#30340;&#23454;&#29616;&#65292;&#23601;&#26159;&#36807; newTaskFor &#26041;&#27861;&#65292;&#20195;&#30721;&#22914;&#19979;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java"><span class="token keyword">public</span> Future<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;</span> <span class="token function">submit</span><span class="token punctuation">(</span>Runnable task<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>task <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    RunnableFuture<span class="token operator">&lt;</span>Void<span class="token operator">&gt;</span> ftask <span class="token operator">=</span> <span class="token function">newTaskFor</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">execute</span><span class="token punctuation">(</span>ftask<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> ftask<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#36825;&#37324;&#29992;&#21040;&#30340; RunnableFuture&#65292;&#23601;&#26159;&#20026;&#20102;&#36825;&#20010;&#21151;&#33021;&#32780;&#29983;&#65292;&#23427;&#23454;&#29616;&#20102; Runbale &#25509;&#21475;&#21450; Future &#25509;&#21475;&#12290;&#25152;&#20197;&#23427;&#21487;&#20197;&#34987;&#20256;&#20837;execute&#26041;&#27861;&#65292;&#20174;&#32780;&#28155;&#21152;&#36827;&#20219;&#21153;&#21015;&#34920;&#12290;&#27492;&#22806;&#23427;&#36824;&#20445;&#23384;&#20102;&#25191;&#34892;&#30340;&#32467;&#26524;&#65292;&#24182;&#34987;&#36820;&#22238;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <h3 id="&#26500;&#36896;threadpoolexecutor">
     3.4 &#26500;&#36896;ThreadPoolExecutor
    </h3>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#19979;&#38754;&#25165;&#26159;&#26412;&#33410;&#30340;&#37325;&#22836;&#25103;&#65292;&#23545; ThreadPoolExecutor &#30340;&#28304;&#20195;&#30721;&#20998;&#26512;&#12290;&#25105;&#20204;&#20174; ThreadPoolExecutor &#30340;&#21019;&#24314;&#24320;&#22987;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java">Executors<span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#21487;&#20197;&#30475;&#21040;&#26159;&#36890;&#36807; Executors &#30340;&#24037;&#21378;&#26041;&#27861;&#26469;&#21019;&#24314;&#30340;&#65292;Executor &#25552;&#20379;&#20102;&#22810;&#31181;&#24037;&#21378;&#26041;&#27861;&#21019;&#24314; ThreadPool&#12290;&#20854;&#23454;&#26681;&#26412;&#26159;&#35843;&#29992; ThreadPoolExecutor &#26500;&#36896;&#26041;&#27861;&#26102;&#20256;&#20837;&#21442;&#25968;&#19981;&#21516;&#12290;&#25105;&#20204;&#20197; newFixedThreadPool &#26041;&#27861;&#20026;&#20363;&#65292;&#30475;&#19968;&#19979;&#20195;&#30721;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> ExecutorService <span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token keyword">int</span> nThreads<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span>nThreads<span class="token punctuation">,</span> nThreads<span class="token punctuation">,</span>
                                  0L<span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">,</span>
                                  <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token operator">&lt;</span>Runnable<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     ThreadPoolExecutor &#26500;&#36896;&#26041;&#27861;&#22914;&#19979;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java"><span class="token keyword">public</span> <span class="token function">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token keyword">int</span> corePoolSize<span class="token punctuation">,</span>
                          <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">,</span>
                          <span class="token keyword">long</span> keepAliveTime<span class="token punctuation">,</span>
                          TimeUnit unit<span class="token punctuation">,</span>
                          BlockingQueue<span class="token operator">&lt;</span>Runnable<span class="token operator">&gt;</span> workQueue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">(</span>corePoolSize<span class="token punctuation">,</span> maximumPoolSize<span class="token punctuation">,</span> keepAliveTime<span class="token punctuation">,</span> unit<span class="token punctuation">,</span> workQueue<span class="token punctuation">,</span>
         Executors<span class="token punctuation">.</span><span class="token function">defaultThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> defaultHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#29616;&#22312;&#25105;&#20204;&#21487;&#20197;&#32763;&#19968;&#19979; newFixedThreadPool &#23450;&#20041;&#20102;&#19968;&#20010;&#20160;&#20040;&#26679;&#30340;&#32447;&#31243;&#27744;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#26680;&#24515;&#32447;&#31243;&#25968;&#37327;&#20026; n&#65292;&#26368;&#22823;&#32447;&#31243;&#25968;&#37327;&#20063;&#20026; n &#30340;&#32447;&#31243;&#27744;&#12290;&#32447;&#31243;&#27744;&#20013;&#32447;&#31243;&#27704;&#36828;&#23384;&#27963;&#12290;&#32447;&#31243;&#27744;&#21019;&#24314;&#32447;&#31243;&#20351;&#29992; defaultTHreadFactory&#12290;&#24403;&#26080;&#27861;&#21019;&#24314;&#32447;&#31243;&#26102;&#65292;&#20351;&#29992; defaultHandler&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     <strong>
      corePoolSize
     </strong>
     &#21363;&#32447;&#31243;&#27744;&#30340;&#26680;&#24515;&#32447;&#31243;&#25968;&#37327;&#65292;&#20854;&#23454;&#20063;&#26159;&#26368;&#23567;&#32447;&#31243;&#25968;&#37327;&#12290;&#19981;&#35774;&#32622; allowCoreThreadTimeOut &#30340;&#24773;&#20917;&#19979;&#65292;&#26680;&#24515;&#32447;&#31243;&#25968;&#37327;&#33539;&#22260;&#20869;&#30340;&#32447;&#31243;&#19968;&#30452;&#23384;&#27963;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     <strong>
      maximumPoolSize
     </strong>
     &#21363;&#32447;&#31243;&#27744;&#30340;&#26368;&#22823;&#32447;&#31243;&#25968;&#37327;&#12290;&#21463;&#38480;&#20110;&#32447;&#31243;&#27744;&#30340; CAPACITY&#12290;&#32447;&#31243;&#27744;&#30340; CAPACITY &#20026; 2 &#30340; 29 &#27425;&#26041; -1&#12290;&#36825;&#26159;&#30001;&#20110;&#32447;&#31243;&#27744;&#25226;&#32447;&#31243;&#25968;&#37327;&#21644;&#29366;&#24577;&#20445;&#23384;&#22312;&#19968;&#20010;&#25972;&#24418;&#21407;&#23376;&#21464;&#37327;&#20013;&#12290;&#29366;&#24577;&#20445;&#23384;&#22312;&#39640;&#20301;&#65292;&#21344;&#25454;&#20102;&#20004;&#20301;&#65292;&#25152;&#20197;&#32447;&#31243;&#27744;&#20013;&#32447;&#31243;&#25968;&#37327;&#26368;&#22810;&#21040; 2 &#30340; 29 &#27425;&#26041; -1&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     <strong>
      workQueue
     </strong>
     &#26159;&#19968;&#20010;&#38459;&#22622;&#30340; queue&#65292;&#29992;&#26469;&#20445;&#23384;&#32447;&#31243;&#27744;&#35201;&#25191;&#34892;&#30340;&#25152;&#26377;&#20219;&#21153;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     <strong>
      Executors.defaultThreadFactory()
     </strong>
     &#65292;&#25105;&#20204;&#30475;&#19979;&#28304;&#20195;&#30721;&#65292;&#21457;&#29616;&#20854;&#26368;&#32456;&#36820;&#22238;&#20102;&#19968;&#20010; DefaultThreadFactory&#12290;&#20195;&#30721;&#22914;&#19979;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java"><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">DefaultThreadFactory</span> <span class="token keyword">implements</span> <span class="token class-name">ThreadFactory</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> AtomicInteger poolNumber <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> ThreadGroup group<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> AtomicInteger threadNumber <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> String namePrefix<span class="token punctuation">;</span>

    <span class="token function">DefaultThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        SecurityManager s <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">getSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        group <span class="token operator">=</span> <span class="token punctuation">(</span>s <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token operator">?</span> s<span class="token punctuation">.</span><span class="token function">getThreadGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span>
                              Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getThreadGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        namePrefix <span class="token operator">=</span> <span class="token string">"pool-"</span> <span class="token operator">+</span>
                      poolNumber<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
                     <span class="token string">"-thread-"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> Thread <span class="token function">newThread</span><span class="token punctuation">(</span>Runnable r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Thread t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>group<span class="token punctuation">,</span> r<span class="token punctuation">,</span>
                              namePrefix <span class="token operator">+</span> threadNumber<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                              <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">isDaemon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            t<span class="token punctuation">.</span><span class="token function">setDaemon</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">getPriority</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> Thread<span class="token punctuation">.</span>NORM_PRIORITY<span class="token punctuation">)</span>
            t<span class="token punctuation">.</span><span class="token function">setPriority</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span>NORM_PRIORITY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> t<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#20854;&#23454;&#23601;&#26159;&#35268;&#33539;&#20102;&#29983;&#25104;&#30340; Thread&#12290;&#36991;&#20813;&#35843;&#29992; new Thread &#21019;&#24314;&#65292;&#23548;&#33268;&#21019;&#24314;&#20986;&#26469;&#30340;Thread&#21487;&#33021;&#23384;&#22312;&#24046;&#24322;&#12290;&#22312;Executor&#20013;&#65292;&#23545;&#32447;&#31243;&#30340;&#21019;&#24314;&#37117;&#26159;&#36890;&#36807; ThreadFactory&#65292;&#31105;&#27490;&#20351;&#29992; new Thread &#26469;&#21019;&#24314;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     ThreadPoolExecutor &#20013;&#36824;&#26377;&#20010;&#37325;&#35201;&#30340;&#23646;&#24615;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java"><span class="token comment">/**
 * Set containing all worker threads in pool. Accessed only when
 * holding mainLock.
 */</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> HashSet<span class="token operator">&lt;</span>Worker<span class="token operator">&gt;</span> workers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token operator">&lt;</span>Worker<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#36890;&#36807;&#27880;&#37322;&#21487;&#20197;&#30475;&#20986;&#65292;&#36825;&#20010; HashSet &#20013;&#23384;&#30340;&#26159; Thread&#12290;&#32780; Worker &#20854;&#23454;&#23601;&#26159;&#23545; Thread &#30340;&#36827;&#19968;&#27493;&#23553;&#35013;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#25105;&#20204;&#20877;&#22238;&#36807;&#22836;&#26469;&#65292;&#30475;&#19968;&#19979; ThreadPoolExecutor &#30340;&#26500;&#36896;&#20989;&#25968;&#20013;&#20570;&#20102;&#20160;&#20040;&#20107;&#24773;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java"><span class="token keyword">public</span> <span class="token function">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token keyword">int</span> corePoolSize<span class="token punctuation">,</span>
                          <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">,</span>
                          <span class="token keyword">long</span> keepAliveTime<span class="token punctuation">,</span>
                          TimeUnit unit<span class="token punctuation">,</span>
                          BlockingQueue<span class="token operator">&lt;</span>Runnable<span class="token operator">&gt;</span> workQueue<span class="token punctuation">,</span>
                          ThreadFactory threadFactory<span class="token punctuation">,</span>
                          RejectedExecutionHandler handler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>corePoolSize <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span>
        maximumPoolSize <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span>
        maximumPoolSize <span class="token operator">&lt;</span> corePoolSize <span class="token operator">||</span>
        keepAliveTime <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>workQueue <span class="token operator">==</span> null <span class="token operator">||</span> threadFactory <span class="token operator">==</span> null <span class="token operator">||</span> handler <span class="token operator">==</span> null<span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>acc <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">getSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> null <span class="token operator">?</span>
            null <span class="token operator">:</span>
            AccessController<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>corePoolSize <span class="token operator">=</span> corePoolSize<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>maximumPoolSize <span class="token operator">=</span> maximumPoolSize<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>workQueue <span class="token operator">=</span> workQueue<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>keepAliveTime <span class="token operator">=</span> unit<span class="token punctuation">.</span><span class="token function">toNanos</span><span class="token punctuation">(</span>keepAliveTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>threadFactory <span class="token operator">=</span> threadFactory<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>handler <span class="token operator">=</span> handler<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#21487;&#20197;&#30475;&#21040;&#21482;&#26159;&#23545;&#23646;&#24615;&#30340;&#36171;&#20540;&#65292;&#24182;&#27809;&#26377;&#21551;&#21160;&#20219;&#20309;&#32447;&#31243;&#12290;&#36825;&#26679;&#20570;&#26159;&#24456;&#22909;&#30340;&#35774;&#35745;&#65292;&#22240;&#20026;&#27809;&#26377;&#20219;&#20309;&#20219;&#21153;&#28155;&#21152;&#26102;&#23601;&#21551;&#21160;&#32447;&#31243;&#65292;&#26159;&#23545;&#31995;&#32479;&#36164;&#28304;&#30340;&#28010;&#36153;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#36890;&#36807;&#20197;&#19978;&#20998;&#26512;&#65292;&#25105;&#20204;&#23545; ThreadPoolExecutor &#30340;&#32467;&#26500;&#24212;&#35813;&#27604;&#36739;&#28165;&#26224;&#20102;&#65292;&#20854;&#23454;&#26680;&#24515;&#21644;&#25105;&#20204;&#33258;&#24049;&#23454;&#29616;&#30340;&#32447;&#31243;&#27744;&#26159;&#19968;&#26679;&#30340;&#12290;ThreadPoolExecutor &#20063;&#26377;&#19968;&#20010;&#20219;&#21153;&#30340;&#21015;&#34920; workQueue&#65292;&#36824;&#26377;&#19968;&#20010;&#32447;&#31243;&#30340;&#21015;&#34920; worker&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#37027;&#20040;&#25353;&#29031;&#25105;&#20204;&#33258;&#24049;&#23454;&#29616;&#30340;&#36923;&#36753;&#65292;&#32447;&#31243;&#27744;&#24212;&#35813;&#26159;&#36890;&#36807;&#21551;&#21160;&#32447;&#31243;&#36718;&#35810;&#20174; workQueue &#20013;&#33719;&#21462;&#20219;&#21153;&#25191;&#34892;&#26469;&#23454;&#29616;&#32447;&#31243;&#27744;&#30340;&#36816;&#36716;&#12290;&#32467;&#19979;&#26469;&#25105;&#20204;&#30475;&#30475;&#29468;&#24819;&#26159;&#21542;&#27491;&#30830;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <h3 id="&#21551;&#21160;-threadpoolexecutor">
     3.5 &#21551;&#21160; ThreadPoolExecutor
    </h3>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#26082;&#28982;&#22312;&#21019;&#24314; ThreadPoolExecutor &#26102;&#24182;&#27809;&#26377;&#21551;&#21160;&#32447;&#31243;&#27744;&#65292;&#37027;&#20040;&#32447;&#31243;&#27744;&#26159;&#20309;&#26102;&#34987;&#21551;&#21160;&#30340;&#21602;&#65311;&#25105;&#29468;&#24212;&#35813;&#26159;&#28155;&#21152;&#31532;&#19968;&#20010;&#20219;&#21153;&#30340;&#26102;&#20505;&#65292;&#20063;&#23601;&#26159;&#35843;&#29992; execute &#26041;&#27861;&#26102;&#12290;&#25105;&#20204;&#26469;&#30475;&#30475; execute &#26041;&#27861;&#30340;&#20195;&#30721;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span>Runnable command<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>command <span class="token operator">==</span> null<span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> c <span class="token operator">=</span> ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">workerCountOf</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">&lt;</span> corePoolSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">addWorker</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            c <span class="token operator">=</span> ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isRunning</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> workQueue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> recheck <span class="token operator">=</span> ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">isRunning</span><span class="token punctuation">(</span>recheck<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">remove</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token function">reject</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">workerCountOf</span><span class="token punctuation">(</span>recheck<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token function">addWorker</span><span class="token punctuation">(</span>null<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">addWorker</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#28304;&#20195;&#30721;&#20013;&#26377;&#19968;&#27573;&#20851;&#38190;&#30340;&#27880;&#37322;&#25105;&#27809;&#26377;&#36148;&#36827;&#26469;&#65292;&#19979;&#38754;&#25105;&#20808;&#25226;&#36825;&#27573;&#20851;&#38190;&#30340;&#27880;&#37322;&#32763;&#35793;&#35762;&#35299;&#19979;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#20998;&#19977;&#27493;&#20570;&#22788;&#29702;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     1&#12289;&#22914;&#26524;&#36816;&#34892;&#30340;&#32447;&#31243;&#25968;&#37327;&#23567;&#20110; corePoolSize&#65292;&#37027;&#20040;&#23581;&#35797;&#21019;&#24314;&#26032;&#30340;&#32447;&#31243;&#65292;&#24182;&#25226;&#20256;&#20837;&#30340; command &#20316;&#20026;&#23427;&#30340;&#31532;&#19968;&#20010; task &#26469;&#25191;&#34892;&#12290;&#35843;&#29992; addWorker &#20250;&#33258;&#21160;&#26816;&#26597; runState &#21644; workCount&#65292;&#20197;&#27492;&#26469;&#38450;&#27490;&#22312;&#19981;&#24212;&#35813;&#28155;&#21152;&#32447;&#31243;&#26102;&#28155;&#21152;&#32447;&#31243;&#30340;&#38169;&#35823;&#35686;&#21578;&#65307;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     2&#12289;&#21363;&#20351; task &#21487;&#20197;&#34987;&#25104;&#21151;&#21152;&#20837;&#38431;&#21015;&#65292;&#25105;&#20204;&#20173;&#26087;&#38656;&#35201;&#20877;&#27425;&#30830;&#35748;&#25105;&#20204;&#26159;&#21542;&#24212;&#35813;&#28155;&#21152; thread&#65288;&#22240;&#20026;&#26368;&#21518;&#19968;&#27425;&#26816;&#26597;&#20043;&#21518;&#21487;&#33021;&#26377;&#32447;&#31243;&#24050;&#32463;&#27515;&#25481;&#20102;&#65289;&#36824;&#26159;&#32447;&#31243;&#27744;&#22312;&#36827;&#20837;&#27492;&#26041;&#27861;&#21518;&#24050;&#32463;&#20572;&#25481;&#20102;&#12290;&#25152;&#20197;&#25105;&#20204;&#20250;&#20877;&#27425;&#26816;&#26597;&#29366;&#24577;&#65292;&#22914;&#26524;&#26377;&#24517;&#35201;&#30340;&#35805;&#65292;&#21487;&#20197;&#22238;&#28378;&#38431;&#21015;&#12290;&#25110;&#32773;&#24403;&#27809;&#26377;&#32447;&#31243;&#26102;&#65292;&#24320;&#21551;&#26032;&#30340; thread&#65307;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     3&#12289;&#22914;&#26524;&#26080;&#27861;&#23558; task &#21152;&#20837; queue&#65292;&#37027;&#20040;&#21487;&#20197;&#23581;&#35797;&#28155;&#21152;&#26032;&#30340; thread&#12290;&#22914;&#26524;&#28155;&#21152;&#22833;&#36133;&#65292;&#36825;&#26159;&#22240;&#20026;&#32447;&#31243;&#27744;&#34987;&#20851;&#38381;&#25110;&#32773;&#24050;&#32463;&#39281;&#21644;&#20102;&#65292;&#25152;&#20197;&#25298;&#32477;&#36825;&#20010; task&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#20197;&#19978;&#26159;&#21407;&#25991;&#30340;&#32763;&#35793;&#12290;&#32467;&#21512;&#20195;&#30721;&#65292;&#20854;&#23454;&#23601;&#26159;&#22914;&#19979;&#19977;&#27493;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     1&#12289;&#32447;&#31243;&#25968;&#37327;&#19981;&#36275; corePoolSize&#26102;&#65292;&#28155;&#21152;&#26032;&#32447;&#31243;&#20316;&#20026; core thread &#25191;&#34892; command&#65307;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     2&#12289;&#23558; command &#21152;&#20837; workQueue&#65292;&#28982;&#21518;&#20877;&#27425;&#26816;&#26597;&#32447;&#31243;&#27744;&#29366;&#24577;&#12290;&#22914;&#26524;&#19981;&#26159; isRunning&#65292;&#21017;&#31227;&#38500; command &#24182;&#19988;reject command&#12290;&#22914;&#26524;&#32447;&#31243;&#25968;&#37327;&#24050;&#32463;&#20026; 0&#65292;&#37027;&#20040;&#21017;&#20877;&#27425; addWorker&#65307;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     3&#12289;&#22914;&#26524;&#26080;&#27861;&#23558; task &#21152;&#20837; workQueue&#65292;&#21017;&#23581;&#35797; addWorker&#12290;&#20294;&#19981;&#20316;&#20026; core thread&#12290;&#22914;&#26524;&#28155;&#21152;&#22833;&#36133;&#65292;&#21017; reject command&#65288;&#30001;&#20110;&#27809;&#26377;&#21152;&#20837; workQueue&#65292;&#25152;&#20197;&#19981;&#38656;&#35201;&#20174; queue &#20013;&#31227;&#38500; command&#65289;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#21487;&#20197;&#30475;&#21040; execute &#27969;&#31243;&#30340;&#26680;&#24515;&#26041;&#27861;&#20026;
     <strong>
      addWorker
     </strong>
     &#12290;&#25105;&#20204;&#32487;&#32493;&#20998;&#26512; addWorker&#26041;&#27861;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     <strong>
      addWork
     </strong>
     &#20013;&#20027;&#35201;&#25191;&#34892;&#22914;&#19979;&#36923;&#36753;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     1&#12289;&#26356;&#26032; worker &#30340;&#25968;&#37327;&#65292;&#20195;&#30721;&#22914;&#19979;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java">retry<span class="token operator">:</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> c <span class="token operator">=</span> ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> rs <span class="token operator">=</span> <span class="token function">runStateOf</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Check if queue empty only if necessary.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>rs <span class="token operator">&gt;=</span> SHUTDOWN <span class="token operator">&amp;&amp;</span>
                <span class="token operator">!</span> <span class="token punctuation">(</span>rs <span class="token operator">==</span> SHUTDOWN <span class="token operator">&amp;&amp;</span>
                   firstTask <span class="token operator">==</span> null <span class="token operator">&amp;&amp;</span>
                   <span class="token operator">!</span> workQueue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">int</span> wc <span class="token operator">=</span> <span class="token function">workerCountOf</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>wc <span class="token operator">&gt;=</span> CAPACITY <span class="token operator">||</span>
                    wc <span class="token operator">&gt;=</span> <span class="token punctuation">(</span>core <span class="token operator">?</span> corePoolSize <span class="token operator">:</span> maximumPoolSize<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">compareAndIncrementWorkerCount</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">break</span> retry<span class="token punctuation">;</span>
                c <span class="token operator">=</span> ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Re-read ctl</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">runStateOf</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">!=</span> rs<span class="token punctuation">)</span>
                    <span class="token keyword">continue</span> retry<span class="token punctuation">;</span>
                <span class="token comment">// else CAS failed due to workerCount change; retry inner loop</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     retry &#26159;&#19968;&#20010;&#26631;&#35760;&#65292;&#21644;&#24490;&#29615;&#37197;&#21512;&#20351;&#29992;&#65292;continue retry &#30340;&#26102;&#20505;&#65292;&#20250;&#36339;&#21040; retry &#30340;&#22320;&#26041;&#20877;&#27425;&#25191;&#34892;&#12290;&#22914;&#26524; break retry&#65292;&#21017;&#36339;&#20986;&#25972;&#20010;&#24490;&#29615;&#20307;&#12290;&#21069;&#25991;&#25552;&#21040;&#36807;&#65292;ThreadPoolExecutor &#25226;&#29366;&#24577;&#21644;&#32447;&#31243;&#27744;&#25968;&#37327;&#20004;&#20010;&#23646;&#24615;&#23384;&#22312;&#20102;&#19968;&#20010; Atomic &#21464;&#37327;&#20013;&#65292;&#23601;&#26159;&#36825;&#37324;&#29992;&#21040;&#30340; ctl&#12290;&#28304;&#30721;&#20013;&#20808;&#26816;&#26597;&#20102;&#29366;&#24577;&#65292;&#28982;&#21518;&#26684;&#23616;&#21019;&#24314;&#32447;&#31243;&#31867;&#22411;&#30340;&#19981;&#21516;&#65292;&#36827;&#34892;&#25968;&#37327;&#30340;&#26657;&#39564;&#12290;&#22312;&#36890;&#36807; CAS&#26041; &#24335;&#26356;&#26032;&#29366; ctl&#65292;&#25104;&#21151;&#30340;&#35805;&#21017;&#36339;&#20986;&#24490;&#29615;&#12290;&#21542;&#21017;&#20877;&#27425;&#21462;&#24471;&#32447;&#31243;&#27744;&#29366;&#24577;&#65292;&#22914;&#26524;&#21644;&#26368;&#21021;&#24050;&#32463;&#19981;&#19968;&#33268;&#65292;&#37027;&#20040;&#20174;&#22836;&#24320;&#22987;&#25191;&#34892;&#12290;&#22914;&#26524;&#29366;&#24577;&#24182;&#26410;&#25913;&#21464;&#21017;&#32487;&#32493;&#26356;&#26032; worker &#30340;&#25968;&#37327;&#12290;&#27969;&#31243;&#21442;&#32771;&#19979;&#22270;&#65306;
     <br>
     <img alt="&#22270;&#29255;&#25551;&#36848;" class="" data-original="//img.mukewang.com/5dba77580001323211010534.jpg" src="EPUB/c200d232-186d-11ed-a978-acde48001122">
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     2&#12289;&#28155;&#21152; worker &#21040; workers &#30340; set &#20013;&#12290;&#24182;&#19988;&#21551;&#21160; worker &#20013;&#25345;&#26377;&#30340;&#32447;&#31243;&#12290;&#20195;&#30721;&#22914;&#19979;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java"><span class="token keyword">boolean</span> workerStarted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">boolean</span> workerAdded <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
Worker w <span class="token operator">=</span> null<span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
    w <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span>firstTask<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> Thread t <span class="token operator">=</span> w<span class="token punctuation">.</span>thread<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> ReentrantLock mainLock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mainLock<span class="token punctuation">;</span>
        mainLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// Recheck while holding lock.</span>
            <span class="token comment">// Back out on ThreadFactory failure or if</span>
            <span class="token comment">// shut down before lock acquired.</span>
            <span class="token keyword">int</span> rs <span class="token operator">=</span> <span class="token function">runStateOf</span><span class="token punctuation">(</span>ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>rs <span class="token operator">&lt;</span> SHUTDOWN <span class="token operator">||</span>
                <span class="token punctuation">(</span>rs <span class="token operator">==</span> SHUTDOWN <span class="token operator">&amp;&amp;</span> firstTask <span class="token operator">==</span> null<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// precheck that t is startable</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalThreadStateException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                workers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> s <span class="token operator">=</span> workers<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">&gt;</span> largestPoolSize<span class="token punctuation">)</span>
                    largestPoolSize <span class="token operator">=</span> s<span class="token punctuation">;</span>
                workerAdded <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            mainLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>workerAdded<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            workerStarted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> workerStarted<span class="token punctuation">)</span>
        <span class="token function">addWorkerFailed</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">return</span> workerStarted<span class="token punctuation">;</span>

</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#21487;&#20197;&#30475;&#21040;&#28155;&#21152; work &#26102;&#38656;&#35201;&#20808;&#33719;&#24471;&#38145;&#65292;&#36825;&#26679;&#30830;&#20445;&#22810;&#32447;&#31243;&#24182;&#21457;&#23433;&#20840;&#12290;&#22914;&#26524;&#28155;&#21152; worker &#25104;&#21151;&#65292;&#37027;&#20040;&#35843;&#29992; worker &#20013;&#32447;&#31243;&#30340; start &#26041;&#27861;&#21551;&#21160;&#32447;&#31243;&#12290;&#22914;&#26524;&#21551;&#21160;&#22833;&#36133;&#21017;&#35843;&#29992; addWorkerFailed &#26041;&#27861;&#36827;&#34892;&#22238;&#28378;&#12290;&#36807;&#31243;&#27604;&#36739;&#31616;&#21333;&#65292;&#36825;&#37324;&#23601;&#19981;&#20877;&#25552;&#27969;&#31243;&#22270;&#20102;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#20998;&#26512;&#21040;&#36825;&#37324;&#65292;&#25105;&#20204;&#20808;&#36827;&#34892;&#19979;&#24635;&#32467;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     1&#12289;ThreadPoolExecutor &#22312;&#21021;&#22987;&#21270;&#21518;&#24182;&#27809;&#26377;&#21551;&#21160;&#21644;&#21019;&#24314;&#20219;&#20309;&#32447;&#31243;&#65307;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     2&#12289;&#22312;&#35843;&#29992; execute &#26041;&#27861;&#26102;&#25165;&#20250;&#35843;&#29992; addWorker &#21019;&#24314;&#32447;&#31243;&#65292;&#24182;&#19988;&#25226; command &#21152;&#20837;&#21040; workQueue&#65288;&#22914;&#26524;&#24050;&#32463;&#25317;&#26377;&#36229;&#36807; core &#25968;&#37327;&#30340;&#32447;&#31243;&#65292;&#21017;&#19981;&#20250;&#20877;&#35843;&#29992; addWorker &#21019;&#24314;&#32447;&#31243;&#65289;&#65307;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     3&#12289;addWorker &#26041;&#27861;&#20013;&#20250;&#21019;&#24314;&#26032;&#30340; worker&#65292;&#24182;&#21551;&#21160;&#20854;&#25345;&#26377;&#30340;&#32447;&#31243;&#26469;&#25191;&#34892;&#20219;&#21153;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#31532;&#20108;&#27493;&#20013;&#65292;&#22914;&#26524;&#32447;&#31243;&#25968;&#37327;&#24050;&#32463;&#36798;&#21040; corePoolSize&#65292;&#21017;&#21482;&#20250;&#25226; command  &#21152;&#20837;&#21040; workQueue &#20013;&#65292;&#37027;&#20040;&#21152;&#20837;&#21040; workQueue &#20013;&#30340; command &#26159;&#22914;&#20309;&#34987;&#25191;&#34892;&#30340;&#21602;&#65311;&#25105;&#20204;&#19979;&#38754;&#26469;&#20998;&#26512; Worker &#30340;&#28304;&#20195;&#30721;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <h3 id="worker">
     3.6 Worker
    </h3>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     Worker &#23553;&#35013;&#20102;&#32447;&#31243;&#65292;&#26159; executor &#20013;&#30340;&#24037;&#20316;&#21333;&#20803;&#12290;worker &#32487;&#25215;&#33258; AbstractQueuedSynchronizer&#65292;&#24182;&#23454;&#29616; Runnable&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     worker &#20013;&#30340;&#23646;&#24615;&#22914;&#19979;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java"><span class="token comment">/** Thread this worker is running in.  Null if factory fails. */</span>
<span class="token keyword">final</span> Thread thread<span class="token punctuation">;</span>
<span class="token comment">/** Initial task to run.  Possibly null. */</span>
Runnable firstTask<span class="token punctuation">;</span>
<span class="token comment">/** Per-thread task counter */</span>
<span class="token keyword">volatile</span> <span class="token keyword">long</span> completedTasks<span class="token punctuation">;</span>

</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#22914;&#26524;&#23384;&#22312; firstTask&#65292;&#37027;&#20040; worker &#20013;&#32447;&#31243;&#21551;&#21160;&#26102;&#65292;&#20250;&#20808;&#25191;&#34892; firstTask&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#26500;&#36896;&#26041;&#27861;&#22914;&#19979;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java"><span class="token function">Worker</span><span class="token punctuation">(</span>Runnable firstTask<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span>firstTask <span class="token operator">=</span> firstTask<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>thread <span class="token operator">=</span> <span class="token function">getThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newThread</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#21487;&#20197;&#30475;&#21040;&#36890;&#36807; ThreadFactory &#21019;&#24314;&#32447;&#31243;&#65292;&#24182;&#27809;&#26377;&#30452;&#25509; new&#12290;&#21407;&#22240;&#19978;&#25991;&#24050;&#32463;&#23558;&#32467;&#26524;&#12290;&#27492;&#22788;&#36824;&#38656;&#35201;&#29305;&#21035;&#27880;&#24847;&#30340;&#26159;&#65292;&#21019;&#24314; thread &#26102;&#25226; worker &#33258;&#24049;&#20316;&#20026; Runnable &#30340;&#23454;&#29616;&#20256;&#20837;&#20102; thread &#20013;&#12290;&#37027;&#20040; addWork &#26102;&#35843;&#29992;&#30340; t.start()&#65292;&#23454;&#38469;&#19978;&#36816;&#34892;&#30340;&#26159; t &#25152;&#23646; worker&#30340;run &#26041;&#27861;&#12290;worker &#30340; run &#26041;&#27861;&#22914;&#19979;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">runWorker</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#23454;&#38469;&#36816;&#34892;&#30340;&#26159; ThreadPoolExecutor &#30340; runWorker &#26041;&#27861;&#65292;&#20195;&#30721;&#22914;&#19979;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <pre class="language-java"><code class="prism language-java">    <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">runWorker</span><span class="token punctuation">(</span>Worker w<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Thread wt <span class="token operator">=</span> Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Runnable task <span class="token operator">=</span> w<span class="token punctuation">.</span>firstTask<span class="token punctuation">;</span>
        w<span class="token punctuation">.</span>firstTask <span class="token operator">=</span> null<span class="token punctuation">;</span>
        w<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// allow interrupts</span>
        <span class="token keyword">boolean</span> completedAbruptly <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>task <span class="token operator">!=</span> null <span class="token operator">||</span> <span class="token punctuation">(</span>task <span class="token operator">=</span> <span class="token function">getTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                w<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">runStateAtLeast</span><span class="token punctuation">(</span>ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> STOP<span class="token punctuation">)</span> <span class="token operator">||</span>
                     <span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">interrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                      <span class="token function">runStateAtLeast</span><span class="token punctuation">(</span>ctl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> STOP<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                    <span class="token operator">!</span>wt<span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    wt<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token function">beforeExecute</span><span class="token punctuation">(</span>wt<span class="token punctuation">,</span> task<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    Throwable thrown <span class="token operator">=</span> null<span class="token punctuation">;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        task<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        thrown <span class="token operator">=</span> x<span class="token punctuation">;</span> <span class="token keyword">throw</span> x<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Error</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        thrown <span class="token operator">=</span> x<span class="token punctuation">;</span> <span class="token keyword">throw</span> x<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        thrown <span class="token operator">=</span> x<span class="token punctuation">;</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                        <span class="token function">afterExecute</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> thrown<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                    task <span class="token operator">=</span> null<span class="token punctuation">;</span>
                    w<span class="token punctuation">.</span>completedTasks<span class="token operator">++</span><span class="token punctuation">;</span>
                    w<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            completedAbruptly <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token function">processWorkerExit</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> completedAbruptly<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

</code></pre>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#20027;&#27969;&#31243;&#22914;&#19979;&#65306;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     1&#12289;&#20808;&#21462;&#20986; worker &#20013;&#30340; firstTask&#65292;&#24182;&#28165;&#31354;&#65307;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     2&#12289;&#22914;&#26524;&#27809;&#26377; firstTask&#65292;&#21017;&#35843;&#29992; getTask &#26041;&#27861;&#65292;&#20174; workQueue &#20013;&#33719;&#21462;task&#65307;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     3&#12289;&#33719;&#21462;&#38145;&#65307;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     4&#12289;&#25191;&#34892; beforeExecute&#12290;&#36825;&#37324;&#26159;&#31354;&#26041;&#27861;&#65292;&#22914;&#26377;&#38656;&#35201;&#22312;&#23376;&#31867;&#23454;&#29616;&#65307;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     5&#12289;&#25191;&#34892; task.run&#65307;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     6&#12289;&#25191;&#34892; afterExecute&#12290;&#36825;&#37324;&#26159;&#31354;&#26041;&#27861;&#65292;&#22914;&#26377;&#38656;&#35201;&#22312;&#23376;&#31867;&#23454;&#29616;&#65307;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     7&#12289;&#28165;&#31354; task&#65292;completedTasks++&#65292;&#37322;&#25918;&#38145;&#65307;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     8&#12289;&#24403;&#26377;&#24322;&#24120;&#25110;&#32773;&#27809;&#26377; task &#21487;&#25191;&#34892;&#26102;&#65292;&#20250;&#36827;&#20837;&#22806;&#23618; finnaly &#20195;&#30721;&#22359;&#12290;&#35843;&#29992; processWorkerExit &#36864;&#20986;&#24403;&#21069; worker&#12290;&#20174; works &#20013;&#31227;&#38500;&#26412; worker &#21518;&#65292;&#22914;&#26524; worker &#25968;&#37327;&#23567;&#20110; corePoolSize&#65292;&#21017;&#21019;&#24314;&#26032;&#30340; worker&#65292;&#20197;&#32500;&#25345; corePoolSize &#22823;&#23567;&#30340;&#32447;&#31243;&#25968;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#36825;&#34892;&#20195;&#30721; while (task != null || (task = getTask()) != null) &#65292;&#30830;&#20445;&#20102; worker &#19981;&#20572;&#22320;&#20174; workQueue &#20013;&#21462;&#24471; task &#25191;&#34892;&#12290;getTask &#26041;&#27861;&#20250;&#20174; BlockingQueue workQueue &#20013; poll &#25110;&#32773; take &#20854;&#20013;&#30340; task &#20986;&#26469;&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#21040;&#36825;&#37324;&#20851;&#20110; executor &#22914;&#20309;&#21019;&#24314;&#24182;&#21551;&#21160;&#32447;&#31243;&#25191;&#34892; task &#30340;&#36807;&#31243;&#24050;&#32463;&#20998;&#26512;&#28165;&#26970;&#20102;&#12290;&#20854;&#23454;&#21644;&#25105;&#20204;&#33258;&#24049;&#23454;&#29616;&#30340;&#32447;&#31243;&#27744;&#30340;&#26680;&#24515;&#24605;&#24819;&#19968;&#33268;&#65292;&#37117;&#26159;&#36890;&#36807;&#32500;&#25252;&#19968;&#23450;&#25968;&#37327;&#30340;&#32447;&#31243;&#65292;&#24182;&#19988;&#19981;&#26029;&#20174;&#20219;&#21153;&#38431;&#21015;&#21462;&#24471;&#20219;&#21153;&#25191;&#34892;&#26469;&#23454;&#29616;&#32447;&#31243;&#27744;&#30340;&#36816;&#36716;&#12290;&#20294;&#26159; Executor &#26694;&#26550;&#32771;&#34385;&#24471;&#26356;&#20026;&#20840;&#38754;&#65292;&#20581;&#22766;&#24615;&#20063;&#35201;&#22909;&#24456;&#22810;&#12290;&#25105;&#20204;&#22312;&#23454;&#38469;&#24320;&#21457;&#20013;&#19981;&#35201;&#33258;&#24049;&#20877;&#21435;&#35774;&#35745;&#32447;&#31243;&#27744;&#65292;&#35831;&#30452;&#25509;&#20351;&#29992; executor&#12290;
    </p>
   </div>
   <div class="cl-preview-section">
    <h2 id="&#12289;&#24635;&#32467;" style="font-size: 30px;">
     4&#12289;&#24635;&#32467;
    </h2>
   </div>
   <div class="cl-preview-section">
    <p style="font-size: 20px; line-height: 38px;">
     &#26412;&#33410;&#30340;&#20869;&#23481;&#30456;&#23545;&#27604;&#36739;&#22810;&#65292;&#28304;&#20195;&#30721;&#38405;&#35835;&#20063;&#27604;&#36739;&#26543;&#29157;&#12290;&#25105;&#20204;&#22312;&#38405;&#35835;&#28304;&#20195;&#30721;&#26102;&#19968;&#23450;&#25235;&#20303;&#26680;&#24515;&#27969;&#31243;&#183;&#65292;&#20174;&#39640;&#23618;&#32423;&#36923;&#36753;&#24320;&#22987;&#33258;&#39030;&#21521;&#19979;&#20998;&#26512;&#21644;&#38405;&#35835;&#12290;&#19981;&#35201;&#36807;&#22810;&#32416;&#32544;&#20110;&#32454;&#33410;&#65292;&#31561;&#21040;&#22823;&#20307;&#33021;&#22815;&#35835;&#25026;&#26102;&#65292;&#20877;&#21435;&#30475;&#24863;&#20852;&#36259;&#30340;&#32454;&#33410;&#23454;&#29616;&#12290;&#21542;&#21017;&#24456;&#23481;&#26131;&#22312;&#23618;&#23618;&#23884;&#22871;&#30340;&#28304;&#20195;&#30721;&#20013;&#36855;&#22833;&#20102;&#26041;&#21521;&#65292;&#38519;&#20837;&#26576;&#20010;&#32454;&#33410;&#19981;&#33021;&#33258;&#25300;&#12290;&#20854;&#23454;&#20851;&#20110; ThreadPoolExecutor &#36824;&#26377;&#20123;&#26041;&#27861;&#65292;&#26412;&#33410;&#27809;&#26377;&#32473;&#20986;&#20998;&#26512;&#65292;&#27604;&#22914; shutdown &#21644; shutdownNow&#65292;&#22823;&#23478;&#21487;&#20197;&#23581;&#35797;&#33258;&#24049;&#20998;&#26512;&#19979;&#12290;
    </p>
   </div>
   }
  </div>
 </div>
 <!-- &#20080;&#36807;&#30340;&#38405;&#35835; -->
 <div class="art-next-prev clearfix">
  <!-- &#24050;&#20080;&#19988;&#24320;&#25918; &#25110;&#32773;&#21487;&#20197;&#35797;&#35835; -->
  <a href="/read/49/article/954">
   <div class="prev l clearfix">
    <div class="icon l">
     <i class="imv2-arrow3_l">
     </i>
    </div>
    <p>
     19 &#33258;&#24049;&#21160;&#25163;&#20016;&#34915;&#36275;&#39135;&#8212;&#31616;&#21333;&#32447;&#31243;&#27744;&#23454;&#29616;
    </p>
   </div>
  </a>
  <!-- &#24050;&#20080;&#19988;&#24320;&#25918; &#25110;&#32773;&#21487;&#20197;&#35797;&#35835; -->
  <a href="/read/49/article/956">
   <div class="next r clearfix">
    <p>
     21 &#26356;&#39640;&#32423;&#30340;&#38145;&#8212;&#28145;&#20837;&#35299;&#26512;Lock
    </p>
    <div class="icon r">
     <i class="imv2-arrow3_r">
     </i>
    </div>
   </div>
  </a>
 </div>
</div>

</div>

</div>
</div>

        </body>
        
        