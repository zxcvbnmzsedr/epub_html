
        <html lang="en">
        <head>
        <meta charset="UTF-8"/>
        </head>
        <body>
        <div><div class="markdown-body">
    <h1>DDD-Demo &#28436;&#31034;&#65288;&#22235;&#65289;&#65306;&#22797;&#26434;&#36923;&#36753;&#22788;&#29702;</h1>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="style/style.css" type="text/css">

<div class="markdown-body">
    <p>
 &#19978;&#19968;&#31687;&#25105;&#20204;&#23398;&#20064;&#20102;&#22914;&#20309;&#20351;&#29992;&#24212;&#29992;&#26381;&#21153;&#26469;&#32534;&#25490;&#19994;&#21153;&#36923;&#36753;&#65292;&#35753;&#20320;&#23545;&#20110;&#24212;&#29992;&#26381;&#21153;&#22312;DDD&#20013;&#30340;&#23454;&#38469;&#20351;&#29992;&#19982;&#22320;&#20301;&#26377;&#20102;&#19968;&#28857;&#31895;&#30053;&#30340;&#20102;&#35299;&#12290;&#34429;&#28982;&#25105;&#20204;&#21487;&#20197;&#22312;&#24212;&#29992;&#26381;&#21153;&#20013;&#25226;&#25152;&#26377;&#30340;&#36923;&#36753;&#37117;&#32534;&#25490;&#23436;&#25104;&#65292;&#20294;&#26159;&#24456;&#22810;&#26102;&#20505;&#20026;&#20102;&#35753;&#20854;&#20013;&#19968;&#37096;&#20998;&#30340;&#21407;&#23376;&#21270;&#32534;&#25490;&#36923;&#36753;&#26356;&#21152;&#31361;&#20986;&#65292;&#25105;&#20204;&#36824;&#20250;&#20877;&#36827;&#34892;&#22686;&#21152;&#39046;&#22495;&#26381;&#21153;&#25110;&#32773;&#33021;&#21147;&#23618;&#26469;&#20351;&#24471;&#19994;&#21153;&#36923;&#36753;&#30340;&#23637;&#29616;&#26356;&#21152;&#31361;&#20986;&#19988;&#26126;&#26174;&#12290;
</p>
<p>
 &#26412;&#25991;&#21017;&#23558;&#36890;&#36807;&#29992;&#25143;&#34987;&#26032;&#22686;&#36825;&#20010;&#20107;&#20214;&#20986;&#21457;&#26469;&#20026;&#20320;&#35762;&#35299;&#22914;&#20309;&#23558;&#24212;&#29992;&#26381;&#21153;&#12289;&#33021;&#21147;&#23618;&#12289;&#39046;&#22495;&#27169;&#22411;&#12289;&#39046;&#22495;&#26381;&#21153;&#19982;&#20107;&#20214;&#39537;&#21160;&#27169;&#22411;&#34701;&#20250;&#36143;&#36890;&#22320;&#20351;&#29992;&#12290;
</p>
<h2>
 &#19968;&#12289;&#24212;&#29992;&#26381;&#21153;&#30452;&#25509;&#32534;&#25490;
</h2>
<p>
 <strong>
  &#22238;&#39038;&#19968;&#19979;&#29992;&#25143;&#26032;&#22686;&#30340;&#38656;&#27714;
 </strong>
 &#65306;
</p>
<ol>
 <li>
  &#29992;&#25143;&#26032;&#22686;&#26102;&#38656;&#35201;&#20851;&#32852;&#35282;&#33394;&#65288;&#19968;&#20010;&#29992;&#25143;&#22810;&#20010;&#35282;&#33394;&#65289;&#12289;&#21333;&#20301;&#65288;&#19968;&#20010;&#29992;&#25143;&#19968;&#20010;&#21333;&#20301;&#65289;&#65292;&#19988;&#26032;&#22686;&#26102;&#29992;&#25143;&#21517;&#19981;&#21487;&#37325;&#22797;&#65307;
 </li>
 <li>
  &#29992;&#25143;&#26032;&#22686;&#26102;&#38656;&#35201;&#20381;&#25454;&#35282;&#33394;&#31867;&#22411;&#25171;&#21360;&#20986;&#26631;&#31614;&#12290;
 </li>
</ol>
<p>
 &#20197;&#19978;&#36923;&#36753;&#25105;&#20204;&#30452;&#25509;&#22312;&#24212;&#29992;&#26381;&#21153;&#20013;&#22914;&#20309;&#23454;&#29616;&#65311;
</p>
<p>
 &#20195;&#30721;&#22914;&#19979;&#65306;
</p>
<pre><code>&#160;@Override
&#160;@Transactional(rollbackFor = Exception.class)
&#160;public void create(CreateUserCommand command){
&#160; &#160;  //&#26657;&#39564;&#29992;&#25143;&#21517;&#19981;&#23384;&#22312; &#160; &#160;   &#160; &#160; &#160; &#160; &#160; &#160;       &#160; &#160; &#160;  ValidationUtil.isTrue(Objects.isNull(userRepository.byUserName(command.getUserName())),
&#160; &#160; &#160; &#160;     &#160; &#160; &#160; &#160; &#160; &#160; "user.user.name.is.exist");
&#160; &#160; &#160; &#160;  //&#26657;&#39564;&#35282;&#33394;&#23384;&#22312;
&#160; &#160;  List&lt;Role&gt; roles = roleRepository.listByIds(command.getRoles());
&#160; &#160;  ValidationUtil.isTrue(CollectionUtils.isNotEmpty(roles) &amp;&amp;
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;  Objects.equals(roles.size(),command.getRoles().size()),"user.role.is.not.exist");
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;
&#160; &#160; &#160; //&#24037;&#21378;&#21019;&#24314;&#29992;&#25143;
&#160; &#160; &#160; User user = command.toUser(command);
&#160;&#8203;
&#160; &#160;  //&#25191;&#34892;&#29992;&#25143;&#26032;&#22686;&#30456;&#20851;&#19994;&#21153;&#36923;&#36753;
&#160; &#160;  user.printCreate();
&#160;&#8203;
&#160; &#160;  //&#25171;&#21360;&#26631;&#31614;
&#160; &#160;  roles.forEach(role-&gt;{
&#160; &#160;    //&#30465;&#30053;&#22823;&#37327;&#36923;&#36753;
&#160; &#160;    if(Objects.equals(role.getCode(),"admin")){
&#160; &#160;        log.info("&#29992;&#25143;&#65306;{}&#30340;&#26631;&#31614;&#35299;&#26512;&#20026;&#65306;{}",user.getUserName(),role.getName());
&#160; &#160;    }
&#160; &#160;  })
&#160;&#8203;
&#160; &#160;  //&#23384;&#20648;&#29992;&#25143;
&#160; &#160;  User save = userRepository.save(user);
&#160;&#8203;
&#160; &#160;  //&#21457;&#24067;&#29992;&#25143;&#26032;&#24314;&#30340;&#39046;&#22495;&#20107;&#20214;
&#160; &#160;  domainEventPublisher.publish(new UserCreateEvent(save));
&#160;}
</code></pre>
<p>
 &#32534;&#30721;&#24605;&#36335;&#36824;&#26159;&#27604;&#36739;&#31616;&#21333;&#30340;&#65292;&#23601;&#26159;&#20381;&#25454;&#38656;&#27714;&#23558;&#19994;&#21153;&#36923;&#36753;&#32534;&#25490;&#22312;&#24212;&#29992;&#26381;&#21153;&#20013;&#12290;
</p>
<p>
 &#39318;&#20808;&#25105;&#35201;&#35828;&#30340;&#26159;&#65292;&#36825;&#26679;&#20889;&#26159;&#23436;&#20840;&#31526;&#21512;DDD&#20256;&#32479;&#26550;&#26500;&#20998;&#23618;&#32534;&#30721;&#35268;&#33539;&#30340;&#65292;&#20063;&#26159;&#20869;&#32858;&#20102;&#19994;&#21153;&#36923;&#36753;&#30340;&#20889;&#27861;&#12290;&#19981;&#36807;&#31934;&#30410;&#27714;&#31934;&#22043;&#65292;&#25105;&#20204;&#26469;&#30475;&#30475;&#30452;&#25509;&#32534;&#25490;&#23384;&#22312;&#20160;&#20040;&#26679;&#30340;&#23567;&#38382;&#39064;&#12290;
</p>
<ul>
 <li>
  <p>
   <strong>
    &#21407;&#23376;&#21270;&#32534;&#25490;&#36923;&#36753;
   </strong>
   &#12290;17&#34892;&#21040;23&#34892;&#26412;&#36136;&#19978;&#24819;&#26159;&#35201;&#23454;&#29616;&#22914;&#26524;&#29992;&#25143;&#20851;&#32852;&#30340;&#35282;&#33394;&#23384;&#22312;&#31649;&#29702;&#21592;&#65292;&#23601;&#25171;&#21360;&#19968;&#19979;&#26631;&#31614;&#12290;&#20854;&#23454;&#36825;&#20010;&#25805;&#20316;&#26159;&#23646;&#20110;&#29992;&#25143;&#39046;&#22495;&#20013;&#30340;&#25171;&#21360;&#26631;&#31614;&#36923;&#36753;&#65292;&#21482;&#19981;&#36807;&#36825;&#20010;&#36923;&#36753;&#28041;&#21450;&#21040;&#20102;&#29992;&#25143;&#39046;&#22495;&#27169;&#22411;&#19982;&#35282;&#33394;&#39046;&#22495;&#27169;&#22411;&#21327;&#20316;&#65292;&#24212;&#29992;&#26381;&#21153;&#21482;&#33021;&#19968;&#34892;&#34892;&#30340;&#32534;&#25490;&#12290;
  </p>
 </li>
 <li>
  <p>
   <strong>
    &#24212;&#29992;&#26381;&#21153;&#22797;&#29992;
   </strong>
   &#12290;&#24212;&#29992;&#26381;&#21153;&#20043;&#38388;&#20114;&#30456;&#35843;&#29992;&#24182;&#19981;&#26159;&#31105;&#27490;&#30340;&#65292;&#20294;&#20063;&#19981;&#25552;&#20513;&#12290;&#22240;&#20026;&#20250;&#23548;&#33268;&#20004;&#20010;&#19981;&#21516;&#39046;&#22495;&#30340;&#21151;&#33021;&#28857;&#20114;&#30456;&#20135;&#29983;&#20381;&#36182;&#65292;&#32780;&#19981;&#26159;&#30452;&#25509;&#32534;&#25490;&#30340;&#36923;&#36753;&#65292;&#20294;&#26159;&#20026;&#20102;&#22797;&#29992;&#36923;&#36753;&#65292;&#36825;&#31181;&#20114;&#30456;&#35843;&#29992;&#21448;&#19981;&#21487;&#33021;&#36991;&#20813;&#12290;
  </p>
 </li>
</ul>
<h2>
 &#20108;&#12289;&#25910;&#32553;&#32534;&#25490;&#36923;&#36753;
</h2>
<p>
 &#25105;&#20204;&#33021;&#22815;&#36890;&#36807;&#24341;&#20837;&#33021;&#21147;&#23618;&#19982;&#39046;&#22495;&#26381;&#21153;&#30340;&#26041;&#24335;&#26469;&#35299;&#20915;&#24212;&#29992;&#26381;&#21153;&#20013;&#21487;&#33021;&#23384;&#22312;&#30340;&#38382;&#39064;&#65292;&#30475;&#19968;&#19979;&#23454;&#29616;&#21518;&#30340;&#20195;&#30721;&#12290;
</p>
<h3>
 1. &#39046;&#22495;&#26381;&#21153;
</h3>
<p>
 &#25105;&#20204;&#25226;17&#21040;23&#34892;&#30340;&#29992;&#25143;&#26681;&#25454;&#35282;&#33394;&#25171;&#21360;&#26631;&#31614;&#36923;&#36753;&#21512;&#24182;&#33267;&#29992;&#25143;&#39046;&#22495;&#26381;&#21153;&#20013;&#65292;&#20195;&#30721;&#22914;&#19979;&#65306;
</p>
<pre><code>&#160;@Service
&#160;@Slf4j
&#160;public class UserDomainServiceImpl implements UserDomainService {
&#160;&#8203;
&#160; &#160;  @Override
&#160; &#160;  public void printTag(User user, List&lt;Role&gt; roles){
&#160; &#160; &#160; &#160;  roles.forEach(role-&gt;{
&#160; &#160; &#160; &#160; &#160; &#160;  //&#30465;&#30053;&#22823;&#37327;&#36923;&#36753;
&#160; &#160; &#160; &#160; &#160; &#160;  if(role.isAdmin()){
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;  log.info("&#29992;&#25143;&#65306;{}&#30340;&#26631;&#31614;&#35299;&#26512;&#20026;&#65306;{}",user.getUserName(),role.getName());
&#160; &#160; &#160; &#160; &#160; &#160;  }
&#160; &#160; &#160; &#160;  });
&#160; &#160;  }
&#160;}
</code></pre>
<p>
 &#22312;&#35282;&#33394;&#32858;&#21512;&#26681;&#20013;&#23450;&#20041;&#19994;&#21153;&#26041;&#27861;&#22914;&#19979;&#65306;
</p>
<pre><code>&#160;/**
&#160;* &#33719;&#21462;&#29992;&#25143;&#35282;&#33394;&#26631;&#31614;
&#160;*
&#160;* @return
&#160;*/
&#160;public Boolean isAdmin(){
&#160;  //&#27492;&#22788;&#30465;&#30053;100&#34892;&#20195;&#30721;
&#160;  return Objects.equals(this.code,"admin");
&#160;}
</code></pre>
<p>
 &#36825;&#26679;&#25105;&#20204;&#21487;&#20197;&#22312;&#33021;&#21147;&#23618;&#36890;&#36807;&#20256;&#36882;&#29992;&#25143;&#32858;&#21512;&#26681;&#19982;&#35282;&#33394;&#32858;&#21512;&#26681;&#21015;&#34920;&#33267;&#29992;&#25143;&#39046;&#22495;&#26381;&#21153;&#30340;&#26041;&#24335;&#26469;&#23436;&#25104;&#25171;&#21360;&#29992;&#25143;&#35282;&#33394;&#26631;&#31614;&#36825;&#20010;&#21407;&#23376;&#21270;&#21151;&#33021;&#20102;&#12290;
</p>
<h3>
 2. &#33021;&#21147;&#23618;
</h3>
<p>
 &#25105;&#20204;&#22312;&#8220;DDD&#30340;&#20998;&#23618;&#35814;&#35299;&#8221;&#19968;&#25991;&#20013;&#24050;&#32463;&#26126;&#30333;&#20102;&#33021;&#21147;&#20998;&#23618;&#30340;&#23450;&#20301;&#65292;&#23427;&#20351;&#29992;&#26469;&#20026;&#24212;&#29992;&#26381;&#21153;&#25552;&#20379;&#33021;&#21147;&#30340;&#12290;&#23427;&#20005;&#26684;&#24847;&#20041;&#19978;&#19981;&#26159;&#19968;&#20010;&#23618;&#65292;&#26159;&#20026;&#20102;&#34920;&#31034;&#19968;&#20010;&#21151;&#33021;&#29305;&#33394;&#27604;&#36739;&#21407;&#23376;&#19988;&#36923;&#36753;&#31361;&#20986;&#30340;&#23567;&#22411;&#24212;&#29992;&#26381;&#21153;&#12290;
</p>
<p>
 &#20174;&#23427;&#30340;&#23450;&#20041;&#25105;&#20204;&#19981;&#38590;&#30475;&#20986;&#26469;&#65292;&#33021;&#21147;&#23618;&#19981;&#20687;&#24212;&#29992;&#26381;&#21153;&#37027;&#26679;&#32858;&#38598;&#20102;&#19968;&#22534;&#21151;&#33021;&#28857;&#65292;&#23427;&#21482;&#26377;&#19968;&#20010;&#20837;&#21475;&#65292;&#23545;&#24212;&#36825;&#25552;&#20379;&#20160;&#20040;&#26679;&#30340;&#33021;&#21147;&#12290;
</p>
<p>
 &#26469;&#30475;&#19968;&#19979;&#33021;&#21147;&#23618;&#30340;&#25277;&#35937;&#65306;
</p>
<pre><code>&#160;@Component
&#160;public abstract class BaseAbility&lt;T, R&gt; {
&#160;&#8203;
&#160; &#160;  /**
&#160; &#160; &#160; * &#33021;&#21147;&#28857;&#25191;&#34892;
&#160; &#160; &#160; *
&#160; &#160; &#160; * @param abilityCmd
&#160; &#160; &#160; * @return
&#160; &#160; &#160; */
&#160; &#160;  @Transactional(rollbackFor = Exception.class)
&#160; &#160;  public Result&lt;R&gt; executeAbility(T abilityCmd) {
&#160; &#160; &#160; &#160;  try {
&#160;&#8203;
&#160; &#160; &#160; &#160; &#160; &#160;  //&#21021;&#22987;&#21270;&#19978;&#19979;&#25991;
&#160; &#160; &#160; &#160; &#160; &#160;  AbilityContext.initContext();
&#160;&#8203;
&#160; &#160; &#160; &#160; &#160; &#160;  //&#33021;&#21147;&#28857;&#25191;&#34892;&#21069;&#30340;&#21442;&#25968;&#26657;&#39564;
&#160; &#160; &#160; &#160; &#160; &#160;  checkHandler(abilityCmd);
&#160;&#8203;
&#160; &#160; &#160; &#160; &#160; &#160;  //&#33021;&#21147;&#28857;&#25191;&#34892;&#21069;&#30340;&#24130;&#31561;&#26657;&#39564;
&#160; &#160; &#160; &#160; &#160; &#160;  Result&lt;R&gt; checkIdempotent = checkIdempotent(abilityCmd);
&#160; &#160; &#160; &#160; &#160; &#160;  if (Objects.isNull(checkIdempotent) || !Objects.equals(checkIdempotent.getCode(), BaseResult.CODE_SUCCESS)) {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;  return checkIdempotent;
&#160; &#160; &#160; &#160; &#160; &#160;  }
&#160;&#8203;
&#160; &#160; &#160; &#160; &#160; &#160;  //&#25191;&#34892;&#33021;&#21147;&#19994;&#21153;
&#160; &#160; &#160; &#160; &#160; &#160;  return execute(abilityCmd);
&#160;&#8203;
&#160; &#160; &#160; &#160;  } finally {
&#160; &#160; &#160; &#160; &#160; &#160;  AbilityContext.clearContext();
&#160; &#160; &#160; &#160;  }
&#160; &#160;  }
&#160;&#8203;
&#160; &#160;  /**
&#160; &#160; &#160; * &#33021;&#21147;&#28857;&#25191;&#34892;&#21069;&#30340;&#21442;&#25968;&#26657;&#39564;
&#160; &#160; &#160; *
&#160; &#160; &#160; * @param abilityCmd abilityCmd
&#160; &#160; &#160; * @return
&#160; &#160; &#160; */
&#160; &#160;  public abstract void checkHandler(T abilityCmd);
&#160;&#8203;
&#160; &#160;  /**
&#160; &#160; &#160; * &#33021;&#21147;&#28857;&#25191;&#34892;&#21069;&#30340;&#24130;&#31561;&#26657;&#39564;
&#160; &#160; &#160; *
&#160; &#160; &#160; * @param abilityCmd abilityCmd
&#160; &#160; &#160; * @return false&#65306;&#24403;&#21069;&#33021;&#21147;&#28857;&#24050;&#25191;&#34892;&#65292;&#19981;&#20877;&#25191;&#34892;&#19994;&#21153;&#36923;&#36753;&#12289;true&#65306;&#24403;&#21069;&#33021;&#21147;&#28857;&#26410;&#25191;&#34892;&#65292;&#32487;&#32493;&#25191;&#34892;&#19994;&#21153;&#36923;&#36753;
&#160; &#160; &#160; */
&#160; &#160;  public abstract Result&lt;R&gt; checkIdempotent(T abilityCmd);
&#160;&#8203;
&#160; &#160;  /**
&#160; &#160; &#160; * &#25191;&#34892;&#33021;&#21147;&#19994;&#21153;
&#160; &#160; &#160; *
&#160; &#160; &#160; * @param abilityCmd abilityCmd
&#160; &#160; &#160; * @return return
&#160; &#160; &#160; */
&#160; &#160;  public abstract Result&lt;R&gt; execute(T abilityCmd);
&#160;&#8203;
&#160;}
</code></pre>
<p>
 &#25152;&#26377;&#30340;&#33021;&#21147;&#36890;&#36807;&#32487;&#25215;&#25277;&#35937;&#33021;&#21147;&#30340;&#26041;&#24335;&#26469;&#23454;&#29616;&#20855;&#20307;&#30340;&#19994;&#21153;&#36923;&#36753;&#12290;&#23545;&#24212;&#30340;&#24212;&#29992;&#26381;&#21153;&#35843;&#29992;&#33021;&#21147;&#25191;&#34892;&#28857;
 <strong>
  executeAbility
 </strong>
 &#21363;&#21487;&#12290;
</p>
<p>
 <strong>
  &#25191;&#34892;&#28857;&#37324;&#38754;&#30340;&#25191;&#34892;&#20027;&#35201;&#20998;&#20026;&#20116;&#27493;&#12290;
 </strong>
</p>
<ol>
 <li>
  &#21021;&#22987;&#21270;&#24403;&#21069;&#33021;&#21147;&#30340;&#19978;&#19979;&#25991;&#20449;&#24687;&#65292;&#20027;&#35201;&#26159;&#20026;&#21518;&#32493;&#27493;&#39588;&#25552;&#20379;&#33021;&#21147;&#28857;&#20869;&#30340;&#32447;&#31243;&#21464;&#37327;&#35775;&#38382;&#33021;&#21147;&#65292;&#36991;&#20813;&#37325;&#22797;&#21152;&#36733;&#25968;&#25454;&#12290;
 </li>
 <li>
  &#21151;&#33021;&#28857;&#21069;&#32622;&#30340;&#21442;&#25968;&#26657;&#39564;&#65292;&#26657;&#39564;&#19981;&#36890;&#36807;&#21017;&#36890;&#36807;&#25243;&#20986;&#24322;&#24120;&#30340;&#26041;&#24335;&#20013;&#26029;&#21151;&#33021;&#28857;&#30340;&#25191;&#34892;&#12290;
 </li>
 <li>
  &#25968;&#25454;&#24130;&#31561;&#30340;&#26657;&#39564;&#65292;&#20363;&#22914;&#35746;&#21333;&#24050;&#32463;&#25903;&#20184;&#21017;&#19981;&#22312;&#36827;&#34892;&#25903;&#20184;&#12290;&#36890;&#36807;&#36820;&#22238;&#32467;&#26524;&#30340;&#26041;&#24335;&#20013;&#26029;&#27969;&#31243;&#65292;&#30001;&#24212;&#29992;&#26381;&#21153;&#20915;&#23450;&#22914;&#20309;&#22788;&#29702;&#12290;
 </li>
 <li>
  &#20855;&#20307;&#33021;&#21147;&#28857;&#30340;&#36923;&#36753;&#25191;&#34892;&#65292;&#32534;&#20889;&#35268;&#33539;&#19982;&#24212;&#29992;&#26381;&#21153;&#19968;&#33268;&#12290;
 </li>
 <li>
  &#28165;&#26970;&#33021;&#21147;&#28857;&#25191;&#34892;&#36807;&#31243;&#20013;&#21152;&#36733;&#30340;&#19978;&#19979;&#25991;&#20449;&#24687;&#65292;&#38450;&#27490;&#20869;&#23384;&#27844;&#28431;&#12290;
 </li>
</ol>
<p>
 &#23558;&#19968;&#20010;&#33021;&#21147;&#25191;&#34892;&#20998;&#20026;&#20116;&#27493;&#21518;&#65292;&#23454;&#38469;&#30340;&#19994;&#21153;&#32534;&#25490;&#26102;&#25918;&#22312;&#31532;&#22235;&#27493;&#30340;&#25191;&#34892;&#22788;&#65292;&#35753;&#20855;&#20307;&#30340;&#25191;&#34892;&#28857;&#30340;&#36923;&#36753;&#26356;&#21152;&#28165;&#26224;&#26126;&#20102;&#12290;
</p>
<p>
 &#25105;&#20204;&#20877;&#30475;&#19968;&#19979;&#29992;&#25143;&#26032;&#22686;&#33021;&#21147;&#28857;&#30340;&#20195;&#30721;&#65306;
</p>
<pre><code>&#160;@Service
&#160;public class UserCreateAbility extends BaseAbility&lt;CreateUserAbilityCommand, Void&gt; {
&#160;&#8203;
&#160; &#160;  @Autowired
&#160; &#160;  RoleRepository roleRepository;
&#160;&#8203;
&#160; &#160;  @Autowired
&#160; &#160;  UserRepository userRepository;
&#160;&#8203;
&#160; &#160;  @Autowired
&#160; &#160;  DomainEventPublisher domainEventPublisher;
&#160;&#8203;
&#160; &#160;  @Autowired
&#160; &#160;  UserDomainService userDomainService;
&#160;&#8203;
&#160; &#160;  private final static String ROLE_INFO_KEY = "roleInfo";
&#160;&#8203;
&#160; &#160;  @Override
&#160; &#160;  public void checkHandler(CreateUserAbilityCommand command) {
&#160; &#160; &#160; &#160;  //&#26657;&#39564;&#29992;&#25143;&#21517;&#19981;&#23384;&#22312;
&#160; &#160; &#160; &#160;  ValidationUtil.isTrue(Objects.isNull(userRepository.byUserName(command.getUserName())),"user.user.name.is.exist");
&#160; &#160; &#160; &#160;  //&#26657;&#39564;&#35282;&#33394;&#23384;&#22312;
&#160; &#160; &#160; &#160;  List&lt;Role&gt; roles = roleRepository.listByIds(command.getRoles());
&#160; &#160; &#160; &#160;  ValidationUtil.isTrue(CollectionUtils.isNotEmpty(roles) &amp;&amp;
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;  Objects.equals(roles.size(),command.getRoles().size()),
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;  "user.role.is.not.exist");
&#160; &#160; &#160; &#160;  AbilityContext.putValue(ROLE_INFO_KEY,roles);
&#160; &#160;  }
&#160;&#8203;
&#160; &#160;  @Override
&#160; &#160;  public Result&lt;Void&gt; checkIdempotent(CreateUserAbilityCommand command) {
&#160;&#8203;
&#160; &#160; &#160; &#160;  //&#22312;&#36825;&#37324;&#36827;&#34892;&#24130;&#31561;&#22788;&#29702;&#21028;&#26029;
&#160;&#8203;
&#160; &#160; &#160; &#160;  return Result.success(null);
&#160; &#160;  }
&#160;&#8203;
&#160; &#160;  @Override
&#160; &#160;  public Result&lt;Void&gt; execute(CreateUserAbilityCommand command) {
&#160;&#8203;
&#160; &#160; &#160; &#160;  //&#24037;&#21378;&#21019;&#24314;&#29992;&#25143;
&#160; &#160; &#160; &#160;  User user = command.toUser(command);
&#160;&#8203;
&#160; &#160; &#160; &#160;  //&#25191;&#34892;&#29992;&#25143;&#26032;&#22686;&#30456;&#20851;&#19994;&#21153;&#36923;&#36753;
&#160; &#160; &#160; &#160;  user.printCreate();
&#160;&#8203;
&#160; &#160; &#160; &#160;  //&#20165;&#20165;&#20026;&#20102;&#28436;&#31034;&#39046;&#22495;&#26381;&#21153;&#20351;&#29992;&#65292;&#36825;&#27809;&#24517;&#35201;&#36825;&#20040;&#20570;&#65292;&#33021;&#21147;&#28857;&#24050;&#32463;&#26159;&#19968;&#20010;&#27604;&#36739;&#21407;&#23376;&#30340;&#19994;&#21153;&#36923;&#36753;&#28857;&#20102;
&#160; &#160; &#160; &#160;  //&#29702;&#35770;&#19978;&#26377;&#20102;&#33021;&#21147;&#23618;&#20043;&#21518;&#30452;&#25509;&#21487;&#20197;&#30733;&#25481;&#39046;&#22495;&#26381;&#21153;&#23618;
&#160; &#160; &#160; &#160;  List&lt;Role&gt; roles = (List&lt;Role&gt;)AbilityContext.getValue(ROLE_INFO_KEY);
&#160; &#160; &#160; &#160;  userDomainService.printTag(user, roles);
&#160;&#8203;
&#160; &#160; &#160; &#160;  //&#23384;&#20648;&#29992;&#25143;
&#160; &#160; &#160; &#160;  User save = userRepository.save(user);
&#160;&#8203;
&#160; &#160; &#160; &#160;  //&#21457;&#24067;&#29992;&#25143;&#26032;&#24314;&#30340;&#39046;&#22495;&#20107;&#20214;
&#160; &#160; &#160; &#160;  domainEventPublisher.publish(new UserCreateEvent(save));
&#160;&#8203;
&#160; &#160; &#160; &#160;  return Result.success(null);
&#160; &#160;  }
&#160;&#8203;
&#160;}
</code></pre>
<p>
 &#36890;&#36807;&#23454;&#29616;&#25277;&#35937;&#25509;&#21475;&#30340;&#19977;&#20010;&#25277;&#35937;&#26041;&#27861;&#30340;&#26041;&#24335;&#26469;&#23436;&#25104;&#19994;&#21153;&#36923;&#36753;&#12290;
</p>
<p>
 &#27880;&#24847;&#30475;checkHandler&#36825;&#37324;&#30340;&#21442;&#25968;&#26657;&#39564;&#36923;&#36753;&#12290;&#25105;&#20204;&#38656;&#35201;&#21306;&#20998;&#26032;&#22686;&#19982;&#20462;&#25913;&#30340;&#21442;&#25968;&#26657;&#39564;&#36923;&#36753;&#12290;
</p>
<p>
 &#29992;&#25143;&#20462;&#25913;&#26102;&#65292;&#29992;&#25143;&#39046;&#22495;&#27169;&#22411;&#24050;&#32463;&#23384;&#22312;&#20102;&#65292;&#22240;&#27492;&#23545;&#23384;&#22312;&#30340;&#39046;&#22495;&#27169;&#22411;&#36827;&#34892;&#20462;&#25913;&#37117;&#38656;&#35201;&#36890;&#36807;&#39046;&#22495;&#27169;&#22411;&#20869;&#30340;&#19994;&#21153;&#26041;&#27861;&#26469;&#20462;&#25913;&#65292;&#20445;&#35777;&#39046;&#22495;&#27169;&#22411;&#30340;&#23436;&#25972;&#24615;&#19982;&#19968;&#33268;&#24615;&#12290;
</p>
<p>
 &#32780;&#26032;&#22686;&#30340;&#26102;&#20505;&#65292;&#39046;&#22495;&#27169;&#22411;&#36824;&#27809;&#26377;&#29983;&#25104;&#12290;&#25105;&#20064;&#24815;&#20808;&#20570;&#21442;&#25968;&#26657;&#39564;&#65292;&#36890;&#36807;&#21518;&#20877;&#36827;&#34892;&#39046;&#22495;&#27169;&#22411;&#30340;&#26032;&#22686;&#12290;
</p>
<p>
 &#36824;&#26377;&#19968;&#31181;&#26041;&#24335;&#26159;&#23450;&#20041;&#19968;&#20010;&#24037;&#21378;&#31867;&#65292;&#25226;&#39046;&#22495;&#27169;&#22411;&#30340;&#26500;&#36896;&#19982;&#26657;&#39564;&#28151;&#21512;&#22312;&#24037;&#21378;&#31867;&#20013;&#12290;&#36825;&#31181;&#26041;&#24335;&#25105;&#22312;&#23454;&#38469;&#24212;&#29992;&#26102;&#21457;&#29616;&#65292;&#36825;&#31181;&#24037;&#21378;&#31867;&#22823;&#22810;&#25968;&#24773;&#20917;&#19979;&#21482;&#33021;&#34987;&#26576;&#19968;&#20010;&#24212;&#29992;&#26381;&#21153;&#25110;&#32773;&#33021;&#21147;&#23618;&#32473;&#20351;&#29992;&#12290;&#32780;&#19988;&#19968;&#26086;&#20351;&#29992;&#19981;&#24403;&#65292;&#24456;&#23481;&#26131;&#22312;&#24037;&#21378;&#31867;&#37324;&#38754;&#20889;&#24456;&#22810;&#30340;&#36923;&#36753;&#65292;&#25105;&#19981;&#22826;&#25512;&#33616;&#36825;&#31181;&#20570;&#27861;&#12290;
</p>
<p>
 &#20877;&#26469;&#30475;&#30475;&#31532;27&#34892;&#65292;&#25105;&#20204;&#36890;&#36807;&#22686;&#21152;&#19978;&#19979;&#25991;&#21464;&#37327;&#30340;&#26041;&#24335;&#26469;&#36991;&#20813;&#37325;&#22797;&#26597;&#35810;&#35282;&#33394;&#32858;&#21512;&#26469;&#36827;&#34892;&#21518;&#32493;&#30340;&#19994;&#21153;&#36923;&#36753;&#22788;&#29702;&#12290;
</p>
<h3>
 3. &#24212;&#29992;&#26381;&#21153;
</h3>
<pre><code>&#160;@Override
&#160;@Transactional(rollbackFor = Exception.class)
&#160;public void create(CreateUserAbilityCommand command){
&#160; &#160;  userCreateAbility.executeAbility(command);
&#160;}
</code></pre>
<p>
 &#26368;&#21518;&#24212;&#29992;&#26381;&#21153;&#30452;&#25509;&#24212;&#29992;&#33021;&#21147;&#23618;&#30340;&#25191;&#34892;&#28857;&#21363;&#21487;&#12290;&#19981;&#21516;&#39046;&#22495;&#20043;&#38388;&#22914;&#26524;&#38656;&#35201;&#24212;&#29992;&#26381;&#21153;&#30340;&#21327;&#20316;&#65292;&#21017;&#21487;&#20197;&#25277;&#31163;&#19968;&#20010;&#33021;&#21147;&#23618;&#30340;&#26041;&#24335;&#26469;&#20316;&#20026;&#24212;&#29992;&#26381;&#21153;&#20043;&#38388;&#30340;&#26725;&#26753;&#12290;
</p>
<p>
 &#24212;&#29992;&#26381;&#21153;&#20837;&#21442;&#19982;&#33021;&#21147;&#28857;&#20837;&#21442;&#26377;&#24046;&#24322;&#30340;&#21487;&#20197;&#23450;&#20041;&#19968;&#20010;&#23545;&#24212;&#33021;&#21147;&#28857;&#30340;assmbler&#36827;&#34892;&#21442;&#25968;&#36716;&#25442;&#65292;&#20363;&#22914;&#65306;
 <code>
  com.baiyan.ddd.application.ability.user.assembler
 </code>
 &#12290;
</p>
<h2>
 &#19977;&#12289;&#33853;&#22320;&#20107;&#20214;&#39537;&#21160;&#27169;&#22411;
</h2>
<p>
 &#21040;&#30446;&#21069;&#20026;&#27490;&#65292;&#25105;&#20204;&#24050;&#32463;&#25226;&#22788;&#20110;&#21516;&#19968;&#20107;&#21153;&#25110;&#32773;&#24378;&#19994;&#21153;&#36923;&#36753;&#30340;&#21151;&#33021;&#28857;&#33853;&#22320;&#20195;&#30721;&#20998;&#26512;&#23436;&#25104;&#12290;
</p>
<p>
 &#22312;&#12298;DDD-Demo&#28436;&#31034;&#65288;&#19977;&#65289;&#65306;&#22686;&#21024;&#25913;&#26597;&#12299;&#20013;&#25105;&#20204;&#24050;&#32463;&#30693;&#36947;&#20102;&#22914;&#20309;&#20351;&#29992;&#20107;&#20214;&#39537;&#21160;&#27169;&#22411;&#35299;&#32806;&#19981;&#21516;&#20107;&#21153;&#19979;&#25110;&#32773;&#38750;&#24378;&#19994;&#21153;&#36923;&#36753;&#30456;&#20851;&#30340;&#21151;&#33021;&#12290;
</p>
<p>
 &#20294;&#25105;&#20204;&#21482;&#26159;&#38024;&#23545;&#20107;&#20214;&#39537;&#21160;&#27169;&#22411;&#20351;&#29992;&#20102;&#20854;&#35299;&#32806;&#30340;&#21151;&#33021;&#65292;&#21035;&#24536;&#20102;&#23427;&#36824;&#26377;&#20107;&#20214;&#28335;&#28304;&#30340;&#33021;&#21147;&#12290;
</p>
<p>
 &#25105;&#20204;&#20197;&#29992;&#25143;&#34987;&#21024;&#38500;&#20107;&#20214;&#20026;&#20363;&#65292;&#19968;&#36215;&#26469;&#30475;&#30475;&#24590;&#20040;&#23558;&#20107;&#20214;&#28335;&#28304;&#21512;&#24182;&#36827;&#20107;&#20214;&#39537;&#21160;&#27169;&#22411;&#12290;
</p>
<h3>
 1. &#23450;&#20041;&#25277;&#35937;&#39046;&#22495;&#20107;&#20214;
</h3>
<pre><code>&#160;@Getter
&#160;@Setter
&#160;@NoArgsConstructor
&#160;public abstract class BaseDomainEvent&lt;T&gt; implements Serializable {
&#160;&#8203;
&#160; &#160;  private static final long serialVersionUID = 1465328245048581896L;
&#160;&#8203;
&#160; &#160;  /**
&#160; &#160; &#160; * &#24130;&#31561;&#38190;:&#21363;&#20026;&#24403;&#21069;&#20107;&#20214;&#30340;id
&#160; &#160; &#160; */
&#160; &#160;  private String id;
&#160;&#8203;
&#160; &#160;  /**
&#160; &#160; &#160; * &#39046;&#22495;&#23545;&#35937;id
&#160; &#160; &#160; */
&#160; &#160;  private String domainId;
&#160;&#8203;
&#160; &#160;  /**
&#160; &#160; &#160; * &#20107;&#20214;&#29366;&#24577;
&#160; &#160; &#160; */
&#160; &#160;  private EventStatusEnum eventStatus;
&#160;&#8203;
&#160; &#160;  /**
&#160; &#160; &#160; * &#20107;&#20214;&#31867;&#22411;
&#160; &#160; &#160; */
&#160; &#160;  private DomainEventEnum eventType;
&#160;&#8203;
&#160; &#160;  /**
&#160; &#160; &#160; * &#19994;&#21153;&#21457;&#29983;&#26102;&#38388;
&#160; &#160; &#160; */
&#160; &#160;  private LocalDateTime occurredOn;
&#160;&#8203;
&#160; &#160;  /**
&#160; &#160; &#160; * &#39046;&#22495;&#20107;&#20214;&#25968;&#25454;
&#160; &#160; &#160; */
&#160; &#160;  private T data;
&#160;&#8203;
&#160; &#160;  public BaseDomainEvent(String domainId, String id, DomainEventEnum eventType, EventStatusEnum eventStatus, LocalDateTime occurredOn, T data) {
&#160; &#160; &#160; &#160;  this.domainId = domainId;
&#160; &#160; &#160; &#160;  this.id = id;
&#160; &#160; &#160; &#160;  this.eventType = eventType;
&#160; &#160; &#160; &#160;  this.eventStatus = eventStatus;
&#160; &#160; &#160; &#160;  this.data = data;
&#160; &#160; &#160; &#160;  this.occurredOn = occurredOn;
&#160; &#160;  }
&#160;&#8203;
&#160; &#160;  /**
&#160; &#160; &#160; * &#20462;&#25913;&#26102;&#38388;&#29366;&#24577;&#20026;&#25104;&#21151;
&#160; &#160; &#160; */
&#160; &#160;  public void handleSuccess() {
&#160; &#160; &#160; &#160;  this.eventStatus = EventStatusEnum.SUCCESS;
&#160; &#160;  }
&#160;&#8203;
&#160; &#160;  /**
&#160; &#160; &#160; * &#20462;&#25913;&#20107;&#20214;&#29366;&#24577;&#20026;&#22833;&#36133;
&#160; &#160; &#160; */
&#160; &#160;  public void handleFailed() {
&#160; &#160; &#160; &#160;  this.eventStatus = EventStatusEnum.FAILED;
&#160; &#160;  }
&#160;&#8203;
&#160;}
</code></pre>
<p>
 &#25152;&#26377;&#19994;&#21153;&#30340;&#39046;&#22495;&#20107;&#20214;&#22343;&#38656;&#35201;&#32487;&#25215;&#27492;&#31867;&#65292;&#23646;&#24615;&#35299;&#37322;&#22914;&#19979;&#12290;
</p>
<ul>
 <li>
  <strong>
   id
  </strong>
  &#65306;&#34920;&#31034;&#24403;&#21069;&#20107;&#20214;&#34987;&#28335;&#28304;&#26102;&#30340;&#21807;&#19968;id&#65292;&#20840;&#23616;&#21807;&#19968;&#65292;&#24314;&#35758;&#36890;&#36807;&#19987;&#38376;&#30340;&#38634;&#33457;id&#29983;&#25104;&#26381;&#21153;&#29983;&#25104;&#12290;
 </li>
 <li>
  <strong>
   domainId
  </strong>
  &#65306;&#39046;&#22495;&#23545;&#35937;&#30340;id&#65292;&#27604;&#22914;&#35746;&#21333;&#39046;&#22495;&#19979;&#34920;&#31034;&#35746;&#21333;id&#12290;&#21487;&#20197;&#26681;&#25454;&#27492;&#19994;&#21153;id&#33719;&#21462;&#26576;&#20010;&#19994;&#21153;&#23545;&#35937;&#30340;&#25152;&#26377;&#21382;&#21490;&#20107;&#20214;&#65292;&#20415;&#20110;&#28335;&#28304;&#25972;&#29702;&#12290;
 </li>
 <li>
  <strong>
   eventStatus
  </strong>
  &#65306;&#20107;&#20214;&#29366;&#24577;&#65292;&#29992;&#20110;&#34920;&#31034;&#20107;&#20214;&#22312;&#28335;&#28304;&#36807;&#31243;&#20013;&#30340;&#29366;&#24577;&#12290;&#21457;&#36865;&#26102;&#22788;&#20110;&#24102;&#24453;&#22788;&#29702;&#29366;&#24577;&#65292;&#20107;&#20214;&#34987;&#27491;&#30830;&#22788;&#29702;&#21518;&#25913;&#20026;&#22788;&#29702;&#25104;&#21151;&#65292;&#22788;&#29702;&#22833;&#36133;&#21518;&#20462;&#25913;&#29366;&#24577;&#20026;&#21021;&#22987;&#22833;&#36133;&#12290;&#35813;&#23383;&#27573;&#20165;&#20026;&#20107;&#20214;&#28335;&#28304;&#20351;&#29992;&#65292;&#22914;&#26524;&#30452;&#25509;&#21457;&#36865;&#28040;&#24687;&#65292;&#19981;&#38656;&#35201;&#20107;&#20214;&#28335;&#28304;&#65292;&#21017;&#35813;&#23383;&#27573;&#27809;&#26377;&#20219;&#20309;&#24847;&#20041;&#12290;
 </li>
 <li>
  <strong>
   eventType
  </strong>
  &#65306;&#20107;&#20214;&#31867;&#22411;&#65292;&#29992;&#20110;&#31649;&#29702;&#20840;&#23616;&#30340;&#20107;&#20214;&#12290;
 </li>
 <li>
  <strong>
   occurredOn
  </strong>
  &#65306;&#20107;&#20214;&#21457;&#29983;&#26102;&#38388;&#65292;&#19968;&#33324;&#24773;&#20917;&#19979;&#23601;&#26159;&#24403;&#21069;&#20195;&#30721;&#25191;&#34892;&#26102;&#38388;&#65292;&#22914;&#26524;&#19994;&#21153;&#26377;&#29305;&#27530;&#38656;&#27714;&#21017;&#21487;&#21333;&#29420;&#25351;&#23450;&#12290;
 </li>
 <li>
  <strong>
   data
  </strong>
  &#65306;&#20107;&#20214;&#25968;&#25454;&#12290;
 </li>
</ul>
<h3>
 2. &#23450;&#20041;&#19994;&#21153;&#39046;&#22495;&#20107;&#20214;
</h3>
<pre><code>&#160;/**
&#160; * &#29992;&#25143;&#21024;&#38500;&#39046;&#22495;&#20107;&#20214;
&#160; *
&#160; * @author baiyan
&#160; */
&#160;public class UserDeleteEvent extends BaseDomainEvent&lt;Long&gt; {
&#160;&#8203;
&#160; &#160;  public UserDeleteEvent(Long id) {
&#160; &#160; &#160; &#160;  super(String.valueOf(id),
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;  //&#20165;&#20570;&#28436;&#31034;&#65292;&#39046;&#22495;&#20107;&#20214;id&#20026;&#38450;&#27490;&#37325;&#22797;&#24314;&#35758;&#33258;&#23450;&#20041;&#38634;&#33457;id
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;  UUID.fastUUID().toString(),
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;  DomainEventEnum.USER_DELETE,
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;  EventStatusEnum.PENDING,
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;  LocalDateTime.now(),
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;  id
&#160; &#160; &#160; &#160;  );
&#160; &#160;  }
&#160;&#8203;
&#160;}
</code></pre>
<p>
 &#23450;&#20041;&#19994;&#21153;&#39046;&#22495;&#20107;&#20214;&#26469;&#36890;&#30693;&#20854;&#20182;&#39046;&#22495;&#27169;&#22411;&#24182;&#28335;&#28304;&#12290;
</p>
<h3>
 3. &#23450;&#20041;&#21516;&#19968;&#19994;&#21153;&#20107;&#20214;&#21457;&#36865;&#26041;
</h3>
<p>
 &#25509;&#21475;&#23450;&#20041;&#22914;&#19979;&#65306;
</p>
<pre><code>&#160;/**
&#160; * &#39046;&#22495;&#20107;&#20214;&#21457;&#24067;&#25509;&#21475;
&#160; *
&#160; * @author baiyan
&#160; */
&#160;public interface DomainEventPublisher {
&#160;&#8203;
&#160; &#160;  /**
&#160; &#160; &#160; * &#21457;&#24067;&#20107;&#20214;
&#160; &#160; &#160; *
&#160; &#160; &#160; * @param event event
&#160; &#160; &#160; */
&#160; &#160;  &lt;EVENT extends BaseDomainEvent&gt; void publish(EVENT event);
&#160;&#8203;
&#160; &#160;  /**
&#160; &#160; &#160; * &#21457;&#24067;&#20107;&#20214;&#24182;&#20445;&#23384;
&#160; &#160; &#160; *
&#160; &#160; &#160; * @param event event
&#160; &#160; &#160; */
&#160; &#160;  &lt;EVENT extends BaseDomainEvent&gt; void publishAndSave(EVENT event);
&#160;&#8203;
&#160;}
</code></pre>
<p>
 &#23454;&#29616;&#31867;&#22914;&#19979;&#65306;
</p>
<pre><code>&#160;@Component
&#160;@Slf4j
&#160;public class DomainEventPublisherImpl implements DomainEventPublisher {
&#160;&#8203;
&#160; &#160;  @Autowired
&#160; &#160;  private ApplicationEventPublisher applicationEventPublisher;
&#160;&#8203;
&#160; &#160;  @Autowired
&#160; &#160;  private DomainEventRepository domainEventRepository;
&#160;&#8203;
&#160; &#160;  @Override
&#160; &#160;  public &lt;EVENT extends BaseDomainEvent&gt; void publish(EVENT event) {
&#160; &#160; &#160; &#160;  log.info("&#21457;&#24067;&#20107;&#20214;,event:{}", GsonUtil.gsonToString(event));
&#160; &#160; &#160; &#160;  applicationEventPublisher.publishEvent(event);
&#160; &#160;  }
&#160;&#8203;
&#160; &#160;  @Override
&#160; &#160;  public &lt;EVENT extends BaseDomainEvent&gt; void publishAndSave(EVENT event) {
&#160; &#160; &#160; &#160;  log.info("&#20445;&#23384;&#24182;&#21457;&#24067;&#20107;&#20214;,event:{}", GsonUtil.gsonToString(event));
&#160;&#8203;
&#160; &#160; &#160; &#160;  List&lt;BaseDomainEvent&gt; baseDomainEventList = domainEventRepository.loadByDomainId(event.getDomainId());
&#160; &#160; &#160; &#160;  if (CollectionUtils.isNotEmpty(baseDomainEventList)) {
&#160;&#8203;
&#160; &#160; &#160; &#160; &#160; &#160;  boolean anyMatch = baseDomainEventList.stream().anyMatch(e -&gt; Objects.equals(e.getId(), event.getId()));
&#160; &#160; &#160; &#160; &#160; &#160;  if (anyMatch) {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;  applicationEventPublisher.publishEvent(event);
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;  return;
&#160; &#160; &#160; &#160; &#160; &#160;  }
&#160; &#160; &#160; &#160;  }
&#160;&#8203;
&#160; &#160; &#160; &#160;  domainEventRepository.save(event);
&#160; &#160; &#160; &#160;  applicationEventPublisher.publishEvent(event);
&#160; &#160;  }
&#160;&#8203;
&#160;}
</code></pre>
<p>
 &#22914;&#26524;&#25105;&#20204;&#21482;&#38656;&#35201;&#20351;&#29992;&#20107;&#20214;&#39537;&#21160;&#27169;&#22411;&#36827;&#34892;&#19994;&#21153;&#35299;&#32806;&#65292;&#21017;&#30452;&#25509;&#35843;&#29992;
 <strong>
  publish&#26041;&#27861;
 </strong>
 &#21363;&#21487;&#12290;
</p>
<p>
 &#22914;&#26524;&#25105;&#20204;&#36824;&#38656;&#35201;&#20351;&#29992;&#20107;&#20214;&#28335;&#28304;&#33021;&#21147;&#65292;&#21017;&#35843;&#29992;
 <strong>
  publishAndSave&#26041;&#27861;
 </strong>
 &#65292;&#22312;&#21457;&#36865;&#20107;&#20214;&#20043;&#21069;&#20250;&#20808;&#23558;&#24453;&#22788;&#29702;&#29366;&#24577;&#30340;&#20107;&#20214;&#20837;&#24211;&#65292;&#31561;&#24453;&#20107;&#20214;&#22788;&#29702;&#23436;&#25104;&#20043;&#21518;&#30340;&#22238;&#35843;&#20462;&#25913;&#20107;&#20214;&#29366;&#24577;&#12290;
</p>
<h3>
 4. &#23450;&#20041;&#20107;&#20214;&#35299;&#26512;&#27880;&#35299;&#19982;&#20999;&#38754;
</h3>
<p>
 &#27880;&#35299;&#65306;
</p>
<pre><code>&#160;/**
&#160; * &#20445;&#23384;&#20107;&#20214;&#32467;&#26524;&#35299;&#26512;&#27880;&#35299;
&#160; *
&#160; * @author baiyan
&#160; */
&#160;@Retention(RetentionPolicy.RUNTIME)
&#160;@Target({ElementType.METHOD, ElementType.ANNOTATION_TYPE})
&#160;public @interface NeedSaveEventResult {
&#160;}
</code></pre>
<p>
 &#20999;&#38754;&#65306;
</p>
<pre><code>&#160;@Aspect
&#160;@Component
&#160;@Slf4j
&#160;public class NeedSaveEventHandlerAspect {
&#160;&#8203;
&#160; &#160;  @Resource
&#160; &#160;  private DomainEventRepository domainEventRepository;
&#160;&#8203;
&#160; &#160;  @Pointcut("@annotation(com.baiyan.ddd.domain.share.event.NeedSaveEventResult)")
&#160; &#160;  public void pointcut() {
&#160; &#160;  }
&#160;&#8203;
&#160; &#160;  @AfterReturning(value = "pointcut()", returning = "result")
&#160; &#160;  public void afterReturning(JoinPoint joinPoint, Result result) {
&#160; &#160; &#160; &#160;  BaseDomainEvent baseEvent = (BaseDomainEvent)joinPoint.getArgs()[0];
&#160; &#160; &#160; &#160;  if(Objects.equals(result.getCode(), BaseResult.CODE_SUCCESS)){
&#160; &#160; &#160; &#160; &#160; &#160;  // &#26356;&#26032;&#20107;&#20214;&#29366;&#24577;&#20026;&#25104;&#21151;
&#160; &#160; &#160; &#160; &#160; &#160;  log.info("&#26356;&#26032;&#20107;&#20214;{}&#29366;&#24577;&#20026;&#25104;&#21151;", baseEvent.getId());
&#160; &#160; &#160; &#160; &#160; &#160;  baseEvent.handleSuccess();
&#160; &#160; &#160; &#160;  }else {
&#160; &#160; &#160; &#160; &#160; &#160;  // &#26356;&#26032;&#29366;&#24577;&#22833;&#36133;
&#160; &#160; &#160; &#160; &#160; &#160;  log.info("&#26356;&#26032;&#20107;&#20214;{}&#29366;&#24577;&#20026;&#22833;&#36133;", baseEvent.getId());
&#160; &#160; &#160; &#160; &#160; &#160;  baseEvent.handleFailed();
&#160; &#160; &#160; &#160;  }
&#160; &#160; &#160; &#160;  domainEventRepository.update(baseEvent);
&#160; &#160;  }
&#160;&#8203;
&#160;}
</code></pre>
<p>
 &#21482;&#35201;&#23558;&#27880;&#35299;&#26631;&#27880;&#22312;&#20107;&#20214;&#22788;&#29702;&#31867;&#19978;&#65292;&#24403;&#20107;&#20214;&#22788;&#29702;&#23436;&#25104;&#20043;&#21518;&#23558;&#20250;&#34987;&#20999;&#38754;&#22788;&#29702;&#22238;&#35843;&#20462;&#25913;&#20107;&#20214;&#29366;&#24577;&#12290;&#20107;&#20214;&#29366;&#24577;&#20462;&#25913;&#20026;&#25104;&#21151;&#21518;&#25165;&#20250;&#34987;&#27491;&#30830;&#28335;&#28304;&#22788;&#29702;&#12290;
</p>
<h3>
 5. &#23450;&#20041;&#20107;&#20214;&#22788;&#29702;&#31867;
</h3>
<pre><code>&#160;@Component
&#160;@Slf4j
&#160;public class UserEventHandler {
&#160;&#8203;
&#160; &#160;  @TransactionalEventListener(fallbackExecution = true)
&#160; &#160;  @NeedSaveEventResult
&#160; &#160;  public Result&lt;Object&gt; handleEvent(UserDeleteEvent event) {
&#160; &#160; &#160; &#160;  try {
&#160; &#160; &#160; &#160; &#160; &#160;  log.info("&#29992;&#25143;&#21024;&#38500;&#21518;&#65292;&#21518;&#32493;&#25191;&#34892;&#24378;&#30456;&#20851;&#30340;&#38142;&#24335;&#35843;&#29992;&#36923;&#36753;");
&#160; &#160; &#160; &#160; &#160; &#160;  return Result.ok();
&#160; &#160; &#160; &#160;  } catch (Exception e) {
&#160; &#160; &#160; &#160; &#160; &#160;  return Result.error(e.getMessage());
&#160; &#160; &#160; &#160;  }
&#160; &#160;  }
&#160;&#8203;
&#160;}
</code></pre>
<p>
 &#23450;&#20041;&#29992;&#25143;&#34987;&#21024;&#38500;&#20107;&#20214;&#30417;&#21548;&#31867;&#24182;&#26631;&#27880;
 <strong>
  @NeedSaveEventResult
 </strong>
 &#27880;&#35299;&#65292;&#22788;&#29702;&#29992;&#25143;&#34987;&#21024;&#38500;&#20107;&#20214;&#12290;
</p>
<p>
 <code>
  &#27880;&#24847;&#27492;&#22788;&#22914;&#26524;&#19981;&#38656;&#35201;&#20107;&#20214;&#28335;&#28304;&#21151;&#33021;&#65292;&#21017;&#19981;&#38656;&#35201;&#26631;&#27880;@NeedSaveEventResult&#65292;&#21363;&#20107;&#20214;&#22788;&#29702;&#23436;&#25104;&#21518;&#23601;&#25243;&#25481;&#20102;&#65292;&#20165;&#20570;&#21151;&#33021;&#36923;&#36753;&#35299;&#32806;&#12290;
 </code>
</p>
<p>
 &#22914;&#26524;&#25105;&#20204;&#19981;&#38656;&#35201;&#20107;&#20214;&#39537;&#21160;&#27169;&#22411;&#30340;&#20107;&#20214;&#28335;&#28304;&#33021;&#21147;&#65292;&#20195;&#30721;&#38750;&#24120;&#31616;&#21333;&#12290;&#21482;&#38656;&#35201;&#21457;&#36865;&#19994;&#21153;&#39046;&#22495;&#20107;&#20214;&#65292;&#23545;&#24212;&#30340;&#22788;&#29702;&#31867;&#22788;&#29702;&#21363;&#21487;&#12290;
</p>
<p>
 &#22914;&#26524;&#25105;&#20204;&#38656;&#35201;&#20107;&#20214;&#28335;&#28304;&#33021;&#21147;&#65292;&#37027;&#20040;&#22312;&#19994;&#21153;&#20391;&#30340;&#32534;&#30721;&#37197;&#32622;&#20063;&#26159;&#27604;&#36739;&#31616;&#21333;&#30340;&#12290;&#20107;&#20214;&#21457;&#36865;&#26102;&#23450;&#20041;&#20107;&#20214;&#29366;&#24577;&#20026;&#24453;&#22788;&#29702;&#65292;&#28982;&#21518;&#36890;&#36807;DomainEventPublisher.publishAndSave&#26041;&#27861;&#23384;&#20648;&#20107;&#20214;&#24182;&#21457;&#36865;&#65292;&#26368;&#21518;&#20999;&#38754;&#23558;&#20250;&#35299;&#26512;&#26631;&#27880;&#20102;@NeedSaveEventResult&#27880;&#35299;&#30340;&#22788;&#29702;&#31867;&#30340;&#36820;&#22238;&#32467;&#26524;&#22238;&#35843;&#20462;&#25913;&#20107;&#20214;&#29366;&#24577;&#12290;&#28335;&#28304;&#20107;&#20214;&#23384;&#20648;&#21518;&#65292;&#23601;&#21487;&#20197;&#26681;&#25454;&#19994;&#21153;&#38656;&#27714;&#26469;&#35299;&#26512;&#20107;&#20214;&#28335;&#28304;&#30340;&#25968;&#25454;&#20102;&#12290;
</p>
<h2>
 &#22235;&#12289;&#24635;&#32467;
</h2>
<p>
 &#26412;&#25991;&#38024;&#23545;&#24212;&#29992;&#26381;&#21153;&#22312;&#32534;&#25490;&#36923;&#36753;&#20013;&#21487;&#33021;&#23384;&#22312;&#30340;&#23567;&#29781;&#30133;&#20986;&#21457;&#65292;&#20998;&#26512;&#35762;&#35299;&#20102;&#22914;&#20309;&#20351;&#29992;&#33021;&#21147;&#23618;&#36319;&#39046;&#22495;&#26381;&#21153;&#30340;&#26041;&#24335;&#65292;&#24182;&#19988;&#23545;&#33021;&#21147;&#23618;&#19982;&#39046;&#22495;&#26381;&#21153;&#30340;&#20351;&#29992;&#35268;&#33539;&#19982;&#27880;&#24847;&#28857;&#20570;&#20102;&#32534;&#30721;&#20171;&#32461;&#12290;
</p>
<p>
 &#22312;&#20998;&#26512;&#23436;&#21516;&#19968;&#20107;&#21153;&#19982;&#24378;&#19994;&#21153;&#36923;&#36753;&#30340;&#22788;&#29702;&#26041;&#24335;&#21518;&#65292;&#25105;&#20204;&#20171;&#32461;&#20102;&#22914;&#20309;&#20351;&#29992;&#20107;&#20214;&#39537;&#21160;&#27169;&#22411;&#26469;&#35299;&#32806;&#24369;&#19994;&#21153;&#20851;&#32852;&#30340;&#36923;&#36753;&#19982;&#33853;&#22320;&#20107;&#20214;&#28335;&#28304;&#30340;&#26041;&#24335;&#12290;
</p>
<p>
 &#26368;&#21518;&#65292;&#25105;&#20204;&#26469;&#24635;&#32467;&#19968;&#19979;&#19968;&#20010;&#22797;&#26434;&#30340;&#22686;&#21024;&#25913;&#19994;&#21153;&#21151;&#33021;&#22312;DDD&#20013;&#30340;&#35843;&#29992;&#26102;&#24207;&#22270;&#65306;
</p>
<p>
 <img alt="image-20211220184142146.png" src="EPUB/1fa04e08-17d9-11ed-92a9-acde48001122">
</p>
<ol>
 <li>
  &#22806;&#37096;&#35831;&#27714;&#36890;&#36807;Command&#21442;&#25968;&#35843;&#29992;&#24212;&#29992;&#26381;&#21153;&#30340;&#25509;&#21475;&#65307;
 </li>
 <li>
  &#24212;&#29992;&#26381;&#21153;&#23454;&#29616;&#31867;&#32534;&#25490;&#33021;&#21147;&#23618;&#65292;&#39046;&#22495;&#36923;&#36753;&#65292;&#39046;&#22495;&#26381;&#21153;&#26469;&#23436;&#25104;&#21151;&#33021;&#28857;&#36923;&#36753;&#65307;
 </li>
 <li>
  &#24212;&#29992;&#26381;&#21153;&#35843;&#29992;&#20179;&#20648;&#25509;&#21475;&#65292;&#30001;&#23450;&#20041;&#22312;&#22522;&#30784;&#35774;&#26045;&#23618;&#30340;&#20179;&#20648;&#23454;&#29616;&#31867;&#23436;&#25104;&#39046;&#22495;&#27169;&#22411;&#21040;&#25968;&#25454;&#27169;&#22411;&#30340;&#36716;&#25442;&#65292;&#20445;&#23384;&#39046;&#22495;&#27169;&#22411;&#65307;
 </li>
 <li>
  &#21457;&#36865;&#39046;&#22495;&#20107;&#20214;&#36827;&#34892;&#19994;&#21153;&#35299;&#32806;&#19982;&#20107;&#20214;&#28335;&#28304;&#65307;
 </li>
 <li>
  &#36820;&#22238;&#35831;&#27714;&#32467;&#26524;&#32473;&#22806;&#37096;&#35831;&#27714;&#26041;&#12290;
 </li>
</ol>
<p>
 &#21516;&#26679;&#65292;&#22312;&#36825;&#19968;&#35762;&#30340;&#23398;&#20064;&#36807;&#31243;&#20013;&#65292;&#22914;&#26524;&#20320;&#36935;&#21040;&#20160;&#20040;&#38382;&#39064;&#25110;&#32773;&#26377;&#22909;&#30340;&#32463;&#39564;&#35201;&#20998;&#20139;&#65292;&#27426;&#36814;&#20320;&#22312;&#30041;&#35328;&#21306;&#19982;&#25105;&#20998;&#20139;&#65292;&#25105;&#20204;&#19968;&#36215;&#20132;&#27969;&#65292;&#19968;&#36215;&#36827;&#27493;&#12290;
</p>
</div>

</div>
</div>

        </body>
        
        