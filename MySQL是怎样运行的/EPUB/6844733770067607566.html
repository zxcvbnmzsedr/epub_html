
        <html lang="en">
        <head>
        <meta charset="UTF-8"/>
        </head>
        <body>
        <div><div class="markdown-body">
    <h1>&#21518;&#24724;&#20102;&#24590;&#20040;&#21150; &#8212;&#8212; undo &#26085;&#24535; (&#19978;)</h1>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="style/style.css" type="text/css">

<div class="markdown-body">
    <h1 class="heading">
 undo&#26085;&#24535;&#65288;&#19978;&#65289;
</h1>
<p>
 &#26631;&#31614;&#65306; MySQL&#26159;&#24590;&#26679;&#36816;&#34892;&#30340;
</p>
<hr>
<h2 class="heading">
 &#20107;&#21153;&#22238;&#28378;&#30340;&#38656;&#27714;
</h2>
<p>
 &#25105;&#20204;&#35828;&#36807;
 <code>
  &#20107;&#21153;
 </code>
 &#38656;&#35201;&#20445;&#35777;
 <code>
  &#21407;&#23376;&#24615;
 </code>
 &#65292;&#20063;&#23601;&#26159;&#20107;&#21153;&#20013;&#30340;&#25805;&#20316;&#35201;&#20040;&#20840;&#37096;&#23436;&#25104;&#65292;&#35201;&#20040;&#20160;&#20040;&#20063;&#19981;&#20570;&#12290;&#20294;&#26159;&#20559;&#20559;&#26377;&#26102;&#20505;&#20107;&#21153;&#25191;&#34892;&#21040;&#19968;&#21322;&#20250;&#20986;&#29616;&#19968;&#20123;&#24773;&#20917;&#65292;&#27604;&#22914;&#65306;
</p>
<ul>
 <li>
  <p>
   &#24773;&#20917;&#19968;&#65306;&#20107;&#21153;&#25191;&#34892;&#36807;&#31243;&#20013;&#21487;&#33021;&#36935;&#21040;&#21508;&#31181;&#38169;&#35823;&#65292;&#27604;&#22914;&#26381;&#21153;&#22120;&#26412;&#36523;&#30340;&#38169;&#35823;&#65292;&#25805;&#20316;&#31995;&#32479;&#38169;&#35823;&#65292;&#29978;&#33267;&#26159;&#31361;&#28982;&#26029;&#30005;&#23548;&#33268;&#30340;&#38169;&#35823;&#12290;
  </p>
 </li>
 <li>
  <p>
   &#24773;&#20917;&#20108;&#65306;&#31243;&#24207;&#21592;&#21487;&#20197;&#22312;&#20107;&#21153;&#25191;&#34892;&#36807;&#31243;&#20013;&#25163;&#21160;&#36755;&#20837;
   <code>
    ROLLBACK
   </code>
   &#35821;&#21477;&#32467;&#26463;&#24403;&#21069;&#30340;&#20107;&#21153;&#30340;&#25191;&#34892;&#12290;
  </p>
 </li>
</ul>
<p>
 &#36825;&#20004;&#31181;&#24773;&#20917;&#37117;&#20250;&#23548;&#33268;&#20107;&#21153;&#25191;&#34892;&#21040;&#19968;&#21322;&#23601;&#32467;&#26463;&#65292;&#20294;&#26159;&#20107;&#21153;&#25191;&#34892;&#36807;&#31243;&#20013;&#21487;&#33021;&#24050;&#32463;&#20462;&#25913;&#20102;&#24456;&#22810;&#19996;&#35199;&#65292;&#20026;&#20102;&#20445;&#35777;&#20107;&#21153;&#30340;&#21407;&#23376;&#24615;&#65292;&#25105;&#20204;&#38656;&#35201;&#25226;&#19996;&#35199;&#25913;&#22238;&#21407;&#20808;&#30340;&#26679;&#23376;&#65292;&#36825;&#20010;&#36807;&#31243;&#23601;&#31216;&#20043;&#20026;
 <code>
  &#22238;&#28378;
 </code>
 &#65288;&#33521;&#25991;&#21517;&#65306;
 <code>
  rollback
 </code>
 &#65289;&#65292;&#36825;&#26679;&#23601;&#21487;&#20197;&#36896;&#25104;&#19968;&#20010;&#20551;&#35937;&#65306;
 <span style="color:red">
  &#36825;&#20010;&#20107;&#21153;&#30475;&#36215;&#26469;&#20160;&#20040;&#37117;&#27809;&#20570;
 </span>
 &#65292;&#25152;&#20197;&#31526;&#21512;
 <code>
  &#21407;&#23376;&#24615;
 </code>
 &#35201;&#27714;&#12290;
</p>
<p>
 &#23567;&#26102;&#20505;&#25105;&#38750;&#24120;&#30196;&#36855;&#20110;&#35937;&#26827;&#65292;&#24635;&#26159;&#24819;&#25214;&#21385;&#23475;&#30340;&#22823;&#20154;&#19979;&#26827;&#65292;&#36194;&#26827;&#26159;&#19981;&#21487;&#33021;&#36194;&#26827;&#30340;&#65292;&#36825;&#36744;&#23376;&#37117;&#19981;&#21487;&#33021;&#36194;&#26827;&#30340;&#65292;&#21448;&#19981;&#24819;&#35748;&#36755;&#65292;&#21482;&#33021;&#20599;&#20599;&#30340;&#24724;&#26827;&#25165;&#33021;&#21193;&#24378;&#29609;&#30340;&#19979;&#21435;&#12290;
 <code>
  &#24724;&#26827;
 </code>
 &#23601;&#26159;&#19968;&#31181;&#38750;&#24120;&#20856;&#22411;&#30340;
 <code>
  &#22238;&#28378;
 </code>
 &#25805;&#20316;&#65292;&#27604;&#22914;&#26827;&#23376;&#24448;&#21069;&#36208;&#20004;&#27493;&#65292;
 <code>
  &#24724;&#26827;
 </code>
 &#23545;&#24212;&#30340;&#25805;&#20316;&#23601;&#26159;&#21521;&#21518;&#36208;&#20004;&#27493;&#65307;&#27604;&#22914;&#26827;&#23376;&#24448;&#24038;&#36208;&#19968;&#27493;&#65292;
 <code>
  &#24724;&#26827;
 </code>
 &#23545;&#24212;&#30340;&#25805;&#20316;&#23601;&#26159;&#21521;&#21491;&#36208;&#19968;&#27493;&#12290;&#25968;&#25454;&#24211;&#20013;&#30340;&#22238;&#28378;&#36319;
 <code>
  &#24724;&#26827;
 </code>
 &#24046;&#19981;&#22810;&#65292;&#20320;&#25554;&#20837;&#20102;&#19968;&#26465;&#35760;&#24405;&#65292;
 <code>
  &#22238;&#28378;
 </code>
 &#25805;&#20316;&#23545;&#24212;&#30340;&#23601;&#26159;&#25226;&#36825;&#26465;&#35760;&#24405;&#21024;&#38500;&#25481;&#65307;&#20320;&#26356;&#26032;&#20102;&#19968;&#26465;&#35760;&#24405;&#65292;
 <code>
  &#22238;&#28378;
 </code>
 &#25805;&#20316;&#23545;&#24212;&#30340;&#23601;&#26159;&#25226;&#35813;&#35760;&#24405;&#26356;&#26032;&#20026;&#26087;&#20540;&#65307;&#20320;&#21024;&#38500;&#20102;&#19968;&#26465;&#35760;&#24405;&#65292;
 <code>
  &#22238;&#28378;
 </code>
 &#25805;&#20316;&#23545;&#24212;&#30340;&#33258;&#28982;&#23601;&#26159;&#25226;&#35813;&#35760;&#24405;&#20877;&#25554;&#36827;&#21435;&#12290;&#35828;&#30340;&#35980;&#20284;&#24456;&#31616;&#21333;&#30340;&#26679;&#23376;[&#25163;&#21160;&#20599;&#31505;]&#12290;
</p>
<p>
 &#20174;&#19978;&#36793;&#30340;&#25551;&#36848;&#20013;&#25105;&#20204;&#24050;&#32463;&#33021;&#38544;&#32422;&#24863;&#35273;&#21040;&#65292;&#27599;&#24403;&#25105;&#20204;&#35201;&#23545;&#19968;&#26465;&#35760;&#24405;&#20570;&#25913;&#21160;&#26102;&#65288;&#36825;&#37324;&#30340;
 <code>
  &#25913;&#21160;
 </code>
 &#21487;&#20197;&#25351;
 <code>
  INSERT
 </code>
 &#12289;
 <code>
  DELETE
 </code>
 &#12289;
 <code>
  UPDATE
 </code>
 &#65289;&#65292;&#37117;&#38656;&#35201;&#30041;&#19968;&#25163; &#8212;&#8212;
 <span style="color:red">
  &#25226;&#22238;&#28378;&#26102;&#25152;&#38656;&#30340;&#19996;&#35199;&#37117;&#32473;&#35760;&#19979;&#26469;
 </span>
 &#12290;&#27604;&#26041;&#35828;&#65306;
</p>
<ul>
 <li>
  <p>
   &#20320;&#25554;&#20837;&#19968;&#26465;&#35760;&#24405;&#26102;&#65292;&#33267;&#23569;&#35201;&#25226;&#36825;&#26465;&#35760;&#24405;&#30340;&#20027;&#38190;&#20540;&#35760;&#19979;&#26469;&#65292;&#20043;&#21518;&#22238;&#28378;&#30340;&#26102;&#20505;&#21482;&#38656;&#35201;&#25226;&#36825;&#20010;&#20027;&#38190;&#20540;&#23545;&#24212;&#30340;&#35760;&#24405;&#21024;&#25481;&#23601;&#22909;&#20102;&#12290;
  </p>
 </li>
 <li>
  <p>
   &#20320;&#21024;&#38500;&#20102;&#19968;&#26465;&#35760;&#24405;&#65292;&#33267;&#23569;&#35201;&#25226;&#36825;&#26465;&#35760;&#24405;&#20013;&#30340;&#20869;&#23481;&#37117;&#35760;&#19979;&#26469;&#65292;&#36825;&#26679;&#20043;&#21518;&#22238;&#28378;&#26102;&#20877;&#25226;&#30001;&#36825;&#20123;&#20869;&#23481;&#32452;&#25104;&#30340;&#35760;&#24405;&#25554;&#20837;&#21040;&#34920;&#20013;&#23601;&#22909;&#20102;&#12290;
  </p>
 </li>
 <li>
  <p>
   &#20320;&#20462;&#25913;&#20102;&#19968;&#26465;&#35760;&#24405;&#65292;&#33267;&#23569;&#35201;&#25226;&#20462;&#25913;&#36825;&#26465;&#35760;&#24405;&#21069;&#30340;&#26087;&#20540;&#37117;&#35760;&#24405;&#19979;&#26469;&#65292;&#36825;&#26679;&#20043;&#21518;&#22238;&#28378;&#26102;&#20877;&#25226;&#36825;&#26465;&#35760;&#24405;&#26356;&#26032;&#20026;&#26087;&#20540;&#23601;&#22909;&#20102;&#12290;
  </p>
 </li>
</ul>
<p>
 &#35774;&#35745;&#25968;&#25454;&#24211;&#30340;&#22823;&#21460;&#25226;&#36825;&#20123;&#20026;&#20102;&#22238;&#28378;&#32780;&#35760;&#24405;&#30340;&#36825;&#20123;&#19996;&#19996;&#31216;&#20043;&#20026;&#25764;&#38144;&#26085;&#24535;&#65292;&#33521;&#25991;&#21517;&#20026;
 <code>
  undo log
 </code>
 &#65292;&#25105;&#20204;&#20063;&#21487;&#20197;&#22303;&#27915;&#32467;&#21512;&#65292;&#31216;&#20043;&#20026;
 <code>
  undo&#26085;&#24535;
 </code>
 &#12290;&#36825;&#37324;&#38656;&#35201;&#27880;&#24847;&#30340;&#19968;&#28857;&#26159;&#65292;&#30001;&#20110;&#26597;&#35810;&#25805;&#20316;&#65288;
 <code>
  SELECT
 </code>
 &#65289;&#24182;&#19981;&#20250;&#20462;&#25913;&#20219;&#20309;&#29992;&#25143;&#35760;&#24405;&#65292;&#25152;&#20197;&#22312;&#26597;&#35810;&#25805;&#20316;&#25191;&#34892;&#26102;&#65292;&#24182;&#19981;&#38656;&#35201;&#35760;&#24405;&#30456;&#24212;&#30340;
 <code>
  undo&#26085;&#24535;
 </code>
 &#12290;&#22312;&#30495;&#23454;&#30340;
 <code>
  InnoDB
 </code>
 &#20013;&#65292;
 <code>
  undo&#26085;&#24535;
 </code>
 &#20854;&#23454;&#24182;&#19981;&#20687;&#25105;&#20204;&#19978;&#36793;&#25152;&#35828;&#30340;&#37027;&#20040;&#31616;&#21333;&#65292;&#19981;&#21516;&#31867;&#22411;&#30340;&#25805;&#20316;&#20135;&#29983;&#30340;
 <code>
  undo&#26085;&#24535;
 </code>
 &#30340;&#26684;&#24335;&#20063;&#26159;&#19981;&#21516;&#30340;&#65292;&#19981;&#36807;&#20808;&#26242;&#26102;&#25226;&#36825;&#20123;&#23481;&#26131;&#35753;&#20154;&#33041;&#23376;&#31946;&#30340;&#20855;&#20307;&#32454;&#33410;&#25918;&#19968;&#25918;&#65292;&#25105;&#20204;&#20808;&#22238;&#36807;&#22836;&#26469;&#30475;&#30475;
 <code>
  &#20107;&#21153;id
 </code>
 &#26159;&#20010;&#31070;&#39532;&#29609;&#24847;&#20799;&#12290;
</p>
<h2 class="heading">
 &#20107;&#21153;id
</h2>
<h3 class="heading">
 &#32473;&#20107;&#21153;&#20998;&#37197;id&#30340;&#26102;&#26426;
</h3>
<p>
 &#25105;&#20204;&#21069;&#36793;&#22312;&#21792;&#21480;
 <code>
  &#20107;&#21153;&#31616;&#20171;
 </code>
 &#26102;&#35828;&#36807;&#65292;&#19968;&#20010;&#20107;&#21153;&#21487;&#20197;&#26159;&#19968;&#20010;&#21482;&#35835;&#20107;&#21153;&#65292;&#25110;&#32773;&#26159;&#19968;&#20010;&#35835;&#20889;&#20107;&#21153;&#65306;
</p>
<ul>
 <li>
  <p>
   &#25105;&#20204;&#21487;&#20197;&#36890;&#36807;
   <code>
    START TRANSACTION READ ONLY
   </code>
   &#35821;&#21477;&#24320;&#21551;&#19968;&#20010;&#21482;&#35835;&#20107;&#21153;&#12290;
  </p>
  <p>
   &#22312;&#21482;&#35835;&#20107;&#21153;&#20013;&#19981;&#21487;&#20197;&#23545;&#26222;&#36890;&#30340;&#34920;&#65288;&#20854;&#20182;&#20107;&#21153;&#20063;&#33021;&#35775;&#38382;&#21040;&#30340;&#34920;&#65289;&#36827;&#34892;&#22686;&#12289;&#21024;&#12289;&#25913;&#25805;&#20316;&#65292;&#20294;&#21487;&#20197;&#23545;&#20020;&#26102;&#34920;&#20570;&#22686;&#12289;&#21024;&#12289;&#25913;&#25805;&#20316;&#12290;
  </p>
 </li>
 <li>
  <p>
   &#25105;&#20204;&#21487;&#20197;&#36890;&#36807;
   <code>
    START TRANSACTION READ WRITE
   </code>
   &#35821;&#21477;&#24320;&#21551;&#19968;&#20010;&#35835;&#20889;&#20107;&#21153;&#65292;&#25110;&#32773;&#20351;&#29992;
   <code>
    BEGIN
   </code>
   &#12289;
   <code>
    START TRANSACTION
   </code>
   &#35821;&#21477;&#24320;&#21551;&#30340;&#20107;&#21153;&#40664;&#35748;&#20063;&#31639;&#26159;&#35835;&#20889;&#20107;&#21153;&#12290;
  </p>
  <p>
   &#22312;&#35835;&#20889;&#20107;&#21153;&#20013;&#21487;&#20197;&#23545;&#34920;&#25191;&#34892;&#22686;&#21024;&#25913;&#26597;&#25805;&#20316;&#12290;
  </p>
 </li>
</ul>
<p>
 &#22914;&#26524;&#26576;&#20010;&#20107;&#21153;&#25191;&#34892;&#36807;&#31243;&#20013;&#23545;&#26576;&#20010;&#34920;&#25191;&#34892;&#20102;&#22686;&#12289;&#21024;&#12289;&#25913;&#25805;&#20316;&#65292;&#37027;&#20040;
 <code>
  InnoDB
 </code>
 &#23384;&#20648;&#24341;&#25806;&#23601;&#20250;&#32473;&#23427;&#20998;&#37197;&#19968;&#20010;&#29420;&#19968;&#26080;&#20108;&#30340;
 <code>
  &#20107;&#21153;id
 </code>
 &#65292;&#20998;&#37197;&#26041;&#24335;&#22914;&#19979;&#65306;
</p>
<ul>
 <li>
  <p>
   &#23545;&#20110;&#21482;&#35835;&#20107;&#21153;&#26469;&#35828;&#65292;&#21482;&#26377;&#22312;&#23427;&#31532;&#19968;&#27425;&#23545;&#26576;&#20010;&#29992;&#25143;&#21019;&#24314;&#30340;&#20020;&#26102;&#34920;&#25191;&#34892;&#22686;&#12289;&#21024;&#12289;&#25913;&#25805;&#20316;&#26102;&#25165;&#20250;&#20026;&#36825;&#20010;&#20107;&#21153;&#20998;&#37197;&#19968;&#20010;
   <code>
    &#20107;&#21153;id
   </code>
   &#65292;&#21542;&#21017;&#30340;&#35805;&#26159;&#19981;&#20998;&#37197;
   <code>
    &#20107;&#21153;id
   </code>
   &#30340;&#12290;
  </p>
  <blockquote class="warning">
   <p>
    &#23567;&#36148;&#22763;&#65306;

&#25105;&#20204;&#21069;&#36793;&#35828;&#36807;&#23545;&#26576;&#20010;&#26597;&#35810;&#35821;&#21477;&#25191;&#34892;EXPLAIN&#20998;&#26512;&#23427;&#30340;&#26597;&#35810;&#35745;&#21010;&#26102;&#65292;&#26377;&#26102;&#20505;&#22312;Extra&#21015;&#20250;&#30475;&#21040;Using temporary&#30340;&#25552;&#31034;&#65292;&#36825;&#20010;&#34920;&#26126;&#22312;&#25191;&#34892;&#35813;&#26597;&#35810;&#35821;&#21477;&#26102;&#20250;&#29992;&#21040;&#20869;&#37096;&#20020;&#26102;&#34920;&#12290;&#36825;&#20010;&#25152;&#35859;&#30340;&#20869;&#37096;&#20020;&#26102;&#34920;&#21644;&#25105;&#20204;&#25163;&#21160;&#29992;CREATE TEMPORARY TABLE&#21019;&#24314;&#30340;&#29992;&#25143;&#20020;&#26102;&#34920;&#24182;&#19981;&#19968;&#26679;&#65292;&#22312;&#20107;&#21153;&#22238;&#28378;&#26102;&#24182;&#19981;&#38656;&#35201;&#25226;&#25191;&#34892;SELECT&#35821;&#21477;&#36807;&#31243;&#20013;&#29992;&#21040;&#30340;&#20869;&#37096;&#20020;&#26102;&#34920;&#20063;&#22238;&#28378;&#65292;&#22312;&#25191;&#34892;SELECT&#35821;&#21477;&#29992;&#21040;&#20869;&#37096;&#20020;&#26102;&#34920;&#26102;&#24182;&#19981;&#20250;&#20026;&#23427;&#20998;&#37197;&#20107;&#21153;id&#12290;
   </p>
  </blockquote>
 </li>
 <li>
  <p>
   &#23545;&#20110;&#35835;&#20889;&#20107;&#21153;&#26469;&#35828;&#65292;&#21482;&#26377;&#22312;&#23427;&#31532;&#19968;&#27425;&#23545;&#26576;&#20010;&#34920;&#65288;&#21253;&#25324;&#29992;&#25143;&#21019;&#24314;&#30340;&#20020;&#26102;&#34920;&#65289;&#25191;&#34892;&#22686;&#12289;&#21024;&#12289;&#25913;&#25805;&#20316;&#26102;&#25165;&#20250;&#20026;&#36825;&#20010;&#20107;&#21153;&#20998;&#37197;&#19968;&#20010;
   <code>
    &#20107;&#21153;id
   </code>
   &#65292;&#21542;&#21017;&#30340;&#35805;&#20063;&#26159;&#19981;&#20998;&#37197;
   <code>
    &#20107;&#21153;id
   </code>
   &#30340;&#12290;
  </p>
  <p>
   &#26377;&#30340;&#26102;&#20505;&#34429;&#28982;&#25105;&#20204;&#24320;&#21551;&#20102;&#19968;&#20010;&#35835;&#20889;&#20107;&#21153;&#65292;&#20294;&#26159;&#22312;&#36825;&#20010;&#20107;&#21153;&#20013;&#20840;&#26159;&#26597;&#35810;&#35821;&#21477;&#65292;&#24182;&#27809;&#26377;&#25191;&#34892;&#22686;&#12289;&#21024;&#12289;&#25913;&#30340;&#35821;&#21477;&#65292;&#37027;&#20063;&#23601;&#24847;&#21619;&#30528;&#36825;&#20010;&#20107;&#21153;&#24182;&#19981;&#20250;&#34987;&#20998;&#37197;&#19968;&#20010;
   <code>
    &#20107;&#21153;id
   </code>
   &#12290;
  </p>
 </li>
</ul>
<p>
 &#35828;&#20102;&#21322;&#22825;&#65292;
 <code>
  &#20107;&#21153;id
 </code>
 &#26377;&#21861;&#23376;&#29992;&#65311;&#36825;&#20010;&#20808;&#20445;&#23494;&#21704;&#65292;&#21518;&#36793;&#20250;&#19968;&#27493;&#27493;&#30340;&#35814;&#32454;&#21792;&#21480;&#12290;&#29616;&#22312;&#21482;&#35201;&#30693;&#36947;&#21482;&#26377;&#22312;&#20107;&#21153;&#23545;&#34920;&#20013;&#30340;&#35760;&#24405;&#20570;&#25913;&#21160;&#26102;&#25165;&#20250;&#20026;&#36825;&#20010;&#20107;&#21153;&#20998;&#37197;&#19968;&#20010;&#21807;&#19968;&#30340;
 <code>
  &#20107;&#21153;id
 </code>
 &#12290;
</p>
<blockquote class="warning">
 <p>
  &#23567;&#36148;&#22763;&#65306;

&#19978;&#36793;&#25551;&#36848;&#30340;&#20107;&#21153;id&#20998;&#37197;&#31574;&#30053;&#26159;&#38024;&#23545;MySQL 5.7&#26469;&#35828;&#30340;&#65292;&#21069;&#36793;&#30340;&#29256;&#26412;&#30340;&#20998;&#37197;&#26041;&#24335;&#21487;&#33021;&#19981;&#21516;&#65374;
 </p>
</blockquote>
<h3 class="heading">
 &#20107;&#21153;id&#26159;&#24590;&#20040;&#29983;&#25104;&#30340;
</h3>
<p>
 &#36825;&#20010;
 <code>
  &#20107;&#21153;id
 </code>
 &#26412;&#36136;&#19978;&#23601;&#26159;&#19968;&#20010;&#25968;&#23383;&#65292;&#23427;&#30340;&#20998;&#37197;&#31574;&#30053;&#21644;&#25105;&#20204;&#21069;&#36793;&#25552;&#21040;&#30340;&#23545;&#38544;&#34255;&#21015;
 <code>
  row_id
 </code>
 &#65288;&#24403;&#29992;&#25143;&#27809;&#26377;&#20026;&#34920;&#21019;&#24314;&#20027;&#38190;&#21644;
 <code>
  UNIQUE
 </code>
 &#38190;&#26102;
 <code>
  InnoDB
 </code>
 &#33258;&#21160;&#21019;&#24314;&#30340;&#21015;&#65289;&#30340;&#20998;&#37197;&#31574;&#30053;&#22823;&#25269;&#30456;&#21516;&#65292;&#20855;&#20307;&#31574;&#30053;&#22914;&#19979;&#65306;
</p>
<ul>
 <li>
  <p>
   &#26381;&#21153;&#22120;&#20250;&#22312;&#20869;&#23384;&#20013;&#32500;&#25252;&#19968;&#20010;&#20840;&#23616;&#21464;&#37327;&#65292;&#27599;&#24403;&#38656;&#35201;&#20026;&#26576;&#20010;&#20107;&#21153;&#20998;&#37197;&#19968;&#20010;
   <code>
    &#20107;&#21153;id
   </code>
   &#26102;&#65292;&#23601;&#20250;&#25226;&#35813;&#21464;&#37327;&#30340;&#20540;&#24403;&#20316;
   <code>
    &#20107;&#21153;id
   </code>
   &#20998;&#37197;&#32473;&#35813;&#20107;&#21153;&#65292;&#24182;&#19988;&#25226;&#35813;&#21464;&#37327;&#33258;&#22686;1&#12290;
  </p>
 </li>
 <li>
  <p>
   &#27599;&#24403;&#36825;&#20010;&#21464;&#37327;&#30340;&#20540;&#20026;
   <code>
    256
   </code>
   &#30340;&#20493;&#25968;&#26102;&#65292;&#23601;&#20250;&#23558;&#35813;&#21464;&#37327;&#30340;&#20540;&#21047;&#26032;&#21040;&#31995;&#32479;&#34920;&#31354;&#38388;&#30340;&#39029;&#21495;&#20026;
   <code>
    5
   </code>
   &#30340;&#39029;&#38754;&#20013;&#19968;&#20010;&#31216;&#20043;&#20026;
   <code>
    Max Trx ID
   </code>
   &#30340;&#23646;&#24615;&#22788;&#65292;&#36825;&#20010;&#23646;&#24615;&#21344;&#29992;
   <code>
    8
   </code>
   &#20010;&#23383;&#33410;&#30340;&#23384;&#20648;&#31354;&#38388;&#12290;
  </p>
 </li>
 <li>
  <p>
   &#24403;&#31995;&#32479;&#19979;&#19968;&#27425;&#37325;&#26032;&#21551;&#21160;&#26102;&#65292;&#20250;&#23558;&#19978;&#36793;&#25552;&#21040;&#30340;
   <code>
    Max Trx ID
   </code>
   &#23646;&#24615;&#21152;&#36733;&#21040;&#20869;&#23384;&#20013;&#65292;&#23558;&#35813;&#20540;&#21152;&#19978;256&#20043;&#21518;&#36171;&#20540;&#32473;&#25105;&#20204;&#21069;&#36793;&#25552;&#21040;&#30340;&#20840;&#23616;&#21464;&#37327;&#65288;&#22240;&#20026;&#22312;&#19978;&#27425;&#20851;&#26426;&#26102;&#35813;&#20840;&#23616;&#21464;&#37327;&#30340;&#20540;&#21487;&#33021;&#22823;&#20110;
   <code>
    Max Trx ID
   </code>
   &#23646;&#24615;&#20540;&#65289;&#12290;
  </p>
 </li>
</ul>
<p>
 &#36825;&#26679;&#23601;&#21487;&#20197;&#20445;&#35777;&#25972;&#20010;&#31995;&#32479;&#20013;&#20998;&#37197;&#30340;
 <code>
  &#20107;&#21153;id
 </code>
 &#20540;&#26159;&#19968;&#20010;&#36882;&#22686;&#30340;&#25968;&#23383;&#12290;&#20808;&#34987;&#20998;&#37197;
 <code>
  id
 </code>
 &#30340;&#20107;&#21153;&#24471;&#21040;&#30340;&#26159;&#36739;&#23567;&#30340;
 <code>
  &#20107;&#21153;id
 </code>
 &#65292;&#21518;&#34987;&#20998;&#37197;
 <code>
  id
 </code>
 &#30340;&#20107;&#21153;&#24471;&#21040;&#30340;&#26159;&#36739;&#22823;&#30340;
 <code>
  &#20107;&#21153;id
 </code>
 &#12290;
</p>
<h3 class="heading">
 trx_id&#38544;&#34255;&#21015;
</h3>
<p>
 &#25105;&#20204;&#21069;&#36793;&#21792;&#21480;
 <code>
  InnoDB
 </code>
 &#35760;&#24405;&#34892;&#26684;&#24335;&#30340;&#26102;&#20505;&#37325;&#28857;&#24378;&#35843;&#36807;&#65306;
 <span style="color:red">
  &#32858;&#31751;&#32034;&#24341;&#30340;&#35760;&#24405;&#38500;&#20102;&#20250;&#20445;&#23384;&#23436;&#25972;&#30340;&#29992;&#25143;&#25968;&#25454;&#20197;&#22806;&#65292;&#32780;&#19988;&#36824;&#20250;&#33258;&#21160;&#28155;&#21152;&#21517;&#20026;trx_id&#12289;roll_pointer&#30340;&#38544;&#34255;&#21015;&#65292;&#22914;&#26524;&#29992;&#25143;&#27809;&#26377;&#22312;&#34920;&#20013;&#23450;&#20041;&#20027;&#38190;&#20197;&#21450;UNIQUE&#38190;&#65292;&#36824;&#20250;&#33258;&#21160;&#28155;&#21152;&#19968;&#20010;&#21517;&#20026;row_id&#30340;&#38544;&#34255;&#21015;
 </span>
 &#12290;&#25152;&#20197;&#19968;&#26465;&#35760;&#24405;&#22312;&#39029;&#38754;&#20013;&#30340;&#30495;&#23454;&#32467;&#26500;&#30475;&#36215;&#26469;&#23601;&#26159;&#36825;&#26679;&#30340;&#65306;
</p>
<p>
</p>
<figure>
 <img alt="image_1d62h05ffsum114cn05koa1igbp.png-45.1kB" src="EPUB/39ae2c36-13d6-11ed-838d-acde48001122">
 <figcaption>
 </figcaption>
</figure>
<p>
</p>
<p>
 &#20854;&#20013;&#30340;
 <code>
  trx_id
 </code>
 &#21015;&#20854;&#23454;&#36824;&#34542;&#22909;&#29702;&#35299;&#30340;&#65292;&#23601;&#26159;&#26576;&#20010;&#23545;&#36825;&#20010;&#32858;&#31751;&#32034;&#24341;&#35760;&#24405;&#20570;&#25913;&#21160;&#30340;&#35821;&#21477;&#25152;&#22312;&#30340;&#20107;&#21153;&#23545;&#24212;&#30340;
 <code>
  &#20107;&#21153;id
 </code>
 &#32780;&#24050;&#65288;&#27492;&#22788;&#30340;&#25913;&#21160;&#21487;&#20197;&#26159;
 <code>
  INSERT
 </code>
 &#12289;
 <code>
  DELETE
 </code>
 &#12289;
 <code>
  UPDATE
 </code>
 &#25805;&#20316;&#65289;&#12290;&#33267;&#20110;
 <code>
  roll_pointer
 </code>
 &#38544;&#34255;&#21015;&#25105;&#20204;&#21518;&#36793;&#20998;&#26512;&#65374;
</p>
<h2 class="heading">
 undo&#26085;&#24535;&#30340;&#26684;&#24335;
</h2>
<p>
 &#20026;&#20102;&#23454;&#29616;&#20107;&#21153;&#30340;
 <code>
  &#21407;&#23376;&#24615;
 </code>
 &#65292;
 <code>
  InnoDB
 </code>
 &#23384;&#20648;&#24341;&#25806;&#22312;&#23454;&#38469;&#36827;&#34892;&#22686;&#12289;&#21024;&#12289;&#25913;&#19968;&#26465;&#35760;&#24405;&#26102;&#65292;&#37117;&#38656;&#35201;
 <span style="color:red">
  &#20808;
 </span>
 &#25226;&#23545;&#24212;&#30340;
 <code>
  undo&#26085;&#24535;
 </code>
 &#35760;&#19979;&#26469;&#12290;&#19968;&#33324;&#27599;&#23545;&#19968;&#26465;&#35760;&#24405;&#20570;&#19968;&#27425;&#25913;&#21160;&#65292;&#23601;&#23545;&#24212;&#30528;&#19968;&#26465;
 <code>
  undo&#26085;&#24535;
 </code>
 &#65292;&#20294;&#22312;&#26576;&#20123;&#26356;&#26032;&#35760;&#24405;&#30340;&#25805;&#20316;&#20013;&#65292;&#20063;&#21487;&#33021;&#20250;&#23545;&#24212;&#30528;2&#26465;
 <code>
  undo&#26085;&#24535;
 </code>
 &#65292;&#36825;&#20010;&#25105;&#20204;&#21518;&#36793;&#20250;&#20180;&#32454;&#21792;&#21480;&#12290;&#19968;&#20010;&#20107;&#21153;&#22312;&#25191;&#34892;&#36807;&#31243;&#20013;&#21487;&#33021;&#26032;&#22686;&#12289;&#21024;&#38500;&#12289;&#26356;&#26032;&#33509;&#24178;&#26465;&#35760;&#24405;&#65292;&#20063;&#23601;&#26159;&#35828;&#38656;&#35201;&#35760;&#24405;&#24456;&#22810;&#26465;&#23545;&#24212;&#30340;
 <code>
  undo&#26085;&#24535;
 </code>
 &#65292;&#36825;&#20123;
 <code>
  undo&#26085;&#24535;
 </code>
 &#20250;&#34987;&#20174;
 <code>
  0
 </code>
 &#24320;&#22987;&#32534;&#21495;&#65292;&#20063;&#23601;&#26159;&#35828;&#26681;&#25454;&#29983;&#25104;&#30340;&#39034;&#24207;&#20998;&#21035;&#34987;&#31216;&#20026;
 <code>
  &#31532;0&#21495;undo&#26085;&#24535;
 </code>
 &#12289;
 <code>
  &#31532;1&#21495;undo&#26085;&#24535;
 </code>
 &#12289;...&#12289;
 <code>
  &#31532;n&#21495;undo&#26085;&#24535;
 </code>
 &#31561;&#65292;&#36825;&#20010;&#32534;&#21495;&#20063;&#34987;&#31216;&#20043;&#20026;
 <code>
  undo no
 </code>
 &#12290;
</p>
<p>
 &#36825;&#20123;
 <code>
  undo&#26085;&#24535;
 </code>
 &#26159;&#34987;&#35760;&#24405;&#21040;&#31867;&#22411;&#20026;
 <code>
  FIL_PAGE_UNDO_LOG
 </code>
 &#65288;&#23545;&#24212;&#30340;&#21313;&#20845;&#36827;&#21046;&#26159;
 <code>
  0x0002
 </code>
 &#65292;&#24536;&#35760;&#20102;&#39029;&#38754;&#31867;&#22411;&#26159;&#20010;&#21861;&#30340;&#21516;&#23398;&#38656;&#35201;&#22238;&#36807;&#22836;&#20877;&#30475;&#30475;&#21069;&#36793;&#30340;&#31456;&#33410;&#65289;&#30340;&#39029;&#38754;&#20013;&#12290;&#36825;&#20123;&#39029;&#38754;&#21487;&#20197;&#20174;&#31995;&#32479;&#34920;&#31354;&#38388;&#20013;&#20998;&#37197;&#65292;&#20063;&#21487;&#20197;&#20174;&#19968;&#31181;&#19987;&#38376;&#23384;&#25918;
 <code>
  undo&#26085;&#24535;
 </code>
 &#30340;&#34920;&#31354;&#38388;&#65292;&#20063;&#23601;&#26159;&#25152;&#35859;&#30340;
 <code>
  undo tablespace
 </code>
 &#20013;&#20998;&#37197;&#12290;&#19981;&#36807;&#20851;&#20110;&#22914;&#20309;&#20998;&#37197;&#23384;&#20648;
 <code>
  undo&#26085;&#24535;
 </code>
 &#30340;&#39029;&#38754;&#36825;&#20010;&#20107;&#24773;&#25105;&#20204;&#31245;&#21518;&#20877;&#35828;&#65292;&#29616;&#22312;&#20808;&#26469;&#30475;&#30475;&#19981;&#21516;&#25805;&#20316;&#37117;&#20250;&#20135;&#29983;&#20160;&#20040;&#26679;&#23376;&#30340;
 <code>
  undo&#26085;&#24535;
 </code>
 &#21543;&#65374; &#20026;&#20102;&#25925;&#20107;&#30340;&#39034;&#21033;&#21457;&#23637;&#65292;&#25105;&#20204;&#20808;&#26469;&#21019;&#24314;&#19968;&#20010;&#21517;&#20026;
 <code>
  undo_demo
 </code>
 &#30340;&#34920;&#65306;
</p>
<pre><code class="hljs bash" lang="bash">CREATE TABLE undo_demo (
    id INT NOT NULL,
    key1 VARCHAR(100),
    col VARCHAR(100),
    PRIMARY KEY (id),
    KEY idx_key1 (key1)
)Engine=InnoDB CHARSET=utf8;
</code></pre>
<p>
 &#36825;&#20010;&#34920;&#20013;&#26377;3&#20010;&#21015;&#65292;&#20854;&#20013;
 <code>
  id
 </code>
 &#21015;&#26159;&#20027;&#38190;&#65292;&#25105;&#20204;&#20026;
 <code>
  key1
 </code>
 &#21015;&#24314;&#31435;&#20102;&#19968;&#20010;&#20108;&#32423;&#32034;&#24341;&#65292;
 <code>
  col
 </code>
 &#21015;&#26159;&#19968;&#20010;&#26222;&#36890;&#30340;&#21015;&#12290;&#25105;&#20204;&#21069;&#36793;&#20171;&#32461;
 <code>
  InnoDB
 </code>
 &#30340;&#25968;&#25454;&#23383;&#20856;&#26102;&#35828;&#36807;&#65292;&#27599;&#20010;&#34920;&#37117;&#20250;&#34987;&#20998;&#37197;&#19968;&#20010;&#21807;&#19968;&#30340;
 <code>
  table id
 </code>
 &#65292;&#25105;&#20204;&#21487;&#20197;&#36890;&#36807;&#31995;&#32479;&#25968;&#25454;&#24211;
 <code>
  information_schema
 </code>
 &#20013;&#30340;
 <code>
  innodb_sys_tables
 </code>
 &#34920;&#26469;&#26597;&#30475;&#26576;&#20010;&#34920;&#23545;&#24212;&#30340;
 <code>
  table id
 </code>
 &#26159;&#20160;&#20040;&#65292;&#29616;&#22312;&#25105;&#20204;&#26597;&#30475;&#19968;&#19979;
 <code>
  undo_demo
 </code>
 &#23545;&#24212;&#30340;
 <code>
  table id
 </code>
 &#26159;&#22810;&#23569;&#65306;
</p>
<pre><code class="hljs bash" lang="bash">mysql&gt; SELECT * FROM information_schema.innodb_sys_tables WHERE name = <span class="hljs-string">'xiaohaizi/undo_demo'</span>;
+----------+---------------------+------+--------+-------+-------------+------------+---------------+------------+
| TABLE_ID | NAME                | FLAG | N_COLS | SPACE | FILE_FORMAT | ROW_FORMAT | ZIP_PAGE_SIZE | SPACE_TYPE |
+----------+---------------------+------+--------+-------+-------------+------------+---------------+------------+
|      138 | xiaohaizi/undo_demo |   33 |      6 |   482 | Barracuda   | Dynamic    |             0 | Single     |
+----------+---------------------+------+--------+-------+-------------+------------+---------------+------------+
1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.01 sec)
</code></pre>
<p>
 &#20174;&#26597;&#35810;&#32467;&#26524;&#21487;&#20197;&#30475;&#20986;&#65292;
 <code>
  undo_demo
 </code>
 &#34920;&#23545;&#24212;&#30340;
 <code>
  table id
 </code>
 &#20026;
 <code>
  138
 </code>
 &#65292;&#20808;&#25226;&#36825;&#20010;&#20540;&#35760;&#20303;&#65292;&#25105;&#20204;&#21518;&#36793;&#26377;&#29992;&#12290;
</p>
<h3 class="heading">
 INSERT&#25805;&#20316;&#23545;&#24212;&#30340;undo&#26085;&#24535;
</h3>
<p>
 &#25105;&#20204;&#21069;&#36793;&#35828;&#36807;&#65292;&#24403;&#25105;&#20204;&#21521;&#34920;&#20013;&#25554;&#20837;&#19968;&#26465;&#35760;&#24405;&#26102;&#20250;&#26377;
 <code>
  &#20048;&#35266;&#25554;&#20837;
 </code>
 &#21644;
 <code>
  &#24754;&#35266;&#25554;&#20837;
 </code>
 &#30340;&#21306;&#20998;&#65292;&#20294;&#26159;&#19981;&#31649;&#24590;&#20040;&#25554;&#20837;&#65292;&#26368;&#32456;&#23548;&#33268;&#30340;&#32467;&#26524;&#23601;&#26159;&#36825;&#26465;&#35760;&#24405;&#34987;&#25918;&#21040;&#20102;&#19968;&#20010;&#25968;&#25454;&#39029;&#20013;&#12290;&#22914;&#26524;&#24076;&#26395;&#22238;&#28378;&#36825;&#20010;&#25554;&#20837;&#25805;&#20316;&#65292;&#37027;&#20040;&#25226;&#36825;&#26465;&#35760;&#24405;&#21024;&#38500;&#23601;&#22909;&#20102;&#65292;&#20063;&#23601;&#26159;&#35828;&#22312;&#20889;&#23545;&#24212;&#30340;
 <code>
  undo
 </code>
 &#26085;&#24535;&#26102;&#65292;&#20027;&#35201;&#26159;&#25226;&#36825;&#26465;&#35760;&#24405;&#30340;&#20027;&#38190;&#20449;&#24687;&#35760;&#19978;&#12290;&#25152;&#20197;&#35774;&#35745;
 <code>
  InnoDB
 </code>
 &#30340;&#22823;&#21460;&#35774;&#35745;&#20102;&#19968;&#20010;&#31867;&#22411;&#20026;
 <code>
  TRX_UNDO_INSERT_REC
 </code>
 &#30340;
 <code>
  undo&#26085;&#24535;
 </code>
 &#65292;&#23427;&#30340;&#23436;&#25972;&#32467;&#26500;&#22914;&#19979;&#22270;&#25152;&#31034;&#65306;
</p>
<p>
</p>
<figure>
 <img alt="image_1d65eln739ukbei9pgid81pr57o.png-112.4kB" src="EPUB/39bfb1e0-13d6-11ed-838d-acde48001122">
 <figcaption>
 </figcaption>
</figure>
<p>
</p>
<p>
 &#26681;&#25454;&#31034;&#24847;&#22270;&#25105;&#20204;&#24378;&#35843;&#20960;&#28857;&#65306;
</p>
<ul>
 <li>
  <p>
   <code>
    undo no
   </code>
   &#22312;&#19968;&#20010;&#20107;&#21153;&#20013;&#26159;&#20174;
   <code>
    0
   </code>
   &#24320;&#22987;&#36882;&#22686;&#30340;&#65292;&#20063;&#23601;&#26159;&#35828;&#21482;&#35201;&#20107;&#21153;&#27809;&#25552;&#20132;&#65292;&#27599;&#29983;&#25104;&#19968;&#26465;
   <code>
    undo&#26085;&#24535;
   </code>
   &#65292;&#37027;&#20040;&#35813;&#26465;&#26085;&#24535;&#30340;
   <code>
    undo no
   </code>
   &#23601;&#22686;1&#12290;
  </p>
 </li>
 <li>
  <p>
   &#22914;&#26524;&#35760;&#24405;&#20013;&#30340;&#20027;&#38190;&#21482;&#21253;&#21547;&#19968;&#20010;&#21015;&#65292;&#37027;&#20040;&#22312;&#31867;&#22411;&#20026;
   <code>
    TRX_UNDO_INSERT_REC
   </code>
   &#30340;
   <code>
    undo&#26085;&#24535;
   </code>
   &#20013;&#21482;&#38656;&#35201;&#25226;&#35813;&#21015;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#22823;&#23567;&#21644;&#30495;&#23454;&#20540;&#35760;&#24405;&#19979;&#26469;&#65292;&#22914;&#26524;&#35760;&#24405;&#20013;&#30340;&#20027;&#38190;&#21253;&#21547;&#22810;&#20010;&#21015;&#65292;&#37027;&#20040;&#27599;&#20010;&#21015;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#22823;&#23567;&#21644;&#23545;&#24212;&#30340;&#30495;&#23454;&#20540;&#37117;&#38656;&#35201;&#35760;&#24405;&#19979;&#26469;&#65288;&#22270;&#20013;&#30340;
   <code>
    len
   </code>
   &#23601;&#20195;&#34920;&#21015;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#22823;&#23567;&#65292;
   <code>
    value
   </code>
   &#23601;&#20195;&#34920;&#21015;&#30340;&#30495;&#23454;&#20540;&#65289;&#12290;
  </p>
 </li>
</ul>
<blockquote class="warning">
 <p>
  &#23567;&#36148;&#22763;&#65306;

&#24403;&#25105;&#20204;&#21521;&#26576;&#20010;&#34920;&#20013;&#25554;&#20837;&#19968;&#26465;&#35760;&#24405;&#26102;&#65292;&#23454;&#38469;&#19978;&#38656;&#35201;&#21521;&#32858;&#31751;&#32034;&#24341;&#21644;&#25152;&#26377;&#30340;&#20108;&#32423;&#32034;&#24341;&#37117;&#25554;&#20837;&#19968;&#26465;&#35760;&#24405;&#12290;&#19981;&#36807;&#35760;&#24405;undo&#26085;&#24535;&#26102;&#65292;&#25105;&#20204;&#21482;&#38656;&#35201;&#32771;&#34385;&#21521;&#32858;&#31751;&#32034;&#24341;&#25554;&#20837;&#35760;&#24405;&#26102;&#30340;&#24773;&#20917;&#23601;&#22909;&#20102;&#65292;&#22240;&#20026;&#20854;&#23454;&#32858;&#31751;&#32034;&#24341;&#35760;&#24405;&#21644;&#20108;&#32423;&#32034;&#24341;&#35760;&#24405;&#26159;&#19968;&#19968;&#23545;&#24212;&#30340;&#65292;&#25105;&#20204;&#22312;&#22238;&#28378;&#25554;&#20837;&#25805;&#20316;&#26102;&#65292;&#21482;&#38656;&#35201;&#30693;&#36947;&#36825;&#26465;&#35760;&#24405;&#30340;&#20027;&#38190;&#20449;&#24687;&#65292;&#28982;&#21518;&#26681;&#25454;&#20027;&#38190;&#20449;&#24687;&#20570;&#23545;&#24212;&#30340;&#21024;&#38500;&#25805;&#20316;&#65292;&#20570;&#21024;&#38500;&#25805;&#20316;&#26102;&#23601;&#20250;&#39034;&#24102;&#30528;&#25226;&#25152;&#26377;&#20108;&#32423;&#32034;&#24341;&#20013;&#30456;&#24212;&#30340;&#35760;&#24405;&#20063;&#21024;&#38500;&#25481;&#12290;&#21518;&#36793;&#35828;&#21040;&#30340;DELETE&#25805;&#20316;&#21644;UPDATE&#25805;&#20316;&#23545;&#24212;&#30340;undo&#26085;&#24535;&#20063;&#37117;&#26159;&#38024;&#23545;&#32858;&#31751;&#32034;&#24341;&#35760;&#24405;&#32780;&#35328;&#30340;&#65292;&#25105;&#20204;&#20043;&#21518;&#23601;&#19981;&#24378;&#35843;&#20102;&#12290;
 </p>
</blockquote>
<p>
 &#29616;&#22312;&#25105;&#20204;&#21521;
 <code>
  undo_demo
 </code>
 &#20013;&#25554;&#20837;&#20004;&#26465;&#35760;&#24405;&#65306;
</p>
<pre><code class="hljs bash" lang="bash">BEGIN;  <span class="hljs-comment"># &#26174;&#24335;&#24320;&#21551;&#19968;&#20010;&#20107;&#21153;&#65292;&#20551;&#35774;&#35813;&#20107;&#21153;&#30340;id&#20026;100</span>

<span class="hljs-comment"># &#25554;&#20837;&#20004;&#26465;&#35760;&#24405;</span>
INSERT INTO undo_demo(id, key1, col) 
    VALUES (1, <span class="hljs-string">'AWM'</span>, <span class="hljs-string">'&#29401;&#20987;&#26538;'</span>), (2, <span class="hljs-string">'M416'</span>, <span class="hljs-string">'&#27493;&#26538;'</span>);
</code></pre>
<p>
 &#22240;&#20026;&#35760;&#24405;&#30340;&#20027;&#38190;&#21482;&#21253;&#21547;&#19968;&#20010;
 <code>
  id
 </code>
 &#21015;&#65292;&#25152;&#20197;&#25105;&#20204;&#22312;&#23545;&#24212;&#30340;
 <code>
  undo&#26085;&#24535;
 </code>
 &#20013;&#21482;&#38656;&#35201;&#23558;&#24453;&#25554;&#20837;&#35760;&#24405;&#30340;
 <code>
  id
 </code>
 &#21015;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#38271;&#24230;&#65288;
 <code>
  id
 </code>
 &#21015;&#30340;&#31867;&#22411;&#20026;
 <code>
  INT
 </code>
 &#65292;
 <code>
  INT
 </code>
 &#31867;&#22411;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#38271;&#24230;&#20026;
 <code>
  4
 </code>
 &#20010;&#23383;&#33410;&#65289;&#21644;&#30495;&#23454;&#20540;&#35760;&#24405;&#19979;&#26469;&#12290;&#26412;&#20363;&#20013;&#25554;&#20837;&#20102;&#20004;&#26465;&#35760;&#24405;&#65292;&#25152;&#20197;&#20250;&#20135;&#29983;&#20004;&#26465;&#31867;&#22411;&#20026;
 <code>
  TRX_UNDO_INSERT_REC
 </code>
 &#30340;
 <code>
  undo&#26085;&#24535;
 </code>
 :
</p>
<ul>
 <li>
  <p>
   &#31532;&#19968;&#26465;
   <code>
    undo&#26085;&#24535;
   </code>
   &#30340;
   <code>
    undo no
   </code>
   &#20026;
   <code>
    0
   </code>
   &#65292;&#35760;&#24405;&#20027;&#38190;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#38271;&#24230;&#20026;
   <code>
    4
   </code>
   &#65292;&#30495;&#23454;&#20540;&#20026;
   <code>
    1
   </code>
   &#12290;&#30011;&#19968;&#20010;&#31034;&#24847;&#22270;&#23601;&#26159;&#36825;&#26679;&#65306;
  </p>
  <p>
  </p>
  <figure>
   <img alt="image_1d658eq7rokf19jffpt20010b63t.png-52.6kB" src="EPUB/39d240ee-13d6-11ed-838d-acde48001122">
   <figcaption>
   </figcaption>
  </figure>
  <p>
  </p>
 </li>
 <li>
  <p>
   &#31532;&#20108;&#26465;
   <code>
    undo&#26085;&#24535;
   </code>
   &#30340;
   <code>
    undo no
   </code>
   &#20026;
   <code>
    1
   </code>
   &#65292;&#35760;&#24405;&#20027;&#38190;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#38271;&#24230;&#20026;
   <code>
    4
   </code>
   &#65292;&#30495;&#23454;&#20540;&#20026;
   <code>
    2
   </code>
   &#12290;&#30011;&#19968;&#20010;&#31034;&#24847;&#22270;&#23601;&#26159;&#36825;&#26679;&#65288;&#19982;&#31532;&#19968;&#26465;
   <code>
    undo&#26085;&#24535;
   </code>
   &#23545;&#27604;&#65292;
   <code>
    undo no
   </code>
   &#21644;&#20027;&#38190;&#21508;&#21015;&#20449;&#24687;&#26377;&#19981;&#21516;&#65289;&#65306;
  </p>
  <p>
  </p>
  <figure>
   <img alt="image_1d658gaqa1n1g5b7166lden5je4q.png-52.5kB" src="EPUB/39e6faca-13d6-11ed-838d-acde48001122">
   <figcaption>
   </figcaption>
  </figure>
  <p>
  </p>
 </li>
</ul>
<blockquote class="warning">
 <p>
  &#23567;&#36148;&#22763;&#65306;

&#20026;&#20102;&#26368;&#22823;&#38480;&#24230;&#30340;&#33410;&#30465;undo&#26085;&#24535;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#65292;&#21644;&#25105;&#20204;&#21069;&#36793;&#35828;&#36807;&#30340;redo&#26085;&#24535;&#31867;&#20284;&#65292;&#35774;&#35745;InnoDB&#30340;&#22823;&#21460;&#20250;&#32473;undo&#26085;&#24535;&#20013;&#30340;&#26576;&#20123;&#23646;&#24615;&#36827;&#34892;&#21387;&#32553;&#22788;&#29702;&#65292;&#20855;&#20307;&#30340;&#21387;&#32553;&#32454;&#33410;&#25105;&#20204;&#23601;&#19981;&#21792;&#21480;&#20102;&#12290;
 </p>
</blockquote>
<h4 class="heading">
 roll_pointer&#38544;&#34255;&#21015;&#30340;&#21547;&#20041;
</h4>
<p>
 &#26159;&#26102;&#20505;&#25581;&#24320;
 <code>
  roll_pointer
 </code>
 &#30340;&#30495;&#23454;&#38754;&#32433;&#20102;&#65292;&#36825;&#20010;&#21344;&#29992;
 <code>
  7
 </code>
 &#20010;&#23383;&#33410;&#30340;&#23383;&#27573;&#20854;&#23454;&#19968;&#28857;&#37117;&#19981;&#31070;&#31192;&#65292;&#26412;&#36136;&#19978;&#23601;&#26159;&#19968;&#20010;&#25351;&#21521;&#35760;&#24405;&#23545;&#24212;&#30340;
 <code>
  undo&#26085;&#24535;
 </code>
 &#30340;&#19968;&#20010;&#25351;&#38024;&#12290;&#27604;&#26041;&#35828;&#25105;&#20204;&#19978;&#36793;&#21521;
 <code>
  undo_demo
 </code>
 &#34920;&#37324;&#25554;&#20837;&#20102;2&#26465;&#35760;&#24405;&#65292;&#27599;&#26465;&#35760;&#24405;&#37117;&#26377;&#19982;&#20854;&#23545;&#24212;&#30340;&#19968;&#26465;
 <code>
  undo&#26085;&#24535;
 </code>
 &#12290;&#35760;&#24405;&#34987;&#23384;&#20648;&#21040;&#20102;&#31867;&#22411;&#20026;
 <code>
  FIL_PAGE_INDEX
 </code>
 &#30340;&#39029;&#38754;&#20013;&#65288;&#23601;&#26159;&#25105;&#20204;&#21069;&#36793;&#19968;&#30452;&#25152;&#35828;&#30340;
 <code>
  &#25968;&#25454;&#39029;
 </code>
 &#65289;&#65292;
 <code>
  undo&#26085;&#24535;
 </code>
 &#34987;&#23384;&#25918;&#21040;&#20102;&#31867;&#22411;&#20026;
 <code>
  FIL_PAGE_UNDO_LOG
 </code>
 &#30340;&#39029;&#38754;&#20013;&#12290;&#25928;&#26524;&#22914;&#22270;&#25152;&#31034;&#65306;
</p>
<p>
</p>
<figure>
 <img alt="image_1d65h98l3qve1ekb13epv4f37685.png-70.6kB" src="EPUB/39f4b6d8-13d6-11ed-838d-acde48001122">
 <figcaption>
 </figcaption>
</figure>
<p>
</p>
<p>
 &#20174;&#22270;&#20013;&#20063;&#21487;&#20197;&#26356;&#30452;&#35266;&#30340;&#30475;&#20986;&#26469;&#65292;
 <code>
  roll_pointer
 </code>
 <span style="color:red">
  &#26412;&#36136;&#23601;&#26159;&#19968;&#20010;&#25351;&#38024;&#65292;&#25351;&#21521;&#35760;&#24405;&#23545;&#24212;&#30340;undo&#26085;&#24535;
 </span>
 &#12290;&#19981;&#36807;&#36825;
 <code>
  7
 </code>
 &#20010;&#23383;&#33410;&#30340;
 <code>
  roll_pointer
 </code>
 &#30340;&#27599;&#19968;&#20010;&#23383;&#33410;&#20855;&#20307;&#30340;&#21547;&#20041;&#25105;&#20204;&#21518;&#36793;&#21792;&#21480;&#23436;&#22914;&#20309;&#20998;&#37197;&#23384;&#20648;
 <code>
  undo
 </code>
 &#26085;&#24535;&#30340;&#39029;&#38754;&#20043;&#21518;&#20877;&#20855;&#20307;&#35828;&#21704;&#65374;
</p>
<h3 class="heading">
 DELETE&#25805;&#20316;&#23545;&#24212;&#30340;undo&#26085;&#24535;
</h3>
<p>
 &#25105;&#20204;&#30693;&#36947;&#25554;&#20837;&#21040;&#39029;&#38754;&#20013;&#30340;&#35760;&#24405;&#20250;&#26681;&#25454;&#35760;&#24405;&#22836;&#20449;&#24687;&#20013;&#30340;
 <code>
  next_record
 </code>
 &#23646;&#24615;&#32452;&#25104;&#19968;&#20010;&#21333;&#21521;&#38142;&#34920;&#65292;&#25105;&#20204;&#25226;&#36825;&#20010;&#38142;&#34920;&#31216;&#20043;&#20026;
 <code>
  &#27491;&#24120;&#35760;&#24405;&#38142;&#34920;
 </code>
 &#65307;&#25105;&#20204;&#22312;&#21069;&#36793;&#21792;&#21480;&#25968;&#25454;&#39029;&#32467;&#26500;&#30340;&#26102;&#20505;&#35828;&#36807;&#65292;&#34987;&#21024;&#38500;&#30340;&#35760;&#24405;&#20854;&#23454;&#20063;&#20250;&#26681;&#25454;&#35760;&#24405;&#22836;&#20449;&#24687;&#20013;&#30340;
 <code>
  next_record
 </code>
 &#23646;&#24615;&#32452;&#25104;&#19968;&#20010;&#38142;&#34920;&#65292;&#21482;&#19981;&#36807;&#36825;&#20010;&#38142;&#34920;&#20013;&#30340;&#35760;&#24405;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#21487;&#20197;&#34987;&#37325;&#26032;&#21033;&#29992;&#65292;&#25152;&#20197;&#20063;&#31216;&#36825;&#20010;&#38142;&#34920;&#20026;
 <code>
  &#22403;&#22334;&#38142;&#34920;
 </code>
 &#12290;
 <code>
  Page Header
 </code>
 &#37096;&#20998;&#26377;&#19968;&#20010;&#31216;&#20043;&#20026;
 <code>
  PAGE_FREE
 </code>
 &#30340;&#23646;&#24615;&#65292;&#23427;&#25351;&#21521;&#30001;&#34987;&#21024;&#38500;&#35760;&#24405;&#32452;&#25104;&#30340;&#22403;&#22334;&#38142;&#34920;&#20013;&#30340;&#22836;&#33410;&#28857;&#12290;&#20026;&#20102;&#25925;&#20107;&#30340;&#39034;&#21033;&#21457;&#23637;&#65292;&#25105;&#20204;&#20808;&#30011;&#19968;&#20010;&#22270;&#65292;&#20551;&#35774;&#27492;&#21051;&#26576;&#20010;&#39029;&#38754;&#20013;&#30340;&#35760;&#24405;&#20998;&#24067;&#24773;&#20917;&#26159;&#36825;&#26679;&#30340;&#65288;&#36825;&#20010;&#19981;&#26159;
 <code>
  undo_demo
 </code>
 &#34920;&#20013;&#30340;&#35760;&#24405;&#65292;&#21482;&#26159;&#25105;&#20204;&#38543;&#20415;&#20030;&#30340;&#19968;&#20010;&#20363;&#23376;&#65289;&#65306;
</p>
<p>
</p>
<figure>
 <img alt="image_1d6abjg9n1kocq5d10j6250164v9.png-62.8kB" src="EPUB/3a07433e-13d6-11ed-838d-acde48001122">
 <figcaption>
 </figcaption>
</figure>
<p>
</p>
<p>
 &#20026;&#20102;&#31361;&#20986;&#20027;&#39064;&#65292;&#22312;&#36825;&#20010;&#31616;&#21270;&#29256;&#30340;&#31034;&#24847;&#22270;&#20013;&#65292;&#25105;&#20204;&#21482;&#25226;&#35760;&#24405;&#30340;
 <code>
  delete_mask
 </code>
 &#26631;&#24535;&#20301;&#23637;&#31034;&#20102;&#20986;&#26469;&#12290;&#20174;&#22270;&#20013;&#21487;&#20197;&#30475;&#20986;&#65292;
 <code>
  &#27491;&#24120;&#35760;&#24405;&#38142;&#34920;
 </code>
 &#20013;&#21253;&#21547;&#20102;3&#26465;&#27491;&#24120;&#35760;&#24405;&#65292;
 <code>
  &#22403;&#22334;&#38142;&#34920;
 </code>
 &#37324;&#21253;&#21547;&#20102;2&#26465;&#24050;&#21024;&#38500;&#35760;&#24405;&#65292;&#22312;
 <code>
  &#22403;&#22334;&#38142;&#34920;
 </code>
 &#20013;&#30340;&#36825;&#20123;&#35760;&#24405;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#21487;&#20197;&#34987;&#37325;&#26032;&#21033;&#29992;&#12290;&#39029;&#38754;&#30340;
 <code>
  Page Header
 </code>
 &#37096;&#20998;&#30340;
 <code>
  PAGE_FREE
 </code>
 &#23646;&#24615;&#30340;&#20540;&#20195;&#34920;&#25351;&#21521;
 <code>
  &#22403;&#22334;&#38142;&#34920;
 </code>
 &#22836;&#33410;&#28857;&#30340;&#25351;&#38024;&#12290;&#20551;&#35774;&#29616;&#22312;&#25105;&#20204;&#20934;&#22791;&#20351;&#29992;
 <code>
  DELETE
 </code>
 &#35821;&#21477;&#25226;
 <code>
  &#27491;&#24120;&#35760;&#24405;&#38142;&#34920;
 </code>
 &#20013;&#30340;&#26368;&#21518;&#19968;&#26465;&#35760;&#24405;&#32473;&#21024;&#38500;&#25481;&#65292;&#20854;&#23454;&#36825;&#20010;&#21024;&#38500;&#30340;&#36807;&#31243;&#38656;&#35201;&#32463;&#21382;&#20004;&#20010;&#38454;&#27573;&#65306;
</p>
<ul>
 <li>
  <p>
   &#38454;&#27573;&#19968;&#65306;&#20165;&#20165;&#23558;&#35760;&#24405;&#30340;
   <code>
    delete_mask
   </code>
   &#26631;&#35782;&#20301;&#35774;&#32622;&#20026;
   <code>
    1
   </code>
   &#65292;&#20854;&#20182;&#30340;&#19981;&#20570;&#20462;&#25913;&#65288;&#20854;&#23454;&#20250;&#20462;&#25913;&#35760;&#24405;&#30340;
   <code>
    trx_id
   </code>
   &#12289;
   <code>
    roll_pointer
   </code>
   &#36825;&#20123;&#38544;&#34255;&#21015;&#30340;&#20540;&#65289;&#12290;&#35774;&#35745;
   <code>
    InnoDB
   </code>
   &#30340;&#22823;&#21460;&#25226;&#36825;&#20010;&#38454;&#27573;&#31216;&#20043;&#20026;
   <code>
    delete mark
   </code>
   &#12290;
  </p>
  <p>
   &#25226;&#36825;&#20010;&#36807;&#31243;&#30011;&#19979;&#26469;&#23601;&#26159;&#36825;&#26679;&#65306;
  </p>
  <p>
  </p>
  <figure>
   <img alt="image_1d78ts1ajulu1v9o11i2g619s3p.png-64.1kB" src="EPUB/3a1cd29e-13d6-11ed-838d-acde48001122">
   <figcaption>
   </figcaption>
  </figure>
  <p>
  </p>
  <p>
   &#21487;&#20197;&#30475;&#21040;&#65292;
   <code>
    &#27491;&#24120;&#35760;&#24405;&#38142;&#34920;
   </code>
   &#20013;&#30340;&#26368;&#21518;&#19968;&#26465;&#35760;&#24405;&#30340;
   <code>
    delete_mask
   </code>
   &#20540;&#34987;&#35774;&#32622;&#20026;
   <code>
    1
   </code>
   &#65292;&#20294;&#26159;&#24182;&#27809;&#26377;&#34987;&#21152;&#20837;&#21040;
   <code>
    &#22403;&#22334;&#38142;&#34920;
   </code>
   &#12290;&#20063;&#23601;&#26159;&#27492;&#26102;&#35760;&#24405;&#22788;&#20110;&#19968;&#20010;
   <code>
    &#20013;&#38388;&#29366;&#24577;
   </code>
   &#65292;&#36319;&#29482;&#20843;&#25106;&#29031;&#38236;&#23376;&#8212;&#8212;&#37324;&#22806;&#19981;&#26159;&#20154;&#20284;&#30340;&#12290;&#22312;&#21024;&#38500;&#35821;&#21477;&#25152;&#22312;&#30340;&#20107;&#21153;&#25552;&#20132;&#20043;&#21069;&#65292;&#34987;&#21024;&#38500;&#30340;&#35760;&#24405;&#19968;&#30452;&#37117;&#22788;&#20110;&#36825;&#31181;&#25152;&#35859;&#30340;
   <code>
    &#20013;&#38388;&#29366;&#24577;
   </code>
   &#12290;
  </p>
  <blockquote class="warning">
   <p>
    &#23567;&#36148;&#22763;&#65306;

&#20026;&#21861;&#20250;&#26377;&#36825;&#31181;&#22855;&#24618;&#30340;&#20013;&#38388;&#29366;&#24577;&#21602;&#65311;&#20854;&#23454;&#20027;&#35201;&#26159;&#20026;&#20102;&#23454;&#29616;&#19968;&#20010;&#31216;&#20043;&#20026;MVCC&#30340;&#21151;&#33021;&#65292;&#21704;&#21704;&#65292;&#31245;&#21518;&#20877;&#20171;&#32461;&#12290;
   </p>
  </blockquote>
 </li>
 <li>
  <p>
   &#38454;&#27573;&#20108;&#65306;
   <span style="color:red">
    &#24403;&#35813;&#21024;&#38500;&#35821;&#21477;&#25152;&#22312;&#30340;&#20107;&#21153;&#25552;&#20132;&#20043;&#21518;
   </span>
   &#65292;&#20250;&#26377;
   <span style="color:red">
    &#19987;&#38376;&#30340;&#32447;&#31243;&#21518;
   </span>
   &#26469;&#30495;&#27491;&#30340;&#25226;&#35760;&#24405;&#21024;&#38500;&#25481;&#12290;&#25152;&#35859;&#30495;&#27491;&#30340;&#21024;&#38500;&#23601;&#26159;&#25226;&#35813;&#35760;&#24405;&#20174;
   <code>
    &#27491;&#24120;&#35760;&#24405;&#38142;&#34920;
   </code>
   &#20013;&#31227;&#38500;&#65292;&#24182;&#19988;&#21152;&#20837;&#21040;
   <code>
    &#22403;&#22334;&#38142;&#34920;
   </code>
   &#20013;&#65292;&#28982;&#21518;&#36824;&#35201;&#35843;&#25972;&#19968;&#20123;&#39029;&#38754;&#30340;&#20854;&#20182;&#20449;&#24687;&#65292;&#27604;&#22914;&#39029;&#38754;&#20013;&#30340;&#29992;&#25143;&#35760;&#24405;&#25968;&#37327;
   <code>
    PAGE_N_RECS
   </code>
   &#12289;&#19978;&#27425;&#25554;&#20837;&#35760;&#24405;&#30340;&#20301;&#32622;
   <code>
    PAGE_LAST_INSERT
   </code>
   &#12289;&#22403;&#22334;&#38142;&#34920;&#22836;&#33410;&#28857;&#30340;&#25351;&#38024;
   <code>
    PAGE_FREE
   </code>
   &#12289;&#39029;&#38754;&#20013;&#21487;&#37325;&#29992;&#30340;&#23383;&#33410;&#25968;&#37327;
   <code>
    PAGE_GARBAGE
   </code>
   &#12289;&#36824;&#26377;&#39029;&#30446;&#24405;&#30340;&#19968;&#20123;&#20449;&#24687;&#31561;&#31561;&#12290;&#35774;&#35745;
   <code>
    InnoDB
   </code>
   &#30340;&#22823;&#21460;&#25226;&#36825;&#20010;&#38454;&#27573;&#31216;&#20043;&#20026;
   <code>
    purge
   </code>
   &#12290;
  </p>
  <p>
   &#25226;
   <code>
    &#38454;&#27573;&#20108;
   </code>
   &#25191;&#34892;&#23436;&#20102;&#65292;&#36825;&#26465;&#35760;&#24405;&#23601;&#31639;&#26159;&#30495;&#27491;&#30340;&#34987;&#21024;&#38500;&#25481;&#20102;&#12290;&#36825;&#26465;&#24050;&#21024;&#38500;&#35760;&#24405;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#20063;&#21487;&#20197;&#34987;&#37325;&#26032;&#21033;&#29992;&#20102;&#12290;&#30011;&#19979;&#26469;&#23601;&#26159;&#36825;&#26679;&#65306;
  </p>
  <p>
  </p>
  <figure>
   <img alt="image_1de3lkv7bkem1n1717tj1jbq669p.png-71.5kB" src="EPUB/3a2f5b30-13d6-11ed-838d-acde48001122">
   <figcaption>
   </figcaption>
  </figure>
  <p>
  </p>
  <p>
   &#23545;&#29031;&#30528;&#22270;&#25105;&#20204;&#36824;&#35201;&#27880;&#24847;&#19968;&#28857;&#65292;&#23558;&#34987;&#21024;&#38500;&#35760;&#24405;&#21152;&#20837;&#21040;
   <code>
    &#22403;&#22334;&#38142;&#34920;
   </code>
   &#26102;&#65292;&#23454;&#38469;&#19978;&#21152;&#20837;&#21040;&#38142;&#34920;&#30340;&#22836;&#33410;&#28857;&#22788;&#65292;&#20250;&#36319;&#30528;&#20462;&#25913;
   <code>
    PAGE_FREE
   </code>
   &#23646;&#24615;&#30340;&#20540;&#12290;
  </p>
 </li>
</ul>
<blockquote class="warning">
 <p>
  &#23567;&#36148;&#22763;&#65306;

&#39029;&#38754;&#30340;Page Header&#37096;&#20998;&#26377;&#19968;&#20010;PAGE_GARBAGE&#23646;&#24615;&#65292;&#35813;&#23646;&#24615;&#35760;&#24405;&#30528;&#24403;&#21069;&#39029;&#38754;&#20013;&#21487;&#37325;&#29992;&#23384;&#20648;&#31354;&#38388;&#21344;&#29992;&#30340;&#24635;&#23383;&#33410;&#25968;&#12290;&#27599;&#24403;&#26377;&#24050;&#21024;&#38500;&#35760;&#24405;&#34987;&#21152;&#20837;&#21040;&#22403;&#22334;&#38142;&#34920;&#21518;&#65292;&#37117;&#20250;&#25226;&#36825;&#20010;PAGE_GARBAGE&#23646;&#24615;&#30340;&#20540;&#21152;&#19978;&#35813;&#24050;&#21024;&#38500;&#35760;&#24405;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#22823;&#23567;&#12290;PAGE_FREE&#25351;&#21521;&#22403;&#22334;&#38142;&#34920;&#30340;&#22836;&#33410;&#28857;&#65292;&#20043;&#21518;&#27599;&#24403;&#26032;&#25554;&#20837;&#35760;&#24405;&#26102;&#65292;&#39318;&#20808;&#21028;&#26029;PAGE_FREE&#25351;&#21521;&#30340;&#22836;&#33410;&#28857;&#20195;&#34920;&#30340;&#24050;&#21024;&#38500;&#35760;&#24405;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#26159;&#21542;&#36275;&#22815;&#23481;&#32435;&#36825;&#26465;&#26032;&#25554;&#20837;&#30340;&#35760;&#24405;&#65292;&#22914;&#26524;&#19981;&#21487;&#20197;&#23481;&#32435;&#65292;&#23601;&#30452;&#25509;&#21521;&#39029;&#38754;&#20013;&#30003;&#35831;&#26032;&#30340;&#31354;&#38388;&#26469;&#23384;&#20648;&#36825;&#26465;&#35760;&#24405;&#65288;&#26159;&#30340;&#65292;&#20320;&#27809;&#30475;&#38169;&#65292;&#24182;&#19981;&#20250;&#23581;&#35797;&#36941;&#21382;&#25972;&#20010;&#22403;&#22334;&#38142;&#34920;&#65292;&#25214;&#21040;&#19968;&#20010;&#21487;&#20197;&#23481;&#32435;&#26032;&#35760;&#24405;&#30340;&#33410;&#28857;&#65289;&#12290;&#22914;&#26524;&#21487;&#20197;&#23481;&#32435;&#65292;&#37027;&#20040;&#30452;&#25509;&#37325;&#29992;&#36825;&#26465;&#24050;&#21024;&#38500;&#35760;&#24405;&#30340;&#23384;&#20648;&#31354;&#38388;&#65292;&#24182;&#19988;&#25226;PAGE_FREE&#25351;&#21521;&#22403;&#22334;&#38142;&#34920;&#20013;&#30340;&#19979;&#19968;&#26465;&#24050;&#21024;&#38500;&#35760;&#24405;&#12290;&#20294;&#26159;&#36825;&#37324;&#26377;&#19968;&#20010;&#38382;&#39064;&#65292;&#22914;&#26524;&#26032;&#25554;&#20837;&#30340;&#37027;&#26465;&#35760;&#24405;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#22823;&#23567;&#23567;&#20110;&#22403;&#22334;&#38142;&#34920;&#30340;&#22836;&#33410;&#28857;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#22823;&#23567;&#65292;&#37027;&#23601;&#24847;&#21619;&#22836;&#33410;&#28857;&#23545;&#24212;&#30340;&#35760;&#24405;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#37324;&#26377;&#19968;&#37096;&#20998;&#31354;&#38388;&#29992;&#19981;&#21040;&#65292;&#36825;&#37096;&#20998;&#31354;&#38388;&#23601;&#34987;&#31216;&#20043;&#20026;&#30862;&#29255;&#31354;&#38388;&#12290;&#37027;&#36825;&#20123;&#30862;&#29255;&#31354;&#38388;&#23682;&#19981;&#26159;&#27704;&#36828;&#37117;&#29992;&#19981;&#21040;&#20102;&#20040;&#65311;&#20854;&#23454;&#20063;&#19981;&#26159;&#65292;&#36825;&#20123;&#30862;&#29255;&#31354;&#38388;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#22823;&#23567;&#20250;&#34987;&#32479;&#35745;&#21040;PAGE_GARBAGE&#23646;&#24615;&#20013;&#65292;&#36825;&#20123;&#30862;&#29255;&#31354;&#38388;&#22312;&#25972;&#20010;&#39029;&#38754;&#24555;&#20351;&#29992;&#23436;&#21069;&#24182;&#19981;&#20250;&#34987;&#37325;&#26032;&#21033;&#29992;&#65292;&#19981;&#36807;&#24403;&#39029;&#38754;&#24555;&#28385;&#26102;&#65292;&#22914;&#26524;&#20877;&#25554;&#20837;&#19968;&#26465;&#35760;&#24405;&#65292;&#27492;&#26102;&#39029;&#38754;&#20013;&#24182;&#19981;&#33021;&#20998;&#37197;&#19968;&#26465;&#23436;&#25972;&#35760;&#24405;&#30340;&#31354;&#38388;&#65292;&#36825;&#26102;&#20505;&#20250;&#39318;&#20808;&#30475;&#19968;&#30475;PAGE_GARBAGE&#30340;&#31354;&#38388;&#21644;&#21097;&#20313;&#21487;&#21033;&#29992;&#30340;&#31354;&#38388;&#21152;&#36215;&#26469;&#26159;&#19981;&#26159;&#21487;&#20197;&#23481;&#32435;&#19979;&#36825;&#26465;&#35760;&#24405;&#65292;&#22914;&#26524;&#21487;&#20197;&#30340;&#35805;&#65292;InnoDB&#20250;&#23581;&#35797;&#37325;&#26032;&#32452;&#32455;&#39029;&#20869;&#30340;&#35760;&#24405;&#65292;&#37325;&#26032;&#32452;&#32455;&#30340;&#36807;&#31243;&#23601;&#26159;&#20808;&#24320;&#36767;&#19968;&#20010;&#20020;&#26102;&#39029;&#38754;&#65292;&#25226;&#39029;&#38754;&#20869;&#30340;&#35760;&#24405;&#20381;&#27425;&#25554;&#20837;&#19968;&#36941;&#65292;&#22240;&#20026;&#20381;&#27425;&#25554;&#20837;&#26102;&#24182;&#19981;&#20250;&#20135;&#29983;&#30862;&#29255;&#65292;&#20043;&#21518;&#20877;&#25226;&#20020;&#26102;&#39029;&#38754;&#30340;&#20869;&#23481;&#22797;&#21046;&#21040;&#26412;&#39029;&#38754;&#65292;&#36825;&#26679;&#23601;&#21487;&#20197;&#25226;&#37027;&#20123;&#30862;&#29255;&#31354;&#38388;&#37117;&#35299;&#25918;&#20986;&#26469;&#65288;&#24456;&#26174;&#28982;&#37325;&#26032;&#32452;&#32455;&#39029;&#38754;&#20869;&#30340;&#35760;&#24405;&#27604;&#36739;&#32791;&#36153;&#24615;&#33021;&#65289;&#12290;
 </p>
</blockquote>
<p>
 &#20174;&#19978;&#36793;&#30340;&#25551;&#36848;&#20013;&#25105;&#20204;&#20063;&#21487;&#20197;&#30475;&#20986;&#26469;&#65292;&#22312;&#21024;&#38500;&#35821;&#21477;&#25152;&#22312;&#30340;&#20107;&#21153;&#25552;&#20132;&#20043;&#21069;&#65292;&#21482;&#20250;&#32463;&#21382;
 <code>
  &#38454;&#27573;&#19968;
 </code>
 &#65292;&#20063;&#23601;&#26159;
 <code>
  delete mark
 </code>
 &#38454;&#27573;&#65288;&#25552;&#20132;&#20043;&#21518;&#25105;&#20204;&#23601;&#19981;&#29992;&#22238;&#28378;&#20102;&#65292;&#25152;&#20197;&#21482;&#38656;&#32771;&#34385;&#23545;&#21024;&#38500;&#25805;&#20316;&#30340;
 <code>
  &#38454;&#27573;&#19968;
 </code>
 &#20570;&#30340;&#24433;&#21709;&#36827;&#34892;&#22238;&#28378;&#65289;&#12290;&#35774;&#35745;
 <code>
  InnoDB
 </code>
 &#30340;&#22823;&#21460;&#20026;&#27492;&#35774;&#35745;&#20102;&#19968;&#31181;&#31216;&#20043;&#20026;
 <code>
  TRX_UNDO_DEL_MARK_REC
 </code>
 &#31867;&#22411;&#30340;
 <code>
  undo&#26085;&#24535;
 </code>
 &#65292;&#23427;&#30340;&#23436;&#25972;&#32467;&#26500;&#22914;&#19979;&#22270;&#25152;&#31034;&#65306;
</p>
<p>
</p>
<figure>
 <img alt="image_1d6avo9eb10dd26lb9jo2o10hu9.png-134.6kB" src="EPUB/3a418e18-13d6-11ed-838d-acde48001122">
 <figcaption>
 </figcaption>
</figure>
<p>
</p>
<p>
 &#39069;&#28404;&#20010;&#31070;&#21584;&#65292;&#36825;&#20010;&#37324;&#36793;&#30340;&#23646;&#24615;&#20063;&#22826;&#22810;&#20102;&#28857;&#20799;&#21543;&#65374; &#65288;&#20854;&#23454;&#22823;&#37096;&#20998;&#23646;&#24615;&#30340;&#24847;&#24605;&#25105;&#20204;&#19978;&#36793;&#24050;&#32463;&#20171;&#32461;&#36807;&#20102;&#65289; &#26159;&#30340;&#65292;&#30340;&#30830;&#26377;&#28857;&#22810;&#65292;&#19981;&#36807;&#22823;&#23478;&#21315;&#19975;&#19981;&#35201;&#22312;&#24847;&#65292;&#22914;&#26524;&#35760;&#19981;&#20303;&#21315;&#19975;&#19981;&#35201;&#21193;&#24378;&#33258;&#24049;&#65292;&#25105;&#36825;&#37324;&#25226;&#23427;&#20204;&#37117;&#21015;&#20986;&#26469;&#35753;&#22823;&#23478;&#28151;&#20010;&#33080;&#29087;&#32780;&#24050;&#12290;&#21171;&#28902;&#22823;&#23478;&#20808;&#20811;&#26381;&#19968;&#19979;&#23494;&#38598;&#24656;&#24613;&#30151;&#65292;&#20877;&#25260;&#22836;&#22823;&#33268;&#30475;&#19968;&#36941;&#19978;&#36793;&#30340;&#36825;&#20010;&#31867;&#22411;&#20026;
 <code>
  TRX_UNDO_DEL_MARK_REC
 </code>
 &#30340;
 <code>
  undo&#26085;&#24535;
 </code>
 &#20013;&#30340;&#23646;&#24615;&#65292;&#29305;&#21035;&#27880;&#24847;&#19968;&#19979;&#36825;&#20960;&#28857;&#65306;
</p>
<ul>
 <li>
  <p>
   &#22312;&#23545;&#19968;&#26465;&#35760;&#24405;&#36827;&#34892;
   <code>
    delete mark
   </code>
   &#25805;&#20316;&#21069;&#65292;&#38656;&#35201;&#25226;&#35813;&#35760;&#24405;&#30340;&#26087;&#30340;
   <code>
    trx_id
   </code>
   &#21644;
   <code>
    roll_pointer
   </code>
   &#38544;&#34255;&#21015;&#30340;&#20540;&#37117;&#32473;&#35760;&#21040;&#23545;&#24212;&#30340;
   <code>
    undo&#26085;&#24535;
   </code>
   &#20013;&#26469;&#65292;&#23601;&#26159;&#25105;&#20204;&#22270;&#20013;&#26174;&#31034;&#30340;
   <code>
    old trx_id
   </code>
   &#21644;
   <code>
    old roll_pointer
   </code>
   &#23646;&#24615;&#12290;&#36825;&#26679;&#26377;&#19968;&#20010;&#22909;&#22788;&#65292;&#37027;&#23601;&#26159;&#21487;&#20197;&#36890;&#36807;
   <code>
    undo&#26085;&#24535;
   </code>
   &#30340;
   <code>
    old roll_pointer
   </code>
   &#25214;&#21040;&#35760;&#24405;&#22312;&#20462;&#25913;&#20043;&#21069;&#23545;&#24212;&#30340;
   <code>
    undo
   </code>
   &#26085;&#24535;&#12290;&#27604;&#26041;&#35828;&#22312;&#19968;&#20010;&#20107;&#21153;&#20013;&#65292;&#25105;&#20204;&#20808;&#25554;&#20837;&#20102;&#19968;&#26465;&#35760;&#24405;&#65292;&#28982;&#21518;&#21448;&#25191;&#34892;&#23545;&#35813;&#35760;&#24405;&#30340;&#21024;&#38500;&#25805;&#20316;&#65292;&#36825;&#20010;&#36807;&#31243;&#30340;&#31034;&#24847;&#22270;&#23601;&#26159;&#36825;&#26679;&#65306;
  </p>
  <p>
  </p>
  <figure>
   <img alt="image_1d6cg2ocf8ctpot13121pb7a9tp.png-36.4kB" src="EPUB/3a5857ba-13d6-11ed-838d-acde48001122">
   <figcaption>
   </figcaption>
  </figure>
  <p>
  </p>
  <p>
   &#20174;&#22270;&#20013;&#21487;&#20197;&#30475;&#20986;&#26469;&#65292;&#25191;&#34892;&#23436;
   <code>
    delete mark
   </code>
   &#25805;&#20316;&#21518;&#65292;&#23427;&#23545;&#24212;&#30340;
   <code>
    undo
   </code>
   &#26085;&#24535;&#21644;
   <code>
    INSERT
   </code>
   &#25805;&#20316;&#23545;&#24212;&#30340;
   <code>
    undo
   </code>
   &#26085;&#24535;&#23601;&#20018;&#25104;&#20102;&#19968;&#20010;&#38142;&#34920;&#12290;&#36825;&#20010;&#24456;&#26377;&#24847;&#24605;&#21834;&#65292;&#36825;&#20010;&#38142;&#34920;&#23601;&#31216;&#20043;&#20026;
   <code>
    &#29256;&#26412;&#38142;
   </code>
   &#65292;&#29616;&#22312;&#35980;&#20284;&#30475;&#19981;&#20986;&#36825;&#20010;
   <code>
    &#29256;&#26412;&#38142;
   </code>
   &#26377;&#21861;&#29992;&#65292;&#31561;&#25105;&#20204;&#20877;&#24448;&#21518;&#30475;&#30475;&#65292;&#35762;&#23436;
   <code>
    UPDATE
   </code>
   &#25805;&#20316;&#23545;&#24212;&#30340;
   <code>
    undo
   </code>
   &#26085;&#24535;&#21518;&#65292;&#36825;&#20010;&#25152;&#35859;&#30340;
   <code>
    &#29256;&#26412;&#38142;
   </code>
   &#23601;&#24930;&#24930;&#30340;&#23637;&#29616;&#20986;&#23427;&#30340;&#29275;&#36924;&#20043;&#22788;&#20102;&#12290;
  </p>
 </li>
 <li>
  <p>
   &#19982;&#31867;&#22411;&#20026;
   <code>
    TRX_UNDO_INSERT_REC
   </code>
   &#30340;
   <code>
    undo&#26085;&#24535;
   </code>
   &#19981;&#21516;&#65292;&#31867;&#22411;&#20026;
   <code>
    TRX_UNDO_DEL_MARK_REC
   </code>
   &#30340;
   <code>
    undo
   </code>
   &#26085;&#24535;&#36824;&#22810;&#20102;&#19968;&#20010;
   <code>
    &#32034;&#24341;&#21015;&#21508;&#21015;&#20449;&#24687;
   </code>
   &#30340;&#20869;&#23481;&#65292;&#20063;&#23601;&#26159;&#35828;&#22914;&#26524;&#26576;&#20010;&#21015;&#34987;&#21253;&#21547;&#22312;&#26576;&#20010;&#32034;&#24341;&#20013;&#65292;&#37027;&#20040;&#23427;&#30340;&#30456;&#20851;&#20449;&#24687;&#23601;&#24212;&#35813;&#34987;&#35760;&#24405;&#21040;&#36825;&#20010;
   <code>
    &#32034;&#24341;&#21015;&#21508;&#21015;&#20449;&#24687;
   </code>
   &#37096;&#20998;&#65292;&#25152;&#35859;&#30340;&#30456;&#20851;&#20449;&#24687;&#21253;&#25324;&#35813;&#21015;&#22312;&#35760;&#24405;&#20013;&#30340;&#20301;&#32622;&#65288;&#29992;
   <code>
    pos
   </code>
   &#34920;&#31034;&#65289;&#65292;&#35813;&#21015;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#22823;&#23567;&#65288;&#29992;
   <code>
    len
   </code>
   &#34920;&#31034;&#65289;&#65292;&#35813;&#21015;&#23454;&#38469;&#20540;&#65288;&#29992;
   <code>
    value
   </code>
   &#34920;&#31034;&#65289;&#12290;&#25152;&#20197;
   <code>
    &#32034;&#24341;&#21015;&#21508;&#21015;&#20449;&#24687;
   </code>
   &#23384;&#20648;&#30340;&#20869;&#23481;&#23454;&#36136;&#19978;&#23601;&#26159;
   <code>
    &lt;pos, len, value&gt;
   </code>
   &#30340;&#19968;&#20010;&#21015;&#34920;&#12290;&#36825;&#37096;&#20998;&#20449;&#24687;&#20027;&#35201;&#26159;&#29992;&#22312;&#20107;&#21153;&#25552;&#20132;&#21518;&#65292;&#23545;&#35813;
   <code>
    &#20013;&#38388;&#29366;&#24577;&#35760;&#24405;
   </code>
   &#20570;&#30495;&#27491;&#21024;&#38500;&#30340;&#38454;&#27573;&#20108;&#65292;&#20063;&#23601;&#26159;
   <code>
    purge
   </code>
   &#38454;&#27573;&#20013;&#20351;&#29992;&#30340;&#65292;&#20855;&#20307;&#22914;&#20309;&#20351;&#29992;&#29616;&#22312;&#25105;&#20204;&#21487;&#20197;&#24573;&#30053;&#65374;
  </p>
 </li>
</ul>
<p>
 &#35813;&#20171;&#32461;&#30340;&#25105;&#20204;&#20171;&#32461;&#23436;&#20102;&#65292;&#29616;&#22312;&#32487;&#32493;&#22312;&#19978;&#36793;&#37027;&#20010;&#20107;&#21153;id&#20026;
 <code>
  100
 </code>
 &#30340;&#20107;&#21153;&#20013;&#21024;&#38500;&#19968;&#26465;&#35760;&#24405;&#65292;&#27604;&#22914;&#25105;&#20204;&#25226;
 <code>
  id
 </code>
 &#20026;1&#30340;&#37027;&#26465;&#35760;&#24405;&#21024;&#38500;&#25481;&#65306;
</p>
<pre><code class="hljs bash" lang="bash">BEGIN;  <span class="hljs-comment"># &#26174;&#24335;&#24320;&#21551;&#19968;&#20010;&#20107;&#21153;&#65292;&#20551;&#35774;&#35813;&#20107;&#21153;&#30340;id&#20026;100</span>

<span class="hljs-comment"># &#25554;&#20837;&#20004;&#26465;&#35760;&#24405;</span>
INSERT INTO undo_demo(id, key1, col) 
    VALUES (1, <span class="hljs-string">'AWM'</span>, <span class="hljs-string">'&#29401;&#20987;&#26538;'</span>), (2, <span class="hljs-string">'M416'</span>, <span class="hljs-string">'&#27493;&#26538;'</span>);
    
<span class="hljs-comment"># &#21024;&#38500;&#19968;&#26465;&#35760;&#24405;    </span>
DELETE FROM undo_demo WHERE id = 1; 
</code></pre>
<p>
 &#36825;&#20010;
 <code>
  delete mark
 </code>
 &#25805;&#20316;&#23545;&#24212;&#30340;
 <code>
  undo&#26085;&#24535;
 </code>
 &#30340;&#32467;&#26500;&#23601;&#26159;&#36825;&#26679;&#65306;
</p>
<p>
</p>
<figure>
 <img alt="image_1d6bbl6nnk8a1ntk1d0ggmog6837.png-113.3kB" src="EPUB/3a689e90-13d6-11ed-838d-acde48001122">
 <figcaption>
 </figcaption>
</figure>
<p>
</p>
<p>
 &#23545;&#29031;&#30528;&#36825;&#20010;&#22270;&#65292;&#25105;&#20204;&#24471;&#27880;&#24847;&#19979;&#36793;&#20960;&#28857;&#65306;
</p>
<ul>
 <li>
  <p>
   &#22240;&#20026;&#36825;&#26465;
   <code>
    undo
   </code>
   &#26085;&#24535;&#26159;
   <code>
    id
   </code>
   &#20026;
   <code>
    100
   </code>
   &#30340;&#20107;&#21153;&#20013;&#20135;&#29983;&#30340;&#31532;3&#26465;
   <code>
    undo
   </code>
   &#26085;&#24535;&#65292;&#25152;&#20197;&#23427;&#23545;&#24212;&#30340;
   <code>
    undo no
   </code>
   &#23601;&#26159;
   <code>
    2
   </code>
   &#12290;
  </p>
 </li>
 <li>
  <p>
   &#22312;&#23545;&#35760;&#24405;&#20570;
   <code>
    delete mark
   </code>
   &#25805;&#20316;&#26102;&#65292;&#35760;&#24405;&#30340;
   <code>
    trx_id
   </code>
   &#38544;&#34255;&#21015;&#30340;&#20540;&#26159;
   <code>
    100
   </code>
   &#65288;&#20063;&#23601;&#26159;&#35828;&#23545;&#35813;&#35760;&#24405;&#26368;&#36817;&#30340;&#19968;&#27425;&#20462;&#25913;&#23601;&#21457;&#29983;&#22312;&#26412;&#20107;&#21153;&#20013;&#65289;&#65292;&#25152;&#20197;&#25226;
   <code>
    100
   </code>
   &#22635;&#20837;
   <code>
    old trx_id
   </code>
   &#23646;&#24615;&#20013;&#12290;&#28982;&#21518;&#25226;&#35760;&#24405;&#30340;
   <code>
    roll_pointer
   </code>
   &#38544;&#34255;&#21015;&#30340;&#20540;&#21462;&#20986;&#26469;&#65292;&#22635;&#20837;
   <code>
    old roll_pointer
   </code>
   &#23646;&#24615;&#20013;&#65292;&#36825;&#26679;&#23601;&#21487;&#20197;&#36890;&#36807;
   <code>
    old roll_pointer
   </code>
   &#23646;&#24615;&#20540;&#25214;&#21040;&#26368;&#36817;&#19968;&#27425;&#23545;&#35813;&#35760;&#24405;&#20570;&#25913;&#21160;&#26102;&#20135;&#29983;&#30340;
   <code>
    undo&#26085;&#24535;
   </code>
   &#12290;
  </p>
 </li>
 <li>
  <p>
   &#30001;&#20110;
   <code>
    undo_demo
   </code>
   &#34920;&#20013;&#26377;2&#20010;&#32034;&#24341;&#65306;&#19968;&#20010;&#26159;&#32858;&#31751;&#32034;&#24341;&#65292;&#19968;&#20010;&#26159;&#20108;&#32423;&#32034;&#24341;
   <code>
    idx_key1
   </code>
   &#12290;&#21482;&#35201;&#26159;&#21253;&#21547;&#22312;&#32034;&#24341;&#20013;&#30340;&#21015;&#65292;&#37027;&#20040;&#36825;&#20010;&#21015;&#22312;&#35760;&#24405;&#20013;&#30340;&#20301;&#32622;&#65288;
   <code>
    pos
   </code>
   &#65289;&#65292;&#21344;&#29992;&#23384;&#20648;&#31354;&#38388;&#22823;&#23567;&#65288;
   <code>
    len
   </code>
   &#65289;&#21644;&#23454;&#38469;&#20540;&#65288;
   <code>
    value
   </code>
   &#65289;&#23601;&#38656;&#35201;&#23384;&#20648;&#21040;
   <code>
    undo&#26085;&#24535;
   </code>
   &#20013;&#12290;
  </p>
  <ul>
   <li>
    <p>
     &#23545;&#20110;&#20027;&#38190;&#26469;&#35828;&#65292;&#21482;&#21253;&#21547;&#19968;&#20010;
     <code>
      id
     </code>
     &#21015;&#65292;&#23384;&#20648;&#21040;
     <code>
      undo&#26085;&#24535;
     </code>
     &#20013;&#30340;&#30456;&#20851;&#20449;&#24687;&#20998;&#21035;&#26159;&#65306;
    </p>
    <ul>
     <li>
      <code>
       pos
      </code>
      &#65306;
      <code>
       id
      </code>
      &#21015;&#26159;&#20027;&#38190;&#65292;&#20063;&#23601;&#26159;&#22312;&#35760;&#24405;&#30340;&#31532;&#19968;&#20010;&#21015;&#65292;&#23427;&#23545;&#24212;&#30340;
      <code>
       pos
      </code>
      &#20540;&#20026;
      <code>
       0
      </code>
      &#12290;
      <code>
       pos
      </code>
      &#21344;&#29992;1&#20010;&#23383;&#33410;&#26469;&#23384;&#20648;&#12290;
     </li>
     <li>
      <code>
       len
      </code>
      &#65306;
      <code>
       id
      </code>
      &#21015;&#30340;&#31867;&#22411;&#20026;
      <code>
       INT
      </code>
      &#65292;&#21344;&#29992;4&#20010;&#23383;&#33410;&#65292;&#25152;&#20197;
      <code>
       len
      </code>
      &#30340;&#20540;&#20026;
      <code>
       4
      </code>
      &#12290;
      <code>
       len
      </code>
      &#21344;&#29992;1&#20010;&#23383;&#33410;&#26469;&#23384;&#20648;&#12290;
     </li>
     <li>
      <code>
       value
      </code>
      &#65306;&#22312;&#34987;&#21024;&#38500;&#30340;&#35760;&#24405;&#20013;
      <code>
       id
      </code>
      &#21015;&#30340;&#20540;&#20026;
      <code>
       1
      </code>
      &#65292;&#20063;&#23601;&#26159;
      <code>
       value
      </code>
      &#30340;&#20540;&#20026;
      <code>
       1
      </code>
      &#12290;
      <code>
       value
      </code>
      &#21344;&#29992;4&#20010;&#23383;&#33410;&#26469;&#23384;&#20648;&#12290;
     </li>
    </ul>
    <p>
     &#30011;&#19968;&#20010;&#22270;&#28436;&#31034;&#19968;&#19979;&#23601;&#26159;&#36825;&#26679;&#65306;
    </p>
    <p>
    </p>
    <figure>
     <img alt="image_1d65ppnsu18o7ggb1lg114o7kf28i.png-39.6kB" src="EPUB/3a75d92a-13d6-11ed-838d-acde48001122">
     <figcaption>
     </figcaption>
    </figure>
    <p>
    </p>
    <p>
     &#25152;&#20197;&#23545;&#20110;
     <code>
      id
     </code>
     &#21015;&#26469;&#35828;&#65292;&#26368;&#32456;&#23384;&#20648;&#30340;&#32467;&#26524;&#23601;&#26159;
     <code>
      &lt;0, 4, 1&gt;
     </code>
     &#65292;&#23384;&#20648;&#36825;&#20123;&#20449;&#24687;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#22823;&#23567;&#20026;
     <code>
      1 + 1 + 4 = 6
     </code>
     &#20010;&#23383;&#33410;&#12290;
    </p>
   </li>
   <li>
    <p>
     &#23545;&#20110;
     <code>
      idx_key1
     </code>
     &#26469;&#35828;&#65292;&#21482;&#21253;&#21547;&#19968;&#20010;
     <code>
      key1
     </code>
     &#21015;&#65292;&#23384;&#20648;&#21040;
     <code>
      undo&#26085;&#24535;
     </code>
     &#20013;&#30340;&#30456;&#20851;&#20449;&#24687;&#20998;&#21035;&#26159;&#65306;
    </p>
    <ul>
     <li>
      <code>
       pos
      </code>
      &#65306;
      <code>
       key1
      </code>
      &#21015;&#26159;&#25490;&#22312;
      <code>
       id
      </code>
      &#21015;&#12289;
      <code>
       trx_id
      </code>
      &#21015;&#12289;
      <code>
       roll_pointer
      </code>
      &#21015;&#20043;&#21518;&#30340;&#65292;&#23427;&#23545;&#24212;&#30340;
      <code>
       pos
      </code>
      &#20540;&#20026;
      <code>
       3
      </code>
      &#12290;
      <code>
       pos
      </code>
      &#21344;&#29992;1&#20010;&#23383;&#33410;&#26469;&#23384;&#20648;&#12290;
     </li>
     <li>
      <code>
       len
      </code>
      &#65306;
      <code>
       key1
      </code>
      &#21015;&#30340;&#31867;&#22411;&#20026;
      <code>
       VARCHAR(100)
      </code>
      &#65292;&#20351;&#29992;
      <code>
       utf8
      </code>
      &#23383;&#31526;&#38598;&#65292;&#34987;&#21024;&#38500;&#30340;&#35760;&#24405;&#23454;&#38469;&#23384;&#20648;&#30340;&#20869;&#23481;&#26159;
      <code>
       AWM
      </code>
      &#65292;&#25152;&#20197;&#19968;&#20849;&#21344;&#29992;3&#20010;&#23383;&#33410;&#65292;&#20063;&#23601;&#26159;&#25152;&#20197;
      <code>
       len
      </code>
      &#30340;&#20540;&#20026;
      <code>
       3
      </code>
      &#12290;
      <code>
       len
      </code>
      &#21344;&#29992;1&#20010;&#23383;&#33410;&#26469;&#23384;&#20648;&#12290;
     </li>
     <li>
      <code>
       value
      </code>
      &#65306;&#22312;&#34987;&#21024;&#38500;&#30340;&#35760;&#24405;&#20013;
      <code>
       key1
      </code>
      &#21015;&#30340;&#20540;&#20026;
      <code>
       AWM
      </code>
      &#65292;&#20063;&#23601;&#26159;
      <code>
       value
      </code>
      &#30340;&#20540;&#20026;
      <code>
       AWM
      </code>
      &#12290;
      <code>
       value
      </code>
      &#21344;&#29992;3&#20010;&#23383;&#33410;&#26469;&#23384;&#20648;&#12290;
     </li>
    </ul>
    <p>
     &#30011;&#19968;&#20010;&#22270;&#28436;&#31034;&#19968;&#19979;&#23601;&#26159;&#36825;&#26679;&#65306;
    </p>
    <p>
    </p>
    <figure>
     <img alt="image_1de3v6ca916bt16kn9sa1ouk1pvn9.png-38.8kB" src="EPUB/3a8930e2-13d6-11ed-838d-acde48001122">
     <figcaption>
     </figcaption>
    </figure>
    <p>
    </p>
    <p>
     &#25152;&#20197;&#23545;&#20110;
     <code>
      key1
     </code>
     &#21015;&#26469;&#35828;&#65292;&#26368;&#32456;&#23384;&#20648;&#30340;&#32467;&#26524;&#23601;&#26159;
     <code>
      &lt;3, 3, 'AWM'&gt;
     </code>
     &#65292;&#23384;&#20648;&#36825;&#20123;&#20449;&#24687;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#22823;&#23567;&#20026;
     <code>
      1 + 1 + 3 = 5
     </code>
     &#20010;&#23383;&#33410;&#12290;
    </p>
   </li>
  </ul>
  <p>
   &#20174;&#19978;&#36793;&#30340;&#21465;&#36848;&#20013;&#21487;&#20197;&#30475;&#21040;&#65292;
   <code>
    &lt;0, 4, 1&gt;
   </code>
   &#21644;
   <code>
    &lt;3, 3, 'AWM'&gt;
   </code>
   &#20849;&#21344;&#29992;
   <code>
    11
   </code>
   &#20010;&#23383;&#33410;&#12290;&#28982;&#21518;
   <code>
    index_col_info len
   </code>
   &#26412;&#36523;&#21344;&#29992;
   <code>
    2
   </code>
   &#20010;&#23383;&#33410;&#65292;&#25152;&#20197;&#21152;&#36215;&#26469;&#19968;&#20849;&#21344;&#29992;
   <code>
    13
   </code>
   &#20010;&#23383;&#33410;&#65292;&#25226;&#25968;&#23383;
   <code>
    13
   </code>
   &#23601;&#22635;&#21040;&#20102;
   <code>
    index_col_info len
   </code>
   &#30340;&#23646;&#24615;&#20013;&#12290;
  </p>
 </li>
</ul>
<h3 class="heading">
 UPDATE&#25805;&#20316;&#23545;&#24212;&#30340;undo&#26085;&#24535;
</h3>
<p>
 &#22312;&#25191;&#34892;
 <code>
  UPDATE
 </code>
 &#35821;&#21477;&#26102;&#65292;
 <code>
  InnoDB
 </code>
 &#23545;&#26356;&#26032;&#20027;&#38190;&#21644;&#19981;&#26356;&#26032;&#20027;&#38190;&#36825;&#20004;&#31181;&#24773;&#20917;&#26377;&#25130;&#28982;&#19981;&#21516;&#30340;&#22788;&#29702;&#26041;&#26696;&#12290;
</p>
<h4 class="heading">
 &#19981;&#26356;&#26032;&#20027;&#38190;&#30340;&#24773;&#20917;
</h4>
<p>
 &#22312;&#19981;&#26356;&#26032;&#20027;&#38190;&#30340;&#24773;&#20917;&#19979;&#65292;&#21448;&#21487;&#20197;&#32454;&#20998;&#20026;&#34987;&#26356;&#26032;&#30340;&#21015;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#19981;&#21457;&#29983;&#21464;&#21270;&#21644;&#21457;&#29983;&#21464;&#21270;&#30340;&#24773;&#20917;&#12290;
</p>
<ul>
 <li>
  <p>
   &#23601;&#22320;&#26356;&#26032;&#65288;in-place update&#65289;
  </p>
  <p>
   &#26356;&#26032;&#35760;&#24405;&#26102;&#65292;&#23545;&#20110;&#34987;&#26356;&#26032;&#30340;
   <span style="color:red">
    &#27599;&#20010;&#21015;
   </span>
   &#26469;&#35828;&#65292;&#22914;&#26524;&#26356;&#26032;&#21518;&#30340;&#21015;&#21644;&#26356;&#26032;&#21069;&#30340;&#21015;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#37117;&#19968;&#26679;&#22823;&#65292;&#37027;&#20040;&#23601;&#21487;&#20197;&#36827;&#34892;
   <code>
    &#23601;&#22320;&#26356;&#26032;
   </code>
   &#65292;&#20063;&#23601;&#26159;&#30452;&#25509;&#22312;&#21407;&#35760;&#24405;&#30340;&#22522;&#30784;&#19978;&#20462;&#25913;&#23545;&#24212;&#21015;&#30340;&#20540;&#12290;&#20877;&#27425;&#24378;&#35843;&#19968;&#36793;&#65292;&#26159;
   <span style="color:red">
    &#27599;&#20010;&#21015;
   </span>
   &#22312;&#26356;&#26032;&#21069;&#21518;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#19968;&#26679;&#22823;&#65292;&#26377;&#20219;&#20309;&#19968;&#20010;&#34987;&#26356;&#26032;&#30340;&#21015;&#26356;&#26032;&#21069;&#27604;&#26356;&#26032;&#21518;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#22823;&#65292;&#25110;&#32773;&#26356;&#26032;&#21069;&#27604;&#26356;&#26032;&#21518;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#23567;&#37117;&#19981;&#33021;&#36827;&#34892;
   <code>
    &#23601;&#22320;&#26356;&#26032;
   </code>
   &#12290;&#27604;&#26041;&#35828;&#29616;&#22312;
   <code>
    undo_demo
   </code>
   &#34920;&#37324;&#36824;&#26377;&#19968;&#26465;
   <code>
    id
   </code>
   &#20540;&#20026;
   <code>
    2
   </code>
   &#30340;&#35760;&#24405;&#65292;&#23427;&#30340;&#21508;&#20010;&#21015;&#21344;&#29992;&#30340;&#22823;&#23567;&#22914;&#22270;&#25152;&#31034;&#65288;&#22240;&#20026;&#37319;&#29992;
   <code>
    utf8
   </code>
   &#23383;&#31526;&#38598;&#65292;&#25152;&#20197;
   <code>
    '&#27493;&#26538;'
   </code>
   &#36825;&#20004;&#20010;&#23383;&#31526;&#21344;&#29992;6&#20010;&#23383;&#33410;&#65289;&#65306;
  </p>
  <p>
  </p>
  <figure>
   <img alt="image_1d67tvp7i1ke1bhn1pre1usu1lvs1p.png-43.5kB" src="EPUB/3a9abf38-13d6-11ed-838d-acde48001122">
   <figcaption>
   </figcaption>
  </figure>
  <p>
  </p>
  <p>
   &#20551;&#22914;&#25105;&#20204;&#26377;&#36825;&#26679;&#30340;
   <code>
    UPDATE
   </code>
   &#35821;&#21477;&#65306;
  </p>
  <pre><code class="hljs bash" lang="bash">UPDATE undo_demo 
    SET key1 = <span class="hljs-string">'P92'</span>, col = <span class="hljs-string">'&#25163;&#26538;'</span> 
    WHERE id = 2;
</code></pre>
  <p>
   &#22312;&#36825;&#20010;
   <code>
    UPDATE
   </code>
   &#35821;&#21477;&#20013;&#65292;
   <code>
    col
   </code>
   &#21015;&#20174;
   <code>
    &#27493;&#26538;
   </code>
   &#34987;&#26356;&#26032;&#20026;
   <code>
    &#25163;&#26538;
   </code>
   &#65292;&#21069;&#21518;&#37117;&#21344;&#29992;6&#20010;&#23383;&#33410;&#65292;&#20063;&#23601;&#26159;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#22823;&#23567;&#26410;&#25913;&#21464;&#65307;
   <code>
    key1
   </code>
   &#21015;&#20174;
   <code>
    M416
   </code>
   &#34987;&#26356;&#26032;&#20026;
   <code>
    P92
   </code>
   &#65292;&#20063;&#23601;&#26159;&#20174;
   <code>
    4
   </code>
   &#20010;&#23383;&#33410;&#34987;&#26356;&#26032;&#20026;
   <code>
    3
   </code>
   &#20010;&#23383;&#33410;&#65292;&#36825;&#23601;&#19981;&#28385;&#36275;
   <code>
    &#23601;&#22320;&#26356;&#26032;
   </code>
   &#38656;&#35201;&#30340;&#26465;&#20214;&#20102;&#65292;&#25152;&#20197;&#19981;&#33021;&#36827;&#34892;
   <code>
    &#23601;&#22320;&#26356;&#26032;
   </code>
   &#12290;&#20294;&#26159;&#22914;&#26524;
   <code>
    UPDATE
   </code>
   &#35821;&#21477;&#38271;&#36825;&#26679;&#65306;
  </p>
  <pre><code class="hljs bash" lang="bash">UPDATE undo_demo 
    SET key1 = <span class="hljs-string">'M249'</span>, col = <span class="hljs-string">'&#26426;&#26538;'</span> 
    WHERE id = 2;
</code></pre>
  <p>
   &#30001;&#20110;&#21508;&#20010;&#34987;&#26356;&#26032;&#30340;&#21015;&#22312;&#26356;&#26032;&#21069;&#21518;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#26159;&#19968;&#26679;&#22823;&#30340;&#65292;&#25152;&#20197;&#36825;&#26679;&#30340;&#35821;&#21477;&#21487;&#20197;&#25191;&#34892;
   <code>
    &#23601;&#22320;&#26356;&#26032;
   </code>
   &#12290;
  </p>
 </li>
 <li>
  <p>
   &#20808;&#21024;&#38500;&#25481;&#26087;&#35760;&#24405;&#65292;&#20877;&#25554;&#20837;&#26032;&#35760;&#24405;
  </p>
  <p>
   &#22312;&#19981;&#26356;&#26032;&#20027;&#38190;&#30340;&#24773;&#20917;&#19979;&#65292;&#22914;&#26524;&#26377;
   <span style="color:red">
    &#20219;&#20309;&#19968;&#20010;
   </span>
   &#34987;&#26356;&#26032;&#30340;&#21015;&#26356;&#26032;&#21069;&#21644;&#26356;&#26032;&#21518;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#22823;&#23567;&#19981;&#19968;&#33268;&#65292;&#37027;&#20040;&#23601;&#38656;&#35201;&#20808;&#25226;&#36825;&#26465;&#26087;&#30340;&#35760;&#24405;&#20174;&#32858;&#31751;&#32034;&#24341;&#39029;&#38754;&#20013;&#21024;&#38500;&#25481;&#65292;&#28982;&#21518;&#20877;&#26681;&#25454;&#26356;&#26032;&#21518;&#21015;&#30340;&#20540;&#21019;&#24314;&#19968;&#26465;&#26032;&#30340;&#35760;&#24405;&#25554;&#20837;&#21040;&#39029;&#38754;&#20013;&#12290;
  </p>
  <p>
   &#35831;&#27880;&#24847;&#19968;&#19979;&#65292;&#25105;&#20204;&#36825;&#37324;&#25152;&#35828;&#30340;
   <code>
    &#21024;&#38500;
   </code>
   &#24182;&#19981;&#26159;
   <code>
    delete mark
   </code>
   &#25805;&#20316;&#65292;&#32780;&#26159;&#30495;&#27491;&#30340;&#21024;&#38500;&#25481;&#65292;&#20063;&#23601;&#26159;&#25226;&#36825;&#26465;&#35760;&#24405;&#20174;
   <code>
    &#27491;&#24120;&#35760;&#24405;&#38142;&#34920;
   </code>
   &#20013;&#31227;&#38500;&#24182;&#21152;&#20837;&#21040;
   <code>
    &#22403;&#22334;&#38142;&#34920;
   </code>
   &#20013;&#65292;&#24182;&#19988;&#20462;&#25913;&#39029;&#38754;&#20013;&#30456;&#24212;&#30340;&#32479;&#35745;&#20449;&#24687;&#65288;&#27604;&#22914;
   <code>
    PAGE_FREE
   </code>
   &#12289;
   <code>
    PAGE_GARBAGE
   </code>
   &#31561;&#36825;&#20123;&#20449;&#24687;&#65289;&#12290;&#19981;&#36807;&#36825;&#37324;&#20570;&#30495;&#27491;&#21024;&#38500;&#25805;&#20316;&#30340;&#32447;&#31243;&#24182;&#19981;&#26159;&#22312;&#21792;&#21480;
   <code>
    DELETE
   </code>
   &#35821;&#21477;&#20013;&#20570;
   <code>
    purge
   </code>
   &#25805;&#20316;&#26102;&#20351;&#29992;&#30340;&#21478;&#22806;&#19987;&#38376;&#30340;&#32447;&#31243;&#65292;&#32780;&#26159;&#30001;&#29992;&#25143;&#32447;&#31243;&#21516;&#27493;&#25191;&#34892;&#30495;&#27491;&#30340;&#21024;&#38500;&#25805;&#20316;&#65292;&#30495;&#27491;&#21024;&#38500;&#20043;&#21518;&#32039;&#25509;&#30528;&#23601;&#35201;&#26681;&#25454;&#21508;&#20010;&#21015;&#26356;&#26032;&#21518;&#30340;&#20540;&#21019;&#24314;&#30340;&#26032;&#35760;&#24405;&#25554;&#20837;&#12290;
  </p>
  <p>
   &#36825;&#37324;&#22914;&#26524;&#26032;&#21019;&#24314;&#30340;&#35760;&#24405;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#22823;&#23567;&#19981;&#36229;&#36807;&#26087;&#35760;&#24405;&#21344;&#29992;&#30340;&#31354;&#38388;&#65292;&#37027;&#20040;&#21487;&#20197;&#30452;&#25509;&#37325;&#29992;&#34987;&#21152;&#20837;&#21040;
   <code>
    &#22403;&#22334;&#38142;&#34920;
   </code>
   &#20013;&#30340;&#26087;&#35760;&#24405;&#25152;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#65292;&#21542;&#21017;&#30340;&#35805;&#38656;&#35201;&#22312;&#39029;&#38754;&#20013;&#26032;&#30003;&#35831;&#19968;&#27573;&#31354;&#38388;&#20197;&#20379;&#26032;&#35760;&#24405;&#20351;&#29992;&#65292;&#22914;&#26524;&#26412;&#39029;&#38754;&#20869;&#24050;&#32463;&#27809;&#26377;&#21487;&#29992;&#30340;&#31354;&#38388;&#30340;&#35805;&#65292;&#37027;&#23601;&#38656;&#35201;&#36827;&#34892;&#39029;&#38754;&#20998;&#35010;&#25805;&#20316;&#65292;&#28982;&#21518;&#20877;&#25554;&#20837;&#26032;&#35760;&#24405;&#12290;
  </p>
 </li>
</ul>
<p>
 &#38024;&#23545;
 <code>
  UPDATE
 </code>
 &#19981;&#26356;&#26032;&#20027;&#38190;&#30340;&#24773;&#20917;&#65288;&#21253;&#25324;&#19978;&#36793;&#25152;&#35828;&#30340;&#23601;&#22320;&#26356;&#26032;&#21644;&#20808;&#21024;&#38500;&#26087;&#35760;&#24405;&#20877;&#25554;&#20837;&#26032;&#35760;&#24405;&#65289;&#65292;&#35774;&#35745;
 <code>
  InnoDB
 </code>
 &#30340;&#22823;&#21460;&#20204;&#35774;&#35745;&#20102;&#19968;&#31181;&#31867;&#22411;&#20026;
 <code>
  TRX_UNDO_UPD_EXIST_REC
 </code>
 &#30340;
 <code>
  undo&#26085;&#24535;
 </code>
 &#65292;&#23427;&#30340;&#23436;&#25972;&#32467;&#26500;&#22914;&#19979;&#65306;
</p>
<p>
</p>
<figure>
 <img alt="image_1d9i13fuqvt2i9qtg9gg2ju2p.png-128.8kB" src="EPUB/3ac15b66-13d6-11ed-838d-acde48001122">
 <figcaption>
 </figcaption>
</figure>
<p>
</p>
<p>
 &#20854;&#23454;&#22823;&#37096;&#20998;&#23646;&#24615;&#21644;&#25105;&#20204;&#20171;&#32461;&#36807;&#30340;
 <code>
  TRX_UNDO_DEL_MARK_REC
 </code>
 &#31867;&#22411;&#30340;
 <code>
  undo&#26085;&#24535;
 </code>
 &#26159;&#31867;&#20284;&#30340;&#65292;&#19981;&#36807;&#36824;&#26159;&#35201;&#27880;&#24847;&#36825;&#20040;&#20960;&#28857;&#65306;
</p>
<ul>
 <li>
  <p>
   <code>
    n_updated
   </code>
   &#23646;&#24615;&#34920;&#31034;&#26412;&#26465;
   <code>
    UPDATE
   </code>
   &#35821;&#21477;&#25191;&#34892;&#21518;&#23558;&#26377;&#20960;&#20010;&#21015;&#34987;&#26356;&#26032;&#65292;&#21518;&#36793;&#36319;&#30528;&#30340;
   <code>
    &lt;pos, old_len, old_value&gt;
   </code>
   &#20998;&#21035;&#34920;&#31034;&#34987;&#26356;&#26032;&#21015;&#22312;&#35760;&#24405;&#20013;&#30340;&#20301;&#32622;&#12289;&#26356;&#26032;&#21069;&#35813;&#21015;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#22823;&#23567;&#12289;&#26356;&#26032;&#21069;&#35813;&#21015;&#30340;&#30495;&#23454;&#20540;&#12290;
  </p>
 </li>
 <li>
  <p>
   &#22914;&#26524;&#22312;
   <code>
    UPDATE
   </code>
   &#35821;&#21477;&#20013;&#26356;&#26032;&#30340;&#21015;&#21253;&#21547;&#32034;&#24341;&#21015;&#65292;&#37027;&#20040;&#20063;&#20250;&#28155;&#21152;
   <code>
    &#32034;&#24341;&#21015;&#21508;&#21015;&#20449;&#24687;
   </code>
   &#36825;&#20010;&#37096;&#20998;&#65292;&#21542;&#21017;&#30340;&#35805;&#26159;&#19981;&#20250;&#28155;&#21152;&#36825;&#20010;&#37096;&#20998;&#30340;&#12290;
  </p>
 </li>
</ul>
<p>
 &#29616;&#22312;&#32487;&#32493;&#22312;&#19978;&#36793;&#37027;&#20010;&#20107;&#21153;id&#20026;100&#30340;&#20107;&#21153;&#20013;&#26356;&#26032;&#19968;&#26465;&#35760;&#24405;&#65292;&#27604;&#22914;&#25105;&#20204;&#25226;id&#20026;2&#30340;&#37027;&#26465;&#35760;&#24405;&#26356;&#26032;&#19968;&#19979;&#65306;
</p>
<pre><code class="hljs bash" lang="bash">BEGIN;  <span class="hljs-comment"># &#26174;&#24335;&#24320;&#21551;&#19968;&#20010;&#20107;&#21153;&#65292;&#20551;&#35774;&#35813;&#20107;&#21153;&#30340;id&#20026;100</span>

<span class="hljs-comment"># &#25554;&#20837;&#20004;&#26465;&#35760;&#24405;</span>
INSERT INTO undo_demo(id, key1, col) 
    VALUES (1, <span class="hljs-string">'AWM'</span>, <span class="hljs-string">'&#29401;&#20987;&#26538;'</span>), (2, <span class="hljs-string">'M416'</span>, <span class="hljs-string">'&#27493;&#26538;'</span>);
    
<span class="hljs-comment"># &#21024;&#38500;&#19968;&#26465;&#35760;&#24405;    </span>
DELETE FROM undo_demo WHERE id = 1; 

<span class="hljs-comment"># &#26356;&#26032;&#19968;&#26465;&#35760;&#24405;</span>
UPDATE undo_demo
    SET key1 = <span class="hljs-string">'M249'</span>, col = <span class="hljs-string">'&#26426;&#26538;'</span>
    WHERE id = 2;
</code></pre>
<p>
 &#36825;&#20010;
 <code>
  UPDATE
 </code>
 &#35821;&#21477;&#26356;&#26032;&#30340;&#21015;&#22823;&#23567;&#37117;&#27809;&#26377;&#25913;&#21160;&#65292;&#25152;&#20197;&#21487;&#20197;&#37319;&#29992;
 <code>
  &#23601;&#22320;&#26356;&#26032;
 </code>
 &#30340;&#26041;&#24335;&#26469;&#25191;&#34892;&#65292;&#22312;&#30495;&#27491;&#25913;&#21160;&#39029;&#38754;&#35760;&#24405;&#26102;&#65292;&#20250;&#20808;&#35760;&#24405;&#19968;&#26465;&#31867;&#22411;&#20026;
 <code>
  TRX_UNDO_UPD_EXIST_REC
 </code>
 &#30340;
 <code>
  undo&#26085;&#24535;
 </code>
 &#65292;&#38271;&#36825;&#26679;&#65306;
</p>
<p>
</p>
<figure>
 <img alt="image_1d6bbqp2f3q160v1lribq31n0f44.png-141.9kB" src="EPUB/3ad3d534-13d6-11ed-838d-acde48001122">
 <figcaption>
 </figcaption>
</figure>
<p>
</p>
<p>
 &#23545;&#29031;&#30528;&#36825;&#20010;&#22270;&#25105;&#20204;&#27880;&#24847;&#19968;&#19979;&#36825;&#20960;&#20010;&#22320;&#26041;&#65306;
</p>
<ul>
 <li>
  <p>
   &#22240;&#20026;&#36825;&#26465;
   <code>
    undo&#26085;&#24535;
   </code>
   &#26159;
   <code>
    id
   </code>
   &#20026;
   <code>
    100
   </code>
   &#30340;&#20107;&#21153;&#20013;&#20135;&#29983;&#30340;&#31532;4&#26465;
   <code>
    undo&#26085;&#24535;
   </code>
   &#65292;&#25152;&#20197;&#23427;&#23545;&#24212;&#30340;
   <code>
    undo no
   </code>
   &#23601;&#26159;3&#12290;
  </p>
 </li>
 <li>
  <p>
   &#36825;&#26465;&#26085;&#24535;&#30340;
   <code>
    roll_pointer
   </code>
   &#25351;&#21521;
   <code>
    undo no
   </code>
   &#20026;
   <code>
    1
   </code>
   &#30340;&#37027;&#26465;&#26085;&#24535;&#65292;&#20063;&#23601;&#26159;&#25554;&#20837;&#20027;&#38190;&#20540;&#20026;
   <code>
    2
   </code>
   &#30340;&#35760;&#24405;&#26102;&#20135;&#29983;&#30340;&#37027;&#26465;
   <code>
    undo&#26085;&#24535;
   </code>
   &#65292;&#20063;&#23601;&#26159;&#26368;&#36817;&#19968;&#27425;&#23545;&#35813;&#35760;&#24405;&#20570;&#25913;&#21160;&#26102;&#20135;&#29983;&#30340;
   <code>
    undo&#26085;&#24535;
   </code>
   &#12290;
  </p>
 </li>
 <li>
  <p>
   &#30001;&#20110;&#26412;&#26465;
   <code>
    UPDATE
   </code>
   &#35821;&#21477;&#20013;&#26356;&#26032;&#20102;&#32034;&#24341;&#21015;
   <code>
    key1
   </code>
   &#30340;&#20540;&#65292;&#25152;&#20197;&#38656;&#35201;&#35760;&#24405;&#19968;&#19979;
   <code>
    &#32034;&#24341;&#21015;&#21508;&#21015;&#20449;&#24687;
   </code>
   &#37096;&#20998;&#65292;&#20063;&#23601;&#26159;&#25226;&#20027;&#38190;&#21644;
   <code>
    key1
   </code>
   &#21015;&#26356;&#26032;&#21069;&#30340;&#20449;&#24687;&#22635;&#20837;&#12290;
  </p>
 </li>
</ul>
<h4 class="heading">
 &#26356;&#26032;&#20027;&#38190;&#30340;&#24773;&#20917;
</h4>
<p>
 &#22312;&#32858;&#31751;&#32034;&#24341;&#20013;&#65292;&#35760;&#24405;&#26159;&#25353;&#29031;&#20027;&#38190;&#20540;&#30340;&#22823;&#23567;&#36830;&#25104;&#20102;&#19968;&#20010;&#21333;&#21521;&#38142;&#34920;&#30340;&#65292;&#22914;&#26524;&#25105;&#20204;&#26356;&#26032;&#20102;&#26576;&#26465;&#35760;&#24405;&#30340;&#20027;&#38190;&#20540;&#65292;&#24847;&#21619;&#30528;&#36825;&#26465;&#35760;&#24405;&#22312;&#32858;&#31751;&#32034;&#24341;&#20013;&#30340;&#20301;&#32622;&#23558;&#20250;&#21457;&#29983;&#25913;&#21464;&#65292;&#27604;&#22914;&#20320;&#23558;&#35760;&#24405;&#30340;&#20027;&#38190;&#20540;&#20174;1&#26356;&#26032;&#20026;10000&#65292;&#22914;&#26524;&#36824;&#26377;&#38750;&#24120;&#22810;&#30340;&#35760;&#24405;&#30340;&#20027;&#38190;&#20540;&#20998;&#24067;&#22312;
 <code>
  1 ~ 10000
 </code>
 &#20043;&#38388;&#30340;&#35805;&#65292;&#37027;&#20040;&#36825;&#20004;&#26465;&#35760;&#24405;&#22312;&#32858;&#31751;&#32034;&#24341;&#20013;&#23601;&#26377;&#21487;&#33021;&#31163;&#24471;&#38750;&#24120;&#36828;&#65292;&#29978;&#33267;&#20013;&#38388;&#38548;&#20102;&#22909;&#22810;&#20010;&#39029;&#38754;&#12290;&#38024;&#23545;
 <code>
  UPDATE
 </code>
 &#35821;&#21477;&#20013;&#26356;&#26032;&#20102;&#35760;&#24405;&#20027;&#38190;&#20540;&#30340;&#36825;&#31181;&#24773;&#20917;&#65292;
 <code>
  InnoDB
 </code>
 &#22312;&#32858;&#31751;&#32034;&#24341;&#20013;&#20998;&#20102;&#20004;&#27493;&#22788;&#29702;&#65306;
</p>
<ul>
 <li>
  <p>
   &#23558;&#26087;&#35760;&#24405;&#36827;&#34892;
   <code>
    delete mark
   </code>
   &#25805;&#20316;
  </p>
  <p>
   &#39640;&#33021;&#27880;&#24847;&#65306;
   <span style="color:red">
    &#36825;&#37324;&#26159;delete mark&#25805;&#20316;&#65281;&#36825;&#37324;&#26159;delete mark&#25805;&#20316;&#65281;&#36825;&#37324;&#26159;delete mark&#25805;&#20316;&#65281;
   </span>
   &#20063;&#23601;&#26159;&#35828;&#22312;
   <code>
    UPDATE
   </code>
   &#35821;&#21477;&#25152;&#22312;&#30340;&#20107;&#21153;&#25552;&#20132;&#21069;&#65292;&#23545;&#26087;&#35760;&#24405;&#21482;&#20570;&#19968;&#20010;
   <code>
    delete mark
   </code>
   &#25805;&#20316;&#65292;&#22312;&#20107;&#21153;&#25552;&#20132;&#21518;&#25165;&#30001;
   <span style="color:red">
    &#19987;&#38376;&#30340;&#32447;&#31243;&#20570;purge&#25805;&#20316;&#65292;&#25226;&#23427;&#21152;&#20837;&#21040;&#22403;&#22334;&#38142;&#34920;&#20013;
   </span>
   &#12290;&#36825;&#37324;&#19968;&#23450;&#35201;&#21644;&#25105;&#20204;&#19978;&#36793;&#25152;&#35828;&#30340;&#22312;&#19981;&#26356;&#26032;&#35760;&#24405;&#20027;&#38190;&#20540;&#26102;&#65292;&#20808;&#30495;&#27491;&#21024;&#38500;&#26087;&#35760;&#24405;&#65292;&#20877;&#25554;&#20837;&#26032;&#35760;&#24405;&#30340;&#26041;&#24335;&#21306;&#20998;&#24320;&#65281;
  </p>
  <blockquote class="warning">
   <p>
    &#23567;&#36148;&#22763;&#65306;

&#20043;&#25152;&#20197;&#21482;&#23545;&#26087;&#35760;&#24405;&#20570;delete mark&#25805;&#20316;&#65292;&#26159;&#22240;&#20026;&#21035;&#30340;&#20107;&#21153;&#21516;&#26102;&#20063;&#21487;&#33021;&#35775;&#38382;&#36825;&#26465;&#35760;&#24405;&#65292;&#22914;&#26524;&#25226;&#23427;&#30495;&#27491;&#30340;&#21024;&#38500;&#21152;&#20837;&#21040;&#22403;&#22334;&#38142;&#34920;&#21518;&#65292;&#21035;&#30340;&#20107;&#21153;&#23601;&#35775;&#38382;&#19981;&#21040;&#20102;&#12290;&#36825;&#20010;&#21151;&#33021;&#23601;&#26159;&#25152;&#35859;&#30340;MVCC&#65292;&#25105;&#20204;&#21518;&#36793;&#30340;&#31456;&#33410;&#20013;&#20250;&#35814;&#32454;&#21792;&#21480;&#20160;&#20040;&#26159;&#20010;MVCC&#12290;
   </p>
  </blockquote>
 </li>
 <li>
  <p>
   &#26681;&#25454;&#26356;&#26032;&#21518;&#21508;&#21015;&#30340;&#20540;&#21019;&#24314;&#19968;&#26465;&#26032;&#35760;&#24405;&#65292;&#24182;&#23558;&#20854;&#25554;&#20837;&#21040;&#32858;&#31751;&#32034;&#24341;&#20013;&#65288;&#38656;&#37325;&#26032;&#23450;&#20301;&#25554;&#20837;&#30340;&#20301;&#32622;&#65289;&#12290;
  </p>
  <p>
   &#30001;&#20110;&#26356;&#26032;&#21518;&#30340;&#35760;&#24405;&#20027;&#38190;&#20540;&#21457;&#29983;&#20102;&#25913;&#21464;&#65292;&#25152;&#20197;&#38656;&#35201;&#37325;&#26032;&#20174;&#32858;&#31751;&#32034;&#24341;&#20013;&#23450;&#20301;&#36825;&#26465;&#35760;&#24405;&#25152;&#22312;&#30340;&#20301;&#32622;&#65292;&#28982;&#21518;&#25226;&#23427;&#25554;&#36827;&#21435;&#12290;
  </p>
 </li>
</ul>
<p>
 &#38024;&#23545;
 <code>
  UPDATE
 </code>
 &#35821;&#21477;&#26356;&#26032;&#35760;&#24405;&#20027;&#38190;&#20540;&#30340;&#36825;&#31181;&#24773;&#20917;&#65292;&#22312;&#23545;&#35813;&#35760;&#24405;&#36827;&#34892;
 <code>
  delete mark
 </code>
 &#25805;&#20316;&#21069;&#65292;&#20250;&#35760;&#24405;&#19968;&#26465;&#31867;&#22411;&#20026;
 <code>
  TRX_UNDO_DEL_MARK_REC
 </code>
 &#30340;
 <code>
  undo&#26085;&#24535;
 </code>
 &#65307;&#20043;&#21518;&#25554;&#20837;&#26032;&#35760;&#24405;&#26102;&#65292;&#20250;&#35760;&#24405;&#19968;&#26465;&#31867;&#22411;&#20026;
 <code>
  TRX_UNDO_INSERT_REC
 </code>
 &#30340;
 <code>
  undo&#26085;&#24535;
 </code>
 &#65292;&#20063;&#23601;&#26159;&#35828;&#27599;&#23545;&#19968;&#26465;&#35760;&#24405;&#30340;&#20027;&#38190;&#20540;&#20570;&#25913;&#21160;&#26102;&#65292;&#20250;&#35760;&#24405;2&#26465;
 <code>
  undo&#26085;&#24535;
 </code>
 &#12290;&#36825;&#20123;&#26085;&#24535;&#30340;&#26684;&#24335;&#25105;&#20204;&#19978;&#36793;&#37117;&#21792;&#21480;&#36807;&#20102;&#65292;&#23601;&#19981;&#36184;&#36848;&#20102;&#12290;
</p>
<blockquote class="warning">
 <p>
  &#23567;&#36148;&#22763;&#65306;

&#20854;&#23454;&#36824;&#26377;&#19968;&#31181;&#31216;&#20026;TRX_UNDO_UPD_DEL_REC&#30340;undo&#26085;&#24535;&#30340;&#31867;&#22411;&#25105;&#20204;&#27809;&#26377;&#20171;&#32461;&#65292;&#20027;&#35201;&#26159;&#24819;&#36991;&#20813;&#24341;&#20837;&#36807;&#22810;&#30340;&#22797;&#26434;&#24230;&#65292;&#22914;&#26524;&#22823;&#23478;&#23545;&#36825;&#31181;&#31867;&#22411;&#30340;undo&#26085;&#24535;&#30340;&#20351;&#29992;&#24863;&#20852;&#36259;&#30340;&#35805;&#65292;&#21487;&#20197;&#39069;&#22806;&#26597;&#19968;&#19979;&#21035;&#30340;&#36164;&#26009;&#12290;
 </p>
</blockquote>
</div>

</div>
</div>

        </body>
        
        