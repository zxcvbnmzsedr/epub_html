
        <html lang="en">
        <head>
        <meta charset="UTF-8"/>
        </head>
        <body>
        <div><div class="markdown-body">
    <h1>&#19968;&#26465;&#35760;&#24405;&#30340;&#22810;&#24133;&#38754;&#23380; &#8212;&#8212; &#20107;&#21153;&#30340;&#38548;&#31163;&#32423;&#21035;&#19982;MVCC</h1>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="style/style.css" type="text/css">

<div class="markdown-body">
    <h1>
 &#20107;&#21153;&#38548;&#31163;&#32423;&#21035;&#21644;MVCC
</h1>
<p>
 &#26631;&#31614;&#65306; MySQL&#26159;&#24590;&#26679;&#36816;&#34892;&#30340;
</p>
<hr>
<h2>
 &#20107;&#21069;&#20934;&#22791;
</h2>
<p>
 &#20026;&#20102;&#25925;&#20107;&#30340;&#39034;&#21033;&#21457;&#23637;&#65292;&#25105;&#20204;&#38656;&#35201;&#21019;&#24314;&#19968;&#20010;&#34920;&#65306;
</p>
<pre><code>CREATE TABLE hero (
    number INT,
    name VARCHAR(100),
    country varchar(100),
    PRIMARY KEY (number)
) Engine=InnoDB CHARSET=utf8;
</code></pre>
<pre><code class="hljs language-!">&#23567;&#36148;&#22763;&#65306;

&#27880;&#24847;&#25105;&#20204;&#25226;&#36825;&#20010;hero&#34920;&#30340;&#20027;&#38190;&#21629;&#21517;&#20026;number&#65292;&#32780;&#19981;&#26159;id&#65292;&#20027;&#35201;&#26159;&#24819;&#21644;&#21518;&#36793;&#35201;&#29992;&#21040;&#30340;&#20107;&#21153;id&#20570;&#21306;&#21035;&#65292;&#22823;&#23478;&#19981;&#29992;&#22823;&#24778;&#23567;&#24618;&#21704;&#65374; 
</code></pre>
<p>
 &#28982;&#21518;&#21521;&#36825;&#20010;&#34920;&#37324;&#25554;&#20837;&#19968;&#26465;&#25968;&#25454;&#65306;
</p>
<pre><code>INSERT INTO hero VALUES(1, '&#21016;&#22791;', '&#34560;');
</code></pre>
<p>
 &#29616;&#22312;&#34920;&#37324;&#30340;&#25968;&#25454;&#23601;&#26159;&#36825;&#26679;&#30340;&#65306;
</p>
<pre><code>mysql&gt; SELECT * FROM hero;
+--------+--------+---------+
| number | name   | country |
+--------+--------+---------+
|      1 | &#21016;&#22791;   | &#34560;      |
+--------+--------+---------+
1 row in set (0.00 sec)
</code></pre>
<h2>
 &#20107;&#21153;&#38548;&#31163;&#32423;&#21035;
</h2>
<p>
 &#25105;&#20204;&#30693;&#36947;
 <code>
  MySQL
 </code>
 &#26159;&#19968;&#20010;
 <code>
  &#23458;&#25143;&#31471;&#65295;&#26381;&#21153;&#22120;
 </code>
 &#26550;&#26500;&#30340;&#36719;&#20214;&#65292;&#23545;&#20110;&#21516;&#19968;&#20010;&#26381;&#21153;&#22120;&#26469;&#35828;&#65292;&#21487;&#20197;&#26377;&#33509;&#24178;&#20010;&#23458;&#25143;&#31471;&#19982;&#20043;&#36830;&#25509;&#65292;&#27599;&#20010;&#23458;&#25143;&#31471;&#19982;&#26381;&#21153;&#22120;&#36830;&#25509;&#19978;&#20043;&#21518;&#65292;&#23601;&#21487;&#20197;&#31216;&#20043;&#20026;&#19968;&#20010;&#20250;&#35805;&#65288;
 <code>
  Session
 </code>
 &#65289;&#12290;&#27599;&#20010;&#23458;&#25143;&#31471;&#37117;&#21487;&#20197;&#22312;&#33258;&#24049;&#30340;&#20250;&#35805;&#20013;&#21521;&#26381;&#21153;&#22120;&#21457;&#20986;&#35831;&#27714;&#35821;&#21477;&#65292;&#19968;&#20010;&#35831;&#27714;&#35821;&#21477;&#21487;&#33021;&#26159;&#26576;&#20010;&#20107;&#21153;&#30340;&#19968;&#37096;&#20998;&#65292;&#20063;&#23601;&#26159;&#23545;&#20110;&#26381;&#21153;&#22120;&#26469;&#35828;&#21487;&#33021;&#21516;&#26102;&#22788;&#29702;&#22810;&#20010;&#20107;&#21153;&#12290;&#22312;&#20107;&#21153;&#31616;&#20171;&#30340;&#31456;&#33410;&#20013;&#25105;&#20204;&#35828;&#36807;&#20107;&#21153;&#26377;&#19968;&#20010;&#31216;&#20043;&#20026;
 <code>
  &#38548;&#31163;&#24615;
 </code>
 &#30340;&#29305;&#24615;&#65292;&#29702;&#35770;&#19978;&#22312;&#26576;&#20010;&#20107;&#21153;&#23545;&#26576;&#20010;&#25968;&#25454;&#36827;&#34892;&#35775;&#38382;&#26102;&#65292;&#20854;&#20182;&#20107;&#21153;&#24212;&#35813;&#36827;&#34892;&#25490;&#38431;&#65292;&#24403;&#35813;&#20107;&#21153;&#25552;&#20132;&#20043;&#21518;&#65292;&#20854;&#20182;&#20107;&#21153;&#25165;&#21487;&#20197;&#32487;&#32493;&#35775;&#38382;&#36825;&#20010;&#25968;&#25454;&#12290;&#20294;&#26159;&#36825;&#26679;&#23376;&#30340;&#35805;&#23545;&#24615;&#33021;&#24433;&#21709;&#22826;&#22823;&#65292;&#25105;&#20204;&#26082;&#24819;&#20445;&#25345;&#20107;&#21153;&#30340;
 <code>
  &#38548;&#31163;&#24615;
 </code>
 &#65292;&#21448;&#24819;&#35753;&#26381;&#21153;&#22120;&#22312;&#22788;&#29702;&#35775;&#38382;&#21516;&#19968;&#25968;&#25454;&#30340;&#22810;&#20010;&#20107;&#21153;&#26102;&#24615;&#33021;&#23613;&#37327;&#39640;&#20123;&#65292;&#40060;&#21644;&#29066;&#25484;&#19981;&#21487;&#24471;&#20860;&#65292;&#33293;&#19968;&#37096;&#20998;
 <code>
  &#38548;&#31163;&#24615;
 </code>
 &#32780;&#21462;&#24615;&#33021;&#32773;&#20063;&#12290;
</p>
<h3>
 &#20107;&#21153;&#24182;&#21457;&#25191;&#34892;&#36935;&#21040;&#30340;&#38382;&#39064;
</h3>
<p>
 &#24590;&#20040;&#20010;&#33293;&#24323;&#27861;&#21602;&#65311;&#25105;&#20204;&#20808;&#24471;&#30475;&#19968;&#19979;&#35775;&#38382;&#30456;&#21516;&#25968;&#25454;&#30340;&#20107;&#21153;&#22312;&#19981;&#20445;&#35777;&#20018;&#34892;&#25191;&#34892;&#65288;&#20063;&#23601;&#26159;&#25191;&#34892;&#23436;&#19968;&#20010;&#20877;&#25191;&#34892;&#21478;&#19968;&#20010;&#65289;&#30340;&#24773;&#20917;&#19979;&#21487;&#33021;&#20250;&#20986;&#29616;&#21738;&#20123;&#38382;&#39064;&#65306;
</p>
<ul>
 <li>
  <p>
   &#33039;&#20889;&#65288;
   <code>
    Dirty Write
   </code>
   &#65289;
  </p>
  <p>
   &#22914;&#26524;
   <span>
    &#19968;&#20010;&#20107;&#21153;&#20462;&#25913;&#20102;&#21478;&#19968;&#20010;&#26410;&#25552;&#20132;&#20107;&#21153;&#20462;&#25913;&#36807;&#30340;&#25968;&#25454;
   </span>
   &#65292;&#37027;&#23601;&#24847;&#21619;&#30528;&#21457;&#29983;&#20102;
   <code>
    &#33039;&#20889;
   </code>
   &#65292;&#31034;&#24847;&#22270;&#22914;&#19979;&#65306;
  </p>
  <p>
   <img alt="image_1d8nigfq618jd1cc56231rt0uq19.png-78.2kB" src="EPUB/3db64a3e-13d6-11ed-838d-acde48001122">
  </p>
  <p>
   &#22914;&#19978;&#22270;&#65292;
   <code>
    Session A
   </code>
   &#21644;
   <code>
    Session B
   </code>
   &#21508;&#24320;&#21551;&#20102;&#19968;&#20010;&#20107;&#21153;&#65292;
   <code>
    Session B
   </code>
   &#20013;&#30340;&#20107;&#21153;&#20808;&#23558;
   <code>
    number
   </code>
   &#21015;&#20026;
   <code>
    1
   </code>
   &#30340;&#35760;&#24405;&#30340;
   <code>
    name
   </code>
   &#21015;&#26356;&#26032;&#20026;
   <code>
    '&#20851;&#32701;'
   </code>
   &#65292;&#28982;&#21518;
   <code>
    Session A
   </code>
   &#20013;&#30340;&#20107;&#21153;&#25509;&#30528;&#21448;&#25226;&#36825;&#26465;
   <code>
    number
   </code>
   &#21015;&#20026;
   <code>
    1
   </code>
   &#30340;&#35760;&#24405;&#30340;
   <code>
    name
   </code>
   &#21015;&#26356;&#26032;&#20026;
   <code>
    &#24352;&#39134;
   </code>
   &#12290;&#22914;&#26524;&#20043;&#21518;
   <code>
    Session B
   </code>
   &#20013;&#30340;&#20107;&#21153;&#36827;&#34892;&#20102;&#22238;&#28378;&#65292;&#37027;&#20040;
   <code>
    Session A
   </code>
   &#20013;&#30340;&#26356;&#26032;&#20063;&#23558;&#19981;&#22797;&#23384;&#22312;&#65292;&#36825;&#31181;&#29616;&#35937;&#23601;&#31216;&#20043;&#20026;
   <code>
    &#33039;&#20889;
   </code>
   &#12290;&#36825;&#26102;
   <code>
    Session A
   </code>
   &#20013;&#30340;&#20107;&#21153;&#23601;&#24456;&#25077;&#36924;&#65292;&#25105;&#26126;&#26126;&#25226;&#25968;&#25454;&#26356;&#26032;&#20102;&#65292;&#26368;&#21518;&#20063;&#25552;&#20132;&#20107;&#21153;&#20102;&#65292;&#24590;&#20040;&#21040;&#26368;&#21518;&#35828;&#33258;&#24049;&#21861;&#20063;&#27809;&#24178;&#21602;&#65311;
  </p>
 </li>
 <li>
  <p>
   &#33039;&#35835;&#65288;
   <code>
    Dirty Read
   </code>
   &#65289;
  </p>
  <p>
   &#22914;&#26524;
   <span>
    &#19968;&#20010;&#20107;&#21153;&#35835;&#21040;&#20102;&#21478;&#19968;&#20010;&#26410;&#25552;&#20132;&#20107;&#21153;&#20462;&#25913;&#36807;&#30340;&#25968;&#25454;
   </span>
   &#65292;&#37027;&#23601;&#24847;&#21619;&#30528;&#21457;&#29983;&#20102;
   <code>
    &#33039;&#35835;
   </code>
   &#65292;&#31034;&#24847;&#22270;&#22914;&#19979;&#65306;
  </p>
  <p>
   <img alt="image_1d8nn50kndkd8641epplvelhk9.png-91.8kB" src="EPUB/3dc42ad2-13d6-11ed-838d-acde48001122">
  </p>
  <p>
   &#22914;&#19978;&#22270;&#65292;
   <code>
    Session A
   </code>
   &#21644;
   <code>
    Session B
   </code>
   &#21508;&#24320;&#21551;&#20102;&#19968;&#20010;&#20107;&#21153;&#65292;
   <code>
    Session B
   </code>
   &#20013;&#30340;&#20107;&#21153;&#20808;&#23558;
   <code>
    number
   </code>
   &#21015;&#20026;
   <code>
    1
   </code>
   &#30340;&#35760;&#24405;&#30340;
   <code>
    name
   </code>
   &#21015;&#26356;&#26032;&#20026;
   <code>
    '&#20851;&#32701;'
   </code>
   &#65292;&#28982;&#21518;
   <code>
    Session A
   </code>
   &#20013;&#30340;&#20107;&#21153;&#20877;&#21435;&#26597;&#35810;&#36825;&#26465;
   <code>
    number
   </code>
   &#20026;
   <code>
    1
   </code>
   &#30340;&#35760;&#24405;&#65292;&#22914;&#26524;&#35835;&#21040;&#21015;
   <code>
    name
   </code>
   &#30340;&#20540;&#20026;
   <code>
    '&#20851;&#32701;'
   </code>
   &#65292;&#32780;
   <code>
    Session B
   </code>
   &#20013;&#30340;&#20107;&#21153;&#31245;&#21518;&#36827;&#34892;&#20102;&#22238;&#28378;&#65292;&#37027;&#20040;
   <code>
    Session A
   </code>
   &#20013;&#30340;&#20107;&#21153;&#30456;&#24403;&#20110;&#35835;&#21040;&#20102;&#19968;&#20010;&#19981;&#23384;&#22312;&#30340;&#25968;&#25454;&#65292;&#36825;&#31181;&#29616;&#35937;&#23601;&#31216;&#20043;&#20026;
   <code>
    &#33039;&#35835;
   </code>
   &#12290;
  </p>
 </li>
 <li>
  <p>
   &#19981;&#21487;&#37325;&#22797;&#35835;&#65288;Non-Repeatable Read&#65289;
  </p>
  <p>
   &#22914;&#26524;
   <span>
    &#19968;&#20010;&#20107;&#21153;&#21482;&#33021;&#35835;&#21040;&#21478;&#19968;&#20010;&#24050;&#32463;&#25552;&#20132;&#30340;&#20107;&#21153;&#20462;&#25913;&#36807;&#30340;&#25968;&#25454;&#65292;&#24182;&#19988;&#20854;&#20182;&#20107;&#21153;&#27599;&#23545;&#35813;&#25968;&#25454;&#36827;&#34892;&#19968;&#27425;&#20462;&#25913;&#24182;&#25552;&#20132;&#21518;&#65292;&#35813;&#20107;&#21153;&#37117;&#33021;&#26597;&#35810;&#24471;&#21040;&#26368;&#26032;&#20540;
   </span>
   &#65292;&#37027;&#23601;&#24847;&#21619;&#30528;&#21457;&#29983;&#20102;
   <code>
    &#19981;&#21487;&#37325;&#22797;&#35835;
   </code>
   &#65292;&#31034;&#24847;&#22270;&#22914;&#19979;&#65306;
  </p>
  <p>
   <img alt="image_1d8nk4k1e1mt51nsj1hg41cd7v5950.png-139.4kB" src="EPUB/3dd72ac4-13d6-11ed-838d-acde48001122">
  </p>
  <p>
   &#22914;&#19978;&#22270;&#65292;&#25105;&#20204;&#22312;
   <code>
    Session B
   </code>
   &#20013;&#25552;&#20132;&#20102;&#20960;&#20010;&#38544;&#24335;&#20107;&#21153;&#65288;&#27880;&#24847;&#26159;&#38544;&#24335;&#20107;&#21153;&#65292;&#24847;&#21619;&#30528;&#35821;&#21477;&#32467;&#26463;&#20107;&#21153;&#23601;&#25552;&#20132;&#20102;&#65289;&#65292;&#36825;&#20123;&#20107;&#21153;&#37117;&#20462;&#25913;&#20102;
   <code>
    number
   </code>
   &#21015;&#20026;
   <code>
    1
   </code>
   &#30340;&#35760;&#24405;&#30340;&#21015;
   <code>
    name
   </code>
   &#30340;&#20540;&#65292;&#27599;&#27425;&#20107;&#21153;&#25552;&#20132;&#20043;&#21518;&#65292;&#22914;&#26524;
   <code>
    Session A
   </code>
   &#20013;&#30340;&#20107;&#21153;&#37117;&#21487;&#20197;&#26597;&#30475;&#21040;&#26368;&#26032;&#30340;&#20540;&#65292;&#36825;&#31181;&#29616;&#35937;&#20063;&#34987;&#31216;&#20043;&#20026;
   <code>
    &#19981;&#21487;&#37325;&#22797;&#35835;
   </code>
   &#12290;
  </p>
 </li>
 <li>
  <p>
   &#24187;&#35835;&#65288;Phantom&#65289;
  </p>
  <p>
   &#22914;&#26524;
   <span>
    &#19968;&#20010;&#20107;&#21153;&#20808;&#26681;&#25454;&#26576;&#20123;&#26465;&#20214;&#26597;&#35810;&#20986;&#19968;&#20123;&#35760;&#24405;&#65292;&#20043;&#21518;&#21478;&#19968;&#20010;&#20107;&#21153;&#21448;&#21521;&#34920;&#20013;&#25554;&#20837;&#20102;&#31526;&#21512;&#36825;&#20123;&#26465;&#20214;&#30340;&#35760;&#24405;&#65292;&#21407;&#20808;&#30340;&#20107;&#21153;&#20877;&#27425;&#25353;&#29031;&#35813;&#26465;&#20214;&#26597;&#35810;&#26102;&#65292;&#33021;&#25226;&#21478;&#19968;&#20010;&#20107;&#21153;&#25554;&#20837;&#30340;&#35760;&#24405;&#20063;&#35835;&#20986;&#26469;
   </span>
   &#65292;&#37027;&#23601;&#24847;&#21619;&#30528;&#21457;&#29983;&#20102;
   <code>
    &#24187;&#35835;
   </code>
   &#65292;&#31034;&#24847;&#22270;&#22914;&#19979;&#65306;
  </p>
  <p>
   <img alt="image_1d8nl564faluogc1eqn1am812v79.png-96.1kB" src="EPUB/3dec0c64-13d6-11ed-838d-acde48001122">
  </p>
  <p>
   &#22914;&#19978;&#22270;&#65292;
   <code>
    Session A
   </code>
   &#20013;&#30340;&#20107;&#21153;&#20808;&#26681;&#25454;&#26465;&#20214;
   <code>
    number &gt; 0
   </code>
   &#36825;&#20010;&#26465;&#20214;&#26597;&#35810;&#34920;
   <code>
    hero
   </code>
   &#65292;&#24471;&#21040;&#20102;
   <code>
    name
   </code>
   &#21015;&#20540;&#20026;
   <code>
    '&#21016;&#22791;'
   </code>
   &#30340;&#35760;&#24405;&#65307;&#20043;&#21518;
   <code>
    Session B
   </code>
   &#20013;&#25552;&#20132;&#20102;&#19968;&#20010;&#38544;&#24335;&#20107;&#21153;&#65292;&#35813;&#20107;&#21153;&#21521;&#34920;
   <code>
    hero
   </code>
   &#20013;&#25554;&#20837;&#20102;&#19968;&#26465;&#26032;&#35760;&#24405;&#65307;&#20043;&#21518;
   <code>
    Session A
   </code>
   &#20013;&#30340;&#20107;&#21153;&#20877;&#26681;&#25454;&#30456;&#21516;&#30340;&#26465;&#20214;
   <code>
    number &gt; 0
   </code>
   &#26597;&#35810;&#34920;
   <code>
    hero
   </code>
   &#65292;&#24471;&#21040;&#30340;&#32467;&#26524;&#38598;&#20013;&#21253;&#21547;
   <code>
    Session B
   </code>
   &#20013;&#30340;&#20107;&#21153;&#26032;&#25554;&#20837;&#30340;&#37027;&#26465;&#35760;&#24405;&#65292;&#36825;&#31181;&#29616;&#35937;&#20063;&#34987;&#31216;&#20043;&#20026;
   <code>
    &#24187;&#35835;
   </code>
   &#12290;
  </p>
  <p>
   &#26377;&#30340;&#21516;&#23398;&#20250;&#26377;&#30097;&#38382;&#65292;&#37027;&#22914;&#26524;
   <code>
    Session B
   </code>
   &#20013;&#26159;&#21024;&#38500;&#20102;&#19968;&#20123;&#31526;&#21512;
   <code>
    number &gt; 0
   </code>
   &#30340;&#35760;&#24405;&#32780;&#19981;&#26159;&#25554;&#20837;&#26032;&#35760;&#24405;&#65292;&#37027;
   <code>
    Session A
   </code>
   &#20013;&#20043;&#21518;&#20877;&#26681;&#25454;
   <code>
    number &gt; 0
   </code>
   &#30340;&#26465;&#20214;&#35835;&#21462;&#30340;&#35760;&#24405;&#21464;&#23569;&#20102;&#65292;&#36825;&#31181;&#29616;&#35937;&#31639;&#19981;&#31639;
   <code>
    &#24187;&#35835;
   </code>
   &#21602;&#65311;&#26126;&#30830;&#35828;&#19968;&#19979;&#65292;&#36825;&#31181;&#29616;&#35937;&#19981;&#23646;&#20110;
   <code>
    &#24187;&#35835;
   </code>
   &#65292;
   <code>
    &#24187;&#35835;
   </code>
   &#24378;&#35843;&#30340;&#26159;&#19968;&#20010;&#20107;&#21153;&#25353;&#29031;&#26576;&#20010;&#30456;&#21516;&#26465;&#20214;&#22810;&#27425;&#35835;&#21462;&#35760;&#24405;&#26102;&#65292;&#21518;&#35835;&#21462;&#26102;&#35835;&#21040;&#20102;&#20043;&#21069;&#27809;&#26377;&#35835;&#21040;&#30340;&#35760;&#24405;&#12290;
  </p>
  <pre><code class="hljs language-!">&#23567;&#36148;&#22763;&#65306;

&#37027;&#23545;&#20110;&#20808;&#21069;&#24050;&#32463;&#35835;&#21040;&#30340;&#35760;&#24405;&#65292;&#20043;&#21518;&#21448;&#35835;&#21462;&#19981;&#21040;&#36825;&#31181;&#24773;&#20917;&#65292;&#31639;&#21861;&#21602;&#65311;&#20854;&#23454;&#36825;&#30456;&#24403;&#20110;&#23545;&#27599;&#19968;&#26465;&#35760;&#24405;&#37117;&#21457;&#29983;&#20102;&#19981;&#21487;&#37325;&#22797;&#35835;&#30340;&#29616;&#35937;&#12290;&#24187;&#35835;&#21482;&#26159;&#37325;&#28857;&#24378;&#35843;&#20102;&#35835;&#21462;&#21040;&#20102;&#20043;&#21069;&#35835;&#21462;&#27809;&#26377;&#33719;&#21462;&#21040;&#30340;&#35760;&#24405;&#12290;
</code></pre>
 </li>
</ul>
<h3>
 SQL&#26631;&#20934;&#20013;&#30340;&#22235;&#31181;&#38548;&#31163;&#32423;&#21035;
</h3>
<p>
 &#25105;&#20204;&#19978;&#36793;&#20171;&#32461;&#20102;&#20960;&#31181;&#24182;&#21457;&#20107;&#21153;&#25191;&#34892;&#36807;&#31243;&#20013;&#21487;&#33021;&#36935;&#21040;&#30340;&#19968;&#20123;&#38382;&#39064;&#65292;&#36825;&#20123;&#38382;&#39064;&#20063;&#26377;&#36731;&#37325;&#32531;&#24613;&#20043;&#20998;&#65292;&#25105;&#20204;&#32473;&#36825;&#20123;&#38382;&#39064;&#25353;&#29031;&#20005;&#37325;&#24615;&#26469;&#25490;&#19968;&#19979;&#24207;&#65306;
</p>
<pre><code>&#33039;&#20889; &gt; &#33039;&#35835; &gt; &#19981;&#21487;&#37325;&#22797;&#35835; &gt; &#24187;&#35835;
</code></pre>
<p>
 &#25105;&#20204;&#19978;&#36793;&#25152;&#35828;&#30340;&#33293;&#24323;&#19968;&#37096;&#20998;&#38548;&#31163;&#24615;&#26469;&#25442;&#21462;&#19968;&#37096;&#20998;&#24615;&#33021;&#22312;&#36825;&#37324;&#23601;&#20307;&#29616;&#22312;&#65306;
 <span>
  &#35774;&#31435;&#19968;&#20123;&#38548;&#31163;&#32423;&#21035;&#65292;&#38548;&#31163;&#32423;&#21035;&#36234;&#20302;&#65292;&#36234;&#20005;&#37325;&#30340;&#38382;&#39064;&#23601;&#36234;&#21487;&#33021;&#21457;&#29983;
 </span>
 &#12290;&#26377;&#19968;&#24110;&#20154;&#65288;&#24182;&#19981;&#26159;&#35774;&#35745;
 <code>
  MySQL
 </code>
 &#30340;&#22823;&#21460;&#20204;&#65289;&#21046;&#23450;&#20102;&#19968;&#20010;&#25152;&#35859;&#30340;
 <code>
  SQL&#26631;&#20934;
 </code>
 &#65292;&#22312;&#26631;&#20934;&#20013;&#35774;&#31435;&#20102;4&#20010;
 <code>
  &#38548;&#31163;&#32423;&#21035;
 </code>
 &#65306;
</p>
<ul>
 <li>
  <p>
   <code>
    READ UNCOMMITTED
   </code>
   &#65306;&#26410;&#25552;&#20132;&#35835;&#12290;
  </p>
 </li>
 <li>
  <p>
   <code>
    READ COMMITTED
   </code>
   &#65306;&#24050;&#25552;&#20132;&#35835;&#12290;
  </p>
 </li>
 <li>
  <p>
   <code>
    REPEATABLE READ
   </code>
   &#65306;&#21487;&#37325;&#22797;&#35835;&#12290;
  </p>
 </li>
 <li>
  <p>
   <code>
    SERIALIZABLE
   </code>
   &#65306;&#21487;&#20018;&#34892;&#21270;&#12290;
  </p>
 </li>
</ul>
<p>
 <code>
  SQL&#26631;&#20934;
 </code>
 &#20013;&#35268;&#23450;&#65292;&#38024;&#23545;&#19981;&#21516;&#30340;&#38548;&#31163;&#32423;&#21035;&#65292;&#24182;&#21457;&#20107;&#21153;&#21487;&#20197;&#21457;&#29983;&#19981;&#21516;&#20005;&#37325;&#31243;&#24230;&#30340;&#38382;&#39064;&#65292;&#20855;&#20307;&#24773;&#20917;&#22914;&#19979;&#65306;
</p>
<table>
 <thead>
  <tr>
   <th align="center">
    &#38548;&#31163;&#32423;&#21035;
   </th>
   <th align="center">
    &#33039;&#35835;
   </th>
   <th align="center">
    &#19981;&#21487;&#37325;&#22797;&#35835;
   </th>
   <th align="center">
    &#24187;&#35835;
   </th>
  </tr>
 </thead>
 <tbody>
  <tr>
   <td align="center">
    <code>
     READ UNCOMMITTED
    </code>
   </td>
   <td align="center">
    Possible
   </td>
   <td align="center">
    Possible
   </td>
   <td align="center">
    Possible
   </td>
  </tr>
  <tr>
   <td align="center">
    <code>
     READ COMMITTED
    </code>
   </td>
   <td align="center">
    Not Possible
   </td>
   <td align="center">
    Possible
   </td>
   <td align="center">
    Possible
   </td>
  </tr>
  <tr>
   <td align="center">
    <code>
     REPEATABLE READ
    </code>
   </td>
   <td align="center">
    Not Possible
   </td>
   <td align="center">
    Not Possible
   </td>
   <td align="center">
    Possible
   </td>
  </tr>
  <tr>
   <td align="center">
    <code>
     SERIALIZABLE
    </code>
   </td>
   <td align="center">
    Not Possible
   </td>
   <td align="center">
    Not Possible
   </td>
   <td align="center">
    Not Possible
   </td>
  </tr>
 </tbody>
</table>
<p>
 &#20063;&#23601;&#26159;&#35828;&#65306;
</p>
<ul>
 <li>
  <p>
   <code>
    READ UNCOMMITTED
   </code>
   &#38548;&#31163;&#32423;&#21035;&#19979;&#65292;&#21487;&#33021;&#21457;&#29983;
   <code>
    &#33039;&#35835;
   </code>
   &#12289;
   <code>
    &#19981;&#21487;&#37325;&#22797;&#35835;
   </code>
   &#21644;
   <code>
    &#24187;&#35835;
   </code>
   &#38382;&#39064;&#12290;
  </p>
 </li>
 <li>
  <p>
   <code>
    READ COMMITTED
   </code>
   &#38548;&#31163;&#32423;&#21035;&#19979;&#65292;&#21487;&#33021;&#21457;&#29983;
   <code>
    &#19981;&#21487;&#37325;&#22797;&#35835;
   </code>
   &#21644;
   <code>
    &#24187;&#35835;
   </code>
   &#38382;&#39064;&#65292;&#20294;&#26159;&#19981;&#21487;&#20197;&#21457;&#29983;
   <code>
    &#33039;&#35835;
   </code>
   &#38382;&#39064;&#12290;
  </p>
 </li>
 <li>
  <p>
   <code>
    REPEATABLE READ
   </code>
   &#38548;&#31163;&#32423;&#21035;&#19979;&#65292;&#21487;&#33021;&#21457;&#29983;
   <code>
    &#24187;&#35835;
   </code>
   &#38382;&#39064;&#65292;&#20294;&#26159;&#19981;&#21487;&#20197;&#21457;&#29983;
   <code>
    &#33039;&#35835;
   </code>
   &#21644;
   <code>
    &#19981;&#21487;&#37325;&#22797;&#35835;
   </code>
   &#30340;&#38382;&#39064;&#12290;
  </p>
 </li>
 <li>
  <p>
   <code>
    SERIALIZABLE
   </code>
   &#38548;&#31163;&#32423;&#21035;&#19979;&#65292;&#21508;&#31181;&#38382;&#39064;&#37117;&#19981;&#21487;&#20197;&#21457;&#29983;&#12290;
  </p>
 </li>
</ul>
<p>
 <code>
  &#33039;&#20889;
 </code>
 &#26159;&#24590;&#20040;&#22238;&#20107;&#20799;&#65311;&#24590;&#20040;&#37324;&#36793;&#37117;&#27809;&#20889;&#21602;&#65311;
 <span>
  &#36825;&#26159;&#22240;&#20026;&#33039;&#20889;&#36825;&#20010;&#38382;&#39064;&#22826;&#20005;&#37325;&#20102;&#65292;&#19981;&#35770;&#26159;&#21738;&#31181;&#38548;&#31163;&#32423;&#21035;&#65292;&#37117;&#19981;&#20801;&#35768;&#33039;&#20889;&#30340;&#24773;&#20917;&#21457;&#29983;
 </span>
 &#12290;
</p>
<h3>
 MySQL&#20013;&#25903;&#25345;&#30340;&#22235;&#31181;&#38548;&#31163;&#32423;&#21035;
</h3>
<p>
 &#19981;&#21516;&#30340;&#25968;&#25454;&#24211;&#21378;&#21830;&#23545;
 <code>
  SQL&#26631;&#20934;
 </code>
 &#20013;&#35268;&#23450;&#30340;&#22235;&#31181;&#38548;&#31163;&#32423;&#21035;&#25903;&#25345;&#19981;&#19968;&#26679;&#65292;&#27604;&#26041;&#35828;
 <code>
  Oracle
 </code>
 &#23601;&#21482;&#25903;&#25345;
 <code>
  READ COMMITTED
 </code>
 &#21644;
 <code>
  SERIALIZABLE
 </code>
 &#38548;&#31163;&#32423;&#21035;&#12290;&#26412;&#20070;&#20013;&#25152;&#35752;&#35770;&#30340;
 <code>
  MySQL
 </code>
 &#34429;&#28982;&#25903;&#25345;4&#31181;&#38548;&#31163;&#32423;&#21035;&#65292;&#20294;&#19982;
 <code>
  SQL&#26631;&#20934;
 </code>
 &#20013;&#25152;&#35268;&#23450;&#30340;&#21508;&#32423;&#38548;&#31163;&#32423;&#21035;&#20801;&#35768;&#21457;&#29983;&#30340;&#38382;&#39064;&#21364;&#26377;&#20123;&#20986;&#20837;&#65292;
 <span>
  MySQL&#22312;REPEATABLE READ&#38548;&#31163;&#32423;&#21035;&#19979;&#65292;&#26159;&#21487;&#20197;&#31105;&#27490;&#24187;&#35835;&#38382;&#39064;&#30340;&#21457;&#29983;&#30340;
 </span>
 &#65288;&#20851;&#20110;&#22914;&#20309;&#31105;&#27490;&#25105;&#20204;&#20043;&#21518;&#20250;&#35814;&#32454;&#35828;&#26126;&#30340;&#65289;&#12290;
</p>
<p>
 <code>
  MySQL
 </code>
 &#30340;&#40664;&#35748;&#38548;&#31163;&#32423;&#21035;&#20026;
 <code>
  REPEATABLE READ
 </code>
 &#65292;&#25105;&#20204;&#21487;&#20197;&#25163;&#21160;&#20462;&#25913;&#19968;&#19979;&#20107;&#21153;&#30340;&#38548;&#31163;&#32423;&#21035;&#12290;
</p>
<h4>
 &#22914;&#20309;&#35774;&#32622;&#20107;&#21153;&#30340;&#38548;&#31163;&#32423;&#21035;
</h4>
<p>
 &#25105;&#20204;&#21487;&#20197;&#36890;&#36807;&#19979;&#36793;&#30340;&#35821;&#21477;&#20462;&#25913;&#20107;&#21153;&#30340;&#38548;&#31163;&#32423;&#21035;&#65306;
</p>
<pre><code>SET [GLOBAL|SESSION] TRANSACTION ISOLATION LEVEL level;
</code></pre>
<p>
 &#20854;&#20013;&#30340;
 <code>
  level
 </code>
 &#21487;&#36873;&#20540;&#26377;4&#20010;&#65306;
</p>
<pre><code>level: {
     REPEATABLE READ
   | READ COMMITTED
   | READ UNCOMMITTED
   | SERIALIZABLE
}
</code></pre>
<p>
 &#35774;&#32622;&#20107;&#21153;&#30340;&#38548;&#31163;&#32423;&#21035;&#30340;&#35821;&#21477;&#20013;&#65292;&#22312;
 <code>
  SET
 </code>
 &#20851;&#38190;&#23383;&#21518;&#21487;&#20197;&#25918;&#32622;
 <code>
  GLOBAL
 </code>
 &#20851;&#38190;&#23383;&#12289;
 <code>
  SESSION
 </code>
 &#20851;&#38190;&#23383;&#25110;&#32773;&#20160;&#20040;&#37117;&#19981;&#25918;&#65292;&#36825;&#26679;&#20250;&#23545;&#19981;&#21516;&#33539;&#22260;&#30340;&#20107;&#21153;&#20135;&#29983;&#19981;&#21516;&#30340;&#24433;&#21709;&#65292;&#20855;&#20307;&#22914;&#19979;&#65306;
</p>
<ul>
 <li>
  <p>
   &#20351;&#29992;
   <code>
    GLOBAL
   </code>
   &#20851;&#38190;&#23383;&#65288;&#22312;&#20840;&#23616;&#33539;&#22260;&#24433;&#21709;&#65289;&#65306;
  </p>
  <p>
   &#27604;&#26041;&#35828;&#36825;&#26679;&#65306;
  </p>
  <pre><code>SET GLOBAL TRANSACTION ISOLATION LEVEL SERIALIZABLE;
</code></pre>
  <p>
   &#21017;&#65306;
  </p>
  <ul>
   <li>
    <p>
     &#21482;&#23545;&#25191;&#34892;&#23436;&#35813;&#35821;&#21477;&#20043;&#21518;&#20135;&#29983;&#30340;&#20250;&#35805;&#36215;&#20316;&#29992;&#12290;
    </p>
   </li>
   <li>
    <p>
     &#24403;&#21069;&#24050;&#32463;&#23384;&#22312;&#30340;&#20250;&#35805;&#26080;&#25928;&#12290;
    </p>
   </li>
  </ul>
 </li>
 <li>
  <p>
   &#20351;&#29992;
   <code>
    SESSION
   </code>
   &#20851;&#38190;&#23383;&#65288;&#22312;&#20250;&#35805;&#33539;&#22260;&#24433;&#21709;&#65289;&#65306;
  </p>
  <p>
   &#27604;&#26041;&#35828;&#36825;&#26679;&#65306;
  </p>
  <pre><code>SET SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;
</code></pre>
  <p>
   &#21017;&#65306;
  </p>
  <ul>
   <li>
    <p>
     &#23545;&#24403;&#21069;&#20250;&#35805;&#30340;&#25152;&#26377;&#21518;&#32493;&#30340;&#20107;&#21153;&#26377;&#25928;
    </p>
   </li>
   <li>
    <p>
     &#35813;&#35821;&#21477;&#21487;&#20197;&#22312;&#24050;&#32463;&#24320;&#21551;&#30340;&#20107;&#21153;&#20013;&#38388;&#25191;&#34892;&#65292;&#20294;&#19981;&#20250;&#24433;&#21709;&#24403;&#21069;&#27491;&#22312;&#25191;&#34892;&#30340;&#20107;&#21153;&#12290;
    </p>
   </li>
   <li>
    <p>
     &#22914;&#26524;&#22312;&#20107;&#21153;&#20043;&#38388;&#25191;&#34892;&#65292;&#21017;&#23545;&#21518;&#32493;&#30340;&#20107;&#21153;&#26377;&#25928;&#12290;
    </p>
   </li>
  </ul>
 </li>
 <li>
  <p>
   &#19978;&#36848;&#20004;&#20010;&#20851;&#38190;&#23383;&#37117;&#19981;&#29992;&#65288;&#21482;&#23545;&#25191;&#34892;&#35821;&#21477;&#21518;&#30340;&#19979;&#19968;&#20010;&#20107;&#21153;&#20135;&#29983;&#24433;&#21709;&#65289;&#65306;
  </p>
  <p>
   &#27604;&#26041;&#35828;&#36825;&#26679;&#65306;
  </p>
  <pre><code>SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;
</code></pre>
  <p>
   &#21017;&#65306;
  </p>
  <ul>
   <li>
    <p>
     &#21482;&#23545;&#24403;&#21069;&#20250;&#35805;&#20013;&#19979;&#19968;&#20010;&#21363;&#23558;&#24320;&#21551;&#30340;&#20107;&#21153;&#26377;&#25928;&#12290;
    </p>
   </li>
   <li>
    <p>
     &#19979;&#19968;&#20010;&#20107;&#21153;&#25191;&#34892;&#23436;&#21518;&#65292;&#21518;&#32493;&#20107;&#21153;&#23558;&#24674;&#22797;&#21040;&#20043;&#21069;&#30340;&#38548;&#31163;&#32423;&#21035;&#12290;
    </p>
   </li>
   <li>
    <p>
     &#35813;&#35821;&#21477;&#19981;&#33021;&#22312;&#24050;&#32463;&#24320;&#21551;&#30340;&#20107;&#21153;&#20013;&#38388;&#25191;&#34892;&#65292;&#20250;&#25253;&#38169;&#30340;&#12290;
    </p>
   </li>
  </ul>
 </li>
</ul>
<p>
 &#22914;&#26524;&#25105;&#20204;&#22312;&#26381;&#21153;&#22120;&#21551;&#21160;&#26102;&#24819;&#25913;&#21464;&#20107;&#21153;&#30340;&#40664;&#35748;&#38548;&#31163;&#32423;&#21035;&#65292;&#21487;&#20197;&#20462;&#25913;&#21551;&#21160;&#21442;&#25968;
 <code>
  transaction-isolation
 </code>
 &#30340;&#20540;&#65292;&#27604;&#26041;&#35828;&#25105;&#20204;&#22312;&#21551;&#21160;&#26381;&#21153;&#22120;&#26102;&#25351;&#23450;&#20102;
 <code>
  --transaction-isolation=SERIALIZABLE
 </code>
 &#65292;&#37027;&#20040;&#20107;&#21153;&#30340;&#40664;&#35748;&#38548;&#31163;&#32423;&#21035;&#23601;&#20174;&#21407;&#26469;&#30340;
 <code>
  REPEATABLE READ
 </code>
 &#21464;&#25104;&#20102;
 <code>
  SERIALIZABLE
 </code>
 &#12290;
</p>
<p>
 &#24819;&#35201;&#26597;&#30475;&#24403;&#21069;&#20250;&#35805;&#40664;&#35748;&#30340;&#38548;&#31163;&#32423;&#21035;&#21487;&#20197;&#36890;&#36807;&#26597;&#30475;&#31995;&#32479;&#21464;&#37327;
 <code>
  transaction_isolation
 </code>
 &#30340;&#20540;&#26469;&#30830;&#23450;&#65306;
</p>
<pre><code>mysql&gt; SHOW VARIABLES LIKE 'transaction_isolation';
+-----------------------+-----------------+
| Variable_name         | Value           |
+-----------------------+-----------------+
| transaction_isolation | REPEATABLE-READ |
+-----------------------+-----------------+
1 row in set (0.02 sec)
</code></pre>
<p>
 &#25110;&#32773;&#20351;&#29992;&#26356;&#31616;&#20415;&#30340;&#20889;&#27861;&#65306;
</p>
<pre><code>mysql&gt; SELECT @@transaction_isolation;
+-------------------------+
| @@transaction_isolation |
+-------------------------+
| REPEATABLE-READ         |
+-------------------------+
1 row in set (0.00 sec)
</code></pre>
<pre><code class="hljs language-!">&#23567;&#36148;&#22763;&#65306;

&#25105;&#20204;&#20063;&#21487;&#20197;&#20351;&#29992;&#35774;&#32622;&#31995;&#32479;&#21464;&#37327;transaction_isolation&#30340;&#26041;&#24335;&#26469;&#35774;&#32622;&#20107;&#21153;&#30340;&#38548;&#31163;&#32423;&#21035;&#65292;&#19981;&#36807;&#25105;&#20204;&#21069;&#36793;&#20171;&#32461;&#36807;&#65292;&#19968;&#33324;&#31995;&#32479;&#21464;&#37327;&#21482;&#26377;GLOBAL&#21644;SESSION&#20004;&#20010;&#20316;&#29992;&#33539;&#22260;&#65292;&#32780;&#36825;&#20010;transaction_isolation&#21364;&#26377;3&#20010;&#65288;&#19982;&#19978;&#36793; SET TRANSACTION ISOLATION LEVEL&#30340;&#35821;&#27861;&#30456;&#23545;&#24212;&#65289;&#65292;&#35774;&#32622;&#35821;&#27861;&#19978;&#26377;&#20123;&#29305;&#27530;&#65292;&#26356;&#22810;&#35814;&#24773;&#21487;&#20197;&#21442;&#35265;&#25991;&#26723;&#65306;https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_transaction_isolation&#12290;

&#21478;&#22806;&#65292;transaction_isolation&#26159;&#22312;MySQL 5.7.20&#30340;&#29256;&#26412;&#20013;&#24341;&#20837;&#26469;&#26367;&#25442;tx_isolation&#30340;&#65292;&#22914;&#26524;&#20320;&#20351;&#29992;&#30340;&#26159;&#20043;&#21069;&#29256;&#26412;&#30340;MySQL&#65292;&#35831;&#23558;&#19978;&#36848;&#29992;&#21040;&#31995;&#32479;&#21464;&#37327;transaction_isolation&#30340;&#22320;&#26041;&#26367;&#25442;&#20026;tx_isolation&#12290;
</code></pre>
<h2>
 MVCC&#21407;&#29702;
</h2>
<h3>
 &#29256;&#26412;&#38142;
</h3>
<p>
 &#25105;&#20204;&#21069;&#36793;&#35828;&#36807;&#65292;&#23545;&#20110;&#20351;&#29992;
 <code>
  InnoDB
 </code>
 &#23384;&#20648;&#24341;&#25806;&#30340;&#34920;&#26469;&#35828;&#65292;&#23427;&#30340;&#32858;&#31751;&#32034;&#24341;&#35760;&#24405;&#20013;&#37117;&#21253;&#21547;&#20004;&#20010;&#24517;&#35201;&#30340;&#38544;&#34255;&#21015;&#65288;
 <code>
  row_id
 </code>
 &#24182;&#19981;&#26159;&#24517;&#35201;&#30340;&#65292;&#25105;&#20204;&#21019;&#24314;&#30340;&#34920;&#20013;&#26377;&#20027;&#38190;&#25110;&#32773;&#38750;NULL&#30340;UNIQUE&#38190;&#26102;&#37117;&#19981;&#20250;&#21253;&#21547;
 <code>
  row_id
 </code>
 &#21015;&#65289;&#65306;
</p>
<ul>
 <li>
  <p>
   <code>
    trx_id
   </code>
   &#65306;&#27599;&#27425;&#19968;&#20010;&#20107;&#21153;&#23545;&#26576;&#26465;&#32858;&#31751;&#32034;&#24341;&#35760;&#24405;&#36827;&#34892;&#25913;&#21160;&#26102;&#65292;&#37117;&#20250;&#25226;&#35813;&#20107;&#21153;&#30340;
   <code>
    &#20107;&#21153;id
   </code>
   &#36171;&#20540;&#32473;
   <code>
    trx_id
   </code>
   &#38544;&#34255;&#21015;&#12290;
  </p>
 </li>
 <li>
  <p>
   <code>
    roll_pointer
   </code>
   &#65306;&#27599;&#27425;&#23545;&#26576;&#26465;&#32858;&#31751;&#32034;&#24341;&#35760;&#24405;&#36827;&#34892;&#25913;&#21160;&#26102;&#65292;&#37117;&#20250;&#25226;&#26087;&#30340;&#29256;&#26412;&#20889;&#20837;&#21040;
   <code>
    undo&#26085;&#24535;
   </code>
   &#20013;&#65292;&#28982;&#21518;&#36825;&#20010;&#38544;&#34255;&#21015;&#23601;&#30456;&#24403;&#20110;&#19968;&#20010;&#25351;&#38024;&#65292;&#21487;&#20197;&#36890;&#36807;&#23427;&#26469;&#25214;&#21040;&#35813;&#35760;&#24405;&#20462;&#25913;&#21069;&#30340;&#20449;&#24687;&#12290;
  </p>
 </li>
</ul>
<p>
 &#27604;&#26041;&#35828;&#25105;&#20204;&#30340;&#34920;
 <code>
  hero
 </code>
 &#29616;&#22312;&#21482;&#21253;&#21547;&#19968;&#26465;&#35760;&#24405;&#65306;
</p>
<pre><code>mysql&gt; SELECT * FROM hero;
+--------+--------+---------+
| number | name   | country |
+--------+--------+---------+
|      1 | &#21016;&#22791;   | &#34560;      |
+--------+--------+---------+
1 row in set (0.07 sec)
</code></pre>
<p>
 &#20551;&#35774;&#25554;&#20837;&#35813;&#35760;&#24405;&#30340;
 <code>
  &#20107;&#21153;id
 </code>
 &#20026;
 <code>
  80
 </code>
 &#65292;&#37027;&#20040;&#27492;&#21051;&#35813;&#26465;&#35760;&#24405;&#30340;&#31034;&#24847;&#22270;&#22914;&#19979;&#25152;&#31034;&#65306;
</p>
<p>
 <img alt="image_1d8oab1ubb7v5f41j2pai21co19.png-22.4kB" src="EPUB/3df73a9e-13d6-11ed-838d-acde48001122">
</p>
<blockquote>
 <p>
  &#23567;&#36148;&#22763;&#65306;
  <br>
  <br>
  &#23454;&#38469;&#19978;insert undo&#21482;&#22312;&#20107;&#21153;&#22238;&#28378;&#26102;&#36215;&#20316;&#29992;&#65292;&#24403;&#20107;&#21153;&#25552;&#20132;&#21518;&#65292;&#35813;&#31867;&#22411;&#30340;undo&#26085;&#24535;&#23601;&#27809;&#29992;&#20102;&#65292;&#23427;&#21344;&#29992;&#30340;Undo Log Segment&#20063;&#20250;&#34987;&#31995;&#32479;&#22238;&#25910;&#65288;&#20063;&#23601;&#26159;&#35813;undo&#26085;&#24535;&#21344;&#29992;&#30340;Undo&#39029;&#38754;&#38142;&#34920;&#35201;&#20040;&#34987;&#37325;&#29992;&#65292;&#35201;&#20040;&#34987;&#37322;&#25918;&#65289;&#12290;&#34429;&#28982;&#30495;&#27491;&#30340;insert undo&#26085;&#24535;&#21344;&#29992;&#30340;&#23384;&#20648;&#31354;&#38388;&#34987;&#37322;&#25918;&#20102;&#65292;&#20294;&#26159;roll_pointer&#30340;&#20540;&#24182;&#19981;&#20250;&#34987;&#28165;&#38500;&#65292;roll_pointer&#23646;&#24615;&#21344;&#29992;7&#20010;&#23383;&#33410;&#65292;&#31532;&#19968;&#20010;&#27604;&#29305;&#20301;&#23601;&#26631;&#35760;&#30528;&#23427;&#25351;&#21521;&#30340;undo&#26085;&#24535;&#30340;&#31867;&#22411;&#65292;&#22914;&#26524;&#35813;&#27604;&#29305;&#20301;&#30340;&#20540;&#20026;1&#26102;&#65292;&#23601;&#20195;&#34920;&#30528;&#23427;&#25351;&#21521;&#30340;undo&#26085;&#24535;&#31867;&#22411;&#20026;insert undo&#12290;&#25152;&#20197;&#25105;&#20204;&#20043;&#21518;&#22312;&#30011;&#22270;&#26102;&#37117;&#20250;&#25226;insert undo&#32473;&#21435;&#25481;&#65292;&#22823;&#23478;&#30041;&#24847;&#19968;&#19979;&#23601;&#22909;&#20102;&#12290;
 </p>
</blockquote>
<p>
 &#20551;&#35774;&#20043;&#21518;&#20004;&#20010;
 <code>
  &#20107;&#21153;id
 </code>
 &#20998;&#21035;&#20026;
 <code>
  100
 </code>
 &#12289;
 <code>
  200
 </code>
 &#30340;&#20107;&#21153;&#23545;&#36825;&#26465;&#35760;&#24405;&#36827;&#34892;
 <code>
  UPDATE
 </code>
 &#25805;&#20316;&#65292;&#25805;&#20316;&#27969;&#31243;&#22914;&#19979;&#65306;
</p>
<p>
 <img alt="image_1d8obbc861ulkpt3no31gecrho16.png-92.3kB" src="EPUB/3e34e330-13d6-11ed-838d-acde48001122">
</p>
<blockquote>
 <p>
  &#23567;&#36148;&#22763;&#65306;
  <br>
  <br>
  &#33021;&#19981;&#33021;&#22312;&#20004;&#20010;&#20107;&#21153;&#20013;&#20132;&#21449;&#26356;&#26032;&#21516;&#19968;&#26465;&#35760;&#24405;&#21602;&#65311;&#21704;&#21704;&#65292;&#36825;&#19981;&#23601;&#26159;&#19968;&#20010;&#20107;&#21153;&#20462;&#25913;&#20102;&#21478;&#19968;&#20010;&#26410;&#25552;&#20132;&#20107;&#21153;&#20462;&#25913;&#36807;&#30340;&#25968;&#25454;&#65292;&#27814;&#20026;&#20102;&#33039;&#20889;&#20102;&#20040;&#65311;InnoDB&#20351;&#29992;&#38145;&#26469;&#20445;&#35777;&#19981;&#20250;&#26377;&#33039;&#20889;&#24773;&#20917;&#30340;&#21457;&#29983;&#65292;&#20063;&#23601;&#26159;&#22312;&#31532;&#19968;&#20010;&#20107;&#21153;&#26356;&#26032;&#20102;&#26576;&#26465;&#35760;&#24405;&#21518;&#65292;&#23601;&#20250;&#32473;&#36825;&#26465;&#35760;&#24405;&#21152;&#38145;&#65292;&#21478;&#19968;&#20010;&#20107;&#21153;&#20877;&#27425;&#26356;&#26032;&#26102;&#23601;&#38656;&#35201;&#31561;&#24453;&#31532;&#19968;&#20010;&#20107;&#21153;&#25552;&#20132;&#20102;&#65292;&#25226;&#38145;&#37322;&#25918;&#20043;&#21518;&#25165;&#21487;&#20197;&#32487;&#32493;&#26356;&#26032;&#12290;&#20851;&#20110;&#38145;&#30340;&#26356;&#22810;&#32454;&#33410;&#25105;&#20204;&#21518;&#32493;&#30340;&#25991;&#31456;&#20013;&#20877;&#21792;&#21480;&#21704;&#65374;
 </p>
</blockquote>
<p>
 &#27599;&#27425;&#23545;&#35760;&#24405;&#36827;&#34892;&#25913;&#21160;&#65292;&#37117;&#20250;&#35760;&#24405;&#19968;&#26465;
 <code>
  undo&#26085;&#24535;
 </code>
 &#65292;&#27599;&#26465;
 <code>
  undo&#26085;&#24535;
 </code>
 &#20063;&#37117;&#26377;&#19968;&#20010;
 <code>
  roll_pointer
 </code>
 &#23646;&#24615;&#65288;
 <code>
  INSERT
 </code>
 &#25805;&#20316;&#23545;&#24212;&#30340;
 <code>
  undo&#26085;&#24535;
 </code>
 &#27809;&#26377;&#35813;&#23646;&#24615;&#65292;&#22240;&#20026;&#35813;&#35760;&#24405;&#24182;&#27809;&#26377;&#26356;&#26089;&#30340;&#29256;&#26412;&#65289;&#65292;&#21487;&#20197;&#23558;&#36825;&#20123;
 <code>
  undo&#26085;&#24535;
 </code>
 &#37117;&#36830;&#36215;&#26469;&#65292;&#20018;&#25104;&#19968;&#20010;&#38142;&#34920;&#65292;&#25152;&#20197;&#29616;&#22312;&#30340;&#24773;&#20917;&#23601;&#20687;&#19979;&#22270;&#19968;&#26679;&#65306;
</p>
<p>
 <img alt="image_1d8po6kgkejilj2g4t3t81evm20.png-81.7kB" src="EPUB/3e442124-13d6-11ed-838d-acde48001122">
</p>
<p>
 &#23545;&#35813;&#35760;&#24405;&#27599;&#27425;&#26356;&#26032;&#21518;&#65292;&#37117;&#20250;&#23558;&#26087;&#20540;&#25918;&#21040;&#19968;&#26465;
 <code>
  undo&#26085;&#24535;
 </code>
 &#20013;&#65292;&#23601;&#31639;&#26159;&#35813;&#35760;&#24405;&#30340;&#19968;&#20010;&#26087;&#29256;&#26412;&#65292;&#38543;&#30528;&#26356;&#26032;&#27425;&#25968;&#30340;&#22686;&#22810;&#65292;&#25152;&#26377;&#30340;&#29256;&#26412;&#37117;&#20250;&#34987;
 <code>
  roll_pointer
 </code>
 &#23646;&#24615;&#36830;&#25509;&#25104;&#19968;&#20010;&#38142;&#34920;&#65292;&#25105;&#20204;&#25226;&#36825;&#20010;&#38142;&#34920;&#31216;&#20043;&#20026;
 <code>
  &#29256;&#26412;&#38142;
 </code>
 &#65292;
 <span>
  &#29256;&#26412;&#38142;&#30340;&#22836;&#33410;&#28857;&#23601;&#26159;&#24403;&#21069;&#35760;&#24405;&#26368;&#26032;&#30340;&#20540;
 </span>
 &#12290;&#21478;&#22806;&#65292;&#27599;&#20010;&#29256;&#26412;&#20013;&#36824;&#21253;&#21547;&#29983;&#25104;&#35813;&#29256;&#26412;&#26102;&#23545;&#24212;&#30340;
 <code>
  &#20107;&#21153;id
 </code>
 &#65292;&#36825;&#20010;&#20449;&#24687;&#24456;&#37325;&#35201;&#65292;&#25105;&#20204;&#31245;&#21518;&#23601;&#20250;&#29992;&#21040;&#12290;
</p>
<h3>
 ReadView
</h3>
<p>
 &#23545;&#20110;&#20351;&#29992;
 <code>
  READ UNCOMMITTED
 </code>
 &#38548;&#31163;&#32423;&#21035;&#30340;&#20107;&#21153;&#26469;&#35828;&#65292;&#30001;&#20110;&#21487;&#20197;&#35835;&#21040;&#26410;&#25552;&#20132;&#20107;&#21153;&#20462;&#25913;&#36807;&#30340;&#35760;&#24405;&#65292;&#25152;&#20197;&#30452;&#25509;&#35835;&#21462;&#35760;&#24405;&#30340;&#26368;&#26032;&#29256;&#26412;&#23601;&#22909;&#20102;&#65307;&#23545;&#20110;&#20351;&#29992;
 <code>
  SERIALIZABLE
 </code>
 &#38548;&#31163;&#32423;&#21035;&#30340;&#20107;&#21153;&#26469;&#35828;&#65292;&#35774;&#35745;
 <code>
  InnoDB
 </code>
 &#30340;&#22823;&#21460;&#35268;&#23450;&#20351;&#29992;&#21152;&#38145;&#30340;&#26041;&#24335;&#26469;&#35775;&#38382;&#35760;&#24405;&#65288;&#21152;&#38145;&#26159;&#21861;&#25105;&#20204;&#21518;&#32493;&#25991;&#31456;&#20013;&#35828;&#21704;&#65289;&#65307;&#23545;&#20110;&#20351;&#29992;
 <code>
  READ COMMITTED
 </code>
 &#21644;
 <code>
  REPEATABLE READ
 </code>
 &#38548;&#31163;&#32423;&#21035;&#30340;&#20107;&#21153;&#26469;&#35828;&#65292;&#37117;&#24517;&#39035;&#20445;&#35777;&#35835;&#21040;&#24050;&#32463;&#25552;&#20132;&#20102;&#30340;&#20107;&#21153;&#20462;&#25913;&#36807;&#30340;&#35760;&#24405;&#65292;&#20063;&#23601;&#26159;&#35828;&#20551;&#22914;&#21478;&#19968;&#20010;&#20107;&#21153;&#24050;&#32463;&#20462;&#25913;&#20102;&#35760;&#24405;&#20294;&#26159;&#23578;&#26410;&#25552;&#20132;&#65292;&#26159;&#19981;&#33021;&#30452;&#25509;&#35835;&#21462;&#26368;&#26032;&#29256;&#26412;&#30340;&#35760;&#24405;&#30340;&#65292;&#26680;&#24515;&#38382;&#39064;&#23601;&#26159;&#65306;
 <span>
  &#38656;&#35201;&#21028;&#26029;&#19968;&#19979;&#29256;&#26412;&#38142;&#20013;&#30340;&#21738;&#20010;&#29256;&#26412;&#26159;&#24403;&#21069;&#20107;&#21153;&#21487;&#35265;&#30340;
 </span>
 &#12290;&#20026;&#27492;&#65292;&#35774;&#35745;
 <code>
  InnoDB
 </code>
 &#30340;&#22823;&#21460;&#25552;&#20986;&#20102;&#19968;&#20010;
 <code>
  ReadView
 </code>
 &#30340;&#27010;&#24565;&#65292;&#36825;&#20010;
 <code>
  ReadView
 </code>
 &#20013;&#20027;&#35201;&#21253;&#21547;4&#20010;&#27604;&#36739;&#37325;&#35201;&#30340;&#20869;&#23481;&#65306;
</p>
<ul>
 <li>
  <p>
   <code>
    m_ids
   </code>
   &#65306;&#34920;&#31034;&#22312;&#29983;&#25104;
   <code>
    ReadView
   </code>
   &#26102;&#24403;&#21069;&#31995;&#32479;&#20013;&#27963;&#36291;&#30340;&#35835;&#20889;&#20107;&#21153;&#30340;
   <code>
    &#20107;&#21153;id
   </code>
   &#21015;&#34920;&#12290;
  </p>
 </li>
 <li>
  <p>
   <code>
    min_trx_id
   </code>
   &#65306;&#34920;&#31034;&#22312;&#29983;&#25104;
   <code>
    ReadView
   </code>
   &#26102;&#24403;&#21069;&#31995;&#32479;&#20013;&#27963;&#36291;&#30340;&#35835;&#20889;&#20107;&#21153;&#20013;&#26368;&#23567;&#30340;
   <code>
    &#20107;&#21153;id
   </code>
   &#65292;&#20063;&#23601;&#26159;
   <code>
    m_ids
   </code>
   &#20013;&#30340;&#26368;&#23567;&#20540;&#12290;
  </p>
 </li>
 <li>
  <p>
   <code>
    max_trx_id
   </code>
   &#65306;&#34920;&#31034;&#29983;&#25104;
   <code>
    ReadView
   </code>
   &#26102;&#31995;&#32479;&#20013;&#24212;&#35813;&#20998;&#37197;&#32473;&#19979;&#19968;&#20010;&#20107;&#21153;&#30340;
   <code>
    id
   </code>
   &#20540;&#12290;
  </p>
  <pre><code class="hljs language-!">&#23567;&#36148;&#22763;&#65306;

&#27880;&#24847;max_trx_id&#24182;&#19981;&#26159;m_ids&#20013;&#30340;&#26368;&#22823;&#20540;&#65292;&#20107;&#21153;id&#26159;&#36882;&#22686;&#20998;&#37197;&#30340;&#12290;&#27604;&#26041;&#35828;&#29616;&#22312;&#26377;id&#20026;1&#65292;2&#65292;3&#36825;&#19977;&#20010;&#20107;&#21153;&#65292;&#20043;&#21518;id&#20026;3&#30340;&#20107;&#21153;&#25552;&#20132;&#20102;&#12290;&#37027;&#20040;&#19968;&#20010;&#26032;&#30340;&#35835;&#20107;&#21153;&#22312;&#29983;&#25104;ReadView&#26102;&#65292;m_ids&#23601;&#21253;&#25324;1&#21644;2&#65292;min_trx_id&#30340;&#20540;&#23601;&#26159;1&#65292;max_trx_id&#30340;&#20540;&#23601;&#26159;4&#12290;
</code></pre>
 </li>
 <li>
  <p>
   <code>
    creator_trx_id
   </code>
   &#65306;&#34920;&#31034;&#29983;&#25104;&#35813;
   <code>
    ReadView
   </code>
   &#30340;&#20107;&#21153;&#30340;
   <code>
    &#20107;&#21153;id
   </code>
   &#12290;
  </p>
  <pre><code class="hljs language-!">&#23567;&#36148;&#22763;&#65306;

&#25105;&#20204;&#21069;&#36793;&#35828;&#36807;&#65292;&#21482;&#26377;&#22312;&#23545;&#34920;&#20013;&#30340;&#35760;&#24405;&#20570;&#25913;&#21160;&#26102;&#65288;&#25191;&#34892;INSERT&#12289;DELETE&#12289;UPDATE&#36825;&#20123;&#35821;&#21477;&#26102;&#65289;&#25165;&#20250;&#20026;&#20107;&#21153;&#20998;&#37197;&#20107;&#21153;id&#65292;&#21542;&#21017;&#22312;&#19968;&#20010;&#21482;&#35835;&#20107;&#21153;&#20013;&#30340;&#20107;&#21153;id&#20540;&#37117;&#40664;&#35748;&#20026;0&#12290;
</code></pre>
 </li>
</ul>
<p>
 &#26377;&#20102;&#36825;&#20010;
 <code>
  ReadView
 </code>
 &#65292;&#36825;&#26679;&#22312;&#35775;&#38382;&#26576;&#26465;&#35760;&#24405;&#26102;&#65292;&#21482;&#38656;&#35201;&#25353;&#29031;&#19979;&#36793;&#30340;&#27493;&#39588;&#21028;&#26029;&#35760;&#24405;&#30340;&#26576;&#20010;&#29256;&#26412;&#26159;&#21542;&#21487;&#35265;&#65306;
</p>
<ul>
 <li>
  <p>
   &#22914;&#26524;&#34987;&#35775;&#38382;&#29256;&#26412;&#30340;
   <code>
    trx_id
   </code>
   &#23646;&#24615;&#20540;&#19982;
   <code>
    ReadView
   </code>
   &#20013;&#30340;
   <code>
    creator_trx_id
   </code>
   &#20540;&#30456;&#21516;&#65292;&#24847;&#21619;&#30528;&#24403;&#21069;&#20107;&#21153;&#22312;&#35775;&#38382;&#23427;&#33258;&#24049;&#20462;&#25913;&#36807;&#30340;&#35760;&#24405;&#65292;&#25152;&#20197;&#35813;&#29256;&#26412;&#21487;&#20197;&#34987;&#24403;&#21069;&#20107;&#21153;&#35775;&#38382;&#12290;
  </p>
 </li>
 <li>
  <p>
   &#22914;&#26524;&#34987;&#35775;&#38382;&#29256;&#26412;&#30340;
   <code>
    trx_id
   </code>
   &#23646;&#24615;&#20540;&#23567;&#20110;
   <code>
    ReadView
   </code>
   &#20013;&#30340;
   <code>
    min_trx_id
   </code>
   &#20540;&#65292;&#34920;&#26126;&#29983;&#25104;&#35813;&#29256;&#26412;&#30340;&#20107;&#21153;&#22312;&#24403;&#21069;&#20107;&#21153;&#29983;&#25104;
   <code>
    ReadView
   </code>
   &#21069;&#24050;&#32463;&#25552;&#20132;&#65292;&#25152;&#20197;&#35813;&#29256;&#26412;&#21487;&#20197;&#34987;&#24403;&#21069;&#20107;&#21153;&#35775;&#38382;&#12290;
  </p>
 </li>
 <li>
  <p>
   &#22914;&#26524;&#34987;&#35775;&#38382;&#29256;&#26412;&#30340;
   <code>
    trx_id
   </code>
   &#23646;&#24615;&#20540;&#22823;&#20110;&#25110;&#31561;&#20110;
   <code>
    ReadView
   </code>
   &#20013;&#30340;
   <code>
    max_trx_id
   </code>
   &#20540;&#65292;&#34920;&#26126;&#29983;&#25104;&#35813;&#29256;&#26412;&#30340;&#20107;&#21153;&#22312;&#24403;&#21069;&#20107;&#21153;&#29983;&#25104;
   <code>
    ReadView
   </code>
   &#21518;&#25165;&#24320;&#21551;&#65292;&#25152;&#20197;&#35813;&#29256;&#26412;&#19981;&#21487;&#20197;&#34987;&#24403;&#21069;&#20107;&#21153;&#35775;&#38382;&#12290;
  </p>
 </li>
 <li>
  <p>
   &#22914;&#26524;&#34987;&#35775;&#38382;&#29256;&#26412;&#30340;
   <code>
    trx_id
   </code>
   &#23646;&#24615;&#20540;&#22312;
   <code>
    ReadView
   </code>
   &#30340;
   <code>
    min_trx_id
   </code>
   &#21644;
   <code>
    max_trx_id
   </code>
   &#20043;&#38388;&#65292;&#37027;&#23601;&#38656;&#35201;&#21028;&#26029;&#19968;&#19979;
   <code>
    trx_id
   </code>
   &#23646;&#24615;&#20540;&#26159;&#19981;&#26159;&#22312;
   <code>
    m_ids
   </code>
   &#21015;&#34920;&#20013;&#65292;&#22914;&#26524;&#22312;&#65292;&#35828;&#26126;&#21019;&#24314;
   <code>
    ReadView
   </code>
   &#26102;&#29983;&#25104;&#35813;&#29256;&#26412;&#30340;&#20107;&#21153;&#36824;&#26159;&#27963;&#36291;&#30340;&#65292;&#35813;&#29256;&#26412;&#19981;&#21487;&#20197;&#34987;&#35775;&#38382;&#65307;&#22914;&#26524;&#19981;&#22312;&#65292;&#35828;&#26126;&#21019;&#24314;
   <code>
    ReadView
   </code>
   &#26102;&#29983;&#25104;&#35813;&#29256;&#26412;&#30340;&#20107;&#21153;&#24050;&#32463;&#34987;&#25552;&#20132;&#65292;&#35813;&#29256;&#26412;&#21487;&#20197;&#34987;&#35775;&#38382;&#12290;
  </p>
 </li>
</ul>
<p>
 &#22914;&#26524;&#26576;&#20010;&#29256;&#26412;&#30340;&#25968;&#25454;&#23545;&#24403;&#21069;&#20107;&#21153;&#19981;&#21487;&#35265;&#30340;&#35805;&#65292;&#37027;&#23601;&#39034;&#30528;&#29256;&#26412;&#38142;&#25214;&#21040;&#19979;&#19968;&#20010;&#29256;&#26412;&#30340;&#25968;&#25454;&#65292;&#32487;&#32493;&#25353;&#29031;&#19978;&#36793;&#30340;&#27493;&#39588;&#21028;&#26029;&#21487;&#35265;&#24615;&#65292;&#20381;&#27492;&#31867;&#25512;&#65292;&#30452;&#21040;&#29256;&#26412;&#38142;&#20013;&#30340;&#26368;&#21518;&#19968;&#20010;&#29256;&#26412;&#12290;&#22914;&#26524;&#26368;&#21518;&#19968;&#20010;&#29256;&#26412;&#20063;&#19981;&#21487;&#35265;&#30340;&#35805;&#65292;&#37027;&#20040;&#23601;&#24847;&#21619;&#30528;&#35813;&#26465;&#35760;&#24405;&#23545;&#35813;&#20107;&#21153;&#23436;&#20840;&#19981;&#21487;&#35265;&#65292;&#26597;&#35810;&#32467;&#26524;&#23601;&#19981;&#21253;&#21547;&#35813;&#35760;&#24405;&#12290;
</p>
<p>
 &#22312;
 <code>
  MySQL
 </code>
 &#20013;&#65292;
 <code>
  READ COMMITTED
 </code>
 &#21644;
 <code>
  REPEATABLE READ
 </code>
 &#38548;&#31163;&#32423;&#21035;&#30340;&#30340;&#19968;&#20010;&#38750;&#24120;&#22823;&#30340;&#21306;&#21035;&#23601;&#26159;
 <span>
  &#23427;&#20204;&#29983;&#25104;ReadView&#30340;&#26102;&#26426;&#19981;&#21516;
 </span>
 &#12290;&#25105;&#20204;&#36824;&#26159;&#20197;&#34920;
 <code>
  hero
 </code>
 &#20026;&#20363;&#26469;&#65292;&#20551;&#35774;&#29616;&#22312;&#34920;
 <code>
  hero
 </code>
 &#20013;&#21482;&#26377;&#19968;&#26465;&#30001;
 <code>
  &#20107;&#21153;id
 </code>
 &#20026;
 <code>
  80
 </code>
 &#30340;&#20107;&#21153;&#25554;&#20837;&#30340;&#19968;&#26465;&#35760;&#24405;&#65306;
</p>
<pre><code>mysql&gt; SELECT * FROM hero;
+--------+--------+---------+
| number | name   | country |
+--------+--------+---------+
|      1 | &#21016;&#22791;   | &#34560;      |
+--------+--------+---------+
1 row in set (0.07 sec)
</code></pre>
<p>
 &#25509;&#19979;&#26469;&#30475;&#19968;&#19979;
 <code>
  READ COMMITTED
 </code>
 &#21644;
 <code>
  REPEATABLE READ
 </code>
 &#25152;&#35859;&#30340;
 <span>
  &#29983;&#25104;ReadView&#30340;&#26102;&#26426;&#19981;&#21516;
 </span>
 &#21040;&#24213;&#19981;&#21516;&#22312;&#21738;&#37324;&#12290;
</p>
<h4>
 READ COMMITTED &#8212;&#8212; &#27599;&#27425;&#35835;&#21462;&#25968;&#25454;&#21069;&#37117;&#29983;&#25104;&#19968;&#20010;ReadView
</h4>
<p>
 &#27604;&#26041;&#35828;&#29616;&#22312;&#31995;&#32479;&#37324;&#26377;&#20004;&#20010;
 <code>
  &#20107;&#21153;id
 </code>
 &#20998;&#21035;&#20026;
 <code>
  100
 </code>
 &#12289;
 <code>
  200
 </code>
 &#30340;&#20107;&#21153;&#22312;&#25191;&#34892;&#65306;
</p>
<pre><code># Transaction 100
BEGIN;

UPDATE hero SET name = '&#20851;&#32701;' WHERE number = 1;

UPDATE hero SET name = '&#24352;&#39134;' WHERE number = 1;
</code></pre>
<pre><code># Transaction 200
BEGIN;

# &#26356;&#26032;&#20102;&#19968;&#20123;&#21035;&#30340;&#34920;&#30340;&#35760;&#24405;
...
</code></pre>
<pre><code class="hljs language-!">&#23567;&#36148;&#22763;&#65306;

&#20877;&#27425;&#24378;&#35843;&#19968;&#36941;&#65292;&#20107;&#21153;&#25191;&#34892;&#36807;&#31243;&#20013;&#65292;&#21482;&#26377;&#22312;&#31532;&#19968;&#27425;&#30495;&#27491;&#20462;&#25913;&#35760;&#24405;&#26102;&#65288;&#27604;&#22914;&#20351;&#29992;INSERT&#12289;DELETE&#12289;UPDATE&#35821;&#21477;&#65289;&#65292;&#25165;&#20250;&#34987;&#20998;&#37197;&#19968;&#20010;&#21333;&#29420;&#30340;&#20107;&#21153;id&#65292;&#36825;&#20010;&#20107;&#21153;id&#26159;&#36882;&#22686;&#30340;&#12290;&#25152;&#20197;&#25105;&#20204;&#25165;&#22312;Transaction 200&#20013;&#26356;&#26032;&#19968;&#20123;&#21035;&#30340;&#34920;&#30340;&#35760;&#24405;&#65292;&#30446;&#30340;&#26159;&#35753;&#23427;&#20998;&#37197;&#20107;&#21153;id&#12290;
</code></pre>
<p>
 &#27492;&#21051;&#65292;&#34920;
 <code>
  hero
 </code>
 &#20013;
 <code>
  number
 </code>
 &#20026;
 <code>
  1
 </code>
 &#30340;&#35760;&#24405;&#24471;&#21040;&#30340;&#29256;&#26412;&#38142;&#34920;&#22914;&#19979;&#25152;&#31034;&#65306;
</p>
<p>
 <img alt="image_1d8poeb056ck1d552it4t91aro2d.png-63.7kB" src="EPUB/3e577486-13d6-11ed-838d-acde48001122">
</p>
<p>
 &#20551;&#35774;&#29616;&#22312;&#26377;&#19968;&#20010;&#20351;&#29992;
 <code>
  READ COMMITTED
 </code>
 &#38548;&#31163;&#32423;&#21035;&#30340;&#20107;&#21153;&#24320;&#22987;&#25191;&#34892;&#65306;
</p>
<pre><code># &#20351;&#29992;READ COMMITTED&#38548;&#31163;&#32423;&#21035;&#30340;&#20107;&#21153;
BEGIN;

# SELECT1&#65306;Transaction 100&#12289;200&#26410;&#25552;&#20132;
SELECT * FROM hero WHERE number = 1; # &#24471;&#21040;&#30340;&#21015;name&#30340;&#20540;&#20026;'&#21016;&#22791;'
</code></pre>
<p>
 &#36825;&#20010;
 <code>
  SELECT1
 </code>
 &#30340;&#25191;&#34892;&#36807;&#31243;&#22914;&#19979;&#65306;
</p>
<ul>
 <li>
  <p>
   &#22312;&#25191;&#34892;
   <code>
    SELECT
   </code>
   &#35821;&#21477;&#26102;&#20250;&#20808;&#29983;&#25104;&#19968;&#20010;
   <code>
    ReadView
   </code>
   &#65292;
   <code>
    ReadView
   </code>
   &#30340;
   <code>
    m_ids
   </code>
   &#21015;&#34920;&#30340;&#20869;&#23481;&#23601;&#26159;
   <code>
    [100, 200]
   </code>
   &#65292;
   <code>
    min_trx_id
   </code>
   &#20026;
   <code>
    100
   </code>
   &#65292;
   <code>
    max_trx_id
   </code>
   &#20026;
   <code>
    201
   </code>
   &#65292;
   <code>
    creator_trx_id
   </code>
   &#20026;
   <code>
    0
   </code>
   &#12290;
  </p>
 </li>
 <li>
  <p>
   &#28982;&#21518;&#20174;&#29256;&#26412;&#38142;&#20013;&#25361;&#36873;&#21487;&#35265;&#30340;&#35760;&#24405;&#65292;&#20174;&#22270;&#20013;&#21487;&#20197;&#30475;&#20986;&#65292;&#26368;&#26032;&#29256;&#26412;&#30340;&#21015;
   <code>
    name
   </code>
   &#30340;&#20869;&#23481;&#26159;
   <code>
    '&#24352;&#39134;'
   </code>
   &#65292;&#35813;&#29256;&#26412;&#30340;
   <code>
    trx_id
   </code>
   &#20540;&#20026;
   <code>
    100
   </code>
   &#65292;&#22312;
   <code>
    m_ids
   </code>
   &#21015;&#34920;&#20869;&#65292;&#25152;&#20197;&#19981;&#31526;&#21512;&#21487;&#35265;&#24615;&#35201;&#27714;&#65292;&#26681;&#25454;
   <code>
    roll_pointer
   </code>
   &#36339;&#21040;&#19979;&#19968;&#20010;&#29256;&#26412;&#12290;
  </p>
 </li>
 <li>
  <p>
   &#19979;&#19968;&#20010;&#29256;&#26412;&#30340;&#21015;
   <code>
    name
   </code>
   &#30340;&#20869;&#23481;&#26159;
   <code>
    '&#20851;&#32701;'
   </code>
   &#65292;&#35813;&#29256;&#26412;&#30340;
   <code>
    trx_id
   </code>
   &#20540;&#20063;&#20026;
   <code>
    100
   </code>
   &#65292;&#20063;&#22312;
   <code>
    m_ids
   </code>
   &#21015;&#34920;&#20869;&#65292;&#25152;&#20197;&#20063;&#19981;&#31526;&#21512;&#35201;&#27714;&#65292;&#32487;&#32493;&#36339;&#21040;&#19979;&#19968;&#20010;&#29256;&#26412;&#12290;
  </p>
 </li>
 <li>
  <p>
   &#19979;&#19968;&#20010;&#29256;&#26412;&#30340;&#21015;
   <code>
    name
   </code>
   &#30340;&#20869;&#23481;&#26159;
   <code>
    '&#21016;&#22791;'
   </code>
   &#65292;&#35813;&#29256;&#26412;&#30340;
   <code>
    trx_id
   </code>
   &#20540;&#20026;
   <code>
    80
   </code>
   &#65292;&#23567;&#20110;
   <code>
    ReadView
   </code>
   &#20013;&#30340;
   <code>
    min_trx_id
   </code>
   &#20540;
   <code>
    100
   </code>
   &#65292;&#25152;&#20197;&#36825;&#20010;&#29256;&#26412;&#26159;&#31526;&#21512;&#35201;&#27714;&#30340;&#65292;&#26368;&#21518;&#36820;&#22238;&#32473;&#29992;&#25143;&#30340;&#29256;&#26412;&#23601;&#26159;&#36825;&#26465;&#21015;
   <code>
    name
   </code>
   &#20026;
   <code>
    '&#21016;&#22791;'
   </code>
   &#30340;&#35760;&#24405;&#12290;
  </p>
 </li>
</ul>
<p>
 &#20043;&#21518;&#65292;&#25105;&#20204;&#25226;
 <code>
  &#20107;&#21153;id
 </code>
 &#20026;
 <code>
  100
 </code>
 &#30340;&#20107;&#21153;&#25552;&#20132;&#19968;&#19979;&#65292;&#23601;&#20687;&#36825;&#26679;&#65306;
</p>
<pre><code># Transaction 100
BEGIN;

UPDATE hero SET name = '&#20851;&#32701;' WHERE number = 1;

UPDATE hero SET name = '&#24352;&#39134;' WHERE number = 1;

COMMIT;
</code></pre>
<p>
 &#28982;&#21518;&#20877;&#21040;
 <code>
  &#20107;&#21153;id
 </code>
 &#20026;
 <code>
  200
 </code>
 &#30340;&#20107;&#21153;&#20013;&#26356;&#26032;&#19968;&#19979;&#34920;
 <code>
  hero
 </code>
 &#20013;
 <code>
  number
 </code>
 &#20026;
 <code>
  1
 </code>
 &#30340;&#35760;&#24405;&#65306;
</p>
<pre><code># Transaction 200
BEGIN;

# &#26356;&#26032;&#20102;&#19968;&#20123;&#21035;&#30340;&#34920;&#30340;&#35760;&#24405;
...

UPDATE hero SET name = '&#36213;&#20113;' WHERE number = 1;

UPDATE hero SET name = '&#35832;&#33883;&#20142;' WHERE number = 1;
</code></pre>
<p>
 &#27492;&#21051;&#65292;&#34920;
 <code>
  hero
 </code>
 &#20013;
 <code>
  number
 </code>
 &#20026;
 <code>
  1
 </code>
 &#30340;&#35760;&#24405;&#30340;&#29256;&#26412;&#38142;&#23601;&#38271;&#36825;&#26679;&#65306;
</p>
<p>
 <img alt="image_1d8poudrjdrk4k0i22bj10g82q.png-78.6kB" src="EPUB/3e670ce8-13d6-11ed-838d-acde48001122">
</p>
<p>
 &#28982;&#21518;&#20877;&#21040;&#21018;&#25165;&#20351;&#29992;
 <code>
  READ COMMITTED
 </code>
 &#38548;&#31163;&#32423;&#21035;&#30340;&#20107;&#21153;&#20013;&#32487;&#32493;&#26597;&#25214;&#36825;&#20010;
 <code>
  number
 </code>
 &#20026;
 <code>
  1
 </code>
 &#30340;&#35760;&#24405;&#65292;&#22914;&#19979;&#65306;
</p>
<pre><code># &#20351;&#29992;READ COMMITTED&#38548;&#31163;&#32423;&#21035;&#30340;&#20107;&#21153;
BEGIN;

# SELECT1&#65306;Transaction 100&#12289;200&#22343;&#26410;&#25552;&#20132;
SELECT * FROM hero WHERE number = 1; # &#24471;&#21040;&#30340;&#21015;name&#30340;&#20540;&#20026;'&#21016;&#22791;'

# SELECT2&#65306;Transaction 100&#25552;&#20132;&#65292;Transaction 200&#26410;&#25552;&#20132;
SELECT * FROM hero WHERE number = 1; # &#24471;&#21040;&#30340;&#21015;name&#30340;&#20540;&#20026;'&#24352;&#39134;'
</code></pre>
<p>
 &#36825;&#20010;
 <code>
  SELECT2
 </code>
 &#30340;&#25191;&#34892;&#36807;&#31243;&#22914;&#19979;&#65306;
</p>
<ul>
 <li>
  <p>
   &#22312;&#25191;&#34892;
   <code>
    SELECT
   </code>
   &#35821;&#21477;&#26102;&#20250;
   <span>
    &#21448;&#20250;&#21333;&#29420;&#29983;&#25104;
   </span>
   &#19968;&#20010;
   <code>
    ReadView
   </code>
   &#65292;&#35813;
   <code>
    ReadView
   </code>
   &#30340;
   <code>
    m_ids
   </code>
   &#21015;&#34920;&#30340;&#20869;&#23481;&#23601;&#26159;
   <code>
    [200]
   </code>
   &#65288;
   <code>
    &#20107;&#21153;id
   </code>
   &#20026;
   <code>
    100
   </code>
   &#30340;&#37027;&#20010;&#20107;&#21153;&#24050;&#32463;&#25552;&#20132;&#20102;&#65292;&#25152;&#20197;&#20877;&#27425;&#29983;&#25104;&#24555;&#29031;&#26102;&#23601;&#27809;&#26377;&#23427;&#20102;&#65289;&#65292;
   <code>
    min_trx_id
   </code>
   &#20026;
   <code>
    200
   </code>
   &#65292;
   <code>
    max_trx_id
   </code>
   &#20026;
   <code>
    201
   </code>
   &#65292;
   <code>
    creator_trx_id
   </code>
   &#20026;
   <code>
    0
   </code>
   &#12290;
  </p>
 </li>
 <li>
  <p>
   &#28982;&#21518;&#20174;&#29256;&#26412;&#38142;&#20013;&#25361;&#36873;&#21487;&#35265;&#30340;&#35760;&#24405;&#65292;&#20174;&#22270;&#20013;&#21487;&#20197;&#30475;&#20986;&#65292;&#26368;&#26032;&#29256;&#26412;&#30340;&#21015;
   <code>
    name
   </code>
   &#30340;&#20869;&#23481;&#26159;
   <code>
    '&#35832;&#33883;&#20142;'
   </code>
   &#65292;&#35813;&#29256;&#26412;&#30340;
   <code>
    trx_id
   </code>
   &#20540;&#20026;
   <code>
    200
   </code>
   &#65292;&#22312;
   <code>
    m_ids
   </code>
   &#21015;&#34920;&#20869;&#65292;&#25152;&#20197;&#19981;&#31526;&#21512;&#21487;&#35265;&#24615;&#35201;&#27714;&#65292;&#26681;&#25454;
   <code>
    roll_pointer
   </code>
   &#36339;&#21040;&#19979;&#19968;&#20010;&#29256;&#26412;&#12290;
  </p>
 </li>
 <li>
  <p>
   &#19979;&#19968;&#20010;&#29256;&#26412;&#30340;&#21015;
   <code>
    name
   </code>
   &#30340;&#20869;&#23481;&#26159;
   <code>
    '&#36213;&#20113;'
   </code>
   &#65292;&#35813;&#29256;&#26412;&#30340;
   <code>
    trx_id
   </code>
   &#20540;&#20026;
   <code>
    200
   </code>
   &#65292;&#20063;&#22312;
   <code>
    m_ids
   </code>
   &#21015;&#34920;&#20869;&#65292;&#25152;&#20197;&#20063;&#19981;&#31526;&#21512;&#35201;&#27714;&#65292;&#32487;&#32493;&#36339;&#21040;&#19979;&#19968;&#20010;&#29256;&#26412;&#12290;
  </p>
 </li>
 <li>
  <p>
   &#19979;&#19968;&#20010;&#29256;&#26412;&#30340;&#21015;
   <code>
    name
   </code>
   &#30340;&#20869;&#23481;&#26159;
   <code>
    '&#24352;&#39134;'
   </code>
   &#65292;&#35813;&#29256;&#26412;&#30340;
   <code>
    trx_id
   </code>
   &#20540;&#20026;
   <code>
    100
   </code>
   &#65292;&#23567;&#20110;
   <code>
    ReadView
   </code>
   &#20013;&#30340;
   <code>
    min_trx_id
   </code>
   &#20540;
   <code>
    200
   </code>
   &#65292;&#25152;&#20197;&#36825;&#20010;&#29256;&#26412;&#26159;&#31526;&#21512;&#35201;&#27714;&#30340;&#65292;&#26368;&#21518;&#36820;&#22238;&#32473;&#29992;&#25143;&#30340;&#29256;&#26412;&#23601;&#26159;&#36825;&#26465;&#21015;
   <code>
    name
   </code>
   &#20026;
   <code>
    '&#24352;&#39134;'
   </code>
   &#30340;&#35760;&#24405;&#12290;
  </p>
 </li>
</ul>
<p>
 &#20197;&#27492;&#31867;&#25512;&#65292;&#22914;&#26524;&#20043;&#21518;
 <code>
  &#20107;&#21153;id
 </code>
 &#20026;
 <code>
  200
 </code>
 &#30340;&#35760;&#24405;&#20063;&#25552;&#20132;&#20102;&#65292;&#20877;&#27425;&#22312;&#20351;&#29992;
 <code>
  READ COMMITTED
 </code>
 &#38548;&#31163;&#32423;&#21035;&#30340;&#20107;&#21153;&#20013;&#26597;&#35810;&#34920;
 <code>
  hero
 </code>
 &#20013;
 <code>
  number
 </code>
 &#20540;&#20026;
 <code>
  1
 </code>
 &#30340;&#35760;&#24405;&#26102;&#65292;&#24471;&#21040;&#30340;&#32467;&#26524;&#23601;&#26159;
 <code>
  '&#35832;&#33883;&#20142;'
 </code>
 &#20102;&#65292;&#20855;&#20307;&#27969;&#31243;&#25105;&#20204;&#23601;&#19981;&#20998;&#26512;&#20102;&#12290;&#24635;&#32467;&#19968;&#19979;&#23601;&#26159;&#65306;
 <span>
  &#20351;&#29992;READ COMMITTED&#38548;&#31163;&#32423;&#21035;&#30340;&#20107;&#21153;&#22312;&#27599;&#27425;&#26597;&#35810;&#24320;&#22987;&#26102;&#37117;&#20250;&#29983;&#25104;&#19968;&#20010;&#29420;&#31435;&#30340;ReadView
 </span>
 &#12290;
</p>
<h4>
 REPEATABLE READ &#8212;&#8212; &#22312;&#31532;&#19968;&#27425;&#35835;&#21462;&#25968;&#25454;&#26102;&#29983;&#25104;&#19968;&#20010;ReadView
</h4>
<p>
 &#23545;&#20110;&#20351;&#29992;
 <code>
  REPEATABLE READ
 </code>
 &#38548;&#31163;&#32423;&#21035;&#30340;&#20107;&#21153;&#26469;&#35828;&#65292;&#21482;&#20250;&#22312;&#31532;&#19968;&#27425;&#25191;&#34892;&#26597;&#35810;&#35821;&#21477;&#26102;&#29983;&#25104;&#19968;&#20010;
 <code>
  ReadView
 </code>
 &#65292;&#20043;&#21518;&#30340;&#26597;&#35810;&#23601;&#19981;&#20250;&#37325;&#22797;&#29983;&#25104;&#20102;&#12290;&#25105;&#20204;&#36824;&#26159;&#29992;&#20363;&#23376;&#30475;&#19968;&#19979;&#26159;&#20160;&#20040;&#25928;&#26524;&#12290;
</p>
<p>
 &#27604;&#26041;&#35828;&#29616;&#22312;&#31995;&#32479;&#37324;&#26377;&#20004;&#20010;
 <code>
  &#20107;&#21153;id
 </code>
 &#20998;&#21035;&#20026;
 <code>
  100
 </code>
 &#12289;
 <code>
  200
 </code>
 &#30340;&#20107;&#21153;&#22312;&#25191;&#34892;&#65306;
</p>
<pre><code># Transaction 100
BEGIN;

UPDATE hero SET name = '&#20851;&#32701;' WHERE number = 1;

UPDATE hero SET name = '&#24352;&#39134;' WHERE number = 1;
</code></pre>
<pre><code># Transaction 200
BEGIN;

# &#26356;&#26032;&#20102;&#19968;&#20123;&#21035;&#30340;&#34920;&#30340;&#35760;&#24405;
...
</code></pre>
<p>
 &#27492;&#21051;&#65292;&#34920;
 <code>
  hero
 </code>
 &#20013;
 <code>
  number
 </code>
 &#20026;
 <code>
  1
 </code>
 &#30340;&#35760;&#24405;&#24471;&#21040;&#30340;&#29256;&#26412;&#38142;&#34920;&#22914;&#19979;&#25152;&#31034;&#65306;
</p>
<p>
 <img alt="image_1d8pt2nd6moqtjn12hibgj91f37.png-60.9kB" src="EPUB/3e761bfc-13d6-11ed-838d-acde48001122">
</p>
<p>
 &#20551;&#35774;&#29616;&#22312;&#26377;&#19968;&#20010;&#20351;&#29992;
 <code>
  REPEATABLE READ
 </code>
 &#38548;&#31163;&#32423;&#21035;&#30340;&#20107;&#21153;&#24320;&#22987;&#25191;&#34892;&#65306;
</p>
<pre><code># &#20351;&#29992;REPEATABLE READ&#38548;&#31163;&#32423;&#21035;&#30340;&#20107;&#21153;
BEGIN;

# SELECT1&#65306;Transaction 100&#12289;200&#26410;&#25552;&#20132;
SELECT * FROM hero WHERE number = 1; # &#24471;&#21040;&#30340;&#21015;name&#30340;&#20540;&#20026;'&#21016;&#22791;'
</code></pre>
<p>
 &#36825;&#20010;
 <code>
  SELECT1
 </code>
 &#30340;&#25191;&#34892;&#36807;&#31243;&#22914;&#19979;&#65306;
</p>
<ul>
 <li>
  <p>
   &#22312;&#25191;&#34892;
   <code>
    SELECT
   </code>
   &#35821;&#21477;&#26102;&#20250;&#20808;&#29983;&#25104;&#19968;&#20010;
   <code>
    ReadView
   </code>
   &#65292;
   <code>
    ReadView
   </code>
   &#30340;
   <code>
    m_ids
   </code>
   &#21015;&#34920;&#30340;&#20869;&#23481;&#23601;&#26159;
   <code>
    [100, 200]
   </code>
   &#65292;
   <code>
    min_trx_id
   </code>
   &#20026;
   <code>
    100
   </code>
   &#65292;
   <code>
    max_trx_id
   </code>
   &#20026;
   <code>
    201
   </code>
   &#65292;
   <code>
    creator_trx_id
   </code>
   &#20026;
   <code>
    0
   </code>
   &#12290;
  </p>
 </li>
 <li>
  <p>
   &#28982;&#21518;&#20174;&#29256;&#26412;&#38142;&#20013;&#25361;&#36873;&#21487;&#35265;&#30340;&#35760;&#24405;&#65292;&#20174;&#22270;&#20013;&#21487;&#20197;&#30475;&#20986;&#65292;&#26368;&#26032;&#29256;&#26412;&#30340;&#21015;
   <code>
    name
   </code>
   &#30340;&#20869;&#23481;&#26159;
   <code>
    '&#24352;&#39134;'
   </code>
   &#65292;&#35813;&#29256;&#26412;&#30340;
   <code>
    trx_id
   </code>
   &#20540;&#20026;
   <code>
    100
   </code>
   &#65292;&#22312;
   <code>
    m_ids
   </code>
   &#21015;&#34920;&#20869;&#65292;&#25152;&#20197;&#19981;&#31526;&#21512;&#21487;&#35265;&#24615;&#35201;&#27714;&#65292;&#26681;&#25454;
   <code>
    roll_pointer
   </code>
   &#36339;&#21040;&#19979;&#19968;&#20010;&#29256;&#26412;&#12290;
  </p>
 </li>
 <li>
  <p>
   &#19979;&#19968;&#20010;&#29256;&#26412;&#30340;&#21015;
   <code>
    name
   </code>
   &#30340;&#20869;&#23481;&#26159;
   <code>
    '&#20851;&#32701;'
   </code>
   &#65292;&#35813;&#29256;&#26412;&#30340;
   <code>
    trx_id
   </code>
   &#20540;&#20063;&#20026;
   <code>
    100
   </code>
   &#65292;&#20063;&#22312;
   <code>
    m_ids
   </code>
   &#21015;&#34920;&#20869;&#65292;&#25152;&#20197;&#20063;&#19981;&#31526;&#21512;&#35201;&#27714;&#65292;&#32487;&#32493;&#36339;&#21040;&#19979;&#19968;&#20010;&#29256;&#26412;&#12290;
  </p>
 </li>
 <li>
  <p>
   &#19979;&#19968;&#20010;&#29256;&#26412;&#30340;&#21015;
   <code>
    name
   </code>
   &#30340;&#20869;&#23481;&#26159;
   <code>
    '&#21016;&#22791;'
   </code>
   &#65292;&#35813;&#29256;&#26412;&#30340;
   <code>
    trx_id
   </code>
   &#20540;&#20026;
   <code>
    80
   </code>
   &#65292;&#23567;&#20110;
   <code>
    ReadView
   </code>
   &#20013;&#30340;
   <code>
    min_trx_id
   </code>
   &#20540;
   <code>
    100
   </code>
   &#65292;&#25152;&#20197;&#36825;&#20010;&#29256;&#26412;&#26159;&#31526;&#21512;&#35201;&#27714;&#30340;&#65292;&#26368;&#21518;&#36820;&#22238;&#32473;&#29992;&#25143;&#30340;&#29256;&#26412;&#23601;&#26159;&#36825;&#26465;&#21015;
   <code>
    name
   </code>
   &#20026;
   <code>
    '&#21016;&#22791;'
   </code>
   &#30340;&#35760;&#24405;&#12290;
  </p>
 </li>
</ul>
<p>
 &#20043;&#21518;&#65292;&#25105;&#20204;&#25226;
 <code>
  &#20107;&#21153;id
 </code>
 &#20026;
 <code>
  100
 </code>
 &#30340;&#20107;&#21153;&#25552;&#20132;&#19968;&#19979;&#65292;&#23601;&#20687;&#36825;&#26679;&#65306;
</p>
<pre><code># Transaction 100
BEGIN;

UPDATE hero SET name = '&#20851;&#32701;' WHERE number = 1;

UPDATE hero SET name = '&#24352;&#39134;' WHERE number = 1;

COMMIT;
</code></pre>
<p>
 &#28982;&#21518;&#20877;&#21040;
 <code>
  &#20107;&#21153;id
 </code>
 &#20026;
 <code>
  200
 </code>
 &#30340;&#20107;&#21153;&#20013;&#26356;&#26032;&#19968;&#19979;&#34920;
 <code>
  hero
 </code>
 &#20013;
 <code>
  number
 </code>
 &#20026;
 <code>
  1
 </code>
 &#30340;&#35760;&#24405;&#65306;
</p>
<pre><code># Transaction 200
BEGIN;

# &#26356;&#26032;&#20102;&#19968;&#20123;&#21035;&#30340;&#34920;&#30340;&#35760;&#24405;
...

UPDATE hero SET name = '&#36213;&#20113;' WHERE number = 1;

UPDATE hero SET name = '&#35832;&#33883;&#20142;' WHERE number = 1;
</code></pre>
<p>
 &#27492;&#21051;&#65292;&#34920;
 <code>
  hero
 </code>
 &#20013;
 <code>
  number
 </code>
 &#20026;
 <code>
  1
 </code>
 &#30340;&#35760;&#24405;&#30340;&#29256;&#26412;&#38142;&#23601;&#38271;&#36825;&#26679;&#65306;
</p>
<p>
 <img alt="image_1d8ptbc339kdk0b1du3nef6s03k.png-78.2kB" src="EPUB/3e8427a6-13d6-11ed-838d-acde48001122">
</p>
<p>
 &#28982;&#21518;&#20877;&#21040;&#21018;&#25165;&#20351;&#29992;
 <code>
  REPEATABLE READ
 </code>
 &#38548;&#31163;&#32423;&#21035;&#30340;&#20107;&#21153;&#20013;&#32487;&#32493;&#26597;&#25214;&#36825;&#20010;
 <code>
  number
 </code>
 &#20026;
 <code>
  1
 </code>
 &#30340;&#35760;&#24405;&#65292;&#22914;&#19979;&#65306;
</p>
<pre><code># &#20351;&#29992;REPEATABLE READ&#38548;&#31163;&#32423;&#21035;&#30340;&#20107;&#21153;
BEGIN;

# SELECT1&#65306;Transaction 100&#12289;200&#22343;&#26410;&#25552;&#20132;
SELECT * FROM hero WHERE number = 1; # &#24471;&#21040;&#30340;&#21015;name&#30340;&#20540;&#20026;'&#21016;&#22791;'

# SELECT2&#65306;Transaction 100&#25552;&#20132;&#65292;Transaction 200&#26410;&#25552;&#20132;
SELECT * FROM hero WHERE number = 1; # &#24471;&#21040;&#30340;&#21015;name&#30340;&#20540;&#20173;&#20026;'&#21016;&#22791;'
</code></pre>
<p>
 &#36825;&#20010;
 <code>
  SELECT2
 </code>
 &#30340;&#25191;&#34892;&#36807;&#31243;&#22914;&#19979;&#65306;
</p>
<ul>
 <li>
  <p>
   &#22240;&#20026;&#24403;&#21069;&#20107;&#21153;&#30340;&#38548;&#31163;&#32423;&#21035;&#20026;
   <code>
    REPEATABLE READ
   </code>
   &#65292;&#32780;&#20043;&#21069;&#22312;&#25191;&#34892;
   <code>
    SELECT1
   </code>
   &#26102;&#24050;&#32463;&#29983;&#25104;&#36807;
   <code>
    ReadView
   </code>
   &#20102;&#65292;&#25152;&#20197;&#27492;&#26102;&#30452;&#25509;&#22797;&#29992;&#20043;&#21069;&#30340;
   <code>
    ReadView
   </code>
   &#65292;&#20043;&#21069;&#30340;
   <code>
    ReadView
   </code>
   &#30340;
   <code>
    m_ids
   </code>
   &#21015;&#34920;&#30340;&#20869;&#23481;&#23601;&#26159;
   <code>
    [100, 200]
   </code>
   &#65292;
   <code>
    min_trx_id
   </code>
   &#20026;
   <code>
    100
   </code>
   &#65292;
   <code>
    max_trx_id
   </code>
   &#20026;
   <code>
    201
   </code>
   &#65292;
   <code>
    creator_trx_id
   </code>
   &#20026;
   <code>
    0
   </code>
   &#12290;
  </p>
 </li>
 <li>
  <p>
   &#28982;&#21518;&#20174;&#29256;&#26412;&#38142;&#20013;&#25361;&#36873;&#21487;&#35265;&#30340;&#35760;&#24405;&#65292;&#20174;&#22270;&#20013;&#21487;&#20197;&#30475;&#20986;&#65292;&#26368;&#26032;&#29256;&#26412;&#30340;&#21015;
   <code>
    name
   </code>
   &#30340;&#20869;&#23481;&#26159;
   <code>
    '&#35832;&#33883;&#20142;'
   </code>
   &#65292;&#35813;&#29256;&#26412;&#30340;
   <code>
    trx_id
   </code>
   &#20540;&#20026;
   <code>
    200
   </code>
   &#65292;&#22312;
   <code>
    m_ids
   </code>
   &#21015;&#34920;&#20869;&#65292;&#25152;&#20197;&#19981;&#31526;&#21512;&#21487;&#35265;&#24615;&#35201;&#27714;&#65292;&#26681;&#25454;
   <code>
    roll_pointer
   </code>
   &#36339;&#21040;&#19979;&#19968;&#20010;&#29256;&#26412;&#12290;
  </p>
 </li>
 <li>
  <p>
   &#19979;&#19968;&#20010;&#29256;&#26412;&#30340;&#21015;
   <code>
    name
   </code>
   &#30340;&#20869;&#23481;&#26159;
   <code>
    '&#36213;&#20113;'
   </code>
   &#65292;&#35813;&#29256;&#26412;&#30340;
   <code>
    trx_id
   </code>
   &#20540;&#20026;
   <code>
    200
   </code>
   &#65292;&#20063;&#22312;
   <code>
    m_ids
   </code>
   &#21015;&#34920;&#20869;&#65292;&#25152;&#20197;&#20063;&#19981;&#31526;&#21512;&#35201;&#27714;&#65292;&#32487;&#32493;&#36339;&#21040;&#19979;&#19968;&#20010;&#29256;&#26412;&#12290;
  </p>
 </li>
 <li>
  <p>
   &#19979;&#19968;&#20010;&#29256;&#26412;&#30340;&#21015;
   <code>
    name
   </code>
   &#30340;&#20869;&#23481;&#26159;
   <code>
    '&#24352;&#39134;'
   </code>
   &#65292;&#35813;&#29256;&#26412;&#30340;
   <code>
    trx_id
   </code>
   &#20540;&#20026;
   <code>
    100
   </code>
   &#65292;&#32780;
   <code>
    m_ids
   </code>
   &#21015;&#34920;&#20013;&#26159;&#21253;&#21547;&#20540;&#20026;
   <code>
    100
   </code>
   &#30340;
   <code>
    &#20107;&#21153;id
   </code>
   &#30340;&#65292;&#25152;&#20197;&#35813;&#29256;&#26412;&#20063;&#19981;&#31526;&#21512;&#35201;&#27714;&#65292;&#21516;&#29702;&#19979;&#19968;&#20010;&#21015;
   <code>
    name
   </code>
   &#30340;&#20869;&#23481;&#26159;
   <code>
    '&#20851;&#32701;'
   </code>
   &#30340;&#29256;&#26412;&#20063;&#19981;&#31526;&#21512;&#35201;&#27714;&#12290;&#32487;&#32493;&#36339;&#21040;&#19979;&#19968;&#20010;&#29256;&#26412;&#12290;
  </p>
 </li>
 <li>
  <p>
   &#19979;&#19968;&#20010;&#29256;&#26412;&#30340;&#21015;
   <code>
    name
   </code>
   &#30340;&#20869;&#23481;&#26159;
   <code>
    '&#21016;&#22791;'
   </code>
   &#65292;&#35813;&#29256;&#26412;&#30340;
   <code>
    trx_id
   </code>
   &#20540;&#20026;
   <code>
    80
   </code>
   &#65292;&#23567;&#20110;
   <code>
    ReadView
   </code>
   &#20013;&#30340;
   <code>
    min_trx_id
   </code>
   &#20540;
   <code>
    100
   </code>
   &#65292;&#25152;&#20197;&#36825;&#20010;&#29256;&#26412;&#26159;&#31526;&#21512;&#35201;&#27714;&#30340;&#65292;&#26368;&#21518;&#36820;&#22238;&#32473;&#29992;&#25143;&#30340;&#29256;&#26412;&#23601;&#26159;&#36825;&#26465;&#21015;
   <code>
    c
   </code>
   &#20026;
   <code>
    '&#21016;&#22791;'
   </code>
   &#30340;&#35760;&#24405;&#12290;
  </p>
 </li>
</ul>
<p>
 &#20063;&#23601;&#26159;&#35828;&#20004;&#27425;
 <code>
  SELECT
 </code>
 &#26597;&#35810;&#24471;&#21040;&#30340;&#32467;&#26524;&#26159;&#37325;&#22797;&#30340;&#65292;&#35760;&#24405;&#30340;&#21015;
 <code>
  c
 </code>
 &#20540;&#37117;&#26159;
 <code>
  '&#21016;&#22791;'
 </code>
 &#65292;&#36825;&#23601;&#26159;
 <code>
  &#21487;&#37325;&#22797;&#35835;
 </code>
 &#30340;&#21547;&#20041;&#12290;&#22914;&#26524;&#25105;&#20204;&#20043;&#21518;&#20877;&#25226;
 <code>
  &#20107;&#21153;id
 </code>
 &#20026;
 <code>
  200
 </code>
 &#30340;&#35760;&#24405;&#25552;&#20132;&#20102;&#65292;&#28982;&#21518;&#20877;&#21040;&#21018;&#25165;&#20351;&#29992;
 <code>
  REPEATABLE READ
 </code>
 &#38548;&#31163;&#32423;&#21035;&#30340;&#20107;&#21153;&#20013;&#32487;&#32493;&#26597;&#25214;&#36825;&#20010;
 <code>
  number
 </code>
 &#20026;
 <code>
  1
 </code>
 &#30340;&#35760;&#24405;&#65292;&#24471;&#21040;&#30340;&#32467;&#26524;&#36824;&#26159;
 <code>
  '&#21016;&#22791;'
 </code>
 &#65292;&#20855;&#20307;&#25191;&#34892;&#36807;&#31243;&#22823;&#23478;&#21487;&#20197;&#33258;&#24049;&#20998;&#26512;&#19968;&#19979;&#12290;
</p>
<h3>
 MVCC&#23567;&#32467;
</h3>
<p>
 &#20174;&#19978;&#36793;&#30340;&#25551;&#36848;&#20013;&#25105;&#20204;&#21487;&#20197;&#30475;&#20986;&#26469;&#65292;&#25152;&#35859;&#30340;
 <code>
  MVCC
 </code>
 &#65288;Multi-Version Concurrency Control &#65292;&#22810;&#29256;&#26412;&#24182;&#21457;&#25511;&#21046;&#65289;&#25351;&#30340;&#23601;&#26159;&#22312;&#20351;&#29992;
 <code>
  READ COMMITTD
 </code>
 &#12289;
 <code>
  REPEATABLE READ
 </code>
 &#36825;&#20004;&#31181;&#38548;&#31163;&#32423;&#21035;&#30340;&#20107;&#21153;&#22312;&#25191;&#34892;&#26222;&#36890;&#30340;
 <code>
  SELECT
 </code>
 &#25805;&#20316;&#26102;&#35775;&#38382;&#35760;&#24405;&#30340;&#29256;&#26412;&#38142;&#30340;&#36807;&#31243;&#65292;&#36825;&#26679;&#23376;&#21487;&#20197;&#20351;&#19981;&#21516;&#20107;&#21153;&#30340;
 <code>
  &#35835;-&#20889;
 </code>
 &#12289;
 <code>
  &#20889;-&#35835;
 </code>
 &#25805;&#20316;&#24182;&#21457;&#25191;&#34892;&#65292;&#20174;&#32780;&#25552;&#21319;&#31995;&#32479;&#24615;&#33021;&#12290;
 <code>
  READ COMMITTD
 </code>
 &#12289;
 <code>
  REPEATABLE READ
 </code>
 &#36825;&#20004;&#20010;&#38548;&#31163;&#32423;&#21035;&#30340;&#19968;&#20010;&#24456;&#22823;&#19981;&#21516;&#23601;&#26159;&#65306;
 <span>
  &#29983;&#25104;ReadView&#30340;&#26102;&#26426;&#19981;&#21516;&#65292;READ COMMITTD&#22312;&#27599;&#19968;&#27425;&#36827;&#34892;&#26222;&#36890;SELECT&#25805;&#20316;&#21069;&#37117;&#20250;&#29983;&#25104;&#19968;&#20010;ReadView&#65292;&#32780;REPEATABLE READ&#21482;&#22312;&#31532;&#19968;&#27425;&#36827;&#34892;&#26222;&#36890;SELECT&#25805;&#20316;&#21069;&#29983;&#25104;&#19968;&#20010;ReadView&#65292;&#20043;&#21518;&#30340;&#26597;&#35810;&#25805;&#20316;&#37117;&#37325;&#22797;&#20351;&#29992;&#36825;&#20010;ReadView&#23601;&#22909;&#20102;
 </span>
 &#12290;
</p>
<pre><code class="hljs language-!">&#23567;&#36148;&#22763;&#65306;

&#25105;&#20204;&#20043;&#21069;&#35828;&#25191;&#34892;DELETE&#35821;&#21477;&#25110;&#32773;&#26356;&#26032;&#20027;&#38190;&#30340;UPDATE&#35821;&#21477;&#24182;&#19981;&#20250;&#31435;&#21363;&#25226;&#23545;&#24212;&#30340;&#35760;&#24405;&#23436;&#20840;&#20174;&#39029;&#38754;&#20013;&#21024;&#38500;&#65292;&#32780;&#26159;&#25191;&#34892;&#19968;&#20010;&#25152;&#35859;&#30340;delete mark&#25805;&#20316;&#65292;&#30456;&#24403;&#20110;&#21482;&#26159;&#23545;&#35760;&#24405;&#25171;&#19978;&#20102;&#19968;&#20010;&#21024;&#38500;&#26631;&#24535;&#20301;&#65292;&#36825;&#20027;&#35201;&#23601;&#26159;&#20026;MVCC&#26381;&#21153;&#30340;&#65292;&#22823;&#23478;&#21487;&#20197;&#23545;&#27604;&#19978;&#36793;&#20030;&#30340;&#20363;&#23376;&#33258;&#24049;&#35797;&#24819;&#19968;&#19979;&#24590;&#20040;&#20351;&#29992;&#12290;

&#21478;&#22806;&#65292;&#25152;&#35859;&#30340;MVCC&#21482;&#26159;&#22312;&#25105;&#20204;&#36827;&#34892;&#26222;&#36890;&#30340;SEELCT&#26597;&#35810;&#26102;&#25165;&#29983;&#25928;&#65292;&#25130;&#27490;&#21040;&#30446;&#21069;&#25105;&#20204;&#25152;&#35265;&#30340;&#25152;&#26377;SELECT&#35821;&#21477;&#37117;&#31639;&#26159;&#26222;&#36890;&#30340;&#26597;&#35810;&#65292;&#33267;&#20110;&#21861;&#26159;&#20010;&#19981;&#26222;&#36890;&#30340;&#26597;&#35810;&#65292;&#25105;&#20204;&#31245;&#21518;&#20877;&#35828;&#21704;&#65374;
</code></pre>
<h2>
 &#20851;&#20110;purge
</h2>
<p>
 &#22823;&#23478;&#26377;&#27809;&#26377;&#21457;&#29616;&#20004;&#20214;&#20107;&#20799;&#65306;
</p>
<ul>
 <li>
  <p>
   &#25105;&#20204;&#35828;
   <code>
    insert undo
   </code>
   &#22312;&#20107;&#21153;&#25552;&#20132;&#20043;&#21518;&#23601;&#21487;&#20197;&#34987;&#37322;&#25918;&#25481;&#20102;&#65292;&#32780;
   <code>
    update undo
   </code>
   &#30001;&#20110;&#36824;&#38656;&#35201;&#25903;&#25345;
   <code>
    MVCC
   </code>
   &#65292;&#19981;&#33021;&#31435;&#21363;&#21024;&#38500;&#25481;&#12290;
  </p>
 </li>
 <li>
  <p>
   &#20026;&#20102;&#25903;&#25345;
   <code>
    MVCC
   </code>
   &#65292;&#23545;&#20110;
   <code>
    delete mark
   </code>
   &#25805;&#20316;&#26469;&#35828;&#65292;&#20165;&#20165;&#26159;&#22312;&#35760;&#24405;&#19978;&#25171;&#19968;&#20010;&#21024;&#38500;&#26631;&#35760;&#65292;&#24182;&#27809;&#26377;&#30495;&#27491;&#23558;&#23427;&#21024;&#38500;&#25481;&#12290;
  </p>
 </li>
</ul>
<p>
 &#38543;&#30528;&#31995;&#32479;&#30340;&#36816;&#34892;&#65292;&#22312;&#30830;&#23450;&#31995;&#32479;&#20013;&#21253;&#21547;&#26368;&#26089;&#20135;&#29983;&#30340;&#37027;&#20010;
 <code>
  ReadView
 </code>
 &#30340;&#20107;&#21153;&#19981;&#20250;&#20877;&#35775;&#38382;&#26576;&#20123;
 <code>
  update undo&#26085;&#24535;
 </code>
 &#20197;&#21450;&#34987;&#25171;&#20102;&#21024;&#38500;&#26631;&#35760;&#30340;&#35760;&#24405;&#21518;&#65292;&#26377;&#19968;&#20010;&#21518;&#21488;&#36816;&#34892;&#30340;
 <code>
  purge&#32447;&#31243;
 </code>
 &#20250;&#25226;&#23427;&#20204;&#30495;&#27491;&#30340;&#21024;&#38500;&#25481;&#12290;&#20851;&#20110;&#26356;&#22810;&#30340;purge&#32454;&#33410;&#65292;&#25105;&#20204;&#23558;&#25918;&#21040;&#32440;&#36136;&#20070;&#20013;&#36827;&#34892;&#35814;&#32454;&#21792;&#21480;&#65292;&#19981;&#35265;&#19981;&#25955;&#21704;&#65374;
</p>
</div>

</div>
</div>

        </body>
        
        