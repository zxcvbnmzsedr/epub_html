
        <html lang="en">
        <head>
        <meta charset="UTF-8"/>
        </head>
        <body>
        <div><div class="markdown-body">
    <h1>&#19987;&#39064;&#24335;&#35762;&#35299; &#8212;&#8212; &#20004;&#26465;&#19968;&#26679;&#30340;INSERT&#35821;&#21477;&#31455;&#28982;&#24341;&#21457;&#20102;&#27515;&#38145;&#65311;</h1>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="style/style.css" type="text/css">

<div class="markdown-body">
    <h1>
 &#20004;&#26465;&#19968;&#26679;&#30340;INSERT&#35821;&#21477;&#31455;&#28982;&#24341;&#21457;&#20102;&#27515;&#38145;&#65311;
</h1>
<p>
 &#26631;&#31614;&#65306; MySQL&#26159;&#24590;&#26679;&#36816;&#34892;&#30340;
</p>
<hr>
<p>
 &#20004;&#26465;&#19968;&#26679;&#30340;INSERT&#35821;&#21477;&#31455;&#28982;&#24341;&#21457;&#20102;&#27515;&#38145;&#65292;&#36825;&#31350;&#31455;&#26159;&#20154;&#24615;&#30340;&#25197;&#26354;&#65292;&#36824;&#26159;&#36947;&#24503;&#30340;&#27814;&#20007;&#65292;&#35753;&#25105;&#20204;&#19981;&#31105;&#24863;&#21497;&#19968;&#21477;&#65306;&#21351;&#27133;&#65281;&#36825;&#20063;&#33021;&#27515;&#38145;&#65292;&#28982;&#21518;&#30524;&#20013;&#21547;&#30528;&#24754;&#20652;&#30340;&#27882;&#27700;&#26080;&#22856;&#30340;&#25913;&#36215;&#20102;&#19994;&#21153;&#20195;&#30721;&#12290;
</p>
<p>
 &#22909;&#30340;&#65292;&#22312;&#28145;&#20837;&#20998;&#26512;&#20026;&#21861;&#20004;&#26465;&#19968;&#26679;&#30340;INSERT&#35821;&#21477;&#20063;&#20250;&#20135;&#29983;&#27515;&#38145;&#20043;&#21069;&#65292;&#25105;&#20204;&#20808;&#20171;&#32461;&#19968;&#20123;&#22522;&#30784;&#30693;&#35782;&#12290;
</p>
<h2>
 &#20934;&#22791;&#19968;&#19979;&#29615;&#22659;
</h2>
<p>
 &#20026;&#20102;&#25925;&#20107;&#30340;&#39034;&#21033;&#21457;&#23637;&#65292;&#25105;&#20204;&#26032;&#24314;&#19968;&#20010;&#29992;&#20102;&#26080;&#25968;&#27425;&#30340;
 <code>
  hero
 </code>
 &#34920;&#65306;
</p>
<pre><code>CREATE TABLE hero (
    number INT AUTO_INCREMENT,
    name VARCHAR(100),
    country varchar(100),
    PRIMARY KEY (number),
    UNIQUE KEY uk_name (name)
) Engine=InnoDB CHARSET=utf8;
</code></pre>
<p>
 &#28982;&#21518;&#21521;&#36825;&#20010;&#34920;&#37324;&#25554;&#20837;&#20960;&#26465;&#35760;&#24405;&#65306;
</p>
<pre><code>INSERT INTO hero VALUES
    (1, 'l&#21016;&#22791;', '&#34560;'),
    (3, 'z&#35832;&#33883;&#20142;', '&#34560;'),
    (8, 'c&#26361;&#25805;', '&#39759;'),
    (15, 'x&#33600;&#24423;', '&#39759;'),
    (20, 's&#23385;&#26435;', '&#21556;');
</code></pre>
<p>
 &#29616;&#22312;
 <code>
  hero
 </code>
 &#34920;&#23601;&#26377;&#20102;&#20004;&#20010;&#32034;&#24341;&#65288;&#19968;&#20010;&#21807;&#19968;&#20108;&#32423;&#32034;&#24341;&#65292;&#19968;&#20010;&#32858;&#31751;&#32034;&#24341;&#65289;&#65292;&#31034;&#24847;&#22270;&#22914;&#19979;&#65306;
</p>
<p>
 <img alt="" src="EPUB/4e41d9a4-13d6-11ed-838d-acde48001122">
</p>
<h2>
 INSERT&#35821;&#21477;&#22914;&#20309;&#21152;&#38145;
</h2>
<p>
 &#35835;&#36807;&#12298;MySQL&#26159;&#24590;&#26679;&#36816;&#34892;&#30340;&#65306;&#20174;&#26681;&#20799;&#19978;&#29702;&#35299;MySQL&#12299;&#30340;&#23567;&#20249;&#20276;&#32943;&#23450;&#30693;&#36947;&#65292;INSERT&#35821;&#21477;&#22312;&#27491;&#24120;&#25191;&#34892;&#26102;&#26159;&#19981;&#20250;&#29983;&#25104;&#38145;&#32467;&#26500;&#30340;&#65292;&#23427;&#26159;&#38752;&#32858;&#31751;&#32034;&#24341;&#35760;&#24405;&#33258;&#24102;&#30340;
 <code>
  trx_id
 </code>
 &#38544;&#34255;&#21015;&#26469;&#20316;&#20026;&#38544;&#24335;&#38145;&#26469;&#20445;&#25252;&#35760;&#24405;&#30340;&#12290;
</p>
<p>
 &#20294;&#26159;&#22312;&#19968;&#20123;&#29305;&#27530;&#22330;&#26223;&#19979;&#65292;INSERT&#35821;&#21477;&#36824;&#26159;&#20250;&#29983;&#25104;&#38145;&#32467;&#26500;&#30340;&#65292;&#25105;&#20204;&#21015;&#20030;&#19968;&#19979;&#65306;
</p>
<h3>
 1. &#24453;&#25554;&#20837;&#35760;&#24405;&#30340;&#19979;&#19968;&#26465;&#35760;&#24405;&#19978;&#24050;&#32463;&#34987;&#20854;&#20182;&#20107;&#21153;&#21152;&#20102;gap&#38145;&#26102;
</h3>
<p>
 &#27599;&#25554;&#20837;&#19968;&#26465;&#26032;&#35760;&#24405;&#65292;&#37117;&#38656;&#35201;&#30475;&#19968;&#19979;&#24453;&#25554;&#20837;&#35760;&#24405;&#30340;&#19979;&#19968;&#26465;&#35760;&#24405;&#19978;&#26159;&#21542;&#24050;&#32463;&#34987;&#21152;&#20102;gap&#38145;&#65292;&#22914;&#26524;&#24050;&#21152;gap&#38145;&#65292;&#37027;INSERT&#35821;&#21477;&#24212;&#35813;&#34987;&#38459;&#22622;&#65292;&#24182;&#29983;&#25104;&#19968;&#20010;
 <code>
  &#25554;&#20837;&#24847;&#21521;&#38145;
 </code>
 &#12290;
</p>
<p>
 &#27604;&#26041;&#35828;&#23545;&#20110;hero&#34920;&#26469;&#35828;&#65292;&#20107;&#21153;T1&#36816;&#34892;&#22312;
 <code>
  REPEATABLE READ
 </code>
 &#65288;&#21518;&#32493;&#31616;&#31216;&#20026;RR&#65292;&#21518;&#32493;&#20063;&#20250;&#25226;READ COMMITTED&#31616;&#31216;&#20026;RC&#65289;&#38548;&#31163;&#32423;&#21035;&#20013;&#65292;&#25191;&#34892;&#20102;&#19979;&#36793;&#30340;&#35821;&#21477;&#65306;
</p>
<pre><code># &#20107;&#21153;T1
mysql&gt; BEGIN;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; SELECT * FROM hero WHERE number &lt; 8 FOR UPDATE;
+--------+------------+---------+
| number | name       | country |
+--------+------------+---------+
|      1 | l&#21016;&#22791;      | &#34560;      |
|      3 | z&#35832;&#33883;&#20142;    | &#34560;      |
+--------+------------+---------+
2 rows in set (0.02 sec)
</code></pre>
<p>
 &#36825;&#26465;&#35821;&#21477;&#20250;&#23545;&#20027;&#38190;&#20540;&#20026;1&#12289;3&#12289;8&#30340;&#36825;3&#26465;&#35760;&#24405;&#37117;&#28155;&#21152;X&#22411;
 <code>
  next-key
 </code>
 &#38145;&#65292;&#19981;&#20449;&#30340;&#35805;&#25105;&#20204;&#20351;&#29992;SHOW ENGINE INNODB STATUS&#35821;&#21477;&#30475;&#19968;&#19979;&#21152;&#38145;&#24773;&#20917;&#65292;&#22270;&#20013;&#31661;&#22836;&#25351;&#21521;&#30340;&#35760;&#24405;&#23601;&#26159;number&#20540;&#20026;8&#30340;&#35760;&#24405;&#65306;
</p>
<p>
 <img alt="" src="EPUB/4e512076-13d6-11ed-838d-acde48001122">
</p>
<blockquote>
 <p>
  &#23567;&#36148;&#22763;&#65306;
  <br>
  <br>
  &#33267;&#20110;SELECT&#12289;DELETE&#12289;UPDATE&#35821;&#21477;&#22914;&#20309;&#21152;&#38145;&#65292;&#25105;&#20204;&#24050;&#32463;&#22312;&#20043;&#21069;&#30340;&#25991;&#31456;&#20013;&#20998;&#26512;&#36807;&#20102;&#65292;&#36825;&#37324;&#23601;&#19981;&#20877;&#36184;&#36848;&#20102;&#12290;
 </p>
</blockquote>
<p>
 &#27492;&#26102;&#20107;&#21153;T2&#24819;&#25554;&#20837;&#19968;&#26465;&#20027;&#38190;&#20540;&#20026;4&#30340;&#32858;&#31751;&#32034;&#24341;&#35760;&#24405;&#65292;&#37027;&#20040;T2&#22312;&#25554;&#20837;&#35760;&#24405;&#21069;&#65292;&#39318;&#20808;&#35201;&#23450;&#20301;&#19968;&#19979;&#20027;&#38190;&#20540;&#20026;4&#30340;&#32858;&#31751;&#32034;&#24341;&#35760;&#24405;&#22312;&#39029;&#38754;&#20013;&#30340;&#20301;&#32622;&#65292;&#21457;&#29616;&#20027;&#38190;&#20540;&#20026;4&#30340;&#19979;&#19968;&#26465;&#35760;&#24405;&#30340;&#20027;&#38190;&#20540;&#26159;8&#65292;&#32780;&#20027;&#38190;&#20540;&#26159;8&#30340;&#32858;&#31751;&#32034;&#24341;&#35760;&#24405;&#24050;&#32463;&#34987;&#28155;&#21152;&#20102;gap&#38145;&#65288;next-key&#38145;&#21253;&#21547;&#20102;&#27491;&#32463;&#35760;&#24405;&#38145;&#21644;gap&#38145;&#65289;&#65292;&#37027;&#20040;&#20107;&#21153;T2&#23601;&#38656;&#35201;&#36827;&#20837;&#38459;&#22622;&#29366;&#24577;&#65292;&#24182;&#29983;&#25104;&#19968;&#20010;&#31867;&#22411;&#20026;
 <code>
  &#25554;&#20837;&#24847;&#21521;&#38145;
 </code>
 &#30340;&#38145;&#32467;&#26500;&#12290;
</p>
<p>
 &#25105;&#20204;&#22312;&#20107;&#21153;T2&#20013;&#25191;&#34892;&#19968;&#19979;INSERT&#35821;&#21477;&#39564;&#35777;&#19968;&#19979;&#65306;
</p>
<pre><code>mysql&gt; BEGIN;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; INSERT INTO hero VALUES(4, 'g&#20851;&#32701;', '&#34560;');

</code></pre>
<p>
 &#27492;&#26102;T2&#36827;&#20837;&#38459;&#22622;&#29366;&#24577;&#65292;&#25105;&#20204;&#20877;&#20351;&#29992;SHOW ENGINE INNODB STATUS&#30475;&#19968;&#19979;&#21152;&#38145;&#24773;&#20917;&#65306;
</p>
<p>
 <img alt="" src="EPUB/4e61d768-13d6-11ed-838d-acde48001122">
</p>
<p>
 &#21487;&#35265;T2&#23545;&#20027;&#38190;&#20540;&#20026;8&#30340;&#32858;&#31751;&#32034;&#24341;&#35760;&#24405;&#21152;&#20102;&#19968;&#20010;
 <code>
  &#25554;&#20837;&#24847;&#21521;&#38145;
 </code>
 &#65288;&#23601;&#26159;&#31661;&#22836;&#22788;&#25351;&#21521;&#30340;lock_mode X locks gap before rec insert intention&#65289;&#65292;&#24182;&#19988;&#22788;&#22312;waiting&#29366;&#24577;&#12290;
</p>
<p>
 &#22909;&#20102;&#65292;&#39564;&#35777;&#36807;&#20043;&#21518;&#65292;&#25105;&#20204;&#20877;&#26469;&#30475;&#30475;&#20195;&#30721;&#37324;&#26159;&#22914;&#20309;&#23454;&#29616;&#30340;&#65306;
</p>
<p>
 <img alt="" src="EPUB/4e7be018-13d6-11ed-838d-acde48001122">
</p>
<p>
 <code>
  lock_rec_insert_check_and_lock
 </code>
 &#20989;&#25968;&#29992;&#20110;&#30475;&#19968;&#19979;&#21035;&#30340;&#20107;&#21153;&#26159;&#21542;&#38459;&#27490;&#26412;&#27425;INSERT&#25554;&#20837;&#65292;&#22914;&#26524;&#26159;&#65292;&#37027;&#20040;&#26412;&#20107;&#21153;&#23601;&#32473;&#34987;&#21035;&#30340;&#20107;&#21153;&#28155;&#21152;&#20102;gap&#38145;&#30340;&#35760;&#24405;&#29983;&#25104;&#19968;&#20010;
 <code>
  &#25554;&#20837;&#24847;&#21521;&#38145;
 </code>
 &#65292;&#20855;&#20307;&#36807;&#31243;&#22914;&#19979;&#65306;
</p>
<p>
 <img alt="" src="EPUB/4e8cb528-13d6-11ed-838d-acde48001122">
</p>
<blockquote>
 <p>
  &#23567;&#36148;&#22763;&#65306;
  <br>
  <br>
  lock_rec_other_has_conflicting&#20989;&#25968;&#29992;&#20110;&#26816;&#27979;&#26412;&#27425;&#35201;&#33719;&#21462;&#30340;&#38145;&#21644;&#35760;&#24405;&#19978;&#24050;&#26377;&#30340;&#38145;&#26159;&#21542;&#26377;&#20914;&#31361;&#65292;&#26377;&#20852;&#36259;&#30340;&#21516;&#23398;&#21487;&#20197;&#30475;&#19968;&#19979;&#12290;
 </p>
</blockquote>
<h3>
 2. &#36935;&#21040;&#37325;&#22797;&#38190;&#26102;
</h3>
<p>
 &#22914;&#26524;&#22312;&#25554;&#20837;&#26032;&#35760;&#24405;&#26102;&#65292;&#21457;&#29616;&#39029;&#38754;&#20013;&#24050;&#26377;&#30340;&#35760;&#24405;&#30340;&#20027;&#38190;&#25110;&#32773;&#21807;&#19968;&#20108;&#32423;&#32034;&#24341;&#21015;&#19982;&#24453;&#25554;&#20837;&#35760;&#24405;&#30340;&#20027;&#38190;&#25110;&#32773;&#21807;&#19968;&#20108;&#32423;&#32034;&#24341;&#21015;&#20540;&#30456;&#21516;&#65288;&#19981;&#36807;&#21487;&#20197;&#26377;&#22810;&#26465;&#35760;&#24405;&#30340;&#21807;&#19968;&#20108;&#32423;&#32034;&#24341;&#21015;&#30340;&#20540;&#21516;&#26102;&#20026;NULL&#65292;&#36825;&#37324;&#19981;&#32771;&#34385;&#36825;&#31181;&#24773;&#20917;&#20102;&#65289;&#65292;&#27492;&#26102;&#25554;&#20837;&#26032;&#35760;&#24405;&#30340;&#20107;&#21153;&#20250;&#33719;&#21462;&#39029;&#38754;&#20013;&#24050;&#23384;&#22312;&#30340;&#38190;&#20540;&#30456;&#21516;&#30340;&#35760;&#24405;&#30340;&#38145;&#12290;
</p>
<p>
 &#22914;&#26524;&#26159;&#20027;&#38190;&#20540;&#37325;&#22797;&#65292;&#37027;&#20040;&#65306;
</p>
<ul>
 <li>
  &#24403;&#38548;&#31163;&#32423;&#21035;&#19981;&#22823;&#20110;RC&#26102;&#65292;&#25554;&#20837;&#26032;&#35760;&#24405;&#30340;&#20107;&#21153;&#20250;&#32473;&#24050;&#23384;&#22312;&#30340;&#20027;&#38190;&#20540;&#37325;&#22797;&#30340;&#32858;&#31751;&#32034;&#24341;&#35760;&#24405;&#28155;&#21152;S&#22411;&#27491;&#32463;&#35760;&#24405;&#38145;&#12290;
 </li>
 <li>
  &#24403;&#38548;&#31163;&#32423;&#21035;&#19981;&#23567;&#20110;RR&#26102;&#65292;&#25554;&#20837;&#26032;&#35760;&#24405;&#30340;&#20107;&#21153;&#20250;&#32473;&#24050;&#23384;&#22312;&#30340;&#20027;&#38190;&#20540;&#37325;&#22797;&#30340;&#32858;&#31751;&#32034;&#24341;&#35760;&#24405;&#28155;&#21152;S&#22411;next-key&#38145;&#12290;
 </li>
</ul>
<p>
 &#22914;&#26524;&#26159;&#21807;&#19968;&#20108;&#32423;&#32034;&#24341;&#21015;&#37325;&#22797;&#65292;&#37027;
 <strong>
  &#19981;&#35770;&#26159;&#21738;&#20010;&#38548;&#31163;&#32423;&#21035;&#65292;&#25554;&#20837;&#26032;&#35760;&#24405;&#30340;&#20107;&#21153;&#37117;&#20250;&#32473;&#24050;&#23384;&#22312;&#30340;&#20108;&#32423;&#32034;&#24341;&#21015;&#20540;&#37325;&#22797;&#30340;&#20108;&#32423;&#32034;&#24341;&#35760;&#24405;&#28155;&#21152;S&#22411;next-key&#38145;
 </strong>
 &#65292;&#20877;&#24378;&#35843;&#19968;&#36941;&#65292;&#21152;&#30340;&#26159;next-key&#38145;&#65281;&#21152;&#30340;&#26159;next-key&#38145;&#65281;&#21152;&#30340;&#26159;next-key&#38145;&#65281;&#36825;&#26159;rc&#38548;&#31163;&#32423;&#21035;&#20013;&#20026;&#25968;&#19981;&#22810;&#30340;&#32473;&#35760;&#24405;&#28155;&#21152;gap&#38145;&#30340;&#22330;&#26223;&#12290;
</p>
<blockquote>
 <p>
  &#23567;&#36148;&#22763;&#65306;
  <br>
  <br>
  &#26412;&#26469;&#35774;&#35745;InnoDB&#30340;&#22823;&#21460;&#24182;&#19981;&#24819;&#22312;RC&#38548;&#31163;&#32423;&#21035;&#24341;&#20837;gap&#38145;&#65292;&#20294;&#26159;&#30001;&#20110;&#26576;&#20123;&#21407;&#22240;&#65292;&#22914;&#26524;&#19981;&#28155;&#21152;gap&#38145;&#30340;&#35805;&#65292;&#20250;&#35753;&#21807;&#19968;&#20108;&#32423;&#32034;&#24341;&#20013;&#20986;&#29616;&#22810;&#26465;&#21807;&#19968;&#20108;&#32423;&#32034;&#24341;&#21015;&#20540;&#30456;&#21516;&#30340;&#35760;&#24405;&#65292;&#36825;&#23601;&#36829;&#32972;&#20102;UNIQUE&#32422;&#26463;&#12290;&#25152;&#20197;&#21518;&#26469;&#35774;&#35745;InnoDB&#30340;&#22823;&#21460;&#23601;&#24456;&#19981;&#24773;&#24895;&#30340;&#22312;RC&#38548;&#31163;&#32423;&#21035;&#20063;&#24341;&#20837;&#20102;gap&#38145;&#12290;
 </p>
</blockquote>
<p>
 &#25105;&#20204;&#20063;&#26469;&#20570;&#19968;&#20010;&#23454;&#39564;&#65292;&#29616;&#22312;&#20551;&#35774;&#19978;&#36793;&#30340;T1&#21644;T2&#37117;&#22238;&#28378;&#20102;&#65292;&#29616;&#22312;&#23558;&#38548;&#31163;&#32423;&#21035;&#35843;&#33267;RC&#65292;&#37325;&#26032;&#24320;&#21551;&#20107;&#21153;&#36827;&#34892;&#27979;&#35797;&#12290;
</p>
<pre><code>mysql&gt; SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;
Query OK, 0 rows affected (0.01 sec)

# &#20107;&#21153;T1
mysql&gt; BEGIN;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; INSERT INTO hero VALUES(30, 'x&#33600;&#24423;', '&#39759;');
ERROR 1062 (23000): Duplicate entry 'x&#33600;&#24423;' for key 'uk_name'
</code></pre>
<p>
 &#28982;&#21518;&#25191;&#34892;SHOW ENGINE INNODB STATUS&#35821;&#21477;&#30475;&#19968;&#19979;T1&#21152;&#20102;&#20160;&#20040;&#38145;&#65306;
</p>
<p>
 <img alt="" src="EPUB/4e981332-13d6-11ed-838d-acde48001122">
</p>
<p>
 &#21487;&#20197;&#30475;&#21040;&#21363;&#20351;&#29616;&#22312;T1&#30340;&#38548;&#31163;&#32423;&#21035;&#20026;RC&#65292;T1&#20173;&#28982;&#32473;name&#21015;&#20540;&#20026;'x&#33600;&#24423;'&#30340;&#20108;&#32423;&#32034;&#24341;&#35760;&#24405;&#28155;&#21152;&#20102;S&#22411;next-key&#38145;&#65288;&#22270;&#20013;&#32418;&#26694;&#20013;&#30340;lock mode S&#65289;&#12290;
</p>
<p>
 &#22914;&#26524;&#25105;&#20204;&#30340;INSERT&#35821;&#21477;&#36824;&#24102;&#26377;
 <code>
  ON DUPLICATE KEY...
 </code>
 &#36825;&#26679;&#30340;&#23376;&#21477;&#65292;&#22914;&#26524;&#36935;&#21040;&#20027;&#38190;&#20540;&#25110;&#32773;&#21807;&#19968;&#20108;&#32423;&#32034;&#24341;&#21015;&#20540;&#37325;&#22797;&#30340;&#24773;&#20917;&#65292;&#20250;&#23545;B+&#26641;&#20013;&#24050;&#23384;&#22312;&#30340;&#30456;&#21516;&#38190;&#20540;&#30340;&#35760;&#24405;&#21152;X&#22411;&#38145;&#65292;&#32780;&#19981;&#26159;S&#22411;&#38145;&#65288;&#19981;&#36807;&#20855;&#20307;&#38145;&#30340;&#20855;&#20307;&#31867;&#22411;&#26159;&#21644;&#21069;&#38754;&#25551;&#36848;&#19968;&#26679;&#30340;&#65289;&#12290;
</p>
<p>
 &#22909;&#20102;&#65292;&#21448;&#21040;&#20102;&#30475;&#20195;&#30721;&#27714;&#35777;&#26102;&#38388;&#20102;&#65292;&#25105;&#20204;&#30475;&#19968;&#19979;&#21543;&#65306;
</p>
<p>
 <img alt="" src="EPUB/4ea48464-13d6-11ed-838d-acde48001122">
</p>
<p>
 <code>
  row_ins_scan_sec_index_for_duplicate
 </code>
 &#26159;&#26816;&#27979;&#21807;&#19968;&#20108;&#32423;&#32034;&#24341;&#21015;&#20540;&#26159;&#21542;&#37325;&#22797;&#30340;&#20989;&#25968;&#65292;&#20855;&#20307;&#21152;&#38145;&#30340;&#20195;&#30721;&#22914;&#19979;&#25152;&#31034;&#65306;
</p>
<p>
 <img alt="" src="EPUB/4ec38832-13d6-11ed-838d-acde48001122">
</p>
<p>
 &#22914;&#19978;&#22270;&#25152;&#31034;&#65292;&#22312;&#36935;&#21040;&#21807;&#19968;&#20108;&#32423;&#32034;&#24341;&#21015;&#37325;&#22797;&#30340;&#24773;&#20917;&#26102;&#65306;
</p>
<ul>
 <li>
  1&#21495;&#32418;&#26694;&#34920;&#31034;&#23545;&#24102;&#26377;
  <code>
   ON DUPLICATE ...
  </code>
  &#23376;&#21477;&#26102;&#30340;&#22788;&#29702;&#26041;&#26696;&#65292;&#20855;&#20307;&#23601;&#26159;&#28155;&#21152;X&#22411;&#38145;&#12290;
 </li>
 <li>
  2&#21495;&#32418;&#26694;&#34920;&#31034;&#23545;&#27491;&#24120;INSERT&#35821;&#21477;&#30340;&#22788;&#29702;&#26041;&#26696;&#65292;&#20855;&#20307;&#23601;&#26159;&#28155;&#21152;S&#22411;&#38145;&#12290;
 </li>
</ul>
<p>
 &#19981;&#36807;&#19981;&#35770;&#26159;&#37027;&#31181;&#24773;&#20917;&#65292;&#28155;&#21152;&#30340;lock_typed&#30340;&#20540;&#37117;&#26159;
 <code>
  LOCK_ORDINARY
 </code>
 &#65292;&#34920;&#31034;next-key&#38145;&#12290;
</p>
<p>
 &#22312;&#20027;&#38190;&#37325;&#22797;&#26102;INSERT&#35821;&#21477;&#30340;&#21152;&#38145;&#20195;&#30721;&#25105;&#20204;&#23601;&#19981;&#21015;&#20030;&#20102;&#12290;
</p>
<h3>
 3. &#22806;&#38190;&#26816;&#26597;&#26102;
</h3>
<p>
 &#24403;&#25105;&#20204;&#21521;&#23376;&#34920;&#20013;&#25554;&#20837;&#35760;&#24405;&#26102;&#65292;&#25105;&#20204;&#20998;&#20004;&#31181;&#24773;&#20917;&#35752;&#35770;&#65306;
</p>
<ul>
 <li>
  <p>
   &#24403;&#23376;&#34920;&#20013;&#30340;&#22806;&#38190;&#20540;&#21487;&#20197;&#22312;&#29238;&#34920;&#20013;&#25214;&#21040;&#26102;&#65292;&#37027;&#20040;&#26080;&#35770;&#24403;&#21069;&#20107;&#21153;&#26159;&#20160;&#20040;&#38548;&#31163;&#32423;&#21035;&#65292;&#21482;&#38656;&#35201;&#32473;&#29238;&#34920;&#20013;&#23545;&#24212;&#30340;&#35760;&#24405;&#28155;&#21152;&#19968;&#20010;
   <code>
    S&#22411;&#27491;&#32463;&#35760;&#24405;&#38145;
   </code>
   &#23601;&#22909;&#20102;&#12290;
  </p>
 </li>
 <li>
  <p>
   &#24403;&#23376;&#34920;&#20013;&#30340;&#22806;&#38190;&#20540;&#22312;&#29238;&#34920;&#20013;&#25214;&#19981;&#21040;&#26102;&#65306;&#37027;&#20040;&#22914;&#26524;&#24403;&#21069;&#38548;&#31163;&#32423;&#21035;&#19981;&#22823;&#20110;RC&#26102;&#65292;&#19981;&#23545;&#29238;&#34920;&#35760;&#24405;&#21152;&#38145;&#65307;&#24403;&#38548;&#31163;&#32423;&#21035;&#19981;&#23567;&#20110;RR&#26102;&#65292;&#23545;&#29238;&#34920;&#20013;&#35813;&#22806;&#38190;&#20540;&#25152;&#22312;&#20301;&#32622;&#30340;&#19979;&#19968;&#26465;&#35760;&#24405;&#28155;&#21152;gap&#38145;&#12290;
  </p>
 </li>
</ul>
<p>
 &#30001;&#20110;&#22806;&#38190;&#19981;&#22826;&#24120;&#29992;&#65292;&#20363;&#23376;&#21644;&#20195;&#30721;&#23601;&#37117;&#19981;&#20030;&#20363;&#20102;&#65292;&#26377;&#20852;&#36259;&#30340;&#23567;&#20249;&#20276;&#21487;&#20197;&#25171;&#24320;&#12298;MySQL&#26159;&#24590;&#26679;&#36816;&#34892;&#30340;&#65306;&#20174;&#26681;&#20799;&#19978;&#29702;&#35299;MySQL&#12299;&#26597;&#30475;&#20363;&#23376;&#12290;
</p>
<h2>
 &#27515;&#38145;&#35201;&#20986;&#22330;&#20102;
</h2>
<p>
 &#22909;&#20102;&#65292;&#22522;&#30784;&#30693;&#35782;&#39044;&#20064;&#23436;&#20102;&#65292;&#35813;&#27515;&#38145;&#20986;&#22330;&#20102;&#12290;
</p>
<p>
 &#30475;&#19979;&#36793;&#36825;&#20010;&#24179;&#24179;&#26080;&#22855;&#30340;INSERT&#35821;&#21477;&#65306;
</p>
<pre><code>INSERT INTO hero(name, country) VALUES('g&#20851;&#32701;', '&#34560;'), ('d&#37011;&#33406;', '&#39759;');
</code></pre>
<p>
 &#36825;&#20010;&#35821;&#21477;&#29992;&#26469;&#25554;&#20837;&#20004;&#26465;&#35760;&#24405;&#65292;&#19981;&#35770;&#26159;&#22312;RC&#65292;&#36824;&#26159;RR&#38548;&#31163;&#32423;&#21035;&#65292;&#22914;&#26524;&#20004;&#20010;&#20107;&#21153;&#24182;&#21457;&#25191;&#34892;&#23427;&#20204;&#26159;&#26377;&#19968;&#23450;&#20960;&#29575;&#35302;&#21457;&#27515;&#38145;&#30340;&#12290;&#20026;&#20102;&#31283;&#23450;&#22797;&#29616;&#36825;&#20010;&#27515;&#38145;&#65292;&#25105;&#20204;&#25226;&#19978;&#36793;&#19968;&#26465;&#35821;&#21477;&#25286;&#20998;&#25104;&#20004;&#26465;&#35821;&#21477;&#65306;
</p>
<pre><code>INSERT INTO hero(name, country) VALUES('g&#20851;&#32701;', '&#34560;');
INSERT INTO hero(name, country) VALUES('d&#37011;&#33406;', '&#39759;');
</code></pre>
<p>
 &#25286;&#20998;&#21069;&#21644;&#25286;&#20998;&#21518;&#36215;&#21040;&#30340;&#20316;&#29992;&#26159;&#30456;&#21516;&#30340;&#65292;&#21482;&#19981;&#36807;&#25286;&#20998;&#21518;&#25105;&#20204;&#21487;&#20197;&#20154;&#20026;&#30340;&#25511;&#21046;&#25554;&#20837;&#35760;&#24405;&#30340;&#26102;&#26426;&#12290;&#22914;&#26524;T1&#21644;T2&#30340;&#25191;&#34892;&#39034;&#24207;&#26159;&#36825;&#26679;&#30340;&#65306;
</p>
<p>
 <img alt="" src="EPUB/4ed1fcbe-13d6-11ed-838d-acde48001122">
</p>
<p>
 &#20063;&#23601;&#26159;&#65306;
</p>
<ul>
 <li>
  T1&#20808;&#25554;&#20837;name&#20540;&#20026;
  <code>
   g&#20851;&#32701;
  </code>
  &#30340;&#35760;&#24405;&#65292;&#21487;&#20197;&#25554;&#20837;&#25104;&#21151;&#65292;&#27492;&#26102;&#23545;&#24212;&#30340;&#21807;&#19968;&#20108;&#32423;&#32034;&#24341;&#35760;&#24405;&#34987;
  <code>
   &#38544;&#24335;&#38145;
  </code>
  &#20445;&#25252;&#65292;&#25105;&#20204;&#25191;&#34892;SHOW ENGINE INNODB STATUS&#35821;&#21477;&#65292;&#21457;&#29616;&#21861;&#19968;&#20010;&#34892;&#38145;&#65288;row lock&#65289;&#37117;&#27809;&#26377;&#65288;&#22240;&#20026;SHOW ENGINE INNODB STATUS&#19981;&#26174;&#31034;&#38544;&#24335;&#38145;&#65289;&#65306;
 </li>
</ul>
<p>
 <img alt="" src="EPUB/4f775b82-13d6-11ed-838d-acde48001122">
</p>
<ul>
 <li>
  &#25509;&#30528;T2&#20063;&#25554;&#20837;name&#20540;&#20026;
  <code>
   g&#20851;&#32701;
  </code>
  &#30340;&#35760;&#24405;&#12290;&#30001;&#20110;T1&#24050;&#32463;&#25554;&#20837;name&#20540;&#20026;
  <code>
   g&#20851;&#32701;
  </code>
  &#30340;&#35760;&#24405;&#65292;&#25152;&#20197;T2&#22312;&#25554;&#20837;&#20108;&#32423;&#32034;&#24341;&#35760;&#24405;&#26102;&#20250;&#36935;&#21040;&#37325;&#22797;&#30340;&#21807;&#19968;&#20108;&#32423;&#32034;&#24341;&#21015;&#20540;&#65292;&#27492;&#26102;T2&#24819;&#33719;&#21462;&#19968;&#20010;S&#22411;next-key&#38145;&#65292;&#20294;&#26159;T1&#24182;&#26410;&#25552;&#20132;&#65292;T1&#25554;&#20837;&#30340;name&#20540;&#20026;
  <code>
   g&#20851;&#32701;
  </code>
  &#30340;&#35760;&#24405;&#19978;&#30340;&#38544;&#24335;&#38145;&#30456;&#24403;&#20110;&#19968;&#20010;X&#22411;&#27491;&#32463;&#35760;&#24405;&#38145;&#65288;RC&#38548;&#31163;&#32423;&#21035;&#65289;&#65292;&#25152;&#20197;T2&#21521;&#33719;&#21462;S&#22411;next-key&#38145;&#26102;&#20250;&#36935;&#21040;&#38145;&#20914;&#31361;&#65292;T2&#36827;&#20837;&#38459;&#22622;&#29366;&#24577;&#65292;&#24182;&#19988;&#23558;T1&#30340;&#38544;&#24335;&#38145;&#36716;&#25442;&#20026;&#26174;&#24335;&#38145;&#65288;&#23601;&#26159;&#24110;&#21161;T1&#29983;&#25104;&#19968;&#20010;&#27491;&#32463;&#35760;&#24405;&#38145;&#30340;&#38145;&#32467;&#26500;&#65289;&#12290;&#36825;&#26102;&#25105;&#20204;&#20877;&#25191;&#34892;SHOW ENGINE INNODB STATUS&#35821;&#21477;&#65306;
 </li>
</ul>
<p>
 <img alt="" src="EPUB/4f817040-13d6-11ed-838d-acde48001122">
</p>
<p>
 &#21487;&#35265;&#65292;T1&#25345;&#26377;&#30340;name&#20540;&#20026;
 <code>
  g&#20851;&#32701;
 </code>
 &#30340;&#38544;&#24335;&#38145;&#24050;&#32463;&#34987;&#36716;&#25442;&#20026;&#26174;&#24335;&#38145;&#65288;X&#22411;&#27491;&#32463;&#35760;&#24405;&#38145;&#65292;lock_mode X locks rec but not gap&#65289;&#65307;T2&#27491;&#22312;&#31561;&#24453;&#33719;&#21462;&#19968;&#20010;S&#22411;next-key&#38145;&#65288;lock mode S waiting&#65289;&#12290;
</p>
<ul>
 <li>
  &#25509;&#30528;T1&#20877;&#25554;&#20837;&#19968;&#26465;name&#20540;&#20026;
  <code>
   d&#37011;&#33406;
  </code>
  &#30340;&#35760;&#24405;&#12290;&#22312;&#25554;&#20837;&#19968;&#26465;&#35760;&#24405;&#26102;&#65292;&#20250;&#22312;&#39029;&#38754;&#20013;&#20808;&#23450;&#20301;&#21040;&#36825;&#26465;&#35760;&#24405;&#30340;&#20301;&#32622;&#12290;&#22312;&#25554;&#20837;name&#20540;&#20026;
  <code>
   d&#37011;&#33406;
  </code>
  &#30340;&#20108;&#32423;&#32034;&#24341;&#35760;&#24405;&#26102;&#65292;&#21457;&#29616;&#29616;&#22312;&#39029;&#38754;&#20013;&#30340;&#35760;&#24405;&#20998;&#24067;&#24773;&#20917;&#22914;&#19979;&#25152;&#31034;&#65306;
 </li>
</ul>
<p>
 <img alt="" src="EPUB/4f92554a-13d6-11ed-838d-acde48001122">
</p>
<p>
 &#24456;&#26174;&#28982;&#65292;name&#20540;&#20026;
 <code>
  'd&#37011;&#33406;'
 </code>
 &#30340;&#20108;&#32423;&#32034;&#24341;&#35760;&#24405;&#25152;&#22312;&#20301;&#32622;&#30340;&#19979;&#19968;&#26465;&#20108;&#32423;&#32034;&#24341;&#35760;&#24405;&#30340;name&#20540;&#24212;&#35813;&#26159;
 <code>
  'g&#20851;&#32701;'
 </code>
 &#65288;&#25353;&#29031;&#27721;&#35821;&#25340;&#38899;&#25490;&#24207;&#65289;&#12290;&#37027;&#20040;&#22312;T1&#25554;&#20837;name&#20540;&#20026;
 <code>
  d&#37011;&#33406;
 </code>
 &#30340;&#20108;&#32423;&#32034;&#24341;&#35760;&#24405;&#26102;&#65292;&#23601;&#38656;&#35201;&#30475;&#19968;&#19979;name&#20540;&#20026;
 <code>
  'g&#20851;&#32701;'
 </code>
 &#30340;&#20108;&#32423;&#32034;&#24341;&#35760;&#24405;&#19978;&#26377;&#27809;&#26377;&#34987;&#21035;&#30340;&#20107;&#21153;&#21152;gap&#38145;&#12290;
</p>
<p>
 &#26377;&#21516;&#23398;&#24819;&#35828;&#65306;&#30446;&#21069;&#21482;&#26377;T2&#24819;&#22312;name&#20540;&#20026;
 <code>
  'g&#20851;&#32701;'
 </code>
 &#30340;&#20108;&#32423;&#32034;&#24341;&#35760;&#24405;&#19978;&#28155;&#21152;
 <code>
  S&#22411;next-key&#38145;
 </code>
 &#65288;next-key&#38145;&#21253;&#21547;gap&#38145;&#65289;&#65292;&#20294;&#26159;T2&#24182;&#27809;&#26377;&#33719;&#21462;&#21040;&#38145;&#21568;&#65292;&#30446;&#21069;&#27491;&#22312;&#31561;&#24453;&#29366;&#24577;&#12290;&#37027;&#20040;T1&#19981;&#26159;&#33021;&#39034;&#21033;&#25554;&#20837;name&#20540;&#20026;
 <code>
  'g&#20851;&#32701;'
 </code>
 &#30340;&#20108;&#32423;&#32034;&#24341;&#35760;&#24405;&#20040;&#65311;
</p>
<p>
 &#25105;&#20204;&#30475;&#19968;&#19979;&#25191;&#34892;&#32467;&#26524;&#65306;
</p>
<pre><code># &#20107;&#21153;T2
mysql&gt; INSERT INTO hero(name, country) VALUES('g&#20851;&#32701;', '&#34560;');
ERROR 1213 (40001): Deadlock found when trying to get lock; try restarting transaction
</code></pre>
<p>
 &#24456;&#26174;&#28982;&#65292;&#35302;&#21457;&#20102;&#19968;&#20010;&#27515;&#38145;&#65292;T2&#34987;InnoDB&#22238;&#28378;&#20102;&#12290;
</p>
<p>
 &#36825;&#26159;&#20026;&#21861;&#21602;&#65311;T2&#26126;&#26126;&#27809;&#26377;&#33719;&#21462;&#21040;name&#20540;&#20026;
 <code>
  'g&#20851;&#32701;'
 </code>
 &#30340;&#20108;&#32423;&#32034;&#24341;&#35760;&#24405;&#19978;&#30340;
 <code>
  S&#22411;next-key&#38145;
 </code>
 &#65292;&#20026;&#21861;T1&#36824;&#19981;&#33021;&#25554;&#20837;&#20837;name&#20540;&#20026;
 <code>
  d&#37011;&#33406;
 </code>
 &#30340;&#20108;&#32423;&#32034;&#24341;&#35760;&#24405;&#21602;&#65311;
</p>
<p>
 &#36825;&#25105;&#20204;&#36824;&#24471;&#22238;&#21040;&#20195;&#30721;&#19978;&#26469;&#65292;&#30475;&#19968;&#19979;&#25554;&#20837;&#26032;&#35760;&#24405;&#26102;&#26159;&#22914;&#20309;&#21028;&#26029;&#38145;&#26159;&#21542;&#20914;&#31361;&#30340;&#65306;
</p>
<p>
 <img alt="" src="EPUB/4f9c031a-13d6-11ed-838d-acde48001122">
</p>
<p>
 &#30475;&#19968;&#19979;&#30011;&#32418;&#26694;&#30340;&#27880;&#37322;&#65292;&#24847;&#24605;&#26159;&#65306;&#21482;&#35201;&#21035;&#30340;&#20107;&#21153;&#29983;&#25104;&#20102;&#19968;&#20010;&#26174;&#24335;&#30340;gap&#38145;&#30340;&#38145;&#32467;&#26500;&#65292;&#19981;&#35770;&#37027;&#20010;&#20107;&#21153;&#24050;&#32463;&#33719;&#21462;&#21040;&#20102;&#35813;&#38145;(granted)&#65292;&#36824;&#26159;&#27491;&#22312;&#31561;&#24453;&#33719;&#21462;&#65288;waiting&#65289;&#65292;&#24403;&#21069;&#20107;&#21153;&#30340;INSERT&#25805;&#20316;&#37117;&#24212;&#35813;&#34987;&#38459;&#22622;&#12290;
</p>
<p>
 &#22238;&#21040;&#25105;&#20204;&#30340;&#20363;&#23376;&#20013;&#26469;&#65292;&#23601;&#26159;T2&#24050;&#32463;&#22312;name&#20540;&#20026;
 <code>
  'g&#20851;&#32701;'
 </code>
 &#30340;&#20108;&#32423;&#32034;&#24341;&#35760;&#24405;&#19978;&#29983;&#25104;&#20102;&#19968;&#20010;S&#22411;next-key&#38145;&#30340;&#38145;&#32467;&#26500;&#65292;&#34429;&#28982;T2&#27491;&#22312;&#38459;&#22622;&#65288;&#23578;&#26410;&#33719;&#21462;&#38145;&#65289;&#65292;&#20294;&#26159;T1&#20173;&#28982;&#19981;&#33021;&#25554;&#20837;name&#20540;&#20026;
 <code>
  d&#37011;&#33406;
 </code>
 &#30340;&#20108;&#32423;&#32034;&#24341;&#35760;&#24405;&#12290;
</p>
<p>
 &#36825;&#26679;&#20063;&#23601;&#35299;&#37322;&#20102;&#27515;&#38145;&#20135;&#29983;&#30340;&#21407;&#22240;&#65306;
</p>
<ul>
 <li>
  T1&#22312;&#31561;&#24453;T2&#37322;&#25918;name&#20540;&#20026;
  <code>
   'g&#20851;&#32701;'
  </code>
  &#30340;&#20108;&#32423;&#32034;&#24341;&#35760;&#24405;&#19978;&#30340;gap&#38145;&#12290;
 </li>
 <li>
  T2&#22312;&#31561;&#24453;T1&#37322;&#25918;name&#20540;&#20026;
  <code>
   'g&#20851;&#32701;'
  </code>
  &#30340;&#20108;&#32423;&#32034;&#24341;&#35760;&#24405;&#19978;&#30340;X&#22411;&#27491;&#32463;&#35760;&#24405;&#38145;&#12290;
 </li>
</ul>
<p>
 &#20004;&#20010;&#20107;&#21153;&#30456;&#20114;&#31561;&#24453;&#23545;&#26041;&#37322;&#25918;&#38145;&#65292;&#36825;&#26679;&#27515;&#38145;&#20063;&#23601;&#20135;&#29983;&#20102;&#12290;
</p>
<h2>
 &#24590;&#20040;&#35299;&#20915;&#36825;&#20010;&#27515;&#38145;&#38382;&#39064;&#65311;
</h2>
<p>
 &#20004;&#20010;&#26041;&#26696;&#65306;
</p>
<ul>
 <li>
  &#26041;&#26696;&#19968;&#65306;&#19968;&#20010;&#20107;&#21153;&#20013;&#21482;&#25554;&#20837;&#19968;&#26465;&#35760;&#24405;&#12290;
 </li>
 <li>
  &#26041;&#26696;&#20108;&#65306;&#20808;&#25554;&#20837;name&#20540;&#20026;
  <code>
   'd&#37011;&#33406;'
  </code>
  &#30340;&#35760;&#24405;&#65292;&#20877;&#25554;&#20837;name&#20540;&#20026;
  <code>
   'g&#20851;&#32701;'
  </code>
  &#30340;&#35760;&#24405;
 </li>
</ul>
<p>
 &#20026;&#21861;&#36825;&#20004;&#20010;&#26041;&#26696;&#21487;&#34892;&#65311;&#23631;&#24149;&#21069;&#30340;&#22823;&#33041;&#29916;&#26159;&#19981;&#26159;&#20063;&#35813;&#36716;&#19968;&#19979;&#20998;&#26512;&#19968;&#27874;&#21591;~
</p>
</div>

</div>
</div>

        </body>
        
        